!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["3Dmol"]=t():e["3Dmol"]=t()}(this,()=>(()=>{var __webpack_modules__={"./node_modules/iobuffer/lib-esm/IOBuffer.js":(e,t,r)=>{r.r(t),r.d(t,{IOBuffer:()=>o});var i=r("./node_modules/iobuffer/lib-esm/text.js");const n=(()=>{var e=new Uint8Array(4);const t=new Uint32Array(e.buffer);return!((t[0]=1)&e[0])})(),a={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class o{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(e=8192,t={}){let r=!1;"number"==typeof e?e=new ArrayBuffer(e):(r=!0,this.lastWrittenByte=e.byteLength);var t=t.offset?t.offset>>>0:0,i=e.byteLength-t;let s=t;(ArrayBuffer.isView(e)||e instanceof o)&&(e.byteLength!==e.buffer.byteLength&&(s=e.byteOffset+t),e=e.buffer),r?this.lastWrittenByte=i:this.lastWrittenByte=0,this.buffer=e,this.length=i,this.byteLength=i,this.byteOffset=s,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,s,i),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){var e=this._marks.pop();if(void 0===e)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){e=2*(this.offset+e);const t=new Uint8Array(e);t.set(new Uint8Array(this.buffer)),this.buffer=t.buffer,this.length=e,this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){var e=a[t].BYTES_PER_ELEMENT*e,r=this.byteOffset+this.offset;const i=this.buffer.slice(r,r+e);if(this.littleEndian===n&&"uint8"!==t&&"int8"!==t){const i=new Uint8Array(this.buffer.slice(r,r+e)),s=(i.reverse(),new a[t](i.buffer));return this.offset+=e,s.reverse(),s}const s=new a[t](i);return this.offset+=e,s}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){var e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){var e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let r="";for(let e=0;e<t;e++)r+=this.readChar();return r}readUtf8(e=1){return(0,i.decode)(this.readBytes(e))}decodeText(e=1,t="utf8"){return(0,i.decode)(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(e){return this.writeBytes((0,i.encode)(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}},"./node_modules/iobuffer/lib-esm/text.js":(e,t,r)=>{r.r(t),r.d(t,{decode:()=>function(e,t="utf8"){const r=new TextDecoder(t);return r.decode(e)},encode:()=>function(e){return i.encode(e)}});const i=new TextEncoder},"./node_modules/netcdfjs/lib-esm/data.js":(e,t,r)=>{r.r(t),r.d(t,{nonRecord:()=>function(t,e){const r=(0,h.str2num)(e.type),i=e.size/(0,h.num2bytes)(r),s=new Array(i);for(let e=0;e<i;e++)s[e]=(0,h.readType)(t,r,1);return s},record:()=>function(t,e,r){const i=(0,h.str2num)(e.type),s=e.size?e.size/(0,h.num2bytes)(i):1,n=r.length,a=new Array(n),o=r.recordStep;{if(!o)throw new Error("recordDimension.recordStep is undefined");for(let e=0;e<n;e++){var l=t.offset;a[e]=(0,h.readType)(t,i,s),t.seek(l+o)}}return a}});var h=r("./node_modules/netcdfjs/lib-esm/types.js")},"./node_modules/netcdfjs/lib-esm/header.js":(e,t,r)=>{r.r(t),r.d(t,{header:()=>function(e,t){const r={version:t},i={length:e.readUint32()},s=function(t){const e={};let r,i;var s=t.readUint32();let n;{if(s===g)return(0,m.notNetcdf)(t.readUint32()!==g,"wrong empty tag for list of dimensions"),[];(0,m.notNetcdf)(s!==h,"wrong tag for list of dimensions");var a=t.readUint32();n=new Array(a);for(let e=0;e<a;e++){var o=(0,m.readName)(t),l=t.readUint32();l===c&&(r=e,i=o),n[e]={name:o,size:l}}}void 0!==r&&(e.recordId=r);void 0!==i&&(e.recordName=i);return e.dimensions=n,e}(e);Array.isArray(s)||(i.id=s.recordId,i.name=s.recordName,r.dimensions=s.dimensions);r.globalAttributes=b(e);e=function(i,s,n){var e=i.readUint32();let a=0,o;{if(e===g)return(0,m.notNetcdf)(i.readUint32()!==g,"wrong empty tag for list of variables"),[];(0,m.notNetcdf)(e!==v,"wrong tag for list of variables");var t=i.readUint32();o=new Array(t);for(let r=0;r<t;r++){var l=(0,m.readName)(i),h=i.readUint32();const p=new Array(h);for(let e=0;e<h;e++)p[e]=i.readUint32();var c=b(i),d=i.readUint32(),u=((0,m.notNetcdf)(d<1&&6<d,"non valid type "+d),i.readUint32());let e=i.readUint32(),t=(2===n&&((0,m.notNetcdf)(0<e,"offsets larger than 4GB not supported"),e=i.readUint32()),!1);void 0!==s&&p[0]===s&&(a+=u,t=!0),o[r]={name:l,dimensions:p,attributes:c,type:(0,f.num2str)(d),size:u,offset:e,record:t}}}return{variables:o,recordStep:a}}(e,i?.id,t);Array.isArray(e)||(r.variables=e.variables,i.recordStep=e.recordStep);return r.recordDimension=i,r}});var f=r("./node_modules/netcdfjs/lib-esm/types.js"),m=r("./node_modules/netcdfjs/lib-esm/utils.js");const g=0,h=10,v=11,o=12,c=0;function b(t){var e=t.readUint32();let r;if(e===g)return(0,m.notNetcdf)(t.readUint32()!==g,"wrong empty tag for list of attributes"),[];(0,m.notNetcdf)(e!==o,"wrong tag for list of attributes");var i=t.readUint32();r=new Array(i);for(let e=0;e<i;e++){var s=(0,m.readName)(t),n=t.readUint32(),a=((0,m.notNetcdf)(n<1||6<n,"non valid type "+n),t.readUint32()),a=(0,f.readType)(t,n,a);(0,m.padding)(t),r[e]={name:s,type:(0,f.num2str)(n),value:a}}return r}},"./node_modules/netcdfjs/lib-esm/index.js":(e,t,r)=>{r.r(t),r.d(t,{NetCDFReader:()=>i.NetCDFReader});var i=r("./node_modules/netcdfjs/lib-esm/parser.js")},"./node_modules/netcdfjs/lib-esm/parser.js":(e,t,r)=>{r.r(t),r.d(t,{NetCDFReader:()=>l});var i=r("./node_modules/iobuffer/lib-esm/IOBuffer.js"),s=r("./node_modules/netcdfjs/lib-esm/data.js"),n=r("./node_modules/netcdfjs/lib-esm/header.js"),a=r("./node_modules/netcdfjs/lib-esm/toString.js"),o=r("./node_modules/netcdfjs/lib-esm/utils.js");class l{constructor(e){this.toString=a.toString;const t=new i.IOBuffer(e);t.setBigEndian(),(0,o.notNetcdf)("CDF"!==t.readChars(3),"should start with CDF");e=t.readByte();(0,o.notNetcdf)(2<e,"unknown version"),this.header=(0,n.header)(t,e),this.buffer=t}get version(){return 1===this.header.version?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}getAttribute(t){var e=this.globalAttributes.find(e=>e.name===t);return e?e.value:null}getDataVariableAsString(e){const t=this.getDataVariable(e);return t?t.join(""):null}get variables(){return this.header.variables}getDataVariable(t){let e;if(void 0===(e="string"==typeof t?this.header.variables.find(e=>e.name===t):t))throw new Error("Not a valid NetCDF v3.x file: variable not found");return this.buffer.seek(e.offset),e.record?(0,s.record)(this.buffer,e,this.header.recordDimension):(0,s.nonRecord)(this.buffer,e)}dataVariableExists(t){return void 0!==this.header.variables.find(e=>e.name===t)}attributeExists(t){return void 0!==this.globalAttributes.find(e=>e.name===t)}}},"./node_modules/netcdfjs/lib-esm/toString.js":(e,t,r)=>{r.r(t),r.d(t,{toString:()=>function(){const t=[];t.push("DIMENSIONS");for(const r of this.dimensions)t.push(`  ${r.name.padEnd(30)} = size: `+r.size);t.push(""),t.push("GLOBAL ATTRIBUTES");for(const i of this.globalAttributes)t.push(`  ${i.name.padEnd(30)} = `+i.value);var e=JSON.parse(JSON.stringify(this.variables));t.push(""),t.push("VARIABLES:");for(const s of e){s.value=this.getDataVariable(s);let e=JSON.stringify(s.value);50<e.length&&(e=e.substring(0,50)),isNaN(s.value.length)||(e+=` (length: ${s.value.length})`),t.push(`  ${s.name.padEnd(30)} = `+e)}return t.join("\n")}})},"./node_modules/netcdfjs/lib-esm/types.js":(e,t,r)=>{r.r(t),r.d(t,{num2bytes:()=>function(e){switch(Number(e)){case i.BYTE:case i.CHAR:return 1;case i.SHORT:return 2;case i.INT:case i.FLOAT:return 4;case i.DOUBLE:return 8;default:return-1}},num2str:()=>function(e){switch(Number(e)){case i.BYTE:return"byte";case i.CHAR:return"char";case i.SHORT:return"short";case i.INT:return"int";case i.FLOAT:return"float";case i.DOUBLE:return"double";default:return"undefined"}},readType:()=>function(e,t,r){switch(t){case i.BYTE:return Array.from(e.readBytes(r));case i.CHAR:return function(e){return 0!==e.charCodeAt(e.length-1)?e:e.substring(0,e.length-1)}(e.readChars(r));case i.SHORT:return s(r,e.readInt16.bind(e));case i.INT:return s(r,e.readInt32.bind(e));case i.FLOAT:return s(r,e.readFloat32.bind(e));case i.DOUBLE:return s(r,e.readFloat64.bind(e));default:throw new Error("non valid type "+t)}},str2num:()=>function(e){switch(String(e)){case"byte":return i.BYTE;case"char":return i.CHAR;case"short":return i.SHORT;case"int":return i.INT;case"float":return i.FLOAT;case"double":return i.DOUBLE;default:return-1}}});const i={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function s(t,r){if(1===t)return r();{const i=new Array(t);for(let e=0;e<t;e++)i[e]=r();return i}}},"./node_modules/netcdfjs/lib-esm/utils.js":(e,t,r)=>{function i(e){e.offset%4!=0&&e.skip(4-e.offset%4)}r.r(t),r.d(t,{notNetcdf:()=>function(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: "+t)},padding:()=>i,readName:()=>function(e){var t=e.readUint32(),t=e.readChars(t);return i(e),t}})},"./node_modules/pako/dist/pako.esm.mjs":(E,e,t)=>{t.r(e),t.d(e,{Deflate:()=>Or,Inflate:()=>Br,constants:()=>Vr,default:()=>Wr,deflate:()=>Rr,deflateRaw:()=>Gr,gzip:()=>Pr,inflate:()=>Ur,inflateRaw:()=>Nr,ungzip:()=>jr});const F=0,D=1;function r(e){let t=e.length;for(;0<=--t;)e[t]=0}const k=29,I=256,O=I+1+k,a=30,R=19,G=2*O+1,g=15,P=16,B=7,U=256,N=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),j=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),V=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);const h=new Array(2*(O+2)),H=(r(h),new Array(2*a)),$=(r(H),new Array(512)),J=(r($),new Array(256)),ee=(r(J),new Array(k)),te=(r(ee),new Array(a));function re(e,t,r,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}r(te);let ie,se,ne;function ae(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const oe=e=>e<256?$[e]:$[256+(e>>>7)],le=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},c=(e,t,r)=>{e.bi_valid>P-r?(e.bi_buf|=t<<e.bi_valid&65535,le(e,e.bi_buf),e.bi_buf=t>>P-e.bi_valid,e.bi_valid+=r-P):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},d=(e,t,r)=>{c(e,r[2*t],r[2*t+1])},he=(e,t)=>{let r=0;for(;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1},ce=(e,t)=>{const r=t.dyn_tree;var i,s=t.max_code,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,h=t.stat_desc.max_length;let c,d,u,p,f,m=0;for(p=0;p<=g;p++)e.bl_count[p]=0;for(r[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<G;c++)d=e.heap[c],(p=r[2*r[2*d+1]+1]+1)>h&&(p=h,m++),r[2*d+1]=p,d>s||(e.bl_count[p]++,f=0,d>=l&&(f=o[d-l]),i=r[2*d],e.opt_len+=i*(p+f),a&&(e.static_len+=i*(n[2*d+1]+f)));if(0!==m){do{for(p=h-1;0===e.bl_count[p];)p--}while(e.bl_count[p]--,e.bl_count[p+1]+=2,e.bl_count[h]--,0<(m-=2));for(p=h;0!==p;p--)for(d=e.bl_count[p];0!==d;)s<(u=e.heap[--c])||(r[2*u+1]!==p&&(e.opt_len+=(p-r[2*u+1])*r[2*u],r[2*u+1]=p),d--)}},de=(e,t,r)=>{const i=new Array(g+1);let s=0,n,a;for(n=1;n<=g;n++)s=s+r[n-1]<<1,i[n]=s;for(a=0;a<=t;a++){var o=e[2*a+1];0!==o&&(e[2*a]=he(i[o]++,o))}},ue=e=>{let t;for(t=0;t<O;t++)e.dyn_ltree[2*t]=0;for(t=0;t<a;t++)e.dyn_dtree[2*t]=0;for(t=0;t<R;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*U]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},pe=e=>{8<e.bi_valid?le(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},fe=(e,t,r,i)=>{var s=2*t,n=2*r;return e[s]<e[n]||e[s]===e[n]&&i[t]<=i[r]},me=(e,t,r)=>{var i=e.heap[r];let s=r<<1;for(;s<=e.heap_len&&(s<e.heap_len&&fe(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!fe(t,i,e.heap[s],e.depth));)e.heap[r]=e.heap[s],r=s,s<<=1;e.heap[r]=i},ge=(e,t,r)=>{var i;let s,n=0,a,o;if(0!==e.sym_next)for(;i=255&e.pending_buf[e.sym_buf+n++],i+=(255&e.pending_buf[e.sym_buf+n++])<<8,s=e.pending_buf[e.sym_buf+n++],0==i?d(e,s,t):(a=J[s],d(e,a+I+1,t),0!==(o=N[a])&&(s-=ee[a],c(e,s,o)),i--,a=oe(i),d(e,a,r),0!==(o=j[a])&&(i-=te[a],c(e,i,o))),n<e.sym_next;);d(e,U,t)},ve=(e,t)=>{const r=t.dyn_tree;var i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,n=t.stat_desc.elems;let a,o,l=-1,h;for(e.heap_len=0,e.heap_max=G,a=0;a<n;a++)0!==r[2*a]?(e.heap[++e.heap_len]=l=a,e.depth[a]=0):r[2*a+1]=0;for(;e.heap_len<2;)h=e.heap[++e.heap_len]=l<2?++l:0,r[2*h]=1,e.depth[h]=0,e.opt_len--,s&&(e.static_len-=i[2*h+1]);for(t.max_code=l,a=e.heap_len>>1;1<=a;a--)me(e,r,a);for(h=n;a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],me(e,r,1),o=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=o,r[2*h]=r[2*a]+r[2*o],e.depth[h]=(e.depth[a]>=e.depth[o]?e.depth[a]:e.depth[o])+1,r[2*a+1]=r[2*o+1]=h,e.heap[1]=h++,me(e,r,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],ce(e,t),de(r,l,e.bl_count)},be=(e,t,r)=>{let i,s=-1;var n;let a=t[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),t[2*(r+1)+1]=65535,i=0;i<=r;i++)n=a,a=t[2*(i+1)+1],++o<l&&n===a||(o<h?e.bl_tree[2*n]+=o:0!==n?(n!==s&&e.bl_tree[2*n]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,s=n,h=0===a?(l=138,3):n===a?(l=6,3):(l=7,4))},_e=(e,t,r)=>{let i,s=-1;var n;let a=t[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),i=0;i<=r;i++)if(n=a,a=t[2*(i+1)+1],!(++o<l&&n===a)){if(o<h)for(;d(e,n,e.bl_tree),0!=--o;);else 0!==n?(n!==s&&(d(e,n,e.bl_tree),o--),d(e,16,e.bl_tree),c(e,o-3,2)):o<=10?(d(e,17,e.bl_tree),c(e,o-3,3)):(d(e,18,e.bl_tree),c(e,o-11,7));o=0,s=n,h=0===a?(l=138,3):n===a?(l=6,3):(l=7,4)}};let ye=!1;const xe=(e,t,r,i)=>{c(e,0+(i?1:0),3),pe(e),le(e,r),le(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var t={_tr_init:e=>{if(!ye){{let e,t,r,i,s;const n=new Array(g+1);for(r=0,i=0;i<k-1;i++)for(ee[i]=r,e=0;e<1<<N[i];e++)J[r++]=i;for(J[r-1]=i,s=0,i=0;i<16;i++)for(te[i]=s,e=0;e<1<<j[i];e++)$[s++]=i;for(s>>=7;i<a;i++)for(te[i]=s<<7,e=0;e<1<<j[i]-7;e++)$[256+s++]=i;for(t=0;t<=g;t++)n[t]=0;for(e=0;e<=143;)h[2*e+1]=8,e++,n[8]++;for(;e<=255;)h[2*e+1]=9,e++,n[9]++;for(;e<=279;)h[2*e+1]=7,e++,n[7]++;for(;e<=287;)h[2*e+1]=8,e++,n[8]++;for(de(h,O+1,n),e=0;e<a;e++)H[2*e+1]=5,H[2*e]=he(e,5);ie=new re(h,N,I+1,O,g),se=new re(H,j,0,a,g),ne=new re(new Array(0),V,0,R,B)}ye=!0}e.l_desc=new ae(e.dyn_ltree,ie),e.d_desc=new ae(e.dyn_dtree,se),e.bl_desc=new ae(e.bl_tree,ne),e.bi_buf=0,e.bi_valid=0,ue(e)},_tr_stored_block:xe,_tr_flush_block:(t,r,i,e)=>{let s,n,a=0;if(0<t.level?(2===t.strm.data_type&&(t.strm.data_type=(e=>{let t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*r])return F;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return D;for(r=32;r<I;r++)if(0!==e.dyn_ltree[2*r])return D;return F})(t)),ve(t,t.l_desc),ve(t,t.d_desc),a=(e=>{let t;for(be(e,e.dyn_ltree,e.l_desc.max_code),be(e,e.dyn_dtree,e.d_desc.max_code),ve(e,e.bl_desc),t=R-1;3<=t&&0===e.bl_tree[2*W[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(t),s=t.opt_len+3+7>>>3,(n=t.static_len+3+7>>>3)<=s&&(s=n)):s=n=i+5,i+4<=s&&-1!==r)xe(t,r,i,e);else if(4===t.strategy||n===s)c(t,2+(e?1:0),3),ge(t,h,H);else{c(t,4+(e?1:0),3);{var o=t;r=t.l_desc.max_code+1;i=t.d_desc.max_code+1;var l=a+1;let e;for(c(o,r-257,5),c(o,i-1,5),c(o,l-4,4),e=0;e<l;e++)c(o,o.bl_tree[2*W[e]+1],3);_e(o,o.dyn_ltree,r-1),_e(o,o.dyn_dtree,i-1)}ge(t,t.dyn_ltree,t.dyn_dtree)}ue(t),e&&pe(t)},_tr_tally:(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(J[r]+I+1)]++,e.dyn_dtree[2*oe(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{c(e,2,3),d(e,U,h),16===(e=e).bi_valid?(le(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},we=(e,t,r,i)=>{let s=65535&e|0,n=e>>>16&65535|0,a=0;for(;0!==r;){for(r-=a=2e3<r?2e3:r;s=s+t[i++]|0,n=n+s|0,--a;);s%=65521,n%=65521}return s|n<<16|0};const Ae=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var q=(t,r,e,i)=>{var s=Ae,n=i+e;t^=-1;for(let e=i;e<n;e++)t=t>>>8^s[255&(t^r[e])];return-1^t},i={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},e={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Se,_tr_stored_block:Ce,_tr_flush_block:Le,_tr_tally:o,_tr_align:Me}=t,{Z_NO_FLUSH:l,Z_PARTIAL_FLUSH:ze,Z_FULL_FLUSH:Te,Z_FINISH:u,Z_BLOCK:Ee,Z_OK:p,Z_STREAM_END:Fe,Z_STREAM_ERROR:f,Z_DATA_ERROR:De,Z_BUF_ERROR:ke,Z_DEFAULT_COMPRESSION:Ie,Z_FILTERED:Oe,Z_HUFFMAN_ONLY:Re,Z_RLE:Ge,Z_FIXED:Pe,Z_DEFAULT_STRATEGY:Be,Z_UNKNOWN:Ue,Z_DEFLATED:Ne}=e,je=9;const Ve=286,We=30,He=19,qe=2*Ve+1,Ye=15,m=3,v=258,b=v+m+1,_=42,Ze=57,Xe=69,Ke=73,Qe=91,$e=103,y=113,Je=666,x=1,et=2,w=3,tt=4,A=(e,t)=>(e.msg=i[t],t),rt=e=>2*e-(4<e?9:0),S=e=>{let t=e.length;for(;0<=--t;)e[t]=0},it=e=>{let t,r,i;var s=e.w_size;for(t=e.hash_size,i=t;r=e.head[--i],e.head[i]=r>=s?r-s:0,--t;);for(t=s,i=t;r=e.prev[--i],e.prev[i]=r>=s?r-s:0,--t;);};let C=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const L=e=>{const t=e.state;let r=t.pending;0!==(r=r>e.avail_out?e.avail_out:r)&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},M=(e,t)=>{Le(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,L(e.strm)},z=(e,t)=>{e.pending_buf[e.pending++]=t},st=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},nt=(e,t,r,i)=>{let s=e.avail_in;return 0===(s=s>i?i:s)?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),r),1===e.state.wrap?e.adler=we(e.adler,t,s,r):2===e.state.wrap&&(e.adler=q(e.adler,t,s,r)),e.next_in+=s,e.total_in+=s,s)},at=(e,t)=>{let r=e.max_chain_length,i=e.strstart,s;var n;let a=e.prev_length,o=e.nice_match;var l=e.strstart>e.w_size-b?e.strstart-(e.w_size-b):0,h=e.window,c=e.w_mask,d=e.prev,u=e.strstart+v;let p=h[i+a-1],f=h[i+a];e.prev_length>=e.good_match&&(r>>=2),o>e.lookahead&&(o=e.lookahead);do{if(h[(s=t)+a]===f&&h[s+a-1]===p&&h[s]===h[i]&&h[++s]===h[i+1]){for(i+=2,s++;h[++i]===h[++s]&&h[++i]===h[++s]&&h[++i]===h[++s]&&h[++i]===h[++s]&&h[++i]===h[++s]&&h[++i]===h[++s]&&h[++i]===h[++s]&&h[++i]===h[++s]&&i<u;);if(n=v-(u-i),i=u-v,n>a){if(e.match_start=t,(a=n)>=o)break;p=h[i+a-1],f=h[i+a]}}}while((t=d[t&c])>l&&0!=--r);return a<=e.lookahead?a:e.lookahead},ot=e=>{var t=e.w_size;let r,i,s;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-b)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),it(e),i+=t),0===e.strm.avail_in)break;if(r=nt(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=m)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=C(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=C(e,e.ins_h,e.window[s+m-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<m)););}while(e.lookahead<b&&0!==e.strm.avail_in)},lt=(e,t)=>{let r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,i,s,n,a=0;for(var o=e.strm.avail_in;i=65535,n=e.bi_valid+42>>3,!(e.strm.avail_out<n||(n=e.strm.avail_out-n,s=e.strstart-e.block_start,(i=(i=i>s+e.strm.avail_in?s+e.strm.avail_in:i)>n?n:i)<r&&(0===i&&t!==u||t===l||i!==s+e.strm.avail_in)||(a=t===u&&i===s+e.strm.avail_in?1:0,Ce(e,0,0,a),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,L(e.strm),s&&(s>i&&(s=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,i-=s),i&&(nt(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i),0!==a))););return(o-=e.strm.avail_in)&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?tt:t!==l&&t!==u&&0===e.strm.avail_in&&e.strstart===e.block_start?et:(n=e.window_size-e.strstart,e.strm.avail_in>n&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,n+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),(n=n>e.strm.avail_in?e.strm.avail_in:n)&&(nt(e.strm,e.window,e.strstart,n),e.strstart+=n,e.insert+=n>e.w_size-e.insert?e.w_size-e.insert:n),e.high_water<e.strstart&&(e.high_water=e.strstart),n=e.bi_valid+42>>3,n=65535<e.pending_buf_size-n?65535:e.pending_buf_size-n,r=n>e.w_size?e.w_size:n,((s=e.strstart-e.block_start)>=r||(s||t===u)&&t!==l&&0===e.strm.avail_in&&s<=n)&&(i=s>n?n:s,a=t===u&&0===e.strm.avail_in&&i===s?1:0,Ce(e,e.block_start,i,a),e.block_start+=i,L(e.strm)),a?w:x)};var t=(e,t)=>{let r,i;for(;;){if(e.lookahead<b){if(ot(e),e.lookahead<b&&t===l)return x;if(0===e.lookahead)break}if(r=0,e.lookahead>=m&&(e.ins_h=C(e,e.ins_h,e.window[e.strstart+m-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-b&&(e.match_length=at(e,r)),e.match_length>=m)if(i=o(e,e.strstart-e.match_start,e.match_length-m),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=m){for(e.match_length--;e.strstart++,e.ins_h=C(e,e.ins_h,e.window[e.strstart+m-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=C(e,e.ins_h,e.window[e.strstart+1]);else i=o(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(M(e,!1),0===e.strm.avail_out))return x}return e.insert=e.strstart<m-1?e.strstart:m-1,t===u?(M(e,!0),0===e.strm.avail_out?w:tt):e.sym_next&&(M(e,!1),0===e.strm.avail_out)?x:et},s=(e,t)=>{let r,i;for(var s;;){if(e.lookahead<b){if(ot(e),e.lookahead<b&&t===l)return x;if(0===e.lookahead)break}if(r=0,e.lookahead>=m&&(e.ins_h=C(e,e.ins_h,e.window[e.strstart+m-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=m-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-b&&(e.match_length=at(e,r),e.match_length<=5&&(e.strategy===Oe||e.match_length===m&&4096<e.strstart-e.match_start)&&(e.match_length=m-1)),e.prev_length>=m&&e.match_length<=e.prev_length){for(s=e.strstart+e.lookahead-m,i=o(e,e.strstart-1-e.prev_match,e.prev_length-m),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=s&&(e.ins_h=C(e,e.ins_h,e.window[e.strstart+m-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=m-1,e.strstart++,i&&(M(e,!1),0===e.strm.avail_out))return x}else if(e.match_available){if((i=o(e,0,e.window[e.strstart-1]))&&M(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return x}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=o(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<m-1?e.strstart:m-1,t===u?(M(e,!0),0===e.strm.avail_out?w:tt):e.sym_next&&(M(e,!1),0===e.strm.avail_out)?x:et};function n(e,t,r,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=s}const ht=[new n(0,0,0,0,lt),new n(4,4,8,4,t),new n(4,5,16,8,t),new n(4,6,32,32,t),new n(4,4,16,16,s),new n(8,16,32,32,s),new n(8,16,128,128,s),new n(8,32,128,256,s),new n(32,128,258,1024,s),new n(32,258,258,4096,s)];function ct(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ne,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*qe),this.dyn_dtree=new Uint16Array(2*(2*We+1)),this.bl_tree=new Uint16Array(2*(2*He+1)),S(this.dyn_ltree),S(this.dyn_dtree),S(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Ye+1),this.heap=new Uint16Array(2*Ve+1),S(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Ve+1),S(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const dt=e=>{if(!e)return 1;var t=e.state;return!t||t.strm!==e||t.status!==_&&t.status!==Ze&&t.status!==Xe&&t.status!==Ke&&t.status!==Qe&&t.status!==$e&&t.status!==y&&t.status!==Je?1:0},ut=e=>{if(dt(e))return A(e,f);e.total_in=e.total_out=0,e.data_type=Ue;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?Ze:t.wrap?_:y,e.adler=2===t.wrap?0:1,t.last_flush=-2,Se(t),p},pt=e=>{var t=ut(e);return t===p&&((e=e.state).window_size=2*e.w_size,S(e.head),e.max_lazy_match=ht[e.level].max_lazy,e.good_match=ht[e.level].good_length,e.nice_match=ht[e.level].nice_length,e.max_chain_length=ht[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=m-1,e.match_available=0,e.ins_h=0),t};const ft=(e,t,r,i,s,n)=>{if(!e)return f;let a=1;if(t===Ie&&(t=6),i<0?(a=0,i=-i):15<i&&(a=2,i-=16),s<1||s>je||r!==Ne||i<8||15<i||t<0||9<t||n<0||n>Pe||8===i&&1!==a)return A(e,f);8===i&&(i=9);const o=new ct;return(e.state=o).strm=e,o.status=_,o.wrap=a,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+m-1)/m),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=n,o.method=r,pt(e)};var mt={deflateInit:(e,t)=>ft(e,t,Ne,15,8,Be),deflateInit2:ft,deflateReset:pt,deflateResetKeep:ut,deflateSetHeader:(e,t)=>dt(e)||2!==e.state.wrap?f:(e.state.gzhead=t,p),deflate:(i,e)=>{if(dt(i)||e>Ee||e<0)return i?A(i,f):f;const s=i.state;if(!i.output||0!==i.avail_in&&!i.input||s.status===Je&&e!==u)return A(i,0===i.avail_out?ke:f);var t=s.last_flush;if(s.last_flush=e,0!==s.pending){if(L(i),0===i.avail_out)return s.last_flush=-1,p}else if(0===i.avail_in&&rt(e)<=rt(t)&&e!==u)return A(i,ke);if(s.status===Je&&0!==i.avail_in)return A(i,ke);if(s.status===_&&0===s.wrap&&(s.status=y),s.status===_){let e=Ne+(s.w_bits-8<<4)<<8,t=-1;if(t=s.strategy>=Re||s.level<2?0:s.level<6?1:6===s.level?2:3,e|=t<<6,0!==s.strstart&&(e|=32),e+=31-e%31,st(s,e),0!==s.strstart&&(st(s,i.adler>>>16),st(s,65535&i.adler)),i.adler=1,s.status=y,L(i),0!==s.pending)return s.last_flush=-1,p}if(s.status===Ze)if(i.adler=0,z(s,31),z(s,139),z(s,8),s.gzhead)z(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),z(s,255&s.gzhead.time),z(s,s.gzhead.time>>8&255),z(s,s.gzhead.time>>16&255),z(s,s.gzhead.time>>24&255),z(s,9===s.level?2:s.strategy>=Re||s.level<2?4:0),z(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(z(s,255&s.gzhead.extra.length),z(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(i.adler=q(i.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=Xe;else if(z(s,0),z(s,0),z(s,0),z(s,0),z(s,0),z(s,9===s.level?2:s.strategy>=Re||s.level<2?4:0),z(s,3),s.status=y,L(i),0!==s.pending)return s.last_flush=-1,p;if(s.status===Xe){if(s.gzhead.extra){let e=s.pending,t=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+t>s.pending_buf_size;){var n=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+n),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>e&&(i.adler=q(i.adler,s.pending_buf,s.pending-e,e)),s.gzindex+=n,L(i),0!==s.pending)return s.last_flush=-1,p;e=0,t-=n}let r=new Uint8Array(s.gzhead.extra);s.pending_buf.set(r.subarray(s.gzindex,s.gzindex+t),s.pending),s.pending+=t,s.gzhead.hcrc&&s.pending>e&&(i.adler=q(i.adler,s.pending_buf,s.pending-e,e)),s.gzindex=0}s.status=Ke}if(s.status===Ke){if(s.gzhead.name){let e=s.pending,t;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>e&&(i.adler=q(i.adler,s.pending_buf,s.pending-e,e)),L(i),0!==s.pending)return s.last_flush=-1,p;e=0}}while(t=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,z(s,t),0!==t);s.gzhead.hcrc&&s.pending>e&&(i.adler=q(i.adler,s.pending_buf,s.pending-e,e)),s.gzindex=0}s.status=Qe}if(s.status===Qe){if(s.gzhead.comment){let e=s.pending,t;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>e&&(i.adler=q(i.adler,s.pending_buf,s.pending-e,e)),L(i),0!==s.pending)return s.last_flush=-1,p;e=0}}while(t=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,z(s,t),0!==t);s.gzhead.hcrc&&s.pending>e&&(i.adler=q(i.adler,s.pending_buf,s.pending-e,e))}s.status=$e}if(s.status===$e){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(L(i),0!==s.pending))return s.last_flush=-1,p;z(s,255&i.adler),z(s,i.adler>>8&255),i.adler=0}if(s.status=y,L(i),0!==s.pending)return s.last_flush=-1,p}if(0!==i.avail_in||0!==s.lookahead||e!==l&&s.status!==Je){t=0===s.level?lt(s,e):s.strategy===Re?((e,t)=>{for(var r;;){if(0===e.lookahead&&(ot(e),0===e.lookahead)){if(t===l)return x;break}if(e.match_length=0,r=o(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(M(e,!1),0===e.strm.avail_out))return x}return e.insert=0,t===u?(M(e,!0),0===e.strm.avail_out?w:tt):e.sym_next&&(M(e,!1),0===e.strm.avail_out)?x:et})(s,e):s.strategy===Ge?((e,t)=>{let r;var i;let s,n;for(var a=e.window;;){if(e.lookahead<=v){if(ot(e),e.lookahead<=v&&t===l)return x;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=m&&0<e.strstart&&(i=a[s=e.strstart-1])===a[++s]&&i===a[++s]&&i===a[++s]){for(n=e.strstart+v;i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&s<n;);e.match_length=v-(n-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=m?(r=o(e,1,e.match_length-m),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=o(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(M(e,!1),0===e.strm.avail_out))return x}return e.insert=0,t===u?(M(e,!0),0===e.strm.avail_out?w:tt):e.sym_next&&(M(e,!1),0===e.strm.avail_out)?x:et})(s,e):ht[s.level].func(s,e);if(t!==w&&t!==tt||(s.status=Je),t===x||t===w)return 0===i.avail_out&&(s.last_flush=-1),p;if(t===et&&(e===ze?Me(s):e!==Ee&&(Ce(s,0,0,!1),e===Te&&(S(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),L(i),0===i.avail_out))return s.last_flush=-1,p}return e!==u?p:s.wrap<=0?Fe:(2===s.wrap?(z(s,255&i.adler),z(s,i.adler>>8&255),z(s,i.adler>>16&255),z(s,i.adler>>24&255),z(s,255&i.total_in),z(s,i.total_in>>8&255),z(s,i.total_in>>16&255),z(s,i.total_in>>24&255)):(st(s,i.adler>>>16),st(s,65535&i.adler)),L(i),0<s.wrap&&(s.wrap=-s.wrap),0!==s.pending?p:Fe)},deflateEnd:e=>{if(dt(e))return f;var t=e.state.status;return e.state=null,t===y?A(e,De):p},deflateSetDictionary:(e,t)=>{let r=t.length;if(dt(e))return f;const i=e.state;var s=i.wrap;if(2===s||1===s&&i.status!==_||i.lookahead)return f;if(1===s&&(e.adler=we(e.adler,t,r,0)),i.wrap=0,r>=i.w_size){0===s&&(S(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(r-i.w_size,r),0),t=e,r=i.w_size}var n=e.avail_in,a=e.next_in,o=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,ot(i);i.lookahead>=m;){let e=i.strstart,t=i.lookahead-(m-1);for(;i.ins_h=C(i,i.ins_h,i.window[e+m-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++,--t;);i.strstart=e,i.lookahead=m-1,ot(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=m-1,i.match_available=0,e.next_in=a,e.input=o,e.avail_in=n,i.wrap=s,p},deflateInfo:"pako deflate (from Nodeca project)"};var gt=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const n in r)i=r,s=n,Object.prototype.hasOwnProperty.call(i,s)&&(e[n]=r[n])}}var i,s;return e},vt=i=>{let r=0;for(let e=0,t=i.length;e<t;e++)r+=i[e].length;const s=new Uint8Array(r);for(let e=0,t=0,r=i.length;e<r;e++){var n=i[e];s.set(n,t),t+=n.length}return s};let bt=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){bt=!1}const _t=new Uint8Array(256);for(let e=0;e<256;e++)_t[e]=252<=e?6:248<=e?5:240<=e?4:224<=e?3:192<=e?2:1;_t[254]=_t[254]=1;var yt=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,i,s,n,a=e.length,o=0;for(s=0;s<a;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(i-56320),s++),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(o),n=0,s=0;n<o;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(i=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(i-56320),s++),r<128?t[n++]=r:(r<2048?t[n++]=192|r>>>6:(r<65536?t[n++]=224|r>>>12:(t[n++]=240|r>>>18,t[n++]=128|r>>>12&63),t[n++]=128|r>>>6&63),t[n++]=128|63&r);return t},xt=(r,e)=>{var i=e||r.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(r.subarray(0,e));let s,n;const a=new Array(2*i);for(n=0,s=0;s<i;){let t=r[s++];if(t<128)a[n++]=t;else{let e=_t[t];if(4<e)a[n++]=65533,s+=e-1;else{for(t&=2===e?31:3===e?15:7;1<e&&s<i;)t=t<<6|63&r[s++],e--;1<e?a[n++]=65533:t<65536?a[n++]=t:(t-=65536,a[n++]=55296|t>>10&1023,a[n++]=56320|1023&t)}}}{var o=a,l=n;if(l<65534&&o.subarray&&bt)return String.fromCharCode.apply(null,o.length===l?o:o.subarray(0,l));let t="";for(let e=0;e<l;e++)t+=String.fromCharCode(o[e]);return t}},wt=(e,t)=>{let r=(t=(t=t||e.length)>e.length?e.length:t)-1;for(;0<=r&&128==(192&e[r]);)r--;return!(r<0)&&0!==r&&r+_t[e[r]]>t?r:t};var At=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const St=Object.prototype.toString,{Z_NO_FLUSH:Ct,Z_SYNC_FLUSH:Lt,Z_FULL_FLUSH:Mt,Z_FINISH:zt,Z_OK:Tt,Z_STREAM_END:Et,Z_DEFAULT_COMPRESSION:Ft,Z_DEFAULT_STRATEGY:Dt,Z_DEFLATED:kt}=e;function It(e){this.options=gt({level:Ft,method:kt,chunkSize:16384,windowBits:15,memLevel:8,strategy:Dt},e||{});let t=this.options,r=(t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new At,this.strm.avail_out=0,mt.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy));if(r!==Tt)throw new Error(i[r]);if(t.header&&mt.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?yt(t.dictionary):"[object ArrayBuffer]"===St.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=mt.deflateSetDictionary(this.strm,e))!==Tt)throw new Error(i[r]);this._dict_set=!0}}function Ot(e,t){const r=new It(t);if(r.push(e,!0),r.err)throw r.msg||i[r.err];return r.result}It.prototype.push=function(e,t){const r=this.strm;var i=this.options.chunkSize;let s,n;if(this.ended)return!1;for(n=t===~~t?t:!0===t?zt:Ct,"string"==typeof e?r.input=yt(e):"[object ArrayBuffer]"===St.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),(n===Lt||n===Mt)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(mt.deflate(r,n)===Et)return 0<r.next_out&&this.onData(r.output.subarray(0,r.next_out)),s=mt.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Tt;if(0===r.avail_out)this.onData(r.output);else if(0<n&&0<r.next_out)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}return!0},It.prototype.onData=function(e){this.chunks.push(e)},It.prototype.onEnd=function(e){e===Tt&&(this.result=vt(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};t={Deflate:It,deflate:Ot,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Ot(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Ot(e,t)},constants:e};const Rt=16209,Gt=16191;const Pt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Bt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ut=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Nt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var jt=(e,t,r,i,s,n,a,o)=>{var l,h=o.bits;let c=0,d=0,u=0,p=0,f=0,m=0,g=0,v=0,b=0,_=0,y,x,w,A,S=null,C;const L=new Uint16Array(16),M=new Uint16Array(16);let z=null,T,E,F;for(c=0;c<=15;c++)L[c]=0;for(d=0;d<i;d++)L[t[r+d]]++;for(f=h,p=15;1<=p&&0===L[p];p--);if(f>p&&(f=p),0===p)return s[n++]=20971520,s[n++]=20971520,o.bits=1,0;for(u=1;u<p&&0===L[u];u++);for(f<u&&(f=u),v=1,c=1;c<=15;c++)if((v=(v<<=1)-L[c])<0)return-1;if(0<v&&(0===e||1!==p))return-1;for(M[1]=0,c=1;c<15;c++)M[c+1]=M[c]+L[c];for(d=0;d<i;d++)0!==t[r+d]&&(a[M[t[r+d]]++]=d);if(C=0===e?(S=z=a,20):1===e?(S=Pt,z=Bt,257):(S=Ut,z=Nt,0),_=0,d=0,c=u,A=n,m=f,g=0,w=-1,l=(b=1<<f)-1,1===e&&852<b||2===e&&592<b)return 1;for(;;){for(T=c-g,F=a[d]+1<C?(E=0,a[d]):a[d]>=C?(E=z[a[d]-C],S[a[d]-C]):(E=96,0),y=1<<c-g,x=1<<m,u=x;x-=y,s[A+(_>>g)+x]=T<<24|E<<16|F|0,0!==x;);for(y=1<<c-1;_&y;)y>>=1;if(_=0!==y?(_&=y-1)+y:0,d++,0==--L[c]){if(c===p)break;c=t[r+a[d]]}if(c>f&&(_&l)!==w){for(0===g&&(g=f),A+=u,m=c-g,v=1<<m;m+g<p&&!((v-=L[m+g])<=0);)m++,v<<=1;if(b+=1<<m,1===e&&852<b||2===e&&592<b)return 1;s[w=_&l]=f<<24|m<<16|A-n|0}}return 0!==_&&(s[A+_]=c-g<<24|64<<16|0),o.bits=f,0};const Vt=1,Wt=2,{Z_FINISH:Ht,Z_BLOCK:qt,Z_TREES:Yt,Z_OK:Y,Z_STREAM_END:Zt,Z_NEED_DICT:Xt,Z_STREAM_ERROR:Z,Z_DATA_ERROR:Kt,Z_MEM_ERROR:Qt,Z_BUF_ERROR:$t,Z_DEFLATED:Jt}=e,er=16180,tr=16190,X=16191,rr=16199,ir=16200,K=16209,sr=16211,nr=852,ar=592;const or=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function lr(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Q=e=>{if(!e)return 1;var t=e.state;return!t||t.strm!==e||t.mode<er||t.mode>sr?1:0},hr=e=>{if(Q(e))return Z;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=er,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(nr),t.distcode=t.distdyn=new Int32Array(ar),t.sane=1,t.back=-1,Y},cr=e=>{if(Q(e))return Z;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,hr(e)},dr=(e,t)=>{let r;if(Q(e))return Z;const i=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?Z:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,cr(e))},ur=(e,t)=>{if(!e)return Z;const r=new lr;(e.state=r).strm=e,r.window=null,r.mode=er;t=dr(e,t);return t!==Y&&(e.state=null),t};let pr=!0,fr,mr;const gr=(e,t,r,i)=>{let s;const n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),i>=n.wsize?(n.window.set(t.subarray(r-n.wsize,r),0),n.wnext=0,n.whave=n.wsize):((s=n.wsize-n.wnext)>i&&(s=i),n.window.set(t.subarray(r-i,r-i+s),n.wnext),(i-=s)?(n.window.set(t.subarray(r-i,r),0),n.wnext=i,n.whave=n.wsize):(n.wnext+=s,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=s))),0};var T={inflateReset:cr,inflateReset2:dr,inflateResetKeep:hr,inflateInit:e=>ur(e,15),inflateInit2:ur,inflate:(d,e)=>{let t,r,i,s,n,a,o,l,h,c,u,p,R,G,f=0,m,g,v,b,_,y,x,w;const A=new Uint8Array(4);let S,C;var L,P,M,B,z,U,T,E,F,N,j,V,D,W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Q(d)||!d.output||!d.input&&0!==d.avail_in)return Z;(t=d.state).mode===X&&(t.mode=16192),n=d.next_out,i=d.output,o=d.avail_out,s=d.next_in,r=d.input,a=d.avail_in,l=t.hold,h=t.bits,c=a,u=o,w=Y;e:for(;;)switch(t.mode){case er:if(0===t.wrap){t.mode=16192;break}for(;h<16;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}if(2&t.wrap&&35615===l){0===t.wbits&&(t.wbits=15),t.check=0,A[0]=255&l,A[1]=l>>>8&255,t.check=q(t.check,A,2,0),l=0,h=0,t.mode=16181;break}if(t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&l)<<8)+(l>>8))%31){d.msg="incorrect header check",t.mode=K;break}if((15&l)!==Jt){d.msg="unknown compression method",t.mode=K;break}if(l>>>=4,h-=4,x=8+(15&l),0===t.wbits&&(t.wbits=x),15<x||x>t.wbits){d.msg="invalid window size",t.mode=K;break}t.dmax=1<<t.wbits,t.flags=0,d.adler=t.check=1,t.mode=512&l?16189:X,l=0,h=0;break;case 16181:for(;h<16;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}if(t.flags=l,(255&t.flags)!==Jt){d.msg="unknown compression method",t.mode=K;break}if(57344&t.flags){d.msg="unknown header flags set",t.mode=K;break}t.head&&(t.head.text=l>>8&1),512&t.flags&&4&t.wrap&&(A[0]=255&l,A[1]=l>>>8&255,t.check=q(t.check,A,2,0)),l=0,h=0,t.mode=16182;case 16182:for(;h<32;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}t.head&&(t.head.time=l),512&t.flags&&4&t.wrap&&(A[0]=255&l,A[1]=l>>>8&255,A[2]=l>>>16&255,A[3]=l>>>24&255,t.check=q(t.check,A,4,0)),l=0,h=0,t.mode=16183;case 16183:for(;h<16;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}t.head&&(t.head.xflags=255&l,t.head.os=l>>8),512&t.flags&&4&t.wrap&&(A[0]=255&l,A[1]=l>>>8&255,t.check=q(t.check,A,2,0)),l=0,h=0,t.mode=16184;case 16184:if(1024&t.flags){for(;h<16;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}t.length=l,t.head&&(t.head.extra_len=l),512&t.flags&&4&t.wrap&&(A[0]=255&l,A[1]=l>>>8&255,t.check=q(t.check,A,2,0)),l=0,h=0}else t.head&&(t.head.extra=null);t.mode=16185;case 16185:if(1024&t.flags&&((p=(p=t.length)>a?a:p)&&(t.head&&(x=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(r.subarray(s,s+p),x)),512&t.flags&&4&t.wrap&&(t.check=q(t.check,r,p,s)),a-=p,s+=p,t.length-=p),t.length))break e;t.length=0,t.mode=16186;case 16186:if(2048&t.flags){if(0===a)break e;for(p=0;x=r[s+p++],t.head&&x&&t.length<65536&&(t.head.name+=String.fromCharCode(x)),x&&p<a;);if(512&t.flags&&4&t.wrap&&(t.check=q(t.check,r,p,s)),a-=p,s+=p,x)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=16187;case 16187:if(4096&t.flags){if(0===a)break e;for(p=0;x=r[s+p++],t.head&&x&&t.length<65536&&(t.head.comment+=String.fromCharCode(x)),x&&p<a;);if(512&t.flags&&4&t.wrap&&(t.check=q(t.check,r,p,s)),a-=p,s+=p,x)break e}else t.head&&(t.head.comment=null);t.mode=16188;case 16188:if(512&t.flags){for(;h<16;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}if(4&t.wrap&&l!==(65535&t.check)){d.msg="header crc mismatch",t.mode=K;break}l=0,h=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),d.adler=t.check=0,t.mode=X;break;case 16189:for(;h<32;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}d.adler=t.check=or(l),l=0,h=0,t.mode=tr;case tr:if(0===t.havedict)return d.next_out=n,d.avail_out=o,d.next_in=s,d.avail_in=a,t.hold=l,t.bits=h,Xt;d.adler=t.check=1,t.mode=X;case X:if(e===qt||e===Yt)break e;case 16192:if(t.last){l>>>=7&h,h-=7&h,t.mode=16206;break}for(;h<3;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}switch(t.last=1&l,l>>>=1,--h,3&l){case 0:t.mode=16193;break;case 1:var k=t;if(pr){fr=new Int32Array(512),mr=new Int32Array(32);let e=0;for(;e<144;)k.lens[e++]=8;for(;e<256;)k.lens[e++]=9;for(;e<280;)k.lens[e++]=7;for(;e<288;)k.lens[e++]=8;for(jt(Vt,k.lens,0,288,fr,0,k.work,{bits:9}),e=0;e<32;)k.lens[e++]=5;jt(Wt,k.lens,0,32,mr,0,k.work,{bits:5}),pr=!1}if(k.lencode=fr,k.lenbits=9,k.distcode=mr,k.distbits=5,t.mode=rr,e!==Yt)break;l>>>=2,h-=2;break e;case 2:t.mode=16196;break;case 3:d.msg="invalid block type",t.mode=K}l>>>=2,h-=2;break;case 16193:for(l>>>=7&h,h-=7&h;h<32;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}if((65535&l)!=(l>>>16^65535)){d.msg="invalid stored block lengths",t.mode=K;break}if(t.length=65535&l,l=0,h=0,t.mode=16194,e===Yt)break e;case 16194:t.mode=16195;case 16195:if(p=t.length){if(0===(p=(p=p>a?a:p)>o?o:p))break e;i.set(r.subarray(s,s+p),n),a-=p,s+=p,o-=p,n+=p,t.length-=p;break}t.mode=X;break;case 16196:for(;h<14;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}if(t.nlen=257+(31&l),l>>>=5,h-=5,t.ndist=1+(31&l),l>>>=5,h-=5,t.ncode=4+(15&l),l>>>=4,h-=4,286<t.nlen||30<t.ndist){d.msg="too many length or distance symbols",t.mode=K;break}t.have=0,t.mode=16197;case 16197:for(;t.have<t.ncode;){for(;h<3;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}t.lens[W[t.have++]]=7&l,l>>>=3,h-=3}for(;t.have<19;)t.lens[W[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,S={bits:t.lenbits},w=jt(0,t.lens,0,19,t.lencode,0,t.work,S),t.lenbits=S.bits,w){d.msg="invalid code lengths set",t.mode=K;break}t.have=0,t.mode=16198;case 16198:for(;t.have<t.nlen+t.ndist;){for(;f=t.lencode[l&(1<<t.lenbits)-1],m=f>>>24,g=f>>>16&255,v=65535&f,!(m<=h);){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}if(v<16)l>>>=m,h-=m,t.lens[t.have++]=v;else{if(16===v){for(C=m+2;h<C;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}if(l>>>=m,h-=m,0===t.have){d.msg="invalid bit length repeat",t.mode=K;break}x=t.lens[t.have-1],p=3+(3&l),l>>>=2,h-=2}else if(17===v){for(C=m+3;h<C;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}l>>>=m,h-=m,x=0,p=3+(7&l),l>>>=3,h-=3}else{for(C=m+7;h<C;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}l>>>=m,h-=m,x=0,p=11+(127&l),l>>>=7,h-=7}if(t.have+p>t.nlen+t.ndist){d.msg="invalid bit length repeat",t.mode=K;break}for(;p--;)t.lens[t.have++]=x}}if(t.mode===K)break;if(0===t.lens[256]){d.msg="invalid code -- missing end-of-block",t.mode=K;break}if(t.lenbits=9,S={bits:t.lenbits},w=jt(Vt,t.lens,0,t.nlen,t.lencode,0,t.work,S),t.lenbits=S.bits,w){d.msg="invalid literal/lengths set",t.mode=K;break}if(t.distbits=6,t.distcode=t.distdyn,S={bits:t.distbits},w=jt(Wt,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,S),t.distbits=S.bits,w){d.msg="invalid distances set",t.mode=K;break}if(t.mode=rr,e===Yt)break e;case rr:t.mode=ir;case ir:if(6<=a&&258<=o){d.next_out=n,d.avail_out=o,d.next_in=s,d.avail_in=a,t.hold=l,t.bits=h;{L=void 0;P=void 0;M=void 0;B=void 0;z=void 0;U=void 0;T=void 0;E=void 0;F=void 0;N=void 0;j=void 0;V=void 0;D=void 0;var I=d;var H=u;let e;let t,r,i,s,n,a,o,l,h,c;const O=I.state;e=I.next_in,h=I.input,L=e+(I.avail_in-5),t=I.next_out,c=I.output,P=t-(H-I.avail_out),M=t+(I.avail_out-257),B=O.dmax,z=O.wsize,U=O.whave,T=O.wnext,E=O.window,r=O.hold,i=O.bits,F=O.lencode,N=O.distcode,j=(1<<O.lenbits)-1,V=(1<<O.distbits)-1;t:do{for(i<15&&(r+=h[e++]<<i,i+=8,r+=h[e++]<<i,i+=8),s=F[r&j];;){if(n=s>>>24,r>>>=n,i-=n,0===(n=s>>>16&255))c[t++]=65535&s;else{if(!(16&n)){if(0==(64&n)){s=F[(65535&s)+(r&(1<<n)-1)];continue}if(32&n){O.mode=Gt;break t}I.msg="invalid literal/length code",O.mode=Rt;break t}for(a=65535&s,(n&=15)&&(i<n&&(r+=h[e++]<<i,i+=8),a+=r&(1<<n)-1,r>>>=n,i-=n),i<15&&(r+=h[e++]<<i,i+=8,r+=h[e++]<<i,i+=8),s=N[r&V];;){if(n=s>>>24,r>>>=n,i-=n,!(16&(n=s>>>16&255))){if(0==(64&n)){s=N[(65535&s)+(r&(1<<n)-1)];continue}I.msg="invalid distance code",O.mode=Rt;break t}if(D=65535&s,n&=15,i<n&&(r+=h[e++]<<i,(i+=8)<n&&(r+=h[e++]<<i,i+=8)),B<(D+=r&(1<<n)-1)){I.msg="invalid distance too far back",O.mode=Rt;break t}if(r>>>=n,i-=n,D>(n=t-P)){if((n=D-n)>U&&O.sane){I.msg="invalid distance too far back",O.mode=Rt;break t}if(o=0,l=E,0===T){if(o+=z-n,n<a){for(a-=n;c[t++]=E[o++],--n;);o=t-D,l=c}}else if(T<n){if(o+=z+T-n,(n-=T)<a){for(a-=n;c[t++]=E[o++],--n;);if(o=0,T<a){for(n=T,a-=n;c[t++]=E[o++],--n;);o=t-D,l=c}}}else if(o+=T-n,n<a){for(a-=n;c[t++]=E[o++],--n;);o=t-D,l=c}for(;2<a;)c[t++]=l[o++],c[t++]=l[o++],c[t++]=l[o++],a-=3;a&&(c[t++]=l[o++],1<a&&(c[t++]=l[o++]))}else{for(o=t-D;c[t++]=c[o++],c[t++]=c[o++],c[t++]=c[o++],2<(a-=3););a&&(c[t++]=c[o++],1<a&&(c[t++]=c[o++]))}break}}break}}while(e<L&&t<M);a=i>>3,e-=a,i-=a<<3,r&=(1<<i)-1,I.next_in=e,I.next_out=t,I.avail_in=e<L?L-e+5:5-(e-L),I.avail_out=t<M?M-t+257:257-(t-M),O.hold=r,O.bits=i}n=d.next_out,i=d.output,o=d.avail_out,s=d.next_in,r=d.input,a=d.avail_in,l=t.hold,h=t.bits,t.mode===X&&(t.back=-1);break}for(t.back=0;f=t.lencode[l&(1<<t.lenbits)-1],m=f>>>24,g=f>>>16&255,v=65535&f,!(m<=h);){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}if(g&&0==(240&g)){for(b=m,_=g,y=v;f=t.lencode[y+((l&(1<<b+_)-1)>>b)],m=f>>>24,g=f>>>16&255,v=65535&f,!(b+m<=h);){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}l>>>=b,h-=b,t.back+=b}if(l>>>=m,h-=m,t.back+=m,t.length=v,0===g){t.mode=16205;break}if(32&g){t.back=-1,t.mode=X;break}if(64&g){d.msg="invalid literal/length code",t.mode=K;break}t.extra=15&g,t.mode=16201;case 16201:if(t.extra){for(C=t.extra;h<C;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}t.length+=l&(1<<t.extra)-1,l>>>=t.extra,h-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=16202;case 16202:for(;f=t.distcode[l&(1<<t.distbits)-1],m=f>>>24,g=f>>>16&255,v=65535&f,!(m<=h);){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}if(0==(240&g)){for(b=m,_=g,y=v;f=t.distcode[y+((l&(1<<b+_)-1)>>b)],m=f>>>24,g=f>>>16&255,v=65535&f,!(b+m<=h);){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}l>>>=b,h-=b,t.back+=b}if(l>>>=m,h-=m,t.back+=m,64&g){d.msg="invalid distance code",t.mode=K;break}t.offset=v,t.extra=15&g,t.mode=16203;case 16203:if(t.extra){for(C=t.extra;h<C;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}t.offset+=l&(1<<t.extra)-1,l>>>=t.extra,h-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){d.msg="invalid distance too far back",t.mode=K;break}t.mode=16204;case 16204:if(0===o)break e;if(p=u-o,t.offset>p){if((p=t.offset-p)>t.whave&&t.sane){d.msg="invalid distance too far back",t.mode=K;break}R=p>t.wnext?(p-=t.wnext,t.wsize-p):t.wnext-p,p>t.length&&(p=t.length),G=t.window}else G=i,R=n-t.offset,p=t.length;for(p>o&&(p=o),o-=p,t.length-=p;i[n++]=G[R++],--p;);0===t.length&&(t.mode=ir);break;case 16205:if(0===o)break e;i[n++]=t.length,o--,t.mode=ir;break;case 16206:if(t.wrap){for(;h<32;){if(0===a)break e;a--,l|=r[s++]<<h,h+=8}if(u-=o,d.total_out+=u,t.total+=u,4&t.wrap&&u&&(d.adler=t.check=(t.flags?q:we)(t.check,i,u,n-u)),u=o,4&t.wrap&&(t.flags?l:or(l))!==t.check){d.msg="incorrect data check",t.mode=K;break}l=0,h=0}t.mode=16207;case 16207:if(t.wrap&&t.flags){for(;h<32;){if(0===a)break e;a--,l+=r[s++]<<h,h+=8}if(4&t.wrap&&l!==(4294967295&t.total)){d.msg="incorrect length check",t.mode=K;break}l=0,h=0}t.mode=16208;case 16208:w=Zt;break e;case K:w=Kt;break e;case 16210:return Qt;default:sr;return Z}return d.next_out=n,d.avail_out=o,d.next_in=s,d.avail_in=a,t.hold=l,t.bits=h,(t.wsize||u!==d.avail_out&&t.mode<K&&(t.mode<16206||e!==Ht))&&gr(d,d.output,d.next_out,u-d.avail_out),c-=d.avail_in,u-=d.avail_out,d.total_in+=c,d.total_out+=u,t.total+=u,4&t.wrap&&u&&(d.adler=t.check=(t.flags?q:we)(t.check,i,u,d.next_out-u)),d.data_type=t.bits+(t.last?64:0)+(t.mode===X?128:0)+(t.mode===rr||16194===t.mode?256:0),w=(0==c&&0===u||e===Ht)&&w===Y?$t:w},inflateEnd:e=>{if(Q(e))return Z;let t=e.state;return t.window&&(t.window=null),e.state=null,Y},inflateGetHeader:(e,t)=>{if(Q(e))return Z;const r=e.state;return 0==(2&r.wrap)?Z:((r.head=t).done=!1,Y)},inflateSetDictionary:(e,t)=>{var r=t.length;let i;return Q(e)||0!==(i=e.state).wrap&&i.mode!==tr?Z:i.mode===tr&&we(1,t,r,0)!==i.check?Kt:gr(e,t,r,r)?(i.mode=16210,Qt):(i.havedict=1,Y)},inflateInfo:"pako inflate (from Nodeca project)"};var vr=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const br=Object.prototype.toString,{Z_NO_FLUSH:_r,Z_FINISH:yr,Z_OK:xr,Z_STREAM_END:wr,Z_NEED_DICT:Ar,Z_STREAM_ERROR:Sr,Z_DATA_ERROR:Cr,Z_MEM_ERROR:Lr}=e;function Mr(e){this.options=gt({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new At,this.strm.avail_out=0;let r=T.inflateInit2(this.strm,t.windowBits);if(r!==xr)throw new Error(i[r]);if(this.header=new vr,T.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=yt(t.dictionary):"[object ArrayBuffer]"===br.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=T.inflateSetDictionary(this.strm,t.dictionary))!==xr))throw new Error(i[r])}function zr(e,t){const r=new Mr(t);if(r.push(e),r.err)throw r.msg||i[r.err];return r.result}Mr.prototype.push=function(e,t){const r=this.strm;var i,s,n,a=this.options.chunkSize,o=this.options.dictionary;let l,h,c;if(this.ended)return!1;for(h=t===~~t?t:!0===t?yr:_r,"[object ArrayBuffer]"===br.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),(l=T.inflate(r,h))===Ar&&o&&((l=T.inflateSetDictionary(r,o))===xr?l=T.inflate(r,h):l===Cr&&(l=Ar));0<r.avail_in&&l===wr&&0<r.state.wrap&&0!==e[r.next_in];)T.inflateReset(r),l=T.inflate(r,h);switch(l){case Sr:case Cr:case Ar:case Lr:return this.onEnd(l),!(this.ended=!0)}if(c=r.avail_out,!r.next_out||0!==r.avail_out&&l!==wr||("string"===this.options.to?(i=wt(r.output,r.next_out),s=r.next_out-i,n=xt(r.output,i),r.next_out=s,r.avail_out=a-s,s&&r.output.set(r.output.subarray(i,i+s),0),this.onData(n)):this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out))),l!==xr||0!==c){if(l===wr)return l=T.inflateEnd(this.strm),this.onEnd(l),this.ended=!0;if(0===r.avail_in)break}}return!0},Mr.prototype.onData=function(e){this.chunks.push(e)},Mr.prototype.onEnd=function(e){e===xr&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=vt(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var{Deflate:s,deflate:t,deflateRaw:Tr,gzip:Er}=t,{Inflate:Fr,inflate:Dr,inflateRaw:kr,ungzip:Ir}={Inflate:Mr,inflate:zr,inflateRaw:function(e,t){return(t=t||{}).raw=!0,zr(e,t)},ungzip:zr},Or=s,Rr=t,Gr=Tr,Pr=Er,Br=Fr,Ur=Dr,Nr=kr,jr=Ir,Vr=e,Wr={Deflate:Or,deflate:Rr,deflateRaw:Gr,gzip:Pr,Inflate:Br,inflate:Ur,inflateRaw:Nr,ungzip:jr,constants:Vr}},"./node_modules/upng-js/UPNG.js":(e,t,r)=>{var X,d,i;i={},e.exports=i,e=r("./node_modules/upng-js/node_modules/pako/index.js"),d=e,(X=i).toRGBA8=function(e){var t=e.width,r=e.height;if(null==e.tabs.acTL)return[X.toRGBA8.decodeImage(e.data,t,r,e).buffer];var i=[];null==e.frames[0].data&&(e.frames[0].data=e.data);for(var s,n=new Uint8Array(t*r*4),a=0;a<e.frames.length;a++){var o=e.frames[a],l=o.rect.x,h=o.rect.y,c=o.rect.width,d=o.rect.height,u=X.toRGBA8.decodeImage(o.data,c,d,e);if(0==a?s=u:0==o.blend?X._copyTile(u,c,d,s,t,r,l,h,0):1==o.blend&&X._copyTile(u,c,d,s,t,r,l,h,1),i.push(s.buffer),s=s.slice(0),0!=o.dispose)if(1==o.dispose)X._copyTile(n,c,d,s,t,r,l,h,0);else if(2==o.dispose){for(var p=a-1;2==e.frames[p].dispose;)p--;s=new Uint8Array(i[p]).slice(0)}}return i},X.toRGBA8.decodeImage=function(e,t,r,i){var s=t*r,n=X.decode._getBPP(i),a=Math.ceil(t*n/8),o=new Uint8Array(4*s),l=new Uint32Array(o.buffer),n=i.ctype,h=i.depth,c=X._bin.readUshort;if(6==n){var d=s<<2;if(8==h)for(var u=0;u<d;u++)o[u]=e[u];if(16==h)for(u=0;u<d;u++)o[u]=e[u<<1]}else if(2==n){var p=i.tabs.tRNS,f=-1,m=-1,g=-1;if(p&&(f=p[0],m=p[1],g=p[2]),8==h)for(u=0;u<s;u++){var v=3*u;o[S=u<<2]=e[v],o[S+1]=e[v+1],o[S+2]=e[v+2],o[S+3]=255,-1!=f&&e[v]==f&&e[v+1]==m&&e[v+2]==g&&(o[S+3]=0)}if(16==h)for(u=0;u<s;u++){v=6*u;o[S=u<<2]=e[v],o[S+1]=e[v+2],o[S+2]=e[v+4],o[S+3]=255,-1!=f&&c(e,v)==f&&c(e,v+2)==m&&c(e,v+4)==g&&(o[S+3]=0)}}else if(3==n){var b=i.tabs.PLTE,_=i.tabs.tRNS,y=_?_.length:0;if(1==h)for(var x=0;x<r;x++)for(var w=x*a,A=x*t,u=0;u<t;u++){var S=A+u<<2,C=3*(L=e[w+(u>>3)]>>7-((7&u)<<0)&1);o[S]=b[C],o[S+1]=b[C+1],o[S+2]=b[C+2],o[S+3]=L<y?_[L]:255}if(2==h)for(x=0;x<r;x++)for(w=x*a,A=x*t,u=0;u<t;u++){S=A+u<<2,C=3*(L=e[w+(u>>2)]>>6-((3&u)<<1)&3);o[S]=b[C],o[S+1]=b[C+1],o[S+2]=b[C+2],o[S+3]=L<y?_[L]:255}if(4==h)for(x=0;x<r;x++)for(w=x*a,A=x*t,u=0;u<t;u++){S=A+u<<2,C=3*(L=e[w+(u>>1)]>>4-((1&u)<<2)&15);o[S]=b[C],o[S+1]=b[C+1],o[S+2]=b[C+2],o[S+3]=L<y?_[L]:255}if(8==h)for(u=0;u<s;u++){var L,S=u<<2,C=3*(L=e[u]);o[S]=b[C],o[S+1]=b[C+1],o[S+2]=b[C+2],o[S+3]=L<y?_[L]:255}}else if(4==n){if(8==h)for(u=0;u<s;u++){var S=u<<2,M=e[z=u<<1];o[S]=M,o[S+1]=M,o[S+2]=M,o[S+3]=e[z+1]}if(16==h)for(u=0;u<s;u++){var z,S=u<<2,M=e[z=u<<2];o[S]=M,o[S+1]=M,o[S+2]=M,o[S+3]=e[z+2]}}else if(0==n){f=i.tabs.tRNS||-1;if(1==h)for(u=0;u<s;u++){var T=(M=255*(e[u>>3]>>7-(7&u)&1))==255*f?0:255;l[u]=T<<24|M<<16|M<<8|M}if(2==h)for(u=0;u<s;u++){T=(M=85*(e[u>>2]>>6-((3&u)<<1)&3))==85*f?0:255;l[u]=T<<24|M<<16|M<<8|M}if(4==h)for(u=0;u<s;u++){T=(M=17*(e[u>>1]>>4-((1&u)<<2)&15))==17*f?0:255;l[u]=T<<24|M<<16|M<<8|M}if(8==h)for(u=0;u<s;u++){T=(M=e[u])==f?0:255;l[u]=T<<24|M<<16|M<<8|M}if(16==h)for(u=0;u<s;u++){M=e[u<<1],T=c(e,u<<1)==f?0:255;l[u]=T<<24|M<<16|M<<8|M}}return o},X.decode=function(e){for(var t,r=new Uint8Array(e),i=8,s=X._bin,n=s.readUshort,a=s.readUint,o={tabs:{},frames:[]},l=new Uint8Array(r.length),h=0,c=0,d=[137,80,78,71,13,10,26,10],u=0;u<8;u++)if(r[u]!=d[u])throw"The input is not a PNG file!";for(;i<r.length;){var p=s.readUint(r,i),f=(i+=4,s.readASCII(r,i,4));if(i+=4,"IHDR"==f)X.decode._IHDR(r,i,o);else if("IDAT"==f){for(u=0;u<p;u++)l[h+u]=r[i+u];h+=p}else if("acTL"==f)o.tabs[f]={num_frames:a(r,i),num_plays:a(r,i+4)},t=new Uint8Array(r.length);else if("fcTL"==f){0!=c&&((m=o.frames[o.frames.length-1]).data=X.decode._decompress(o,t.slice(0,c),m.rect.width,m.rect.height),c=0);var m,g={x:a(r,i+12),y:a(r,i+16),width:a(r,i+4),height:a(r,i+8)},v=n(r,i+22),v=n(r,i+20)/(0==v?100:v),g={rect:g,delay:Math.round(1e3*v),dispose:r[i+24],blend:r[i+25]};o.frames.push(g)}else if("fdAT"==f){for(u=0;u<p-4;u++)t[c+u]=r[i+u+4];c+=p-4}else if("pHYs"==f)o.tabs[f]=[s.readUint(r,i),s.readUint(r,i+4),r[i+8]];else if("cHRM"==f){o.tabs[f]=[];for(u=0;u<8;u++)o.tabs[f].push(s.readUint(r,i+4*u))}else if("tEXt"==f){null==o.tabs[f]&&(o.tabs[f]={});var b=s.nextZero(r,i),_=s.readASCII(r,i,b-i),y=s.readASCII(r,b+1,i+p-b-1);o.tabs[f][_]=y}else if("iTXt"==f){null==o.tabs[f]&&(o.tabs[f]={});b=0,v=i,_=(b=s.nextZero(r,v),s.readASCII(r,v,b-v)),y=(r[v=b+1],r[v+1],v+=2,b=s.nextZero(r,v),s.readASCII(r,v,b-v),b=s.nextZero(r,v=b+1),s.readUTF8(r,v,b-v),s.readUTF8(r,v=b+1,p-(v-i)));o.tabs[f][_]=y}else if("PLTE"==f)o.tabs[f]=s.readBytes(r,i,p);else if("hIST"==f){var x=o.tabs.PLTE.length/3;o.tabs[f]=[];for(u=0;u<x;u++)o.tabs[f].push(n(r,i+2*u))}else if("tRNS"==f)3==o.ctype?o.tabs[f]=s.readBytes(r,i,p):0==o.ctype?o.tabs[f]=n(r,i):2==o.ctype&&(o.tabs[f]=[n(r,i),n(r,i+2),n(r,i+4)]);else if("gAMA"==f)o.tabs[f]=s.readUint(r,i)/1e5;else if("sRGB"==f)o.tabs[f]=r[i];else if("bKGD"==f)0==o.ctype||4==o.ctype?o.tabs[f]=[n(r,i)]:2==o.ctype||6==o.ctype?o.tabs[f]=[n(r,i),n(r,i+2),n(r,i+4)]:3==o.ctype&&(o.tabs[f]=r[i]);else if("IEND"==f){0!=c&&((m=o.frames[o.frames.length-1]).data=X.decode._decompress(o,t.slice(0,c),m.rect.width,m.rect.height),c=0),o.data=X.decode._decompress(o,l,o.width,o.height);break}i+=p;s.readUint(r,i);i+=4}return delete o.compress,delete o.interlace,delete o.filter,o},X.decode._decompress=function(e,t,r,i){return 0==e.compress&&(t=X.decode._inflate(t)),0==e.interlace?t=X.decode._filterZero(t,e,0,r,i):1==e.interlace&&(t=X.decode._readInterlace(t,e)),t},X.decode._inflate=function(e){return d.inflate(e)},X.decode._readInterlace=function(e,t){for(var r=t.width,i=t.height,s=X.decode._getBPP(t),n=s>>3,a=Math.ceil(r*s/8),o=new Uint8Array(i*a),l=0,h=[0,0,4,0,2,0,1],c=[0,4,0,2,0,1,0],d=[8,8,8,4,4,2,2],u=[8,8,4,4,2,2,1],p=0;p<7;){for(var f=d[p],m=u[p],g=0,v=0,b=h[p];b<i;)b+=f,v++;for(var _=c[p];_<r;)_+=m,g++;for(var y=Math.ceil(g*s/8),x=(X.decode._filterZero(e,t,l,g,v),0),w=h[p];w<i;){for(var A,S=c[p],C=l+x*y<<3;S<r;){if(1==s&&(A=e[C>>3],o[w*a+(S>>3)]|=(A=A>>7-(7&C)&1)<<7-((3&S)<<0)),2==s&&(A=e[C>>3],o[w*a+(S>>2)]|=(A=A>>6-(7&C)&3)<<6-((3&S)<<1)),4==s&&(A=e[C>>3],o[w*a+(S>>1)]|=(A=A>>4-(7&C)&15)<<4-((1&S)<<2)),8<=s)for(var L=w*a+S*n,M=0;M<n;M++)o[L+M]=e[(C>>3)+M];C+=s,S+=m}x++,w+=f}g*v!=0&&(l+=v*(1+y)),p+=1}return o},X.decode._getBPP=function(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth},X.decode._filterZero=function(e,t,r,i,s){for(var n=X.decode._getBPP(t),a=Math.ceil(i*n/8),o=X.decode._paeth,n=Math.ceil(n/8),l=0;l<s;l++){var h=r+l*a,c=h+l+1,d=e[c-1];if(0==d)for(var u=0;u<a;u++)e[h+u]=e[c+u];else if(1==d){for(u=0;u<n;u++)e[h+u]=e[c+u];for(u=n;u<a;u++)e[h+u]=e[c+u]+e[h+u-n]&255}else if(0==l){for(u=0;u<n;u++)e[h+u]=e[c+u];if(2==d)for(u=n;u<a;u++)e[h+u]=255&e[c+u];if(3==d)for(u=n;u<a;u++)e[h+u]=e[c+u]+(e[h+u-n]>>1)&255;if(4==d)for(u=n;u<a;u++)e[h+u]=e[c+u]+o(e[h+u-n],0,0)&255}else{if(2==d)for(u=0;u<a;u++)e[h+u]=e[c+u]+e[h+u-a]&255;if(3==d){for(u=0;u<n;u++)e[h+u]=e[c+u]+(e[h+u-a]>>1)&255;for(u=n;u<a;u++)e[h+u]=e[c+u]+(e[h+u-a]+e[h+u-n]>>1)&255}if(4==d){for(u=0;u<n;u++)e[h+u]=e[c+u]+o(0,e[h+u-a],0)&255;for(u=n;u<a;u++)e[h+u]=e[c+u]+o(e[h+u-n],e[h+u-a],e[h+u-n-a])&255}}}return e},X.decode._paeth=function(e,t,r){var i=e+t-r,s=Math.abs(i-e),n=Math.abs(i-t),i=Math.abs(i-r);return s<=n&&s<=i?e:n<=i?t:r},X.decode._IHDR=function(e,t,r){var i=X._bin;r.width=i.readUint(e,t),r.height=i.readUint(e,t+=4),r.depth=e[t+=4],r.ctype=e[++t],r.compress=e[++t],r.filter=e[++t],r.interlace=e[++t],t++},X._bin={nextZero:function(e,t){for(;0!=e[t];)t++;return t},readUshort:function(e,t){return e[t]<<8|e[t+1]},writeUshort:function(e,t,r){e[t]=r>>8&255,e[t+1]=255&r},readUint:function(e,t){return 16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3])},writeUint:function(e,t,r){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},readASCII:function(e,t,r){for(var i="",s=0;s<r;s++)i+=String.fromCharCode(e[t+s]);return i},writeASCII:function(e,t,r){for(var i=0;i<r.length;i++)e[t+i]=r.charCodeAt(i)},readBytes:function(e,t,r){for(var i=[],s=0;s<r;s++)i.push(e[t+s]);return i},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(t,r,i){for(var e,s="",n=0;n<i;n++)s+="%"+X._bin.pad(t[r+n].toString(16));try{e=decodeURIComponent(s)}catch(e){return X._bin.readASCII(t,r,i)}return e}},X._copyTile=function(e,t,r,i,s,n,a,o,l){for(var h=Math.min(t,s),c=Math.min(r,n),d=0,u=0,p=0;p<c;p++)for(var f=0;f<h;f++)if(u=0<=a&&0<=o?(d=p*t+f<<2,(o+p)*s+a+f<<2):(d=(-o+p)*t-a+f<<2,p*s+f<<2),0==l)i[u]=e[d],i[u+1]=e[d+1],i[u+2]=e[d+2],i[u+3]=e[d+3];else if(1==l){var m=e[d+3]*(1/255),g=e[d]*m,v=e[d+1]*m,b=e[d+2]*m,_=i[u+3]*(1/255),y=i[u]*_,x=i[u+1]*_,w=i[u+2]*_,A=1-m,S=m+_*A,C=0==S?0:1/S;i[u+3]=255*S,i[u+0]=(g+y*A)*C,i[u+1]=(v+x*A)*C,i[u+2]=(b+w*A)*C}else if(2==l){m=e[d+3],g=e[d],v=e[d+1],b=e[d+2],_=i[u+3],y=i[u],x=i[u+1],w=i[u+2];m==_&&g==y&&v==x&&b==w?(i[u]=0,i[u+1]=0,i[u+2]=0,i[u+3]=0):(i[u]=g,i[u+1]=v,i[u+2]=b,i[u+3]=m)}else if(3==l){m=e[d+3],g=e[d],v=e[d+1],b=e[d+2],_=i[u+3],y=i[u],x=i[u+1],w=i[u+2];if((m!=_||g!=y||v!=x||b!=w)&&(m<220&&20<_))return!1}return!0},X.encode=function(e,t,r,i,s,n){null==i&&(i=0),null==n&&(n=!1);for(var a=new Uint8Array(e[0].byteLength*e.length+100),o=[137,80,78,71,13,10,26,10],l=0;l<8;l++)a[l]=o[l];var h=8,c=X._bin,d=X.crc.crc,u=c.writeUint,p=c.writeUshort,f=c.writeASCII,m=X.encode.compressPNG(e,t,r,i,n),g=(u(a,h,13),f(a,h+=4,"IHDR"),u(a,h+=4,t),u(a,h+=4,r),a[h+=4]=m.depth,a[++h]=m.ctype,a[++h]=0,a[++h]=0,a[++h]=0,u(a,++h,d(a,h-17,17)),u(a,h+=4,1),f(a,h+=4,"sRGB"),a[h+=4]=1,u(a,++h,d(a,h-5,5)),h+=4,1<e.length);if(g&&(u(a,h,8),f(a,h+=4,"acTL"),u(a,h+=4,e.length),u(a,h+=4,0),u(a,h+=4,d(a,h-12,12)),h+=4),3==m.ctype){u(a,h,3*(A=m.plte.length)),f(a,h+=4,"PLTE"),h+=4;for(l=0;l<A;l++){var v=3*l,b=m.plte[l],_=b>>8&255,y=b>>16&255;a[h+v+0]=255&b,a[h+v+1]=_,a[h+v+2]=y}if(u(a,h+=3*A,d(a,h-3*A-4,3*A+4)),h+=4,m.gotAlpha){u(a,h,A),f(a,h+=4,"tRNS"),h+=4;for(l=0;l<A;l++)a[h+l]=m.plte[l]>>24&255;u(a,h+=A,d(a,h-A-4,A+4)),h+=4}}for(var x=0,w=0;w<m.frames.length;w++){var A,S=m.frames[w],C=(g&&(u(a,h,26),f(a,h+=4,"fcTL"),u(a,h+=4,x++),u(a,h+=4,S.rect.width),u(a,h+=4,S.rect.height),u(a,h+=4,S.rect.x),u(a,h+=4,S.rect.y),p(a,h+=4,s[w]),p(a,h+=2,1e3),a[h+=2]=S.dispose,a[++h]=S.blend,u(a,++h,d(a,h-30,30)),h+=4),S.cimg),S=(u(a,h,(A=C.length)+(0==w?0:4)),h+=4);f(a,h,0==w?"IDAT":"fdAT"),h+=4,0!=w&&(u(a,h,x++),h+=4);for(l=0;l<A;l++)a[h+l]=C[l];u(a,h+=A,d(a,S,h-S)),h+=4}return u(a,h,0),f(a,h+=4,"IEND"),u(a,h+=4,d(a,h-4,4)),a.buffer.slice(0,h+=4)},X.encode.compressPNG=function(e,t,r,i,s){for(var n=X.encode.compress(e,t,r,i,!1,s),a=0;a<e.length;a++){var o=n.frames[a],l=(o.rect.width,o.rect.height),h=o.bpl,c=o.bpp,d=new Uint8Array(l*h+l);o.cimg=X.encode._filterZero(o.img,l,c,h,d)}return n},X.encode.compress=function(e,t,r,i,s,n){null==n&&(n=!1);for(var a=6,o=8,l=4,R=255,h=0;h<e.length;h++)for(var G=new Uint8Array(e[h]),P=G.length,c=0;c<P;c+=4)R&=G[c+3];var d=255!=R,u={},p=[];if(0!=e.length&&(u[0]=0,p.push(0),0!=i&&i--),0!=i){var f=X.quantize(e,i,s);e=f.bufs;for(c=0;c<f.plte.length;c++)null==u[g=f.plte[c].est.rgba]&&(u[g]=p.length,p.push(g))}else for(h=0;h<e.length;h++)for(var m=new Uint32Array(e[h]),P=m.length,c=0;c<P;c++){var g=m[c];if((c<t||g!=m[c-1]&&g!=m[c-t])&&null==u[g]&&(u[g]=p.length,p.push(g),300<=p.length))break}for(var B=!!d&&s,v=p.length,b=(v<=256&&0==n&&(o=s?8:v<=2?1:v<=4?2:v<=16?4:8,d=!0),[]),h=0;h<e.length;h++){var _=new Uint8Array(e[h]),y=new Uint32Array(_.buffer),x=0,w=0,A=t,S=r,U=0;if(0!=h&&!B){for(var N=s||1==h||2==b[b.length-2].dispose?1:2,C=0,j=1e9,L=0;L<N;L++){for(var V=new Uint8Array(e[h-1-L]),W=new Uint32Array(e[h-1-L]),M=t,z=r,T=-1,E=-1,F=0;F<r;F++)for(var D=0;D<t;D++)y[c=F*t+D]!=W[c]&&(D<M&&(M=D),T<D&&(T=D),F<z&&(z=F),E<F&&(E=F));var H=-1==T?1:(T-M+1)*(E-z+1);H<j&&(j=H,C=L,-1==T?(x=w=0,A=S=1):(A=T-(x=M)+1,S=E-(w=z)+1))}var V=new Uint8Array(e[h-1-C]),k=(1==C&&(b[b.length-1].dispose=2),new Uint8Array(A*S*4));new Uint32Array(k.buffer);X._copyTile(V,t,r,k,A,S,-x,-w,0),U=X._copyTile(_,t,r,k,A,S,-x,-w,3)?(X._copyTile(_,t,r,k,A,S,-x,-w,2),1):(X._copyTile(_,t,r,k,A,S,-x,-w,0),0),_=k,y=new Uint32Array(_.buffer)}var I=4*A;if(v<=256&&0==n){for(I=Math.ceil(o*A/8),k=new Uint8Array(I*S),F=0;F<S;F++){var c=F*I,O=F*A;if(8==o)for(D=0;D<A;D++)k[c+D]=u[y[O+D]];else if(4==o)for(D=0;D<A;D++)k[c+(D>>1)]|=u[y[O+D]]<<4-4*(1&D);else if(2==o)for(D=0;D<A;D++)k[c+(D>>2)]|=u[y[O+D]]<<6-2*(3&D);else if(1==o)for(D=0;D<A;D++)k[c+(D>>3)]|=u[y[O+D]]<<7-(7&D)}_=k,a=3,l=1}else if(0==d&&1==e.length){for(var k=new Uint8Array(A*S*3),q=A*S,c=0;c<q;c++){var Y=3*c,Z=4*c;k[Y]=_[Z],k[1+Y]=_[1+Z],k[2+Y]=_[2+Z]}_=k,a=2,I=(l=3)*A}b.push({rect:{x:x,y:w,width:A,height:S},img:_,bpl:I,bpp:l,blend:U,dispose:B?1:0})}return{ctype:a,depth:o,plte:p,gotAlpha:d,frames:b}},X.encode._filterZero=function(e,t,r,i,s){for(var n=[],a=0;a<5;a++)if(!(5e5<t*i)||2!=a&&3!=a&&4!=a){for(var o=0;o<t;o++)X.encode._filterLine(s,e,o,i,r,a);if(n.push(d.deflate(s)),1==r)break}for(var l,h=1e9,c=0;c<n.length;c++)n[c].length<h&&(h=n[l=c].length);return n[l]},X.encode._filterLine=function(e,t,r,i,s,n){var a=r*i,o=a+r,l=X.decode._paeth;if(e[o]=n,o++,0==n)for(var h=0;h<i;h++)e[o+h]=t[a+h];else if(1==n){for(h=0;h<s;h++)e[o+h]=t[a+h];for(h=s;h<i;h++)e[o+h]=t[a+h]-t[a+h-s]+256&255}else if(0==r){for(h=0;h<s;h++)e[o+h]=t[a+h];if(2==n)for(h=s;h<i;h++)e[o+h]=t[a+h];if(3==n)for(h=s;h<i;h++)e[o+h]=t[a+h]-(t[a+h-s]>>1)+256&255;if(4==n)for(h=s;h<i;h++)e[o+h]=t[a+h]-l(t[a+h-s],0,0)+256&255}else{if(2==n)for(h=0;h<i;h++)e[o+h]=t[a+h]+256-t[a+h-i]&255;if(3==n){for(h=0;h<s;h++)e[o+h]=t[a+h]+256-(t[a+h-i]>>1)&255;for(h=s;h<i;h++)e[o+h]=t[a+h]+256-(t[a+h-i]+t[a+h-s]>>1)&255}if(4==n){for(h=0;h<s;h++)e[o+h]=t[a+h]+256-l(0,t[a+h-i],0)&255;for(h=s;h<i;h++)e[o+h]=t[a+h]+256-l(t[a+h-s],t[a+h-i],t[a+h-s-i])&255}}},X.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,i=0;i<8;i++)1&r?r=3988292384^r>>>1:r>>>=1;e[t]=r}return e}(),update:function(e,t,r,i){for(var s=0;s<i;s++)e=X.crc.table[255&(e^t[r+s])]^e>>>8;return e},crc:function(e,t,r){return 4294967295^X.crc.update(4294967295,e,t,r)}},X.quantize=function(e,t,r){for(var i=[],s=0,n=0;n<e.length;n++)i.push(X.encode.alphaMul(new Uint8Array(e[n]),r)),s+=e[n].byteLength;for(var a=new Uint8Array(s),o=new Uint32Array(a.buffer),l=0,n=0;n<i.length;n++){for(var h=i[n],c=h.length,d=0;d<c;d++)a[l+d]=h[d];l+=c}for(var u={i0:0,i1:a.length,bst:null,est:null,tdst:0,left:null,right:null},p=(u.bst=X.quantize.stats(a,u.i0,u.i1),u.est=X.quantize.estats(u.bst),[u]);p.length<t;){for(var f=0,m=0,n=0;n<p.length;n++)p[n].est.L>f&&(f=p[n].est.L,m=n);if(f<.001)break;var g=p[m],v=X.quantize.splitPixels(a,o,g.i0,g.i1,g.est.e,g.est.eMq255),b={i0:g.i0,i1:v,bst:null,est:null,tdst:0,left:null,right:null},_=(b.bst=X.quantize.stats(a,b.i0,b.i1),b.est=X.quantize.estats(b.bst),{i0:v,i1:g.i1,bst:null,est:null,tdst:0,left:null,right:null});_.bst={R:[],m:[],N:g.bst.N-b.bst.N};for(n=0;n<16;n++)_.bst.R[n]=g.bst.R[n]-b.bst.R[n];for(n=0;n<4;n++)_.bst.m[n]=g.bst.m[n]-b.bst.m[n];_.est=X.quantize.estats(_.bst),g.left=b,g.right=_,p[m]=b,p.push(_)}p.sort(function(e,t){return t.bst.N-e.bst.N});for(var y=0;y<i.length;y++){for(var x=X.quantize.planeDst,w=new Uint8Array(i[y].buffer),A=new Uint32Array(i[y].buffer),S=w.length,n=0;n<S;n+=4){for(var C=w[n]*(1/255),L=w[n+1]*(1/255),M=w[n+2]*(1/255),z=w[n+3]*(1/255),T=u;T.left;)T=x(T.est,C,L,M,z)<=0?T.left:T.right;A[n>>2]=T.est.rgba}i[y]=A.buffer}return{bufs:i,plte:p}},X.quantize.getNearest=function(e,t,r,i,s){if(null==e.left)return e.tdst=X.quantize.dist(e.est.q,t,r,i,s),e;var n=X.quantize.planeDst(e.est,t,r,i,s),a=e.left,o=e.right,e=(0<n&&(a=e.right,o=e.left),X.quantize.getNearest(a,t,r,i,s));if(e.tdst<=n*n)return e;a=X.quantize.getNearest(o,t,r,i,s);return a.tdst<e.tdst?a:e},X.quantize.planeDst=function(e,t,r,i,s){var n=e.e;return n[0]*t+n[1]*r+n[2]*i+n[3]*s-e.eMq},X.quantize.dist=function(e,t,r,i,s){t-=e[0],r-=e[1],i-=e[2],s-=e[3];return t*t+r*r+i*i+s*s},X.quantize.splitPixels=function(e,t,r,i,s,n){var a=X.quantize.vecDot;for(i-=4;r<i;){for(;a(e,r,s)<=n;)r+=4;for(;a(e,i,s)>n;)i-=4;if(i<=r)break;var o=t[r>>2];t[r>>2]=t[i>>2],t[i>>2]=o,r+=4,i-=4}for(;a(e,r,s)>n;)r-=4;return r+4},X.quantize.vecDot=function(e,t,r){return e[t]*r[0]+e[t+1]*r[1]+e[t+2]*r[2]+e[t+3]*r[3]},X.quantize.stats=function(e,t,r){for(var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=[0,0,0,0],n=r-t>>2,a=t;a<r;a+=4){var o=e[a]*(1/255),l=e[a+1]*(1/255),h=e[a+2]*(1/255),c=e[a+3]*(1/255);s[0]+=o,s[1]+=l,s[2]+=h,s[3]+=c,i[0]+=o*o,i[1]+=o*l,i[2]+=o*h,i[3]+=o*c,i[5]+=l*l,i[6]+=l*h,i[7]+=l*c,i[10]+=h*h,i[11]+=h*c,i[15]+=c*c}return i[4]=i[1],i[8]=i[2],i[12]=i[3],i[9]=i[6],i[13]=i[7],i[14]=i[11],{R:i,m:s,N:n}},X.quantize.estats=function(e){var t,r=e.R,i=e.m,e=e.N,s=i[0],n=i[1],a=i[2],i=i[3],o=0==e?0:1/e,r=[r[0]-s*s*o,r[1]-s*n*o,r[2]-s*a*o,r[3]-s*i*o,r[4]-n*s*o,r[5]-n*n*o,r[6]-n*a*o,r[7]-n*i*o,r[8]-a*s*o,r[9]-a*n*o,r[10]-a*a*o,r[11]-a*i*o,r[12]-i*s*o,r[13]-i*n*o,r[14]-i*a*o,r[15]-i*i*o],l=r,h=X.M4,c=[.5,.5,.5,.5],d=0;if(0!=e)for(var u=0;u<10&&(c=h.multVec(l,c),t=Math.sqrt(h.dot(c,c)),c=h.sml(1/t,c),!(Math.abs(t-d)<1e-9));u++)d=t;e=[s*o,n*o,a*o,i*o],s=h.dot(h.sml(255,e),c),n=e[3]<.001?0:1/e[3];return{Cov:r,q:e,e:c,L:d,eMq255:s,eMq:h.dot(c,e),rgba:(Math.round(255*e[3])<<24|Math.round(255*e[2]*n)<<16|Math.round(255*e[1]*n)<<8|Math.round(255*e[0]*n)<<0)>>>0}},X.M4={multVec:function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]]},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},sml:function(e,t){return[e*t[0],e*t[1],e*t[2],e*t[3]]}},X.encode.alphaMul=function(e,t){for(var r=new Uint8Array(e.length),i=e.length>>2,s=0;s<i;s++){var n=s<<2,a=e[3+n],o=(a=t?a<128?0:255:a)*(1/255);r[n]=e[n]*o,r[1+n]=e[1+n]*o,r[2+n]=e[2+n]*o,r[3+n]=a}return r}},"./node_modules/upng-js/node_modules/pako/index.js":(e,t,r)=>{var i={};(0,r("./node_modules/upng-js/node_modules/pako/lib/utils/common.js").assign)(i,r("./node_modules/upng-js/node_modules/pako/lib/deflate.js"),r("./node_modules/upng-js/node_modules/pako/lib/inflate.js"),r("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js")),e.exports=i},"./node_modules/upng-js/node_modules/pako/lib/deflate.js":(e,t,r)=>{var a=r("./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js"),o=r("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),l=r("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),i=r("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),s=r("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),h=Object.prototype.toString;function n(e){if(!(this instanceof n))return new n(e);this.options=o.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});e=this.options;if(e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,(this.strm.avail_out=0)!==(t=a.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy)))throw new Error(i[t]);if(e.header&&a.deflateSetHeader(this.strm,e.header),e.dictionary){var t,e="string"==typeof e.dictionary?l.string2buf(e.dictionary):"[object ArrayBuffer]"===h.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary;if(0!==(t=a.deflateSetDictionary(this.strm,e)))throw new Error(i[t]);this._dict_set=!0}}function c(e,t){t=new n(t);if(t.push(e,!0),t.err)throw t.msg||i[t.err];return t.result}n.prototype.push=function(e,t){var r,i,s=this.strm,n=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=l.string2buf(e):"[object ArrayBuffer]"===h.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new o.Buf8(n),s.next_out=0,s.avail_out=n),1!==(r=a.deflate(s,i))&&0!==r)return this.onEnd(r),!(this.ended=!0)}while(0!==s.avail_out&&(0!==s.avail_in||4!==i&&2!==i)||("string"===this.options.to?this.onData(l.buf2binstring(o.shrinkBuf(s.output,s.next_out))):this.onData(o.shrinkBuf(s.output,s.next_out))),(0<s.avail_in||0===s.avail_out)&&1!==r);return 4===i?(r=a.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==i||(this.onEnd(0),!(s.avail_out=0))},n.prototype.onData=function(e){this.chunks.push(e)},n.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=n,t.deflate=c,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,c(e,t)}},"./node_modules/upng-js/node_modules/pako/lib/inflate.js":(e,t,r)=>{var d=r("./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js"),u=r("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),p=r("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),f=r("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),i=r("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),s=r("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),n=r("./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js"),m=Object.prototype.toString;function a(e){if(!(this instanceof a))return new a(e);this.options=u.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options,e=(t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0,d.inflateInit2(this.strm,t.windowBits));if(e!==f.Z_OK)throw new Error(i[e]);if(this.header=new n,d.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=p.string2buf(t.dictionary):"[object ArrayBuffer]"===m.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=d.inflateSetDictionary(this.strm,t.dictionary))!==f.Z_OK))throw new Error(i[e])}function o(e,t){t=new a(t);if(t.push(e,!0),t.err)throw t.msg||i[t.err];return t.result}a.prototype.push=function(e,t){var r,i,s,n,a,o=this.strm,l=this.options.chunkSize,h=this.options.dictionary,c=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?f.Z_FINISH:f.Z_NO_FLUSH,"string"==typeof e?o.input=p.binstring2buf(e):"[object ArrayBuffer]"===m.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new u.Buf8(l),o.next_out=0,o.avail_out=l),(r=(r=d.inflate(o,f.Z_NO_FLUSH))===f.Z_NEED_DICT&&h?d.inflateSetDictionary(this.strm,h):r)===f.Z_BUF_ERROR&&!0===c&&(r=f.Z_OK,c=!1),r!==f.Z_STREAM_END&&r!==f.Z_OK)return this.onEnd(r),!(this.ended=!0)}while(!o.next_out||0!==o.avail_out&&r!==f.Z_STREAM_END&&(0!==o.avail_in||i!==f.Z_FINISH&&i!==f.Z_SYNC_FLUSH)||("string"===this.options.to?(s=p.utf8border(o.output,o.next_out),n=o.next_out-s,a=p.buf2string(o.output,s),o.next_out=n,o.avail_out=l-n,n&&u.arraySet(o.output,o.output,s,n,0),this.onData(a)):this.onData(u.shrinkBuf(o.output,o.next_out))),0===o.avail_in&&0===o.avail_out&&(c=!0),(0<o.avail_in||0===o.avail_out)&&r!==f.Z_STREAM_END);return(i=r===f.Z_STREAM_END?f.Z_FINISH:i)===f.Z_FINISH?(r=d.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===f.Z_OK):i!==f.Z_SYNC_FLUSH||(this.onEnd(f.Z_OK),!(o.avail_out=0))},a.prototype.onData=function(e){this.chunks.push(e)},a.prototype.onEnd=function(e){e===f.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=a,t.inflate=o,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,o(e,t)},t.ungzip=o},"./node_modules/upng-js/node_modules/pako/lib/utils/common.js":(e,t)=>{var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t,r,i=Array.prototype.slice.call(arguments,1);i.length;){var s=i.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(var n in s)t=s,r=n,Object.prototype.hasOwnProperty.call(t,r)&&(e[n]=s[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,i,s){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+i),s);else for(var n=0;n<i;n++)e[s+n]=t[r+n]},flattenChunks:function(e){for(var t,r,i,s=0,n=0,a=e.length;n<a;n++)s+=e[n].length;for(i=new Uint8Array(s),n=t=0,a=e.length;n<a;n++)r=e[n],i.set(r,t),t+=r.length;return i}},s={arraySet:function(e,t,r,i,s){for(var n=0;n<i;n++)e[s+n]=t[r+n]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,s))},t.setTyped(r)},"./node_modules/upng-js/node_modules/pako/lib/utils/strings.js":(e,t,r)=>{var l=r("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),s=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch(e){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){n=!1}for(var h=new l.Buf8(256),i=0;i<256;i++)h[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;function c(e,t){if(t<65534&&(e.subarray&&n||!e.subarray&&s))return String.fromCharCode.apply(null,l.shrinkBuf(e,t));for(var r="",i=0;i<t;i++)r+=String.fromCharCode(e[i]);return r}h[254]=h[254]=1,t.string2buf=function(e){for(var t,r,i,s,n=e.length,a=0,o=0;o<n;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<n&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),a+=r<128?1:r<2048?2:r<65536?3:4;for(t=new l.Buf8(a),o=s=0;s<a;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<n&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),r<128?t[s++]=r:(r<2048?t[s++]=192|r>>>6:(r<65536?t[s++]=224|r>>>12:(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63),t[s++]=128|r>>>6&63),t[s++]=128|63&r);return t},t.buf2binstring=function(e){return c(e,e.length)},t.binstring2buf=function(e){for(var t=new l.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},t.buf2string=function(e,t){for(var r,i,s=t||e.length,n=new Array(2*s),a=0,o=0;o<s;)if((r=e[o++])<128)n[a++]=r;else if(4<(i=h[r]))n[a++]=65533,o+=i-1;else{for(r&=2===i?31:3===i?15:7;1<i&&o<s;)r=r<<6|63&e[o++],i--;1<i?n[a++]=65533:r<65536?n[a++]=r:(r-=65536,n[a++]=55296|r>>10&1023,n[a++]=56320|1023&r)}return c(n,a)},t.utf8border=function(e,t){for(var r=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=r&&128==(192&e[r]);)r--;return!(r<0)&&0!==r&&r+h[e[r]]>t?r:t}},"./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js":e=>{e.exports=function(e,t,r,i){for(var s=65535&e|0,n=e>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;n=n+(s=s+t[i++]|0)|0,--a;);s%=65521,n%=65521}return s|n<<16|0}},"./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js":e=>{e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},"./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js":e=>{var o=function(){for(var e=[],t=0;t<256;t++){for(var r=t,i=0;i<8;i++)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return e}();e.exports=function(e,t,r,i){var s=o,n=i+r;e^=-1;for(var a=i;a<n;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}},"./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js":(R,e,t)=>{var o,d=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),l=t("./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js"),u=t("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),p=t("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),G=t("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),h=0,c=4,f=0,m=-2,P=-1,B=4,U=2,g=8,N=9,r=286,j=30,V=19,W=2*r+1,H=15,v=3,b=258,_=b+v+1,y=42,x=113,w=1,A=2,S=3,C=4;function L(e,t){return e.msg=G[t],t}function M(e){return(e<<1)-(4<e?9:0)}function z(e){for(var t=e.length;0<=--t;)e[t]=0}function T(e){var t=e.state,r=t.pending;0!==(r=r>e.avail_out?e.avail_out:r)&&(d.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function E(e,t){l._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,T(e.strm)}function F(e,t){e.pending_buf[e.pending++]=t}function D(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function n(e,t){var r,i,s=e.max_chain_length,n=e.strstart,a=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-_?e.strstart-(e.w_size-_):0,h=e.window,c=e.w_mask,d=e.prev,u=e.strstart+b,p=h[n+a-1],f=h[n+a];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(h[(r=t)+a]===f&&h[r+a-1]===p&&h[r]===h[n]&&h[++r]===h[n+1]){for(n+=2,r++;h[++n]===h[++r]&&h[++n]===h[++r]&&h[++n]===h[++r]&&h[++n]===h[++r]&&h[++n]===h[++r]&&h[++n]===h[++r]&&h[++n]===h[++r]&&h[++n]===h[++r]&&n<u;);if(i=b-(u-n),n=u-b,a<i){if(e.match_start=t,o<=(a=i))break;p=h[n+a-1],f=h[n+a]}}}while((t=d[t&c])>l&&0!=--s);return a<=e.lookahead?a:e.lookahead}function k(e){var t,r,i,s,n,a,o,l,h,c=e.w_size;do{if(l=e.window_size-e.lookahead-e.strstart,e.strstart>=c+(c-_)){for(d.arraySet(e.window,e.window,c,c,0),e.match_start-=c,e.strstart-=c,e.block_start-=c,t=r=e.hash_size;i=e.head[--t],e.head[t]=c<=i?i-c:0,--r;);for(t=r=c;i=e.prev[--t],e.prev[t]=c<=i?i-c:0,--r;);l+=c}if(0===e.strm.avail_in)break;if(n=e.strm,a=e.window,o=e.strstart+e.lookahead,l=l,h=void 0,h=n.avail_in,r=0===(h=l<h?l:h)?0:(n.avail_in-=h,d.arraySet(a,n.input,n.next_in,h,o),1===n.state.wrap?n.adler=u(n.adler,a,h,o):2===n.state.wrap&&(n.adler=p(n.adler,a,h,o)),n.next_in+=h,n.total_in+=h,h),e.lookahead+=r,e.lookahead+e.insert>=v)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+v-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<v)););}while(e.lookahead<_&&0!==e.strm.avail_in)}function i(e,t){for(var r,i;;){if(e.lookahead<_){if(k(e),e.lookahead<_&&t===h)return w;if(0===e.lookahead)break}if(r=0,e.lookahead>=v&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+v-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-_&&(e.match_length=n(e,r)),e.match_length>=v)if(i=l._tr_tally(e,e.strstart-e.match_start,e.match_length-v),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=v){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+v-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=l._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(E(e,!1),0===e.strm.avail_out))return w}return e.insert=e.strstart<v-1?e.strstart:v-1,t===c?(E(e,!0),0===e.strm.avail_out?S:C):e.last_lit&&(E(e,!1),0===e.strm.avail_out)?w:A}function s(e,t){for(var r,i,s;;){if(e.lookahead<_){if(k(e),e.lookahead<_&&t===h)return w;if(0===e.lookahead)break}if(r=0,e.lookahead>=v&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+v-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=v-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-_&&(e.match_length=n(e,r),e.match_length<=5&&(1===e.strategy||e.match_length===v&&4096<e.strstart-e.match_start)&&(e.match_length=v-1)),e.prev_length>=v&&e.match_length<=e.prev_length){for(s=e.strstart+e.lookahead-v,i=l._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-v),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+v-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=v-1,e.strstart++,i&&(E(e,!1),0===e.strm.avail_out))return w}else if(e.match_available){if((i=l._tr_tally(e,0,e.window[e.strstart-1]))&&E(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return w}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=l._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<v-1?e.strstart:v-1,t===c?(E(e,!0),0===e.strm.avail_out?S:C):e.last_lit&&(E(e,!1),0===e.strm.avail_out)?w:A}function a(e,t,r,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=s}function q(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new d.Buf16(2*W),this.dyn_dtree=new d.Buf16(2*(2*j+1)),this.bl_tree=new d.Buf16(2*(2*V+1)),z(this.dyn_ltree),z(this.dyn_dtree),z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new d.Buf16(H+1),this.heap=new d.Buf16(2*r+1),z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new d.Buf16(2*r+1),z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function I(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=U,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?y:x,e.adler=2===t.wrap?0:1,t.last_flush=h,l._tr_init(t),f):L(e,m)}function O(e){var t=I(e);return t===f&&((e=e.state).window_size=2*e.w_size,z(e.head),e.max_lazy_match=o[e.level].max_lazy,e.good_match=o[e.level].good_length,e.nice_match=o[e.level].nice_length,e.max_chain_length=o[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=v-1,e.match_available=0,e.ins_h=0),t}function Y(e,t,r,i,s,n){if(!e)return m;var a=1;if(t===P&&(t=6),i<0?(a=0,i=-i):15<i&&(a=2,i-=16),s<1||N<s||r!==g||i<8||15<i||t<0||9<t||n<0||B<n)return L(e,m);8===i&&(i=9);var o=new q;return(e.state=o).strm=e,o.wrap=a,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+v-1)/v),o.window=new d.Buf8(2*o.w_size),o.head=new d.Buf16(o.hash_size),o.prev=new d.Buf16(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new d.Buf8(o.pending_buf_size),o.d_buf=+o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=n,o.method=r,O(e)}o=[new a(0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(k(e),0===e.lookahead&&t===h)return w;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+r;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,E(e,!1),0===e.strm.avail_out))return w;if(e.strstart-e.block_start>=e.w_size-_&&(E(e,!1),0===e.strm.avail_out))return w}return e.insert=0,t===c?(E(e,!0),0===e.strm.avail_out?S:C):(e.strstart>e.block_start&&(E(e,!1),e.strm.avail_out),w)}),new a(4,4,8,4,i),new a(4,5,16,8,i),new a(4,6,32,32,i),new a(4,4,16,16,s),new a(8,16,32,32,s),new a(8,16,128,128,s),new a(8,32,128,256,s),new a(32,128,258,1024,s),new a(32,258,258,4096,s)],e.deflateInit=function(e,t){return Y(e,t,g,15,8,0)},e.deflateInit2=Y,e.deflateReset=O,e.deflateResetKeep=I,e.deflateSetHeader=function(e,t){return!e||!e.state||2!==e.state.wrap?m:(e.state.gzhead=t,f)},e.deflate=function(e,t){var r,i,s,n;if(!e||!e.state||5<t||t<0)return e?L(e,m):m;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&t!==c)return L(e,0===e.avail_out?-5:m);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===y&&(2===i.wrap?(e.adler=0,F(i,31),F(i,139),F(i,8),i.gzhead?(F(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),F(i,255&i.gzhead.time),F(i,i.gzhead.time>>8&255),F(i,i.gzhead.time>>16&255),F(i,i.gzhead.time>>24&255),F(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),F(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(F(i,255&i.gzhead.extra.length),F(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=p(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(F(i,0),F(i,0),F(i,0),F(i,0),F(i,0),F(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),F(i,3),i.status=x)):(a=g+(i.w_bits-8<<4)<<8,a|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(a|=32),a+=31-a%31,i.status=x,D(i,a),0!==i.strstart&&(D(i,e.adler>>>16),D(i,65535&e.adler)),e.adler=1)),69===i.status)if(i.gzhead.extra){for(s=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>s&&(e.adler=p(e.adler,i.pending_buf,i.pending-s,s)),T(e),s=i.pending,i.pending!==i.pending_buf_size));)F(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>s&&(e.adler=p(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=p(e.adler,i.pending_buf,i.pending-s,s)),T(e),s=i.pending,i.pending===i.pending_buf_size)){n=1;break}}while(n=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,F(i,n),0!==n);i.gzhead.hcrc&&i.pending>s&&(e.adler=p(e.adler,i.pending_buf,i.pending-s,s)),0===n&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){s=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>s&&(e.adler=p(e.adler,i.pending_buf,i.pending-s,s)),T(e),s=i.pending,i.pending===i.pending_buf_size)){n=1;break}}while(n=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,F(i,n),0!==n);i.gzhead.hcrc&&i.pending>s&&(e.adler=p(e.adler,i.pending_buf,i.pending-s,s)),0===n&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&T(e),i.pending+2<=i.pending_buf_size&&(F(i,255&e.adler),F(i,e.adler>>8&255),e.adler=0,i.status=x)):i.status=x),0!==i.pending){if(T(e),0===e.avail_out)return i.last_flush=-1,f}else if(0===e.avail_in&&M(t)<=M(r)&&t!==c)return L(e,-5);if(666===i.status&&0!==e.avail_in)return L(e,-5);if(0!==e.avail_in||0!==i.lookahead||t!==h&&666!==i.status){var a=2===i.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(k(e),0===e.lookahead)){if(t===h)return w;break}if(e.match_length=0,r=l._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(E(e,!1),0===e.strm.avail_out))return w}return e.insert=0,t===c?(E(e,!0),0===e.strm.avail_out?S:C):e.last_lit&&(E(e,!1),0===e.strm.avail_out)?w:A}(i,t):3===i.strategy?function(e,t){for(var r,i,s,n,a=e.window;;){if(e.lookahead<=b){if(k(e),e.lookahead<=b&&t===h)return w;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=v&&0<e.strstart&&(i=a[s=e.strstart-1])===a[++s]&&i===a[++s]&&i===a[++s]){for(n=e.strstart+b;i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&i===a[++s]&&s<n;);e.match_length=b-(n-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=v?(r=l._tr_tally(e,1,e.match_length-v),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=l._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(E(e,!1),0===e.strm.avail_out))return w}return e.insert=0,t===c?(E(e,!0),0===e.strm.avail_out?S:C):e.last_lit&&(E(e,!1),0===e.strm.avail_out)?w:A}(i,t):o[i.level].func(i,t);if(a!==S&&a!==C||(i.status=666),a===w||a===S)return 0===e.avail_out&&(i.last_flush=-1),f;if(a===A&&(1===t?l._tr_align(i):5!==t&&(l._tr_stored_block(i,0,0,!1),3===t&&(z(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),T(e),0===e.avail_out))return i.last_flush=-1,f}return t!==c?f:i.wrap<=0?1:(2===i.wrap?(F(i,255&e.adler),F(i,e.adler>>8&255),F(i,e.adler>>16&255),F(i,e.adler>>24&255),F(i,255&e.total_in),F(i,e.total_in>>8&255),F(i,e.total_in>>16&255),F(i,e.total_in>>24&255)):(D(i,e.adler>>>16),D(i,65535&e.adler)),T(e),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?f:1)},e.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==y&&69!==t&&73!==t&&91!==t&&103!==t&&t!==x&&666!==t?L(e,m):(e.state=null,t===x?L(e,-3):f):m},e.deflateSetDictionary=function(e,t){var r,i,s,n,a,o,l,h=t.length;if(!e||!e.state)return m;if(2===(n=(r=e.state).wrap)||1===n&&r.status!==y||r.lookahead)return m;for(1===n&&(e.adler=u(e.adler,t,h,0)),r.wrap=0,h>=r.w_size&&(0===n&&(z(r.head),r.strstart=0,r.block_start=0,r.insert=0),l=new d.Buf8(r.w_size),d.arraySet(l,t,h-r.w_size,r.w_size,0),t=l,h=r.w_size),l=e.avail_in,a=e.next_in,o=e.input,e.avail_in=h,e.next_in=0,e.input=t,k(r);r.lookahead>=v;){for(i=r.strstart,s=r.lookahead-(v-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[i+v-1])&r.hash_mask,r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++,--s;);r.strstart=i,r.lookahead=v-1,k(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=v-1,r.match_available=0,e.next_in=a,e.input=o,e.avail_in=l,r.wrap=n,f},e.deflateInfo="pako deflate (from Nodeca project)"},"./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js":e=>{e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},"./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js":e=>{e.exports=function(e,t){var r,i,s,n,a,o,l=e.state,h=e.next_in,c=e.input,d=h+(e.avail_in-5),u=e.next_out,p=e.output,f=u-(t-e.avail_out),m=u+(e.avail_out-257),g=l.dmax,v=l.wsize,b=l.whave,_=l.wnext,y=l.window,x=l.hold,w=l.bits,A=l.lencode,S=l.distcode,C=(1<<l.lenbits)-1,L=(1<<l.distbits)-1;e:do{for(w<15&&(x+=c[h++]<<w,w+=8,x+=c[h++]<<w,w+=8),r=A[x&C];;){if(x>>>=i=r>>>24,w-=i,0===(i=r>>>16&255))p[u++]=65535&r;else{if(!(16&i)){if(0==(64&i)){r=A[(65535&r)+(x&(1<<i)-1)];continue}if(32&i){l.mode=12;break e}e.msg="invalid literal/length code",l.mode=30;break e}for(s=65535&r,(i&=15)&&(w<i&&(x+=c[h++]<<w,w+=8),s+=x&(1<<i)-1,x>>>=i,w-=i),w<15&&(x+=c[h++]<<w,w+=8,x+=c[h++]<<w,w+=8),r=S[x&L];;){if(x>>>=i=r>>>24,w-=i,!(16&(i=r>>>16&255))){if(0==(64&i)){r=S[(65535&r)+(x&(1<<i)-1)];continue}e.msg="invalid distance code",l.mode=30;break e}if(n=65535&r,w<(i&=15)&&(x+=c[h++]<<w,(w+=8)<i&&(x+=c[h++]<<w,w+=8)),g<(n+=x&(1<<i)-1)){e.msg="invalid distance too far back",l.mode=30;break e}if(x>>>=i,w-=i,(i=u-f)<n){if(b<(i=n-i)&&l.sane){e.msg="invalid distance too far back",l.mode=30;break e}if(o=y,(a=0)===_){if(a+=v-i,i<s){for(s-=i;p[u++]=y[a++],--i;);a=u-n,o=p}}else if(_<i){if(a+=v+_-i,(i-=_)<s){for(s-=i;p[u++]=y[a++],--i;);if(a=0,_<s){for(s-=i=_;p[u++]=y[a++],--i;);a=u-n,o=p}}}else if(a+=_-i,i<s){for(s-=i;p[u++]=y[a++],--i;);a=u-n,o=p}for(;2<s;)p[u++]=o[a++],p[u++]=o[a++],p[u++]=o[a++],s-=3;s&&(p[u++]=o[a++],1<s&&(p[u++]=o[a++]))}else{for(a=u-n;p[u++]=p[a++],p[u++]=p[a++],p[u++]=p[a++],2<(s-=3););s&&(p[u++]=p[a++],1<s&&(p[u++]=p[a++]))}break}}break}}while(h<d&&u<m);x&=(1<<(w-=(s=w>>3)<<3))-1,e.next_in=h-=s,e.next_out=u,e.avail_in=h<d?d-h+5:5-(h-d),e.avail_out=u<m?m-u+257:257-(u-m),l.hold=x,l.bits=w}},"./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js":(e,t,r)=>{var F=r("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),D=r("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),k=r("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),I=r("./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js"),O=r("./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js"),R=1,G=2,P=0,B=-2,U=1,i=852,s=592;function N(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new F.Buf16(320),this.work=new F.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=U,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new F.Buf32(i),t.distcode=t.distdyn=new F.Buf32(s),t.sane=1,t.back=-1,P):B}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):B}function l(e,t){var r,i;return e&&e.state?(i=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?B:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,o(e))):B}function h(e,t){var r;return e?(r=new n,(e.state=r).window=null,(r=l(e,t))!==P&&(e.state=null),r):B}var j,V,W=!0;function H(e,t,r,i){var s,e=e.state;return null===e.window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new F.Buf8(e.wsize)),i>=e.wsize?(F.arraySet(e.window,t,r-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):(i<(s=e.wsize-e.wnext)&&(s=i),F.arraySet(e.window,t,r-i,s,e.wnext),(i-=s)?(F.arraySet(e.window,t,r-i,i,0),e.wnext=i,e.whave=e.wsize):(e.wnext+=s,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=s))),0}t.inflateReset=o,t.inflateReset2=l,t.inflateResetKeep=a,t.inflateInit=function(e){return h(e,15)},t.inflateInit2=h,t.inflate=function(e,t){var r,i,s,n,a,o,l,h,c,d,u,p,f,m,g,v,b,_,y,x,w,A,S,C,L=0,M=new F.Buf8(4),z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return B;12===(r=e.state).mode&&(r.mode=13),a=e.next_out,s=e.output,l=e.avail_out,n=e.next_in,i=e.input,o=e.avail_in,h=r.hold,c=r.bits,d=o,u=l,A=P;e:for(;;)switch(r.mode){case U:if(0===r.wrap){r.mode=13;break}for(;c<16;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}if(2&r.wrap&&35615===h){M[r.check=0]=255&h,M[1]=h>>>8&255,r.check=k(r.check,M,2,0),c=h=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&h)){e.msg="unknown compression method",r.mode=30;break}if(c-=4,w=8+(15&(h>>>=4)),0===r.wbits)r.wbits=w;else if(w>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<w,e.adler=r.check=1,r.mode=512&h?10:12,c=h=0;break;case 2:for(;c<16;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}if(r.flags=h,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=h>>8&1),512&r.flags&&(M[0]=255&h,M[1]=h>>>8&255,r.check=k(r.check,M,2,0)),c=h=0,r.mode=3;case 3:for(;c<32;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}r.head&&(r.head.time=h),512&r.flags&&(M[0]=255&h,M[1]=h>>>8&255,M[2]=h>>>16&255,M[3]=h>>>24&255,r.check=k(r.check,M,4,0)),c=h=0,r.mode=4;case 4:for(;c<16;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}r.head&&(r.head.xflags=255&h,r.head.os=h>>8),512&r.flags&&(M[0]=255&h,M[1]=h>>>8&255,r.check=k(r.check,M,2,0)),c=h=0,r.mode=5;case 5:if(1024&r.flags){for(;c<16;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}r.length=h,r.head&&(r.head.extra_len=h),512&r.flags&&(M[0]=255&h,M[1]=h>>>8&255,r.check=k(r.check,M,2,0)),c=h=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((p=o<(p=r.length)?o:p)&&(r.head&&(w=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),F.arraySet(r.head.extra,i,n,p,w)),512&r.flags&&(r.check=k(r.check,i,p,n)),o-=p,n+=p,r.length-=p),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break e;for(p=0;w=i[n+p++],r.head&&w&&r.length<65536&&(r.head.name+=String.fromCharCode(w)),w&&p<o;);if(512&r.flags&&(r.check=k(r.check,i,p,n)),o-=p,n+=p,w)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break e;for(p=0;w=i[n+p++],r.head&&w&&r.length<65536&&(r.head.comment+=String.fromCharCode(w)),w&&p<o;);if(512&r.flags&&(r.check=k(r.check,i,p,n)),o-=p,n+=p,w)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;c<16;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}if(h!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}c=h=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;c<32;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}e.adler=r.check=N(h),c=h=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=a,e.avail_out=l,e.next_in=n,e.avail_in=o,r.hold=h,r.bits=c,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){h>>>=7&c,c-=7&c,r.mode=27;break}for(;c<3;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}switch(r.last=1&h,--c,3&(h>>>=1)){case 0:r.mode=14;break;case 1:T=E=void 0;var T,E=r;if(W){for(j=new F.Buf32(512),V=new F.Buf32(32),T=0;T<144;)E.lens[T++]=8;for(;T<256;)E.lens[T++]=9;for(;T<280;)E.lens[T++]=7;for(;T<288;)E.lens[T++]=8;for(O(R,E.lens,0,288,j,0,E.work,{bits:9}),T=0;T<32;)E.lens[T++]=5;O(G,E.lens,0,32,V,0,E.work,{bits:5}),W=!1}if(E.lencode=j,E.lenbits=9,E.distcode=V,E.distbits=5,r.mode=20,6!==t)break;h>>>=2,c-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}h>>>=2,c-=2;break;case 14:for(h>>>=7&c,c-=7&c;c<32;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&h,c=h=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(p=r.length){if(0===(p=l<(p=o<p?o:p)?l:p))break e;F.arraySet(s,i,n,p,a),o-=p,n+=p,l-=p,a+=p,r.length-=p;break}r.mode=12;break;case 17:for(;c<14;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}if(r.nlen=257+(31&h),h>>>=5,c-=5,r.ndist=1+(31&h),h>>>=5,c-=5,r.ncode=4+(15&h),h>>>=4,c-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;c<3;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}r.lens[z[r.have++]]=7&h,h>>>=3,c-=3}for(;r.have<19;)r.lens[z[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,S={bits:r.lenbits},A=O(0,r.lens,0,19,r.lencode,0,r.work,S),r.lenbits=S.bits,A){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;v=(L=r.lencode[h&(1<<r.lenbits)-1])>>>16&255,b=65535&L,!((g=L>>>24)<=c);){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}if(b<16)h>>>=g,c-=g,r.lens[r.have++]=b;else{if(16===b){for(C=g+2;c<C;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}if(h>>>=g,c-=g,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}w=r.lens[r.have-1],p=3+(3&h),h>>>=2,c-=2}else if(17===b){for(C=g+3;c<C;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}w=0,p=3+(7&(h>>>=g)),h>>>=3,c=c-g-3}else{for(C=g+7;c<C;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}w=0,p=11+(127&(h>>>=g)),h>>>=7,c=c-g-7}if(r.have+p>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;p--;)r.lens[r.have++]=w}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,S={bits:r.lenbits},A=O(R,r.lens,0,r.nlen,r.lencode,0,r.work,S),r.lenbits=S.bits,A){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,S={bits:r.distbits},A=O(G,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,S),r.distbits=S.bits,A){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=o&&258<=l){e.next_out=a,e.avail_out=l,e.next_in=n,e.avail_in=o,r.hold=h,r.bits=c,I(e,u),a=e.next_out,s=e.output,l=e.avail_out,n=e.next_in,i=e.input,o=e.avail_in,h=r.hold,c=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;v=(L=r.lencode[h&(1<<r.lenbits)-1])>>>16&255,b=65535&L,!((g=L>>>24)<=c);){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}if(v&&0==(240&v)){for(_=g,y=v,x=b;v=(L=r.lencode[x+((h&(1<<_+y)-1)>>_)])>>>16&255,b=65535&L,!(_+(g=L>>>24)<=c);){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}h>>>=_,c-=_,r.back+=_}if(h>>>=g,c-=g,r.back+=g,r.length=b,0===v){r.mode=26;break}if(32&v){r.back=-1,r.mode=12;break}if(64&v){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&v,r.mode=22;case 22:if(r.extra){for(C=r.extra;c<C;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}r.length+=h&(1<<r.extra)-1,h>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;v=(L=r.distcode[h&(1<<r.distbits)-1])>>>16&255,b=65535&L,!((g=L>>>24)<=c);){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}if(0==(240&v)){for(_=g,y=v,x=b;v=(L=r.distcode[x+((h&(1<<_+y)-1)>>_)])>>>16&255,b=65535&L,!(_+(g=L>>>24)<=c);){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}h>>>=_,c-=_,r.back+=_}if(h>>>=g,c-=g,r.back+=g,64&v){e.msg="invalid distance code",r.mode=30;break}r.offset=b,r.extra=15&v,r.mode=24;case 24:if(r.extra){for(C=r.extra;c<C;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}r.offset+=h&(1<<r.extra)-1,h>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===l)break e;if(r.offset>(p=u-l)){if((p=r.offset-p)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}f=p>r.wnext?(p-=r.wnext,r.wsize-p):r.wnext-p,p>r.length&&(p=r.length),m=r.window}else m=s,f=a-r.offset,p=r.length;for(l-=p=l<p?l:p,r.length-=p;s[a++]=m[f++],--p;);0===r.length&&(r.mode=21);break;case 26:if(0===l)break e;s[a++]=r.length,l--,r.mode=21;break;case 27:if(r.wrap){for(;c<32;){if(0===o)break e;o--,h|=i[n++]<<c,c+=8}if(u-=l,e.total_out+=u,r.total+=u,u&&(e.adler=r.check=(r.flags?k:D)(r.check,s,u,a-u)),u=l,(r.flags?h:N(h))!==r.check){e.msg="incorrect data check",r.mode=30;break}c=h=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;c<32;){if(0===o)break e;o--,h+=i[n++]<<c,c+=8}if(h!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}c=h=0}r.mode=29;case 29:A=1;break e;case 30:A=-3;break e;case 31:return-4;default:return B}return e.next_out=a,e.avail_out=l,e.next_in=n,e.avail_in=o,r.hold=h,r.bits=c,(r.wsize||u!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&H(e,e.output,e.next_out,u-e.avail_out)?(r.mode=31,-4):(d-=e.avail_in,u-=e.avail_out,e.total_in+=d,e.total_out+=u,r.total+=u,r.wrap&&u&&(e.adler=r.check=(r.flags?k:D)(r.check,s,u,e.next_out-u)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==d&&0===u||4===t)&&A===P?-5:A)},t.inflateEnd=function(e){if(!e||!e.state)return B;var t=e.state;return t.window&&(t.window=null),e.state=null,P},t.inflateGetHeader=function(e,t){return!e||!e.state||0==(2&(e=e.state).wrap)?B:((e.head=t).done=!1,P)},t.inflateSetDictionary=function(e,t){var r,i=t.length;return!e||!e.state||0!==(r=e.state).wrap&&11!==r.mode?B:11===r.mode&&D(1,t,i,0)!==r.check?-3:H(e,t,i,i)?(r.mode=31,-4):(r.havedict=1,P)},t.inflateInfo="pako inflate (from Nodeca project)"},"./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js":(e,t,r)=>{var I=r("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),O=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],R=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],G=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],P=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,r,i,s,n,a,o){for(var l,h,c,d,u,p,f,m,g,v=o.bits,b=0,_=0,y=0,x=0,w=0,A=0,S=0,C=0,L=0,M=0,z=null,T=0,E=new I.Buf16(16),F=new I.Buf16(16),D=null,k=0,b=0;b<=15;b++)E[b]=0;for(_=0;_<i;_++)E[t[r+_]]++;for(w=v,x=15;1<=x&&0===E[x];x--);if(x<w&&(w=x),0===x)return s[n++]=20971520,s[n++]=20971520,o.bits=1,0;for(y=1;y<x&&0===E[y];y++);for(w<y&&(w=y),b=C=1;b<=15;b++)if((C=(C<<=1)-E[b])<0)return-1;if(0<C&&(0===e||1!==x))return-1;for(F[1]=0,b=1;b<15;b++)F[b+1]=F[b]+E[b];for(_=0;_<i;_++)0!==t[r+_]&&(a[F[t[r+_]]++]=_);if(p=0===e?(z=D=a,19):1===e?(z=O,T-=257,D=R,k-=257,256):(z=G,D=P,-1),b=y,u=n,S=_=M=0,c=-1,d=(L=1<<(A=w))-1,1===e&&852<L||2===e&&592<L)return 1;for(;;){for(g=a[_]<p?(m=0,a[_]):a[_]>p?(m=D[k+a[_]],z[T+a[_]]):(m=96,0),l=1<<(f=b-S),y=h=1<<A;s[u+(M>>S)+(h-=l)]=f<<24|m<<16|g|0,0!==h;);for(l=1<<b-1;M&l;)l>>=1;if(M=0!==l?(M&l-1)+l:0,_++,0==--E[b]){if(b===x)break;b=t[r+a[_]]}if(w<b&&(M&d)!==c){for(u+=y,C=1<<(A=b-(S=0===S?w:S));A+S<x&&!((C-=E[A+S])<=0);)A++,C<<=1;if(L+=1<<A,1===e&&852<L||2===e&&592<L)return 1;s[c=M&d]=w<<24|A<<16|u-n|0}}return 0!==M&&(s[u+M]=b-S<<24|64<<16|0),o.bits=w,0}},"./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js":e=>{e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},"./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js":(r,e,n)=>{var a=n("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),c=0,d=1;function t(e){for(var t=e.length;0<=--t;)e[t]=0}var o,l,h,u=29,p=256,f=p+1+u,m=30,g=19,C=2*f+1,L=15,i=16,B=7,v=256,b=16,_=17,y=18,x=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],w=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],U=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S=new Array(2*(f+2)),M=(t(S),new Array(2*m)),z=(t(M),new Array(512)),T=(t(z),new Array(256)),E=(t(T),new Array(u)),F=(t(E),new Array(m));function D(e,t,r,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}function k(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function I(e){return e<256?z[e]:z[256+(e>>>7)]}function s(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function O(e,t,r){e.bi_valid>i-r?(e.bi_buf|=t<<e.bi_valid&65535,s(e,e.bi_buf),e.bi_buf=t>>i-e.bi_valid,e.bi_valid+=r-i):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function R(e,t,r){O(e,r[2*t],r[2*t+1])}function N(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function j(e,t,r){for(var i,s=new Array(L+1),n=0,a=1;a<=L;a++)s[a]=n=n+r[a-1]<<1;for(i=0;i<=t;i++){var o=e[2*i+1];0!==o&&(e[2*i]=N(s[o]++,o))}}function V(e){for(var t=0;t<f;t++)e.dyn_ltree[2*t]=0;for(t=0;t<m;t++)e.dyn_dtree[2*t]=0;for(t=0;t<g;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*v]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function W(e){8<e.bi_valid?s(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function H(e,t,r,i){var s=2*t,n=2*r;return e[s]<e[n]||e[s]===e[n]&&i[t]<=i[r]}function G(e,t,r){for(var i=e.heap[r],s=r<<1;s<=e.heap_len&&(s<e.heap_len&&H(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!H(t,i,e.heap[s],e.depth));)e.heap[r]=e.heap[s],r=s,s<<=1;e.heap[r]=i}function q(e,t,r){var i,s,n,a,o=0;if(0!==e.last_lit)for(;i=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],s=e.pending_buf[e.l_buf+o],o++,0==i?R(e,s,t):(R(e,(n=T[s])+p+1,t),0!==(a=x[n])&&O(e,s-=E[n],a),R(e,n=I(--i),r),0!==(a=w[n])&&O(e,i-=F[n],a)),o<e.last_lit;);R(e,v,t)}function P(e,t){var r,i,s,n=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,h=-1;for(e.heap_len=0,e.heap_max=C,r=0;r<l;r++)0!==n[2*r]?(e.heap[++e.heap_len]=h=r,e.depth[r]=0):n[2*r+1]=0;for(;e.heap_len<2;)n[2*(s=e.heap[++e.heap_len]=h<2?++h:0)]=1,e.depth[s]=0,e.opt_len--,o&&(e.static_len-=a[2*s+1]);for(t.max_code=h,r=e.heap_len>>1;1<=r;r--)G(e,n,r);for(s=l;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],G(e,n,1),i=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=i,n[2*s]=n[2*r]+n[2*i],e.depth[s]=(e.depth[r]>=e.depth[i]?e.depth[r]:e.depth[i])+1,n[2*r+1]=n[2*i+1]=s,e.heap[1]=s++,G(e,n,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1];for(var c,d,u,p,f,m=e,g=t.dyn_tree,v=t.max_code,b=t.stat_desc.static_tree,_=t.stat_desc.has_stree,y=t.stat_desc.extra_bits,x=t.stat_desc.extra_base,w=t.stat_desc.max_length,A=0,S=0;S<=L;S++)m.bl_count[S]=0;for(g[2*m.heap[m.heap_max]+1]=0,c=m.heap_max+1;c<C;c++)w<(S=g[2*g[2*(d=m.heap[c])+1]+1]+1)&&(S=w,A++),g[2*d+1]=S,v<d||(m.bl_count[S]++,p=0,x<=d&&(p=y[d-x]),f=g[2*d],m.opt_len+=f*(S+p),_&&(m.static_len+=f*(b[2*d+1]+p)));if(0!==A){do{for(S=w-1;0===m.bl_count[S];)S--}while(m.bl_count[S]--,m.bl_count[S+1]+=2,m.bl_count[w]--,0<(A-=2));for(S=w;0!==S;S--)for(d=m.bl_count[S];0!==d;)v<(u=m.heap[--c])||(g[2*u+1]!==S&&(m.opt_len+=(S-g[2*u+1])*g[2*u],g[2*u+1]=S),d--)}j(n,h,e.bl_count)}function Y(e,t,r){var i,s,n=-1,a=t[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),t[2*(r+1)+1]=65535,i=0;i<=r;i++)s=a,a=t[2*(i+1)+1],++o<l&&s===a||(o<h?e.bl_tree[2*s]+=o:0!==s?(s!==n&&e.bl_tree[2*s]++,e.bl_tree[2*b]++):o<=10?e.bl_tree[2*_]++:e.bl_tree[2*y]++,n=s,h=(o=0)===a?(l=138,3):s===a?(l=6,3):(l=7,4))}function Z(e,t,r){var i,s,n=-1,a=t[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),i=0;i<=r;i++)if(s=a,a=t[2*(i+1)+1],!(++o<l&&s===a)){if(o<h)for(;R(e,s,e.bl_tree),0!=--o;);else 0!==s?(s!==n&&(R(e,s,e.bl_tree),o--),R(e,b,e.bl_tree),O(e,o-3,2)):o<=10?(R(e,_,e.bl_tree),O(e,o-3,3)):(R(e,y,e.bl_tree),O(e,o-11,7));n=s,h=(o=0)===a?(l=138,3):s===a?(l=6,3):(l=7,4)}}t(F);var X=!1;function K(e,t,r,i){O(e,0+(i?1:0),3),i=t,t=r,r=!0,W(e=e),r&&(s(e,t),s(e,~t)),a.arraySet(e.pending_buf,e.window,i,t,e.pending),e.pending+=t}e._tr_init=function(e){if(!X){for(var t,r,i,s=new Array(L+1),n=0,a=0;a<u-1;a++)for(E[a]=n,t=0;t<1<<x[a];t++)T[n++]=a;for(T[n-1]=a,a=i=0;a<16;a++)for(F[a]=i,t=0;t<1<<w[a];t++)z[i++]=a;for(i>>=7;a<m;a++)for(F[a]=i<<7,t=0;t<1<<w[a]-7;t++)z[256+i++]=a;for(r=0;r<=L;r++)s[r]=0;for(t=0;t<=143;)S[2*t+1]=8,t++,s[8]++;for(;t<=255;)S[2*t+1]=9,t++,s[9]++;for(;t<=279;)S[2*t+1]=7,t++,s[7]++;for(;t<=287;)S[2*t+1]=8,t++,s[8]++;for(j(S,f+1,s),t=0;t<m;t++)M[2*t+1]=5,M[2*t]=N(t,5);o=new D(S,x,p+1,f,L),l=new D(M,w,0,m,L),h=new D(new Array(0),U,0,g,B),X=!0}e.l_desc=new k(e.dyn_ltree,o),e.d_desc=new k(e.dyn_dtree,l),e.bl_desc=new k(e.bl_tree,h),e.bi_buf=0,e.bi_valid=0,V(e)},e._tr_stored_block=K,e._tr_flush_block=function(e,t,r,i){var s,n,a=0;if(0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){for(var t=4093624447,r=0;r<=31;r++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*r])return c;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return d;for(r=32;r<p;r++)if(0!==e.dyn_ltree[2*r])return d;return c}(e)),P(e,e.l_desc),P(e,e.d_desc),a=function(e){var t;for(Y(e,e.dyn_ltree,e.l_desc.max_code),Y(e,e.dyn_dtree,e.d_desc.max_code),P(e,e.bl_desc),t=g-1;3<=t&&0===e.bl_tree[2*A[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),s=e.opt_len+3+7>>>3,(n=e.static_len+3+7>>>3)<=s&&(s=n)):s=n=r+5,r+4<=s&&-1!==t)K(e,t,r,i);else if(4===e.strategy||n===s)O(e,2+(i?1:0),3),q(e,S,M);else{O(e,4+(i?1:0),3);var o,l=e,t=e.l_desc.max_code+1,r=e.d_desc.max_code+1,h=a+1;for(O(l,t-257,5),O(l,r-1,5),O(l,h-4,4),o=0;o<h;o++)O(l,l.bl_tree[2*A[o]+1],3);Z(l,l.dyn_ltree,t-1),Z(l,l.dyn_dtree,r-1),q(e,e.dyn_ltree,e.dyn_dtree)}V(e),i&&W(e)},e._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(T[r]+p+1)]++,e.dyn_dtree[2*I(t)]++),e.last_lit===e.lit_bufsize-1},e._tr_align=function(e){O(e,2,3),R(e,v,S),16===(e=e).bi_valid?(s(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},"./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js":e=>{e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},"./src/3Dmol.ts":(e,t,r)=>{r.r(t),r.d(t,{CAP:()=>a.CAP,CC:()=>s.CC,CONTEXTS_PER_VIEWPORT:()=>h.CONTEXTS_PER_VIEWPORT,Color:()=>s.Color,CustomLinear:()=>c.CustomLinear,Cylinder:()=>_.Cylinder,GLDraw:()=>a.GLDraw,GLModel:()=>o.GLModel,GLShape:()=>l.GLShape,GLViewer:()=>h.GLViewer,GLVolumetricRender:()=>v.GLVolumetricRender,Gradient:()=>c.Gradient,GradientType:()=>c.GradientType,Label:()=>d.Label,LabelCount:()=>d.LabelCount,MarchingCube:()=>f.MarchingCube,MarchingCubeInitializer:()=>f.MarchingCubeInitializer,Matrix3:()=>b.Matrix3,Matrix4:()=>b.Matrix4,Parsers:()=>u.Parsers,PausableTimer:()=>m.PausableTimer,PointGrid:()=>f.PointGrid,ProteinSurface:()=>f.ProteinSurface,Quaternion:()=>b.Quaternion,ROYGB:()=>c.ROYGB,RWB:()=>c.RWB,Ray:()=>b.Ray,Sinebow:()=>c.Sinebow,Sphere:()=>_.Sphere,SurfaceType:()=>f.SurfaceType,Triangle:()=>_.Triangle,Vector2:()=>b.Vector2,Vector3:()=>b.Vector3,VolumeData:()=>g.VolumeData,adjustVolumeStyle:()=>m.adjustVolumeStyle,applyPartialCharges:()=>p.applyPartialCharges,autoinit:()=>i.autoinit,autoload:()=>i.autoload,base64ToArray:()=>m.base64ToArray,bondLength:()=>u.bondLength,builtinColorSchemes:()=>s.builtinColorSchemes,builtinGradients:()=>c.builtinGradients,chains:()=>s.chains,clamp:()=>b.clamp,conversionMatrix3:()=>b.conversionMatrix3,createStereoViewer:()=>h.createStereoViewer,createViewer:()=>h.createViewer,createViewerGrid:()=>h.createViewerGrid,deepCopy:()=>m.deepCopy,degToRad:()=>b.degToRad,download:()=>m.download,drawCartoon:()=>n.drawCartoon,elementColors:()=>s.elementColors,extend:()=>m.extend,get:()=>m.get,getAtomProperty:()=>m.getAtomProperty,getColorFromStyle:()=>m.getColorFromStyle,getElement:()=>m.getElement,getExtent:()=>m.getExtent,getGradient:()=>c.getGradient,getPropertyRange:()=>m.getPropertyRange,getbin:()=>m.getbin,htmlColors:()=>s.htmlColors,inflateString:()=>m.inflateString,isEmptyObject:()=>m.isEmptyObject,isNumeric:()=>m.isNumeric,makeFunction:()=>m.makeFunction,mergeGeos:()=>m.mergeGeos,normalizeValue:()=>c.normalizeValue,partialCharges:()=>p.partialCharges,processing_autoinit:()=>i.processing_autoinit,residues:()=>s.residues,setBondLength:()=>u.setBondLength,setSyncSurface:()=>f.setSyncSurface,specStringToObject:()=>m.specStringToObject,splitMesh:()=>l.splitMesh,ssColors:()=>s.ssColors,subdivide_spline:()=>n.subdivide_spline,syncSurface:()=>f.syncSurface,viewers:()=>i.viewers});var i=r("./src/autoload.ts"),s=r("./src/colors.ts"),n=r("./src/glcartoon.ts"),a=r("./src/GLDraw.ts"),o=r("./src/GLModel.ts"),l=r("./src/GLShape.ts"),h=r("./src/GLViewer.ts"),c=r("./src/Gradient.ts"),d=r("./src/Label.ts"),u=r("./src/parsers/index.ts"),p=r("./src/partialCharges.ts"),f=r("./src/ProteinSurface4.ts"),m=(r("./src/specs.ts"),r("./src/utilities.ts")),g=r("./src/VolumeData.ts"),v=r("./src/VolumetricRender.ts"),b=r("./src/WebGL/math/index.ts"),_=r("./src/WebGL/shapes/index.ts")},"./src/GLDraw.ts":(e,t,r)=>{r.r(t),r.d(t,{CAP:()=>te,GLDraw:()=>i});var te,i,re,k,w=r("./src/WebGL/math/index.ts");function ie(e,t,r){var i,s,n=Math.hypot(e,t),n=n<1e-4?(i=0,1):(i=-e/n,t/n);t=-i*e+n*t;r=(e=Math.hypot(t,r))<1e-4?(s=0,1):(s=r/e,t/e),t=new Float32Array(9);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i*r,t[4]=n*r,t[5]=s,t[6]=i*s,t[7]=-n*s,t[8]=r,t}(t=te=te||{})[t.NONE=0]="NONE",t[t.FLAT=1]="FLAT",t[t.ROUND=2]="ROUND",r=i=i||{},re=new class{constructor(){this.cache={};let e=[];var t=Math.pow(2,4);let r=2;var i,s=t/Math.pow(2,r);let n;for(e[0]=new w.Vector3(-1,0,0),e[s]=new w.Vector3(0,0,1),e[2*s]=new w.Vector3(1,0,0),e[3*s]=new w.Vector3(0,0,-1),r=3;r<=4;r++){for(s=t/(i=Math.pow(2,r-1)),n=0;n<i-1;n++)e[s/2+n*s]=e[n*s].clone().add(e[(n+1)*s]).normalize();n=i-1,e[s/2+n*s]=e[n*s].clone().add(e[0]).normalize()}this.basisVectors=e}getVerticesForRadius(e,t,r){if(void 0!==this.cache&&void 0!==this.cache[e]&&void 0!==this.cache[e][t+r])return this.cache[e][t+r];for(var i,s=this.basisVectors.length,n=[],a=[],o=0;o<s;o++)n.push(this.basisVectors[o].clone().multiplyScalar(e)),n.push(this.basisVectors[o].clone().multiplyScalar(e)),i=this.basisVectors[o].clone().normalize(),a.push(i),a.push(i);for(var l=[],h=s,c=2*Math.PI,d=Math.PI,u=0;u<=10;u++){for(var p,f,m,g=0===u||10===u,v=5===u,b=[],_=[],y=0;y<=h;y++)v?(_.push(1+(p=y<h?2*y:0)),b.push(p)):(p=y/h,f=u/10,g&&0!==y?g&&b.push(n.length-1):y<h?((m=new w.Vector3).x=-e*Math.cos(0+p*c)*Math.sin(0+f*d),m.y=1==t?0:e*Math.cos(0+f*d),m.z=e*Math.sin(0+p*c)*Math.sin(0+f*d),Math.abs(m.x)<1e-5&&(m.x=0),Math.abs(m.y)<1e-5&&(m.y=0),Math.abs(m.z)<1e-5&&(m.z=0),(i=t==te.FLAT?new w.Vector3(0,Math.cos(0+f*d),0):new w.Vector3(m.x,m.y,m.z)).normalize(),n.push(m),a.push(i),b.push(n.length-1)):b.push(n.length-h));v&&l.push(_),l.push(b)}var x={vertices:n,normals:a,verticesRows:l,w:h,h:10};return e in this.cache||(this.cache[e]={}),this.cache[e][t+r]=x}},r.drawCylinder=function(R,e,t,G,r,P=0,B=0){if(e&&t){function U(t){if("string"!=typeof t)return t;{let e=t;return"flat"==e.toLowerCase()?te.FLAT:"round"==e.toLowerCase()?te.ROUND:te.NONE}}P=U(P);for(var N=(B=U(B))||P,i=(r=r||{r:0,g:0,b:0},ie(t.x-e.x,t.y-e.y,t.z-e.z)),j=re.getVerticesForRadius(G,B,"to"),V=j.w,s=j.h,W=N?s*V+2:2*V,n=R.updateGeoGroup(W),a=j.vertices,o=j.normals,l=j.verticesRows,H=l[s/2],q=l[s/2+1],h=n.vertices,c=n.vertexArray,d=n.normalArray,u=n.colorArray,p=n.faceArray,f=0;f<V;++f){var m=2*f,g=i[0]*a[m].x+i[3]*a[m].y+i[6]*a[m].z,v=i[1]*a[m].x+i[4]*a[m].y+i[7]*a[m].z,Y=i[5]*a[m].y+i[8]*a[m].z,b=n.faceidx;c[m=3*(h+m)]=g+e.x,c[1+m]=v+e.y,c[2+m]=Y+e.z,c[3+m]=g+t.x,c[4+m]=v+t.y,c[5+m]=Y+t.z,d[m]=g,d[3+m]=g,d[1+m]=v,d[4+m]=v,d[2+m]=Y,d[5+m]=Y,u[m]=r.r,u[3+m]=r.r,u[1+m]=r.g,u[4+m]=r.g,u[2+m]=r.b,u[5+m]=r.b,p[b]=q[f]+h,p[b+1]=q[f+1]+h,p[b+2]=H[f]+h,p[b+3]=H[f]+h,p[b+4]=q[f+1]+h,p[b+5]=H[f+1]+h,n.faceidx+=6}if(N){var _,y,x,w,A,S,C,L,M,z,T,E,Z,X,K,Q,F,D,k,I,$=P?s+1:s/2+1;for(v=B?0:s/2;v<$;v++)if(v!==s/2){var O=v<=s/2?t:e,J=re.getVerticesForRadius(G,B,"to"),ee=re.getVerticesForRadius(G,P,"from");for(O===t?(a=J.vertices,o=J.normals,l=J.verticesRows):O==e&&(a=ee.vertices,o=ee.normals,l=ee.verticesRows),g=0;g<V;g++)b=n.faceidx,_=l[v][g+1],D=3*((y=l[v][g])+h),k=3*((x=l[v+1][g])+h),I=3*((w=l[v+1][g+1])+h),A=i[0]*a[_].x+i[3]*a[_].y+i[6]*a[_].z,S=i[0]*a[y].x+i[3]*a[y].y+i[6]*a[y].z,C=i[0]*a[x].x+i[3]*a[x].y+i[6]*a[x].z,L=i[0]*a[w].x+i[3]*a[w].y+i[6]*a[w].z,M=i[1]*a[_].x+i[4]*a[_].y+i[7]*a[_].z,z=i[1]*a[y].x+i[4]*a[y].y+i[7]*a[y].z,T=i[1]*a[x].x+i[4]*a[x].y+i[7]*a[x].z,E=i[1]*a[w].x+i[4]*a[w].y+i[7]*a[w].z,Z=i[5]*a[_].y+i[8]*a[_].z,X=i[5]*a[y].y+i[8]*a[y].z,K=i[5]*a[x].y+i[8]*a[x].z,Q=i[5]*a[w].y+i[8]*a[w].z,c[F=3*(_+h)]=A+O.x,c[D]=S+O.x,c[k]=C+O.x,c[I]=L+O.x,c[1+F]=M+O.y,c[1+D]=z+O.y,c[1+k]=T+O.y,c[1+I]=E+O.y,c[2+F]=Z+O.z,c[2+D]=X+O.z,c[2+k]=K+O.z,c[2+I]=Q+O.z,u[F]=r.r,u[D]=r.r,u[k]=r.r,u[I]=r.r,u[1+F]=r.g,u[1+D]=r.g,u[1+k]=r.g,u[1+I]=r.g,u[2+F]=r.b,u[2+D]=r.b,u[2+k]=r.b,u[2+I]=r.b,A=i[0]*o[_].x+i[3]*o[_].y+i[6]*o[_].z,S=i[0]*o[y].x+i[3]*o[y].y+i[6]*o[y].z,C=i[0]*o[x].x+i[3]*o[x].y+i[6]*o[x].z,L=i[0]*o[w].x+i[3]*o[w].y+i[6]*o[w].z,M=i[1]*o[_].x+i[4]*o[_].y+i[7]*o[_].z,z=i[1]*o[y].x+i[4]*o[y].y+i[7]*o[y].z,T=i[1]*o[x].x+i[4]*o[x].y+i[7]*o[x].z,E=i[1]*o[w].x+i[4]*o[w].y+i[7]*o[w].z,Z=i[5]*o[_].y+i[8]*o[_].z,X=i[5]*o[y].y+i[8]*o[y].z,K=i[5]*o[x].y+i[8]*o[x].z,Q=i[5]*o[w].y+i[8]*o[w].z,0===v?(d[F]=A,d[k]=C,d[I]=L,d[1+F]=M,d[1+k]=T,d[1+I]=E,d[2+F]=Z,d[2+k]=K,d[2+I]=Q,p[b]=_+h,p[b+1]=x+h,p[b+2]=w+h,n.faceidx+=3):v===$-1?(d[F]=A,d[D]=S,d[k]=C,d[1+F]=M,d[1+D]=z,d[1+k]=T,d[2+F]=Z,d[2+D]=X,d[2+k]=K,p[b]=_+h,p[b+1]=y+h,p[b+2]=x+h,n.faceidx+=3):(d[F]=A,d[D]=S,d[I]=L,d[1+F]=M,d[1+D]=z,d[1+I]=E,d[2+F]=Z,d[2+D]=X,d[2+I]=Q,d[D]=S,d[k]=C,d[I]=L,d[1+D]=z,d[1+k]=T,d[1+I]=E,d[2+D]=X,d[2+k]=K,d[2+I]=Q,p[b]=_+h,p[b+1]=y+h,p[b+2]=w+h,p[b+3]=y+h,p[b+4]=x+h,p[b+5]=w+h,n.faceidx+=6)}}n.vertices+=W}},r.drawCone=function(t,r,i,s,n){if(r&&i){n=n||{r:0,g:0,b:0};let e=new w.Vector3(i.x-r.x,i.y-r.y,i.z-r.z);var a,o,l,h,c=ie(e.x,e.y,e.z),d=(e=e.normalize(),re.basisVectors.length),u=re.basisVectors,t=t.updateGeoGroup(d+2),p=t.vertices,f=t.vertexArray,m=t.normalArray,g=t.colorArray,v=t.faceArray,b=3*p;for(f[b]=r.x,f[b+1]=r.y,f[b+2]=r.z,m[b]=-e.x,m[b+1]=-e.y,m[b+2]=-e.z,g[b]=n.r,g[b+1]=n.g,g[b+2]=n.b,f[b+3]=i.x,f[b+4]=i.y,f[b+5]=i.z,m[b+3]=e.x,m[b+4]=e.y,m[b+5]=e.z,g[b+3]=n.r,g[b+4]=n.g,g[b+5]=n.b,b+=6,o=0;o<d;++o){var _=u[o].clone();_.multiplyScalar(s),l=c[0]*_.x+c[3]*_.y+c[6]*_.z,h=c[1]*_.x+c[4]*_.y+c[7]*_.z,_=c[5]*_.y+c[8]*_.z,f[b]=l+r.x,f[b+1]=h+r.y,f[b+2]=_+r.z,m[b]=l,m[b+1]=h,m[b+2]=_,g[b]=n.r,g[b+1]=n.g,g[b+2]=n.b,b+=3}for(t.vertices+=d+2,a=t.faceidx,o=0;o<d;o++){var y=p+2+o,x=p+2+(o+1)%d;v[a]=y,v[a+1]=x,v[a+2]=p,v[a+=3]=y,v[a+1]=x,v[a+2]=p+1,a+=3}t.faceidx+=6*d}},k=new class{constructor(){this.cache=new Map}getVerticesForRadius(t,e){this.cache.has(e=e||2)||this.cache.set(e,new Map);let r=this.cache.get(e);if(r.has(t))return r.get(t);for(var i,s={vertices:[],verticesRows:[],normals:[]},n=16*e,a=10*e,o=(t<1&&(n=10*e,a=8*e),2*Math.PI),l=Math.PI,h=0;h<=a;h++){let e=[];for(i=0;i<=n;i++){var c=i/n,d=h/a,u=-t*Math.cos(0+c*o)*Math.sin(0+d*l),p=t*Math.cos(0+d*l),c=t*Math.sin(0+c*o)*Math.sin(0+d*l),d=new w.Vector3(u,p,c);d.normalize(),s.vertices.push({x:u,y:p,z:c}),s.normals.push(d),e.push(s.vertices.length-1)}s.verticesRows.push(e)}return r.set(t,s),s}},r.drawSphere=function(e,r,i,s,t){var n=(t=k.getVerticesForRadius(i,t)).vertices,a=t.normals,o=e.updateGeoGroup(n.length),l=o.vertices,h=o.vertexArray,c=o.colorArray,d=o.faceArray,u=o.lineArray,p=o.normalArray;for(let e=0,t=n.length;e<t;++e){var f=3*(l+e),m=n[e];h[f]=m.x+r.x,h[1+f]=m.y+r.y,h[2+f]=m.z+r.z,c[f]=s.r,c[1+f]=s.g,c[2+f]=s.b}o.vertices+=n.length;var g=t.verticesRows,v=g.length-1;for(let t=0;t<v;t++){var b=g[t].length-1;for(let e=0;e<b;e++){var _=o.faceidx,y=o.lineidx,x=g[t][e+1]+l,w=3*x,A=g[t][e]+l,S=3*A,C=g[t+1][e]+l,L=3*C,M=g[t+1][e+1]+l,z=3*M,T=a[x-l],E=a[A-l],F=a[C-l],D=a[M-l];Math.abs(n[x-l].y)===i?(p[w]=T.x,p[L]=F.x,p[z]=D.x,p[1+w]=T.y,p[1+L]=F.y,p[1+z]=D.y,p[2+w]=T.z,p[2+L]=F.z,p[2+z]=D.z,d[_]=x,d[_+1]=C,d[_+2]=M,u[y]=x,u[y+1]=C,u[y+2]=x,u[y+3]=M,u[y+4]=C,u[y+5]=M,o.faceidx+=3,o.lineidx+=6):Math.abs(n[C-l].y)===i?(p[w]=T.x,p[S]=E.x,p[L]=F.x,p[1+w]=T.y,p[1+S]=E.y,p[1+L]=F.y,p[2+w]=T.z,p[2+S]=E.z,p[2+L]=F.z,d[_]=x,d[_+1]=A,d[_+2]=C,u[y]=x,u[y+1]=A,u[y+2]=x,u[y+3]=C,u[y+4]=A,u[y+5]=C,o.faceidx+=3,o.lineidx+=6):(p[w]=T.x,p[S]=E.x,p[z]=D.x,p[1+w]=T.y,p[1+S]=E.y,p[1+z]=D.y,p[2+w]=T.z,p[2+S]=E.z,p[2+z]=D.z,p[S]=E.x,p[L]=F.x,p[z]=D.x,p[1+S]=E.y,p[1+L]=F.y,p[1+z]=D.y,p[2+S]=E.z,p[2+L]=F.z,p[2+z]=D.z,d[_]=x,d[_+1]=A,d[_+2]=M,d[_+3]=A,d[_+4]=C,d[_+5]=M,u[y]=x,u[y+1]=A,u[y+2]=x,u[y+3]=M,u[y+4]=A,u[y+5]=C,u[y+6]=C,u[y+7]=M,o.faceidx+=6,o.lineidx+=8)}}}},"./src/GLModel.ts":(e,t,r)=>{r.r(t),r.d(t,{GLModel:()=>$});var C=r("./src/WebGL/index.ts"),Y=r("./src/WebGL/shapes/index.ts"),Z=r("./src/WebGL/math/index.ts"),X=r("./src/colors.ts"),K=r("./src/GLDraw.ts"),L=r("./src/glcartoon.ts"),Q=r("./src/utilities.ts"),o=r("./src/Gradient.ts"),i=r("./src/parsers/index.ts"),a=r("./node_modules/netcdfjs/lib-esm/index.js"),s=r("./src/parsers/utils/assignBonds.ts");class ${static sameObj(e,t){return e&&t?JSON.stringify(e)==JSON.stringify(t):e==t}constructor(e,t,r){this.atoms=[],this.frames=[],this.box=null,this.atomdfs=null,this.id=0,this.hidden=!1,this.molObj=null,this.renderedMolObj=null,this.lastColors=null,this.modelData={},this.modelDatas=null,this.idMatrix=new Z.Matrix4,this.dontDuplicateAtoms=!0,this.defaultColor=X.elementColors.defaultColor,this.defaultStickRadius=.25,this.options=t||{},this.viewer=r,this.ElementColors=this.options.defaultcolors||X.elementColors.defaultColors,this.defaultSphereRadius=this.options.defaultSphereRadius||1.5,this.defaultCartoonQuality=this.options.cartoonQuality||10,this.id=e}getRadiusFromStyle(t,e){var r=this.defaultSphereRadius;if(void 0!==e.radius)r=e.radius;else if($.vdwRadii[t.elem])r=$.vdwRadii[t.elem];else if(1<t.elem.length){let e=t.elem;e=e[0].toUpperCase()+e[1].toLowerCase(),$.vdwRadii[e]&&(r=$.vdwRadii[e])}return void 0!==e.scale&&(r*=e.scale),r}drawAtomCross(e,t){if(e.style.cross){var r=e.style.cross;if(!r.hidden)for(var i=r.linewidth||$.defaultlineWidth,s=(t[i]||(t[i]=new C.Geometry),t[i].updateGeoGroup(6)),t=this.getRadiusFromStyle(e,r),n=[[t,0,0],[-t,0,0],[0,t,0],[0,-t,0],[0,0,t],[0,0,-t]],a=e.clickable||e.hoverable,o=(a&&void 0===e.intersectionShape&&(e.intersectionShape={sphere:[],cylinder:[],line:[]}),(0,Q.getColorFromStyle)(e,r)),l=s.vertexArray,h=s.colorArray,c=0;c<6;c++){var d=3*s.vertices;s.vertices++,l[d]=e.x+n[c][0],l[1+d]=e.y+n[c][1],l[2+d]=e.z+n[c][2],h[d]=o.r,h[1+d]=o.g,h[2+d]=o.b,a&&((d=new Z.Vector3(n[c][0],n[c][1],n[c][2])).multiplyScalar(.1),d.set(d.x+e.x,d.y+e.y,d.z+e.z),e.intersectionShape.line.push(d))}}}getGoodCross(i,e,s,n){for(var a=null,o=-1,l=0,t=i.bonds.length;l<t;l++)if(i.bonds[l]!=e.index){var h=i.bonds[l],h=this.atoms[h];let e=new Z.Vector3(h.x,h.y,h.z),t=e.clone(),r=(t.sub(s),t.clone());r.cross(n);h=r.lengthSq();if(o<h&&(o=h,a=r,.1<o))return a}return a}getSideBondV(e,t,r){var i,s,n=new Z.Vector3(e.x,e.y,e.z),a=new Z.Vector3(t.x,t.y,t.z).clone(),o=null;return a.sub(n),1===e.bonds.length?1===t.bonds.length?(o=a.clone(),1e-4<Math.abs(o.x)?o.y+=1:o.x+=1):(r=(r+1)%t.bonds.length,s=t.bonds[r],(i=this.atoms[s]).index==e.index&&(r=(1+r)%t.bonds.length,s=t.bonds[r],i=this.atoms[s]),(r=new Z.Vector3(i.x,i.y,i.z).clone()).sub(n),(o=r.clone()).cross(a)):(o=this.getGoodCross(e,t,n,a)).lengthSq()<.01&&(null!=(s=this.getGoodCross(t,e,n,a))&&(o=s)),o.lengthSq()<.01&&(o=a.clone(),1e-4<Math.abs(o.x)?o.y+=1:o.x+=1),o.cross(a),o.normalize(),o}addLine(e,t,r,i,s,n){e[r]=i.x,e[r+1]=i.y,e[r+2]=i.z,t[r]=n.r,t[r+1]=n.g,t[r+2]=n.b,e[r+3]=s.x,e[r+4]=s.y,e[r+5]=s.z,t[r+3]=n.r,t[r+4]=n.g,t[r+5]=n.b}drawBondLines(e,t,r){if(e.style.line){var i=e.style.line;if(!i.hidden)for(var s,n,a,o,i=i.linewidth||$.defaultlineWidth,l=(r[i]||(r[i]=new C.Geometry),r[i].updateGeoGroup(6*e.bonds.length)),h=l.vertexArray,c=l.colorArray,d=0;d<e.bonds.length;d++){var u=t[e.bonds[d]];if(u.style.line&&!(e.index>=u.index)){var p=new Z.Vector3(e.x,e.y,e.z),f=new Z.Vector3(u.x,u.y,u.z),m=p.clone().add(f).multiplyScalar(.5),g=!1,v=e.clickable||e.hoverable,b=u.clickable||u.hoverable,v=((v||b)&&(v&&(void 0===e.intersectionShape&&(e.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),e.intersectionShape.line.push(p),e.intersectionShape.line.push(m)),b&&(void 0===u.intersectionShape&&(u.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),u.intersectionShape.line.push(m),u.intersectionShape.line.push(f))),(0,Q.getColorFromStyle)(e,e.style.line)),b=(0,Q.getColorFromStyle)(u,u.style.line);if(e.bondStyles&&e.bondStyles[d]){var _=e.bondStyles[d];if(!_.iswire)continue;_.singleBond&&(g=!0),void 0!==_.color1&&(v=X.CC.color(_.color1)),void 0!==_.color2&&(b=X.CC.color(_.color2))}var y,x,_=3*l.vertices;1<e.bondOrder[d]&&e.bondOrder[d]<4&&!g?(g=this.getSideBondV(e,u,d),(u=f.clone()).sub(p),2==e.bondOrder[d]?(g.multiplyScalar(.1),(s=p.clone()).add(g),(n=p.clone()).sub(g),(a=s.clone()).add(u),(o=n.clone()).add(u),v==b?(l.vertices+=4,this.addLine(h,c,_,s,a,v),this.addLine(h,c,6+_,n,o,v)):(l.vertices+=8,u.multiplyScalar(.5),(y=s.clone()).add(u),(x=n.clone()).add(u),this.addLine(h,c,_,s,y,v),this.addLine(h,c,6+_,y,a,b),this.addLine(h,c,12+_,n,x,v),this.addLine(h,c,18+_,x,o,b))):3==e.bondOrder[d]&&(g.multiplyScalar(.1),(s=p.clone()).add(g),(n=p.clone()).sub(g),(a=s.clone()).add(u),(o=n.clone()).add(u),v==b?(l.vertices+=6,this.addLine(h,c,_,p,f,v),this.addLine(h,c,6+_,s,a,v),this.addLine(h,c,12+_,n,o,v)):(l.vertices+=12,u.multiplyScalar(.5),(y=s.clone()).add(u),(x=n.clone()).add(u),this.addLine(h,c,_,p,m,v),this.addLine(h,c,6+_,m,f,b),this.addLine(h,c,12+_,s,y,v),this.addLine(h,c,18+_,y,a,b),this.addLine(h,c,24+_,n,x,v),this.addLine(h,c,30+_,x,o,b)))):v==b?(l.vertices+=2,this.addLine(h,c,_,p,f,v)):(l.vertices+=4,this.addLine(h,c,_,p,m,v),this.addLine(h,c,6+_,m,f,b))}}}}drawAtomSphere(e,t){var r,i,s;!e.style.sphere||(i=e.style.sphere).hidden||(r=(0,Q.getColorFromStyle)(e,i),i=this.getRadiusFromStyle(e,i),!0!==e.clickable&&!e.hoverable||void 0===e.intersectionShape||(s=new Z.Vector3(e.x,e.y,e.z),e.intersectionShape.sphere.push(new Y.Sphere(s,i))),K.GLDraw.drawSphere(t,e,i,r))}drawAtomClickSphere(e){var t,r;!e.style.clicksphere||(t=e.style.clicksphere).hidden||(t=this.getRadiusFromStyle(e,t),!0!==e.clickable&&!e.hoverable||void 0===e.intersectionShape||(r=new Z.Vector3(e.x,e.y,e.z),e.intersectionShape.sphere.push(new Y.Sphere(r,t))))}drawAtomInstanced(e,t){var r,i,s,n,a,o,l;!e.style.sphere||(i=e.style.sphere).hidden||(r=this.getRadiusFromStyle(e,i),i=(0,Q.getColorFromStyle)(e,i),s=(t=t.updateGeoGroup(1)).vertices,l=t.vertexArray,a=t.colorArray,o=t.radiusArray,l[n=3*s]=e.x,l[1+n]=e.y,l[2+n]=e.z,a[n]=i.r,a[1+n]=i.g,a[2+n]=i.b,o[s]=r,!0!==e.clickable&&!e.hoverable||void 0===e.intersectionShape||(l=new Z.Vector3(e.x,e.y,e.z),e.intersectionShape.sphere.push(new Y.Sphere(l,r))),t.vertices+=1)}drawSphereImposter(e,t,r,i){for(var e=e.updateGeoGroup(4),s=e.vertices,n=3*s,a=e.vertexArray,o=e.colorArray,l=0;l<4;l++)a[n+3*l]=t.x,a[n+3*l+1]=t.y,a[n+3*l+2]=t.z;var h=e.normalArray;for(l=0;l<4;l++)o[n+3*l]=i.r,o[n+3*l+1]=i.g,o[n+3*l+2]=i.b;h[0+n]=-r,h[1+n]=r,h[2+n]=0,h[3+n]=-r,h[4+n]=-r,h[5+n]=0,h[6+n]=r,h[7+n]=-r,h[8+n]=0,h[9+n]=r,h[10+n]=r,h[11+n]=0,e.vertices+=4;r=e.faceArray,h=e.faceidx;r[h+0]=s,r[h+1]=s+1,r[h+2]=s+2,r[h+3]=s+2,r[h+4]=s+3,r[h+5]=s,e.faceidx+=6}drawAtomImposter(e,t){var r,i,s;!e.style.sphere||(i=e.style.sphere).hidden||(r=this.getRadiusFromStyle(e,i),i=(0,Q.getColorFromStyle)(e,i),!0!==e.clickable&&!e.hoverable||void 0===e.intersectionShape||(s=new Z.Vector3(e.x,e.y,e.z),e.intersectionShape.sphere.push(new Y.Sphere(s,r))),this.drawSphereImposter(t,e,r,i))}calculateDashes(e,t,r,i,s){for(var n,a=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2)),o=(r=Math.max(r,0),s=Math.max(s,0)+2*r,a<(i=Math.max(i,.001))+s&&(i=a,s=0),Math.floor((a-i)/(i+s))+1),l=(s=(a-o*i)/o,new Z.Vector3(e.x,e.y,e.z)),h=new Z.Vector3((t.x-e.x)/(a/s),(t.y-e.y)/(a/s),(t.z-e.z)/(a/s)),c=new Z.Vector3((t.x-e.x)/(a/i),(t.y-e.y)/(a/i),(t.z-e.z)/(a/i)),d=[],u=0;u<o;u++)n=new Z.Vector3(l.x+c.x,l.y+c.y,l.z+c.z),d.push({from:l,to:n}),l=new Z.Vector3(n.x+h.x,n.y+h.y,n.z+h.z);return d}static drawStickImposter(e,t,r,i,s,n=0,a){for(var e=e.updateGeoGroup(4),o=e.vertices,l=e.vertexArray,h=e.colorArray,c=e.radiusArray,d=e.normalArray,u=s.r,p=s.g,f=s.b,m=3*o,g=0;g<4;g++)l[m]=t.x,d[m]=r.x,h[m]=u,l[++m]=t.y,d[m]=r.y,h[m]=p,l[++m]=t.z,d[m]=r.z,h[m]=g<2?f:function(e){e=-e;return e=0==e?-1e-4:e}(f),m++;e.vertices+=4,c[o]=-i,c[o+1]=i,c[o+2]=-i,c[o+3]=i;s=e.faceArray,c=e.faceidx;s[c+0]=o,s[c+1]=o+1,s[c+2]=o+2,s[c+3]=o+2,s[c+4]=o+3,s[c+5]=o,e.faceidx+=6}drawBondSticks(e,R,t){if(e.style.stick){var r=e.style.stick;if(!r.hidden){for(var i,s,n,a,o,l,h,c,d,u=r.radius||this.defaultStickRadius,G=r.doubleBondScaling||.4,P=r.tripleBondScaling||.25,B=(null==(O=r.dashedBondConfig)?void 0:O.dashLength)||.1,U=(null==(O=r.dashedBondConfig)?void 0:O.gapLength)||.25,p=u,N=r.singleBonds||!1,j=r.dashedBonds||!1,f=0,m=0,g=(0,Q.getColorFromStyle)(e,r),V=(!e.capDrawn&&e.bonds.length<4&&(f=2),e=>{var h=t.imposter?$.drawStickImposter:K.GLDraw.drawCylinder;return!j&&1<=e?h:(t,e,r,i,s,n=0,a=0,o=.1,l=.25)=>{this.calculateDashes(e,r,i,o,l).forEach(e=>{h(t,e.from,e.to,i,s,n,a)})}}),v=0;v<e.bonds.length;v++){var b=V(e.bondOrder[v]),_=R[e.bonds[v]];if(A=c=d=null,e.index<_.index){var y=_.style;if(y.stick&&!y.stick.hidden){var y=(0,Q.getColorFromStyle)(_,y.stick),p=u,x=N;if(e.bondStyles&&e.bondStyles[v]){if((n=e.bondStyles[v]).iswire)continue;n.radius&&(p=n.radius),n.singleBond&&(x=!0),void 0!==n.color1&&(g=X.CC.color(n.color1)),void 0!==n.color2&&(y=X.CC.color(n.color2))}var w,W,A,S,C,L,M,z,T,E,F,D,k=new Z.Vector3(e.x,e.y,e.z),I=new Z.Vector3(_.x,_.y,_.z);e.bondOrder[v]<=1||x||3<e.bondOrder[v]?(e.bondOrder[v]<1&&(p*=e.bondOrder[v]),!_.capDrawn&&_.bonds.length<4&&(m=2),g!=y?(A=(new Z.Vector3).addVectors(k,I).multiplyScalar(.5),b(t,k,A,p,g,f,0,B,U),b(t,A,I,p,y,0,m,B,U)):b(t,k,I,p,g,f,m,B,U),i=e.clickable||e.hoverable,s=_.clickable||_.hoverable,(i||s)&&(A=A||(new Z.Vector3).addVectors(k,I).multiplyScalar(.5),i&&(w=new Y.Cylinder(k,A,p),W=new Y.Sphere(k,p),e.intersectionShape.cylinder.push(w),e.intersectionShape.sphere.push(W)),s&&(w=new Y.Cylinder(I,A,p),W=new Y.Sphere(I,p),_.intersectionShape.cylinder.push(w),_.intersectionShape.sphere.push(W)))):1<e.bondOrder[v]&&(C=S=0,p!=u&&(C=S=2),M=null,(L=I.clone()).sub(k),M=this.getSideBondV(e,_,v),2==e.bondOrder[v]?(M.multiplyScalar(1.5*(z=p*G)),(T=k.clone()).add(M),(E=k.clone()).sub(M),(F=T.clone()).add(L),(D=E.clone()).add(L),g!=y?(A=(new Z.Vector3).addVectors(T,F).multiplyScalar(.5),c=(new Z.Vector3).addVectors(E,D).multiplyScalar(.5),b(t,T,A,z,g,S,0),b(t,A,F,z,y,0,C),b(t,E,c,z,g,S,0),b(t,c,D,z,y,0,C)):(b(t,T,F,z,g,S,C),b(t,E,D,z,g,S,C)),i=e.clickable||e.hoverable,s=_.clickable||_.hoverable,(i||s)&&(A=A||(new Z.Vector3).addVectors(T,F).multiplyScalar(.5),c=c||(new Z.Vector3).addVectors(E,D).multiplyScalar(.5),i&&(a=new Y.Cylinder(T,A,z),o=new Y.Cylinder(E,c,z),e.intersectionShape.cylinder.push(a),e.intersectionShape.cylinder.push(o)),s&&(l=new Y.Cylinder(F,A,z),h=new Y.Cylinder(D,c,z),_.intersectionShape.cylinder.push(l),_.intersectionShape.cylinder.push(h)))):3==e.bondOrder[v]&&(z=p*P,M.cross(L),M.normalize(),M.multiplyScalar(3*z),(T=k.clone()).add(M),(E=k.clone()).sub(M),(F=T.clone()).add(L),(D=E.clone()).add(L),g!=y?(A=(new Z.Vector3).addVectors(T,F).multiplyScalar(.5),c=(new Z.Vector3).addVectors(E,D).multiplyScalar(.5),d=(new Z.Vector3).addVectors(k,I).multiplyScalar(.5),b(t,T,A,z,g,S,0),b(t,A,F,z,y,0,C),b(t,k,d,z,g,f,0),b(t,d,I,z,y,0,m),b(t,E,c,z,g,S,0),b(t,c,D,z,y,0,C)):(b(t,T,F,z,g,S,C),b(t,k,I,z,g,f,m),b(t,E,D,z,g,S,C)),i=e.clickable||e.hoverable,s=_.clickable||_.hoverable,(i||s)&&(A=A||(new Z.Vector3).addVectors(T,F).multiplyScalar(.5),c=c||(new Z.Vector3).addVectors(E,D).multiplyScalar(.5),d=d||(new Z.Vector3).addVectors(k,I).multiplyScalar(.5),i&&(a=new Y.Cylinder(T.clone(),A.clone(),z),o=new Y.Cylinder(E.clone(),c.clone(),z),M=new Y.Cylinder(k.clone(),d.clone(),z),e.intersectionShape.cylinder.push(a),e.intersectionShape.cylinder.push(o),e.intersectionShape.cylinder.push(M)),s&&(l=new Y.Cylinder(F.clone(),A.clone(),z),h=new Y.Cylinder(D.clone(),c.clone(),z),L=new Y.Cylinder(I.clone(),d.clone(),z),_.intersectionShape.cylinder.push(l),_.intersectionShape.cylinder.push(h),_.intersectionShape.cylinder.push(L)))))}}}var O=!1,H=0,q=!1;for(v=0;v<e.bonds.length;v++)x=N,e.bondStyles&&e.bondStyles[v]&&((n=e.bondStyles[v]).singleBond&&(x=!0),n.radius&&n.radius!=u&&(q=!0)),!x&&1!=e.bondOrder[v]||H++;q?0<H&&(O=!0):0==H&&(0<e.bonds.length||r.showNonBonded)&&(O=!0),O&&(p=u,t.imposter?this.drawSphereImposter(t.sphereGeometry,e,p,g):K.GLDraw.drawSphere(t,e,p,g))}}}createMolObj(e,t){t=t||{};for(var r,i,s,n,a,o,l,h,c=new C.Object3D,d=[],u={},p={},f=this.drawAtomSphere,m=null,g=null,v=(t.supportsImposters?(f=this.drawAtomImposter,(m=new C.Geometry(!0)).imposter=!0,(g=new C.Geometry(!0,!0)).imposter=!0,g.sphereGeometry=new C.Geometry(!0),g.sphereGeometry.imposter=!0,g.drawnCaps={}):g=(t.supportsAIA?(f=this.drawAtomInstanced,(m=new C.Geometry(!1,!0,!0)).instanced=!0):m=new C.Geometry(!0),new C.Geometry(!0)),{}),b=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],_=0,y=e.length;_<y;_++){var x=e[_];if(x&&x.style){for(r in(x.clickable||x.hoverable)&&void 0===x.intersectionShape&&(x.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),i={line:void 0,cross:void 0,stick:void 0,sphere:void 0})x.style[r]?x.style[r].opacity?i[r]=parseFloat(x.style[r].opacity):i[r]=1:i[r]=void 0,v[r]?null!=i[r]&&v[r]!=i[r]&&(console.log("Warning: "+r+" opacity is ambiguous"),v[r]=1):v[r]=i[r];f.call(this,x,m),this.drawAtomClickSphere(x),this.drawAtomCross(x,p),this.drawBondLines(x,e,u),this.drawBondSticks(x,e,g),void 0===x.style.cartoon||x.style.cartoon.hidden||("spectrum"!==x.style.cartoon.color||"number"!=typeof x.resi||x.hetflag||(x.resi<b[0]&&(b[0]=x.resi),x.resi>b[1]&&(b[1]=x.resi)),d.push(x))}}for(_ in 0<d.length&&(0,L.drawCartoon)(c,d,b,this.defaultCartoonQuality),m&&0<m.vertices&&(m.initTypedArrays(),s=t=null,t=m.imposter?new C.SphereImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0}):m.instanced?(s=new C.Geometry(!0),K.GLDraw.drawSphere(s,{x:0,y:0,z:0},1,new X.Color(.5,.5,.5)),s.initTypedArrays(),new C.InstancedMaterial({sphereMaterial:new C.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),sphere:s})):new C.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),v.sphere<1&&0<=v.sphere&&(t.transparent=!0,t.opacity=v.sphere),s=new C.Mesh(m,t),c.add(s)),0<g.vertices&&(s=t=null,(n=g.sphereGeometry)&&void 0!==n.vertices&&0!=n.vertices||(n=null),g.initTypedArrays(),n&&n.initTypedArrays(),a={ambient:0,vertexColors:!0,reflectivity:0},g.imposter?(t=new C.StickImposterMaterial(a),s=new C.SphereImposterMaterial(a)):(t=new C.MeshLambertMaterial(a),s=new C.MeshLambertMaterial(a),t.wireframe&&(g.setUpWireframe(),n&&n.setUpWireframe())),v.stick<1&&0<=v.stick&&(t.transparent=!0,t.opacity=v.stick,s.transparent=!0,s.opacity=v.stick),a=new C.Mesh(g,t),c.add(a),n&&(t=new C.Mesh(n,s),c.add(t))),u)u.hasOwnProperty(_)&&(o=_,l=new C.LineBasicMaterial({linewidth:o,vertexColors:!0}),v.line<1&&0<=v.line&&(l.transparent=!0,l.opacity=v.line),u[_].initTypedArrays(),l=new C.Line(u[_],l,C.LineStyle.LinePieces),c.add(l));for(_ in p)p.hasOwnProperty(_)&&(o=_,h=new C.LineBasicMaterial({linewidth:o,vertexColors:!0}),v.cross<1&&0<=v.cross&&(h.transparent=!0,h.opacity=v.cross),p[_].initTypedArrays(),h=new C.Line(p[_],h,C.LineStyle.LinePieces),c.add(h));if(this.dontDuplicateAtoms&&this.modelData.symmetries&&0<this.modelData.symmetries.length){for(var w=new C.Object3D,A=0;A<this.modelData.symmetries.length;A++){var S=new C.Object3D;(S=c.clone()).matrix.copy(this.modelData.symmetries[A]),S.matrixAutoUpdate=!1,w.add(S)}return w}return c}getViewer(){return this.viewer}getInternalState(){return{atoms:this.atoms,frames:this.frames}}setInternalState(e){this.atoms=e.atoms,this.frames=e.frames,this.molObj=null}getCrystData(){var e;return this.modelData.cryst?(this.modelData.cryst.matrix||(e=this.modelData.cryst,this.modelData.cryst.matrix=(0,Z.conversionMatrix3)(e.a,e.b,e.c,e.alpha,e.beta,e.gamma)),this.modelData.cryst):null}setCrystData(e,t,r,i,s,n){var a=(0,Z.conversionMatrix3)(e=e||1,t=t||1,r=r||1,i=i||90,s=s||90,n=n||90);this.modelData.cryst={a:e,b:t,c:r,alpha:i,beta:s,gamma:n,matrix:a}}setCrystMatrix(e){e=e||new Z.Matrix3(1,0,0,0,1,0,0,0,1),this.modelData.cryst={matrix:e}}getSymmetries(){return void 0===this.modelData.symmetries&&(this.modelData.symmetries=[this.idMatrix]),this.modelData.symmetries}setSymmetries(e){void 0===e?this.modelData.symmetries=[this.idMatrix]:(this.modelData.symmetries=e,this.molObj=null)}getID(){return this.id}getNumFrames(){return null!=this.frames.numFrames?this.frames.numFrames:this.frames.length}adjustCoord(e,t,r,i){e=t-e;return e<-r?t+i:r<e?t-i:t}adjustCoordinatesToBox(){if(this.box&&this.atomdfs)for(var e=this.box[0],t=this.box[1],r=this.box[2],i=.9*e,s=.9*t,n=.9*r,a=0;a<this.atomdfs.length;a++)for(var o=this.atomdfs[a],l=1;l<o.length;l++){var h=this.atoms[o[l][0]],c=this.atoms[o[l][1]];h.x=this.adjustCoord(c.x,h.x,i,e),h.y=this.adjustCoord(c.y,h.y,s,t),h.z=this.adjustCoord(c.z,h.z,n,r)}}setFrame(r){var i=this.getNumFrames();let n=this,a=this.viewer;return new Promise(function(s,e){var t;0==i&&s(),(r<0||i<=r)&&(r=i-1),null!=n.frames.url?(t=n.frames.url,(0,Q.getbin)(t+"/traj/frame/"+r+"/"+n.frames.path,void 0,"POST",void 0).then(function(e){for(var t=new Float32Array(e,44),r=0,i=0;i<n.atoms.length;i++)n.atoms[i].x=t[r++],n.atoms[i].y=t[r++],n.atoms[i].z=t[r++];n.box&&n.atomdfs&&n.adjustCoordinatesToBox(),s()}).catch(e)):(n.atoms=n.frames[r],s()),n.molObj=null,n.modelDatas&&r<n.modelDatas.length&&(n.modelData=n.modelDatas[r],n.unitCellObjects&&a&&(a.removeUnitCell(n),a.addUnitCell(n)))})}addFrame(e){this.frames.push(e)}vibrate(e=10,t=1,r=!1,i){var s=0,n=e;let a=this.viewer;r&&(s=-e,n=e),void 0!==this.frames&&void 0!==this.frames.origIndex?this.setFrame(this.frames.origIndex):this.setFrame(0),s<n&&(this.frames=[]),r&&(this.frames.origIndex=e);for(var o=s;o<n;o++){var l=[],h=this.frames.length;if(0!=o||i){for(var c=0;c<this.atoms.length;c++){var d,u=(0,Q.getAtomProperty)(this.atoms[c],"dx"),p=(0,Q.getAtomProperty)(this.atoms[c],"dy"),f=(0,Q.getAtomProperty)(this.atoms[c],"dz"),m=new Z.Vector3(u,p,f),g=new Z.Vector3(this.atoms[c].x,this.atoms[c].y,this.atoms[c].z),v=(m.multiplyScalar(o*t/e),g.add(m),{});for(d in this.atoms[c])v[d]=this.atoms[c][d];v.x=g.x,v.y=g.y,v.z=g.z,l.push(v),a&&i&&(m=(0,Q.extend)({},i),(u=new Z.Vector3(u,p,f)).multiplyScalar(t),u.add(g),m.start=g,m.end=u,m.frame=h,m.color||(p=(p=(p=v.style.sphere)||v.style.stick)||v.style.line,m.color=(0,Q.getColorFromStyle)(v,p)),a.addArrow(m))}this.frames.push(l)}else this.frames.push(this.atoms)}}setAtomDefaults(r){for(let t=0;t<r.length;t++){let e=r[t];e&&(e.style=e.style||(0,Q.deepCopy)($.defaultAtomStyle),e.color=e.color||this.ElementColors[e.elem]||this.defaultColor,e.model=this.id,(e.clickable||e.hoverable)&&(e.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}}addMolData(e,t,r={}){var i=$.parseMolData(e,t,r),e=(this.dontDuplicateAtoms=!r.duplicateAssemblyAtoms,i.modelData);if(e&&(Array.isArray(e)?(this.modelData=e[0],r.frames&&(this.modelDatas=e)):this.modelData=e),i.box?this.box=i.box:this.box=null,0==this.frames.length){for(let e=0;e<i.length;e++)0!=i[e].length&&this.frames.push(i[e]);this.frames[0]&&(this.atoms=this.frames[0])}else if(r.frames)for(let e=0;e<i.length;e++)this.frames.push(i[e]);else for(var s=0;s<i.length;s++)this.addAtoms(i[s]);for(let e=0;e<this.frames.length;e++)this.setAtomDefaults(this.frames[e]);r.vibrate&&r.vibrate.frames&&r.vibrate.amplitude&&this.vibrate(r.vibrate.frames,r.vibrate.amplitude),r.style&&this.setStyle({},r.style)}setDontDuplicateAtoms(e){this.dontDuplicateAtoms=e}setModelData(e){this.modelData=e}propertyMatches(e,t){if(e==t)return!0;if("string"==typeof t&&"number"==typeof e){t=t.match(/(-?\d+)\s*-\s*(-?\d+)/);if(t){var r=parseInt(t[1]),i=parseInt(t[2]);if(t&&r<=e&&e<=i)return!0}}return!1}static deepCopyAndCache(e,t){if("object"!=typeof e||null==e||e instanceof $)return e;if(e.__cache_created)return e;const r={};for(const s in e){var i=e[s];if(Array.isArray(i)){r[s]=[];for(let e=0;e<i.length;e++)r[s].push($.deepCopyAndCache(i[e],t))}else"object"==typeof i&&"properties"!=s&&"model"!=s?r[s]=$.deepCopyAndCache(i,t):r[s]=i;if("and"==s||"or"==s){const n=[];for(const a of r[s]){const o=new Set;for(const l of t.selectedAtoms(a))o.add(l.index);n.push(o)}if("and"==s){let e=new Set(n[0]);for(const h of n.splice(1))e=function(e,t){const r=new Set;for(const i of t)e.has(i)&&r.add(i);return r}(e,h);r[s].__cached_results=e}else if("or"==s){const c=new Set;for(const d of n)for(const u of d)c.add(u);r[s].__cached_results=c}}}return r.__cache_created=!0,r}atomIsSelected(e,i){if(void 0===i)return!0;var r,t=!!i.invert,s=!0;for(r in i)if("and"==r||"or"==r||"not"==r){if("not"==r){if(this.atomIsSelected(e,i[r])){s=!1;break}}else if(!(s=(i=void 0===i[r].__cached_results?$.deepCopyAndCache(i,this):i)[r].__cached_results.has(e.index)))break}else if("predicate"===r){if(!i.predicate(e)){s=!1;break}}else if("properties"==r&&e[r]){for(var n in i.properties)if(!n.startsWith("__cache")){if(void 0===e.properties[n]){s=!1;break}if(e.properties[n]!=i.properties[n]){s=!1;break}}}else if("model"==r){let r=i.model;if("number"==typeof r&&r<0&&(r=this.viewer.getNextModelId()+r),Array.isArray(r)){let t=!1;for(let e=0;e<r.length;e++)if(r[e]==this||r[e]==this.id){t=!0;break}if(!t){s=!1;break}}else if(r!=this&&r!=this.id){s=!1;break}}else if(i.hasOwnProperty(r)&&!$.ignoredKeys.has(r)&&!r.startsWith("__cache")){if(void 0===e[r]){s=!1;break}let t=!1;if("bonds"===r){if(i[r]!=e.bonds.length){s=!1;break}}else if(Array.isArray(i[r])){var a=i[r],o=e[r];for(let e=0;e<a.length;e++)if(this.propertyMatches(o,a[e])){t=!0;break}if(!t){s=!1;break}}else{var l=i[r];if(!this.propertyMatches(e[r],l)){s=!1;break}}}return t?!s:s}static squaredDistance(e,t){var r=t.x-e.x,i=t.y-e.y,t=t.z-e.z;return r*r+i*i+t*t}expandAtomList(e,t){if(t<=0)return e;for(var r=(0,Q.getExtent)(e,void 0),i=[[],[],[]],s=0;s<3;s++)i[0][s]=r[0][s]-t,i[1][s]=r[1][s]+t,i[2][s]=r[2][s];var n=[];for(let e=0;e<this.atoms.length;e++){var a=this.atoms[e].x,o=this.atoms[e].y,l=this.atoms[e].z;a>=i[0][0]&&a<=i[1][0]&&o>=i[0][1]&&o<=i[1][1]&&l>=i[0][2]&&l<=i[1][2]&&(a>=r[0][0]&&a<=r[1][0]&&o>=r[0][1]&&o<=r[1][1]&&l>=r[0][2]&&l<=r[1][2]||n.push(this.atoms[e]))}return n}static getFloat(e){return"number"==typeof e?e:parseFloat(e)}selectedAtoms(e,t){for(var r=[],i=(e=$.deepCopyAndCache(e||{},this),(t=t||this.atoms).length),s=0;s<i;s++){var n=t[s];n&&this.atomIsSelected(n,e)&&r.push(n)}if(e.hasOwnProperty("expand")){var a=$.getFloat(e.expand),o=this.expandAtomList(r,a),l=r.length,h=a*a;for(let t=0;t<o.length;t++)for(let e=0;e<l;e++){var c=$.squaredDistance(o[t],r[e]);c<h&&0<c&&r.push(o[t])}}if(e.hasOwnProperty("within")&&e.within.hasOwnProperty("sel")&&e.within.hasOwnProperty("distance")){var d=this.selectedAtoms(e.within.sel,this.atoms),u={};const c=$.getFloat(e.within.distance);var p=c*c;for(let t=0;t<d.length;t++)for(let e=0;e<r.length;e++){var f=$.squaredDistance(d[t],r[e]);f<p&&0<f&&(u[e]=1)}var m=[];if(e.within.invert)for(let e=0;e<r.length;e++)u[e]||m.push(r[e]);else for(var g in u)m.push(r[g]);r=m}if(e.hasOwnProperty("byres")){var v={},b=[],_=[];for(let t=0;t<r.length;t++){let e=r[t];var y=e.chain,x=e.resi;if(void 0===v[y]&&(v[y]={}),e.hasOwnProperty("resi")&&void 0===v[y][x])for(v[y][x]=!0,_.push(e);0<_.length;)if(y=(e=_.pop()).chain,x=e.resi,void 0===b[e.index]){b[e.index]=!0;for(var w=0;w<e.bonds.length;w++){var A=this.atoms[e.bonds[w]];void 0===b[A.index]&&A.hasOwnProperty("resi")&&A.chain==y&&A.resi==x&&(_.push(A),r.push(A))}}}}return r}addAtoms(e){this.molObj=null;for(var t=this.atoms.length,r=[],i=0;i<e.length;i++)void 0===e[i].index&&(e[i].index=i),void 0===e[i].serial&&(e[i].serial=i),r[e[i].index]=t+i;for(i=0;i<e.length;i++){for(var s=e[i],n=r[s.index],a=(0,Q.extend)({},s),o=(a.index=n,a.bonds=[],a.bondOrder=[],a.model=this.id,a.style=a.style||(0,Q.deepCopy)($.defaultAtomStyle),void 0===a.color&&(a.color=this.ElementColors[a.elem]||this.defaultColor),s.bonds?s.bonds.length:0),l=0;l<o;l++){var h=r[s.bonds[l]];void 0!==h&&(a.bonds.push(h),a.bondOrder.push(s.bondOrder?s.bondOrder[l]:1))}this.atoms.push(a)}}assignBonds(){(0,s.assignBonds)(this.atoms,{assignBonds:!0})}removeAtoms(e){this.molObj=null;for(var t=[],r=0;r<e.length;r++)t[e[r].index]=!0;var i=[];for(r=0;r<this.atoms.length;r++){var s=this.atoms[r];t[s.index]||i.push(s)}this.atoms=[],this.addAtoms(i)}setStyle(s,n,a){void 0===n&&void 0===a&&(n=s,s={}),"string"==typeof n&&(n=(0,Q.specStringToObject)(n));function t(t){var r=e.selectedAtoms(s,t);for(let e=0;e<t.length;e++)t[e]&&(t[e].capDrawn=!1);for(let e=0;e<r.length;e++)for(var i in o=!0,(r[e].clickable||r[e].hoverable)&&(r[e].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),a||(r[e].style={}),n)n.hasOwnProperty(i)&&(r[e].style[i]=r[e].style[i]||{},Object.assign(r[e].style[i],n[i]))}var o=!1,e=this;if(void 0!==s.frame&&s.frame<this.frames.length){let e=s.frame;e<0&&(e=this.frames.length+e),t(this.frames[e])}else{t(this.atoms);for(var r=0;r<this.frames.length;r++)this.frames[r]!==this.atoms&&t(this.frames[r])}o&&(this.molObj=null)}setClickable(e,t,r){if(t=!!t,null===(r=(0,Q.makeFunction)(r)))console.log("Callback is not a function");else{var i=this.selectedAtoms(e,this.atoms),s=i.length;for(let e=0;e<s;e++)i[e].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},i[e].clickable=t,r&&(i[e].callback=r);0<s&&(this.molObj=null)}}setHoverable(e,t,r,i){if(t=!!t,r=(0,Q.makeFunction)(r),i=(0,Q.makeFunction)(i),null===r)console.log("Hover_callback is not a function");else if(null===i)console.log("Unhover_callback is not a function");else{var s=this.selectedAtoms(e,this.atoms),n=s.length;for(let e=0;e<n;e++)s[e].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},s[e].hoverable=t,r&&(s[e].hover_callback=r),i&&(s[e].unhover_callback=i);0<n&&(this.molObj=null)}}enableContextMenu(e,t){t=!!t;for(var r=this.selectedAtoms(e,this.atoms),i=r.length,s=0;s<i;s++)r[s].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},r[s].contextMenuEnabled=t;0<i&&(this.molObj=null)}setColorByElement(e,t){if(null===this.molObj||!$.sameObj(t,this.lastColors)){this.lastColors=t;var r=this.selectedAtoms(e,void 0);0<r.length&&(this.molObj=null);for(var i=0;i<r.length;i++){var s=r[i];void 0!==t[s.elem]&&(s.color=t[s.elem])}}}setColorByProperty(e,t,r,i){var s,n=this.selectedAtoms(e,void 0);for(this.lastColors=null,0<n.length&&(this.molObj=null),"string"==typeof r&&void 0!==o.Gradient.builtinGradients[r]&&(r=new o.Gradient.builtinGradients[r]),i=(i=i||r.range())||(0,Q.getPropertyRange)(n,t),s=0;s<n.length;s++){var a=n[s];null!=(0,Q.getAtomProperty)(a,t)&&(a.color=r.valueToHex(parseFloat(a.properties[t]),i))}}setColorByFunction(e,r){var i=this.selectedAtoms(e,void 0);if("function"==typeof r){this.lastColors=null,0<i.length&&(this.molObj=null);for(let t=0;t<i.length;t++){let e=i[t];e.color=r(e)}}}toCDObject(t=!1){var i={a:[],b:[]};t&&(i.s=[]);for(let r=0;r<this.atoms.length;r++){let e={};var s=this.atoms[r];if(e.x=s.x,e.y=s.y,e.z=s.z,"C"!=s.elem&&(e.l=s.elem),t){for(var n=0;n<i.s.length&&JSON.stringify(s.style)!==JSON.stringify(i.s[n]);)n++;n===i.s.length&&i.s.push(s.style),0!==n&&(e.s=n)}i.a.push(e);for(let t=0;t<s.bonds.length;t++){var a=r,o=s.bonds[t];if(!(o<=a)){let e={b:a,e:o};a=s.bondOrder[t];1!=a&&(e.o=a),i.b.push(e)}}}return i}globj(e,t){null!==this.molObj&&!t.regen||(this.molObj=this.createMolObj(this.atoms,t),this.renderedMolObj&&(e.remove(this.renderedMolObj),this.renderedMolObj=null),this.renderedMolObj=this.molObj.clone(),this.hidden&&(this.renderedMolObj.setVisible(!1),this.molObj.setVisible(!1)),e.add(this.renderedMolObj))}exportVRML(){return this.createMolObj(this.atoms,{supportsImposters:!1,supportsAIA:!1}).vrml()}removegl(e){this.renderedMolObj&&(void 0!==this.renderedMolObj.geometry&&this.renderedMolObj.geometry.dispose(),void 0!==this.renderedMolObj.material&&this.renderedMolObj.material.dispose(),e.remove(this.renderedMolObj),this.renderedMolObj=null),this.molObj=null}hide(){this.hidden=!0,this.renderedMolObj&&this.renderedMolObj.setVisible(!1),this.molObj&&this.molObj.setVisible(!1)}show(){this.hidden=!1,this.renderedMolObj&&this.renderedMolObj.setVisible(!0),this.molObj&&this.molObj.setVisible(!0)}addPropertyLabels(t,e,r){var i=this.selectedAtoms(e);let s=this.viewer,n=(0,Q.deepCopy)(r);for(let e=0;e<i.length;e++){var a=i[e],o=null;void 0!==a[t]?o=String(a[t]):void 0!==a.properties[t]&&(o=String(a.properties[t])),null!=o&&(n.position=a,s.addLabel(o,n))}}addResLabels(m,g,e=!1){let v=this.viewer;function t(e,r){for(var t=e.selectedAtoms(m,void 0),i={},s=0;s<t.length;s++){var n=t[s],a=n.chain,o=n.resn+""+n.resi;i[a]||(i[a]={}),i[a][o]||(i[a][o]=[]),i[a][o].push(n)}var l,h=(0,Q.deepCopy)(g);for(l in i)if(i.hasOwnProperty(l)){var c,d=i[l];for(c in d)if(d.hasOwnProperty(c)){var u=d[c];let t=new Z.Vector3(0,0,0);for(let e=0;e<u.length;e++){var p=u[e];t.x+=p.x,t.y+=p.y,t.z+=p.z}t.divideScalar(u.length),h.position=t,h.frame=r;var f=v.addLabel(c,h,void 0,!0);b.push(f)}}}var b=[];if(e){var r=this.getNumFrames(),e=this.atoms;for(let e=0;e<r;e++)this.frames[e]&&(this.atoms=this.frames[e],t(this,e));this.atoms=e}else t(this);return b}setupDFS(){this.atomdfs=[];for(var e,a=this,o=new Int8Array(this.atoms.length),l=(o.fill(0),function(e,t,r){r.push([e,t]);var i=a.atoms[e];o[e]=1;for(var s=0;s<i.bonds.length;s++){var n=i.bonds[s];a.atoms[n]&&!o[n]&&l(n,e,r)}}),t=0;t<this.atoms.length;t++)this.atoms[t]&&!o[t]&&(l(t,-1,e=[]),this.atomdfs.push(e))}setCoordinatesFromURL(t,r){this.frames=[];var i=this;return this.box&&this.setupDFS(),t.startsWith("http")||(t="http://"+t),(0,Q.get)(t+"/traj/numframes/"+r,function(e){if(!isNaN(parseInt(e)))return i.frames.push(i.atoms),i.frames.numFrames=e,i.frames.url=t,i.frames.path=r,i.setFrame(0)})}setCoordinates(e,t){if(!e)return[];if(/\.gz$/.test(t=t||"")){t=t.replace(/\.gz$/,"");try{e=(0,Q.inflateString)(e)}catch(e){console.log(e)}}if({mdcrd:"",inpcrd:"",pdb:"",netcdf:"",array:""}.hasOwnProperty(t)){this.frames=[];for(var r=this.atoms.length,i=$.parseCrd(e,t),s=0;s<i.length;){for(var n=[],a=0;a<r;a++){var o,l={};for(o in this.atoms[a])l[o]=this.atoms[a][o];n[a]=l,n[a].x=i[s++],n[a].y=i[s++],n[a].z=i[s++]}this.frames.push(n)}return this.atoms=this.frames[0],this.frames}return[]}addAtomSpecs(e){}static parseCrd(t,r){var i=[],e=0;if("pdb"==r)for(var s=t.indexOf("\nATOM");-1!=s;){for(;"\nATOM"==t.slice(s,s+5)||"\nHETATM"==t.slice(s,s+7);)i[e++]=parseFloat(t.slice(s+31,s+39)),i[e++]=parseFloat(t.slice(s+39,s+47)),i[e++]=parseFloat(t.slice(s+47,s+55)),s=t.indexOf("\n",s+54),"\nTER"==t.slice(s,s+4)&&(s=t.indexOf("\n",s+5));s=t.indexOf("\nATOM",s)}else if("netcdf"==r)var n=new a.NetCDFReader(t),i=[].concat.apply([],n.getDataVariable("coordinates"));else{if("array"==r||Array.isArray(t))return t.flat(2);{let e=t.indexOf("\n");"inpcrd"==r&&(e=t.indexOf("\n",e+1)),i=(t=t.slice(e+1)).match(/\S+/g).map(parseFloat)}}return i}static parseMolData(e,t="",r){if(!e)return[];if(/\.gz$/.test(t)){t=t.replace(/\.gz$/,"");try{e=t.match(/bcif/i)?(0,Q.inflateString)(e,!1):(0,Q.inflateString)(e)}catch(e){console.log(e)}}return void 0===i.Parsers[t]&&(t=t.split(".").pop(),void 0===i.Parsers[t]&&(console.log("Unknown format: "+t),t=e instanceof Uint8Array?"bcif":e.match(/^@<TRIPOS>MOLECULE/gm)?"mol2":e.match(/^data_/gm)&&e.match(/^loop_/gm)?"cif":e.match(/^HETATM/gm)||e.match(/^ATOM/gm)?"pdb":e.match(/ITEM: TIMESTEP/gm)?"lammpstrj":e.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/gm)?"sdf":e.match(/^%VERSION\s+VERSION_STAMP/gm)?"prmtop":"xyz",console.log("Best guess: "+t))),(0,i.Parsers[t])(e,r)}}$.defaultAtomStyle={line:{}},$.defaultlineWidth=1,$.vdwRadii={H:1.2,He:1.4,Li:1.82,Be:1.53,B:1.92,C:1.7,N:1.55,O:1.52,F:1.47,Ne:1.54,Na:2.27,Mg:1.73,Al:1.84,Si:2.1,P:1.8,S:1.8,Cl:1.75,Ar:1.88,K:2.75,Ca:2.31,Ni:1.63,Cu:1.4,Zn:1.39,Ga:1.87,Ge:2.11,As:1.85,Se:1.9,Br:1.85,Kr:2.02,Rb:3.03,Sr:2.49,Pd:1.63,Ag:1.72,Cd:1.58,In:1.93,Sn:2.17,Sb:2.06,Te:2.06,I:1.98,Xe:2.16,Cs:3.43,Ba:2.68,Pt:1.75,Au:1.66,Hg:1.55,Tl:1.96,Pb:2.02,Bi:2.07,Po:1.97,At:2.02,Rn:2.2,Fr:3.48,Ra:2.83,U:1.86},$.ignoredKeys=new Set(["props","invert","model","frame","byres","expand","within","and","or","not"])},"./src/GLShape.ts":(e,t,r)=>{r.r(t),r.d(t,{GLShape:()=>F,splitMesh:()=>c});var i=r("./src/WebGL/index.ts"),Z=r("./src/WebGL/shapes/index.ts"),X=r("./src/WebGL/math/index.ts"),u=r("./src/colors.ts"),E=r("./src/ProteinSurface4.ts"),s=r("./src/VolumeData.ts"),p=r("./src/GLDraw.ts"),d=r("./src/glcartoon.ts"),o=r("./src/utilities.ts");class F{static finalizeGeo(e){e=e.updateGeoGroup(0);0<e.vertices&&e.truncateArrayBuffers(!0,!0)}static updateColor(e,i){for(var s in i=i||u.CC.color(i),e.colorsNeedUpdate=!0,i.constructor!==Array&&(a=i.r,o=i.g,l=i.b),e.geometryGroups){var n,a,o,l,s=e.geometryGroups[s];let r=s.colorArray;for(let e=0,t=s.vertices;e<t;++e)i.constructor===Array&&(a=(n=i[e]).r,o=n.g,l=n.b),r[3*e]=a,r[3*e+1]=o,r[3*e+2]=l}}static drawArrow(R,e,t){var r=t.start,i=t.end,G=t.radius,P=t.radiusRatio,B=t.mid,t=t.midpos;if(r&&i){for(var U,s,n,a,o,l,h,c,d,N,u,p,f,m,g,v,b,_,y,x=e.updateGeoGroup(51),e=new X.Vector3(i.x,i.y,i.z).sub(r),w=(t&&(A=e.length(),B=0<t?t/A:(A+t)/A),e.multiplyScalar(B),new X.Vector3(r.x,r.y,r.z).add(e)),t=e.clone().negate(),A=new X.Vector3(r.x,r.y,r.z),S=(R.intersectionShape.cylinder.push(new Z.Cylinder(A,w.clone(),G)),R.intersectionShape.sphere.push(new Z.Sphere(A,G)),[]),C=(S[0]=e.clone(),1e-4<Math.abs(S[0].x)?S[0].y+=1:S[0].x+=1,S[0].cross(e),S[0].normalize(),S[4]=S[0].clone(),S[4].crossVectors(S[0],e),S[4].normalize(),S[8]=S[0].clone().negate(),S[12]=S[4].clone().negate(),S[2]=S[0].clone().add(S[4]).normalize(),S[6]=S[4].clone().add(S[8]).normalize(),S[10]=S[8].clone().add(S[12]).normalize(),S[14]=S[12].clone().add(S[0]).normalize(),S[1]=S[0].clone().add(S[2]).normalize(),S[3]=S[2].clone().add(S[4]).normalize(),S[5]=S[4].clone().add(S[6]).normalize(),S[7]=S[6].clone().add(S[8]).normalize(),S[9]=S[8].clone().add(S[10]).normalize(),S[11]=S[10].clone().add(S[12]).normalize(),S[13]=S[12].clone().add(S[14]).normalize(),S[15]=S[14].clone().add(S[0]).normalize(),x.vertices),L=x.vertexArray,M=x.faceArray,z=x.normalArray,T=x.lineArray,E=0,j=S.length;E<j;++E){var V,F=3*(C+3*E),D=S[E].clone().multiplyScalar(G).add(r),k=S[E].clone().multiplyScalar(G).add(w),I=S[E].clone().multiplyScalar(G*P).add(w);L[F]=D.x,L[F+1]=D.y,L[F+2]=D.z,L[F+3]=k.x,L[F+4]=k.y,L[F+5]=k.z,L[F+6]=I.x,L[F+7]=I.y,L[F+8]=I.z,0<E&&(D=L[F-3],k=L[F-2],V=L[F-1],D=new X.Vector3(D,k,V),k=new X.Vector3(i.x,i.y,i.z),V=w.clone(),I=new X.Vector3(I.x,I.y,I.z),R.intersectionShape.triangle.push(new Z.Triangle(I,k,D)),R.intersectionShape.triangle.push(new Z.Triangle(D.clone(),V,I.clone())))}x.vertices+=48,L[F=3*x.vertices]=r.x,L[F+1]=r.y,L[F+2]=r.z,L[F+3]=w.x,L[F+4]=w.y,L[F+5]=w.z,L[F+6]=i.x,L[F+7]=i.y,L[F+8]=i.z,x.vertices+=3;var W=x.vertices-3,H=x.vertices-2,O=x.vertices-1,B=3*W,A=3*H,q=3*O;for(E=0,j=S.length-1;E<j;++E){var Y=C+3*E;F=3*Y,s=x.faceidx,n=x.lineidx,u=3*(o=(a=Y)+1),p=3*(l=Y+2),f=3*(h=Y+4),m=3*(c=Y+5),g=3*(d=Y+3),v=b=S[E],_=y=S[E+1],z[N=3*a]=v.x,z[u]=b.x,z[g]=y.x,z[N+1]=v.y,z[u+1]=b.y,z[g+1]=y.y,z[N+2]=v.z,z[u+2]=b.z,z[g+2]=y.z,z[u]=b.x,z[f]=_.x,z[g]=y.x,z[u+1]=b.y,z[f+1]=_.y,z[g+1]=y.y,z[u+2]=b.z,z[f+2]=_.z,z[g+2]=y.z,z[p]=b.x,z[m]=_.x,z[p+1]=b.y,z[m+1]=_.y,z[p+2]=b.z,z[m+2]=_.z,M[s]=a,M[s+1]=o,M[s+2]=d,M[s+3]=o,M[s+4]=h,M[s+5]=d,M[s+6]=a,M[s+7]=d,M[s+8]=W,M[s+9]=l,M[s+10]=H,M[s+11]=c,M[s+12]=l,M[s+13]=O,M[s+14]=c,T[n]=a,T[n+1]=o,T[n+2]=a,T[n+3]=d,T[n+4]=h,T[n+5]=d,T[n+6]=a,T[n+7]=d,T[n+8]=l,T[n+9]=o,T[n+10]=l,T[n+11]=c,T[n+12]=h,T[n+13]=c,T[n+14]=l,T[n+15]=O,T[n+16]=l,T[n+17]=c,T[n+18]=O,T[n+19]=c,x.faceidx+=15,x.lineidx+=20}s=x.faceidx,n=x.lineidx,u=3*(o=(U=[C+45,C+46,C+1,C,C+47,C+2])[1]),p=3*(l=U[4]),f=3*(h=U[2]),m=3*(c=U[5]),g=3*(d=U[3]),v=b=S[15],_=y=S[0],z[N=3*(a=U[0])]=v.x,z[u]=b.x,z[g]=y.x,z[N+1]=v.y,z[u+1]=b.y,z[g+1]=y.y,z[N+2]=v.z,z[u+2]=b.z,z[g+2]=y.z,z[u]=b.x,z[f]=_.x,z[g]=y.x,z[u+1]=b.y,z[f+1]=_.y,z[g+1]=y.y,z[u+2]=b.z,z[f+2]=_.z,z[g+2]=y.z,z[p]=b.x,z[m]=_.x,z[p+1]=b.y,z[m+1]=_.y,z[p+2]=b.z,z[m+2]=_.z,e.normalize(),t.normalize(),z[B]=t.x,z[A]=z[q]=e.x,z[1+B]=t.y,z[1+A]=z[1+q]=e.y,z[2+B]=t.z,z[2+A]=z[2+q]=e.z,M[s]=a,M[s+1]=o,M[s+2]=d,M[s+3]=o,M[s+4]=h,M[s+5]=d,M[s+6]=a,M[s+7]=d,M[s+8]=W,M[s+9]=l,M[s+10]=H,M[s+11]=c,M[s+12]=l,M[s+13]=O,M[s+14]=c,T[n]=a,T[n+1]=o,T[n+2]=a,T[n+3]=d,T[n+4]=h,T[n+5]=d,T[n+6]=a,T[n+7]=d,T[n+8]=l,T[n+9]=o,T[n+10]=l,T[n+11]=c,T[n+12]=h,T[n+13]=c,T[n+14]=l,T[n+15]=O,T[n+16]=l,T[n+17]=c,T[n+18]=O,T[n+19]=c,x.faceidx+=15,x.lineidx+=20}}static updateBoundingFromPoints(e,t,r,i){e.center.set(0,0,0);let s=1/0,n=1/0,a=1/0,o=-1/0,l=-1/0,h=-1/0;e.box&&(s=e.box.min.x,o=e.box.max.x,n=e.box.min.y,l=e.box.max.y,a=e.box.min.z,h=e.box.max.z);for(let e=0,t=i;e<t;e++){var c=r[3*e],d=r[3*e+1],u=r[3*e+2];c<s&&(s=c),d<n&&(n=d),u<a&&(a=u),c>o&&(o=c),d>l&&(l=d),u>h&&(h=u)}e.center.set((o+s)/2,(l+n)/2,(h+a)/2),e.radius=e.center.distanceTo({x:o,y:l,z:h}),e.box={min:{x:s,y:n,z:a},max:{x:o,y:l,z:h}}}static addCustomGeo(e,t,r,i,s){var n,a,o,l=t.addGeoGroup(),h=r.vertexArr,c=r.normalArr,d=r.faceArr,u=(l.vertices=h.length,l.faceidx=d.length,l.vertexArray),p=l.colorArray;for(i.constructor!==Array&&(a=i.r,o=i.g,g=i.b),C=0,L=l.vertices;C<L;++C)n=h[C],u[f=3*C]=n.x,u[f+1]=n.y,u[f+2]=n.z,i.constructor===Array&&(a=(v=i[C]).r,o=v.g,g=v.b),p[f]=a,p[f+1]=o,p[f+2]=g;if(s)for(C=0,L=l.faceidx/3;C<L;++C){var f,m=d[f=3*C],g=d[f+1],v=d[f+2],b=new X.Vector3,_=new X.Vector3,y=new X.Vector3;e.intersectionShape.triangle.push(new Z.Triangle(b.copy(h[m]),_.copy(h[g]),y.copy(h[v])))}if(s){var x=new X.Vector3(0,0,0),w=0;for(let e=0;e<t.geometryGroups.length;e++)x.add(t.geometryGroups[e].getCentroid()),w++;x.divideScalar(w),F.updateBoundingFromPoints(e.boundingSphere,{centroid:x},u,l.vertices)}if(l.faceArray=new Uint16Array(d),l.truncateArrayBuffers(!0,!0),c.length<l.vertices)l.setNormals();else for(var A,S=l.normalArray=new Float32Array(3*l.vertices),C=0,L=l.vertices;C<L;++C)A=c[C],S[f=3*C]=A.x,S[f+1]=A.y,S[f+2]=A.z;l.setLineIndices(),l.lineidx=l.lineArray.length}static updateFromStyle(e,t){void 0!==t.color?(e.color=t.color||new u.Color,t.color instanceof u.Color||(e.color=u.CC.color(t.color))):e.color=u.CC.color(0),e.wireframe=!!t.wireframe,e.opacity=t.alpha?(0,X.clamp)(t.alpha,0,1):1,void 0!==t.opacity&&(e.opacity=(0,X.clamp)(t.opacity,0,1)),e.side=void 0!==t.side?t.side:i.DoubleSide,e.linewidth=void 0===t.linewidth?1:t.linewidth,e.clickable=!!t.clickable,e.callback=(0,o.makeFunction)(t.callback),e.hoverable=!!t.hoverable,e.hover_callback=(0,o.makeFunction)(t.hover_callback),e.unhover_callback=(0,o.makeFunction)(t.unhover_callback),e.contextMenuEnabled=!!t.contextMenuEnabled,e.hidden=t.hidden,e.frame=t.frame}constructor(e){this.color=16777215,this.hidden=!1,this.wireframe=!1,this.opacity=1,this.linewidth=1,this.clickable=!1,this.hoverable=!1,this.contextMenuEnabled=!1,this.side=i.DoubleSide,this.stylespec=e||{},this.boundingSphere=new Z.Sphere,this.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},F.updateFromStyle(this,this.stylespec),this.components=[],this.shapeObj=null,this.renderedShapeObj=null,this.geo=new i.Geometry(!0),this.linegeo=new i.Geometry(!0)}updateStyle(e){for(var t in e)this.stylespec[t]=e[t];if(F.updateFromStyle(this,this.stylespec),e.voldata&&e.volscheme){(0,o.adjustVolumeStyle)(e);const i=e.volscheme,s=e.voldata,n=u.CC,a=i.range()||[-1,1];this.geo.setColors(function(e,t,r){e=s.getVal(e,t,r);return n.color(i.valueToHex(e,a))}),delete this.color}}addCustom(e){e.vertexArr=e.vertexArr||[],e.faceArr=e.faceArr||[],e.normalArr=e.normalArr||[],F.drawCustom(this,this.geo,e)}addSphere(e){e.center||(e.center=new X.Vector3(0,0,0)),e.radius=e.radius?(0,X.clamp)(e.radius,0,1/0):1.5,e.color=u.CC.color(e.color),this.intersectionShape.sphere.push(new Z.Sphere(e.center,e.radius)),p.GLDraw.drawSphere(this.geo,e.center,e.radius,e.color,e.quality),this.components.push({centroid:new X.Vector3(e.center.x,e.center.y,e.center.z)});e=this.geo.updateGeoGroup(0);F.updateBoundingFromPoints(this.boundingSphere,this.components,e.vertexArray,e.vertices)}addBox(e){var t=e.dimensions||{w:1,h:1,d:1},r="number"==typeof t.w?{x:t.w,y:0,z:0}:t.w,i="number"==typeof t.h?{x:0,y:t.h,z:0}:t.h,t="number"==typeof t.d?{x:0,y:0,z:t.d}:t.d,s=e.corner,s=[{x:(s=null==s?void 0!==e.center?{x:e.center.x-.5*(r.x+i.x+t.x),y:e.center.y-.5*(r.y+i.y+t.y),z:e.center.z-.5*(r.z+i.z+t.z)}:{x:0,y:0,z:0}:s).x,y:s.y,z:s.z},{x:s.x+r.x,y:s.y+r.y,z:s.z+r.z},{x:s.x+i.x,y:s.y+i.y,z:s.z+i.z},{x:s.x+r.x+i.x,y:s.y+r.y+i.y,z:s.z+r.z+i.z},{x:s.x+t.x,y:s.y+t.y,z:s.z+t.z},{x:s.x+r.x+t.x,y:s.y+r.y+t.y,z:s.z+r.z+t.z},{x:s.x+i.x+t.x,y:s.y+i.y+t.y,z:s.z+i.z+t.z},{x:s.x+r.x+i.x+t.x,y:s.y+r.y+i.y+t.y,z:s.z+r.z+i.z+t.z}],r=[],i=[],t=(r.splice(r.length,0,s[0],s[1],s[2],s[3]),i.splice(i.length,0,0,2,1,1,2,3),r.splice(r.length,0,s[2],s[3],s[6],s[7]),i.splice(i.length,0,4,6,5,5,6,7),r.splice(r.length,0,s[4],s[5],s[0],s[1]),i.splice(i.length,0,8,10,9,9,10,11),r.splice(r.length,0,s[6],s[7],s[4],s[5]),i.splice(i.length,0,12,14,13,13,14,15),r.splice(r.length,0,s[3],s[1],s[7],s[5]),i.splice(i.length,0,16,18,17,17,18,19),r.splice(r.length,0,s[2],s[6],s[0],s[4]),i.splice(i.length,0,20,22,21,21,22,23),(0,o.extend)({},e)),e=(t.vertexArr=r,t.faceArr=i,t.normalArr=[],F.drawCustom(this,this.geo,t),new X.Vector3),r=(this.components.push({centroid:e.addVectors(s[0],s[7]).multiplyScalar(.5)}),this.geo.updateGeoGroup(0));F.updateBoundingFromPoints(this.boundingSphere,this.components,r.vertexArray,r.vertices)}addCylinder(e){var t,r=e.start?new X.Vector3(e.start.x||0,e.start.y||0,e.start.z||0):new X.Vector3(0,0,0),i=(e.end?void 0===(t=new X.Vector3(e.end.x,e.end.y||0,e.end.z||0)).x&&(t.x=3):t=new X.Vector3(0,0,0),e.radius||.1),s=u.CC.color(e.color),i=(this.intersectionShape.cylinder.push(new Z.Cylinder(r,t,i)),p.GLDraw.drawCylinder(this.geo,r,t,i,s,e.fromCap,e.toCap),new X.Vector3),s=(this.components.push({centroid:i.addVectors(r,t).multiplyScalar(.5)}),this.geo.updateGeoGroup(0));F.updateBoundingFromPoints(this.boundingSphere,this.components,s.vertexArray,s.vertices)}addDashedCylinder(e){e.dashLength=e.dashLength||.25,e.gapLength=e.gapLength||.25,t=e.start?new X.Vector3(e.start.x||0,e.start.y||0,e.start.z||0):new X.Vector3(0,0,0),e.end?void 0===(r=new X.Vector3(e.end.x,e.end.y||0,e.end.z||0)).x&&(r.x=3):r=new X.Vector3(3,0,0);for(var t,r,i,s=e.radius||.1,n=u.CC.color(e.color),a=Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2)+Math.pow(t.z-r.z,2)),o=a/(e.gapLength+e.dashLength),l=new X.Vector3(e.start.x||0,e.start.y||0,e.start.z||0),h=(new X.Vector3(e.end.x,e.end.y||0,e.end.z||0),new X.Vector3((r.x-t.x)/(a/e.gapLength),(r.y-t.y)/(a/e.gapLength),(r.z-t.z)/(a/e.gapLength))),c=new X.Vector3((r.x-t.x)/(a/e.dashLength),(r.y-t.y)/(a/e.dashLength),(r.z-t.z)/(a/e.dashLength)),d=0;d<o;d++)i=new X.Vector3(l.x+c.x,l.y+c.y,l.z+c.z),this.intersectionShape.cylinder.push(new Z.Cylinder(l,i,s)),p.GLDraw.drawCylinder(this.geo,l,i,s,n,e.fromCap,e.toCap),l=new X.Vector3(i.x+h.x,i.y+h.y,i.z+h.z);a=new X.Vector3,this.components.push({centroid:a.addVectors(t,r).multiplyScalar(.5)}),a=this.geo.updateGeoGroup(0);F.updateBoundingFromPoints(this.boundingSphere,this.components,a.vertexArray,a.vertices)}addCurve(e){e.points=e.points||[],e.smooth=e.smooth||10,void 0===e.fromCap&&(e.fromCap=2),void 0===e.toCap&&(e.toCap=2);var t=(0,d.subdivide_spline)(e.points,e.smooth);if(t.length<3)console.log("Too few points in addCurve");else for(var r,i=e.radius||.1,s=u.CC.color(e.color),n=0,a=t.length-1,o=t[0].distanceTo(t[1]),o=Math.ceil(2*i/o),l=(e.toArrow&&(r={start:t[a-=o],end:t[t.length-1],radius:i,color:s,mid:1e-4},this.addArrow(r)),e.fromArrow&&(r={start:t[n+=o],end:t[0],radius:i,color:s,mid:1e-4},this.addArrow(r)),Math.ceil(t.length/2)),h={radius:i,color:s,fromCap:2,toCap:2},c=n;c<a;c++)h.start=t[c],h.end=t[c+1],h.fromCap=2,h.toCap=2,c<l?(h.fromCap=2,h.toCap=0):(h.fromCap=l<c?0:2,h.toCap=2),this.addCylinder(h)}addLine(e){var t,r=e.start?new X.Vector3(e.start.x||0,e.start.y||0,e.start.z||0):new X.Vector3(0,0,0),e=(e.end?void 0===(t=new X.Vector3(e.end.x,e.end.y||0,e.end.z||0)).x&&(t.x=3):t=new X.Vector3(3,0,0),this.geo.updateGeoGroup(2)),i=e.vertices,s=3*i,n=e.vertexArray,n=(n[s]=r.x,n[1+s]=r.y,n[2+s]=r.z,n[3+s]=t.x,n[4+s]=t.y,n[5+s]=t.z,e.vertices+=2,e.lineArray),s=e.lineidx,n=(n[s]=i,n[s+1]=i+1,e.lineidx+=2,new X.Vector3);this.components.push({centroid:n.addVectors(r,t).multiplyScalar(.5)}),e=this.geo.updateGeoGroup(0),F.updateBoundingFromPoints(this.boundingSphere,this.components,e.vertexArray,e.vertices)}addArrow(e){e.start?e.start=new X.Vector3(e.start.x||0,e.start.y||0,e.start.z||0):e.start=new X.Vector3(0,0,0),e.dir instanceof X.Vector3&&"number"==typeof e.length?(t=e.dir.clone().multiplyScalar(e.length).add(e.start),e.end=t):e.end?(e.end=new X.Vector3(e.end.x,e.end.y||0,e.end.z||0),void 0===e.end.x&&(e.end.x=3)):e.end=new X.Vector3(3,0,0),e.radius=e.radius||.1,e.radiusRatio=e.radiusRatio||1.618034,e.mid=0<e.mid&&e.mid<1?e.mid:.618034,F.drawArrow(this,this.geo,e);var t=new X.Vector3,t=(this.components.push({centroid:t.addVectors(e.start,e.end).multiplyScalar(.5)}),this.geo.updateGeoGroup(0));F.updateBoundingFromPoints(this.boundingSphere,this.components,t.vertexArray,t.vertices)}static distance_from(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2))}static inSelectedRegion(e,t,r){for(var i=0;i<t.length;i++)if(F.distance_from(t[i],e)<=r)return!0;return!1}addIsosurface(e,t,r,i){for(var s=void 0!==t.isoval&&"number"==typeof t.isoval?t.isoval:0,n=!!t.voxel,a=void 0===t.smoothness?1:t.smoothness,o=e.size.x,l=e.size.y,h=e.size.z,c=new Int16Array(o*l*h),d=e.data,u=0,p=c.length;u<p;++u)c[u]=-1;var f=new Uint8Array(o*l*h);for(u=0,p=d.length;u<p;++u)0<(0<=s?d[u]-s:s-d[u])&&(f[u]|=F.ISDONE);var m=[],g=[],v=(E.MarchingCube.march(f,m,g,{fulltable:!0,voxel:n,unitCube:e.unit,origin:e.origin,matrix:e.matrix,nX:o,nY:l,nZ:h}),!n&&0<a&&E.MarchingCube.laplacianSmooth(a,m,g),[]),b=[],_=[];if(t.selectedRegion&&void 0===t.coords&&(t.coords=t.selectedRegion),void 0===t.coords&&void 0!==t.selection&&(i?t.coords=i.selectedAtoms(t.selection):console.log("addIsosurface needs viewer is selection provided.")),void 0!==t.coords){var y=t.coords[0].x,x=t.coords[0].y,w=t.coords[0].z,A=t.coords[0].x,S=t.coords[0].y,C=t.coords[0].z;for(let e=0;e<t.coords.length;e++)t.coords[e].x>y?y=t.coords[e].x:t.coords[e].x<A&&(A=t.coords[e].x),t.coords[e].y>x?x=t.coords[e].y:t.coords[e].y<S&&(S=t.coords[e].y),t.coords[e].z>w?w=t.coords[e].z:t.coords[e].z<C&&(C=t.coords[e].z);var L=2;void 0!==t.radius&&(L=t.radius),void 0!==t.selectedOffset&&(L=t.selectedOffset),A-=L=void 0!==t.seldist?t.seldist:L,y+=L,S-=L,x+=L,C-=L,w+=L;for(let e=0;e<m.length;e++)m[e].x>A&&m[e].x<y&&m[e].y>S&&m[e].y<x&&m[e].z>C&&m[e].z<w&&F.inSelectedRegion(m[e],t.coords,L)?(v.push(b.length),b.push(m[e])):v.push(-1);for(let e=0;e+2<g.length;e+=3)-1!==v[g[e]]&&-1!==v[g[e+1]]&&-1!==v[g[e+2]]&&(_.push(g[e]-(g[e]-v[g[e]])),_.push(g[e+1]-(g[e+1]-v[g[e+1]])),_.push(g[e+2]-(g[e+2]-v[g[e+2]])));m=b,g=_}F.drawCustom(this,this.geo,{vertexArr:m,faceArr:g,normalArr:[],clickable:t.clickable,hoverable:t.hoverable}),this.updateStyle(t);var o=new X.Vector3(e.origin.x,e.origin.y,e.origin.z),l=new X.Vector3(e.size.x*e.unit.x,e.size.y*e.unit.y,e.size.z*e.unit.z),M=new X.Vector3(0,0,0),z=o.clone(),T=o.clone().add(l);for(let e=0;e<m.length;e++)M.add(m[e]),z.max(m[e]),T.min(m[e]);M.divideScalar(m.length);h=M.distanceTo(T),n=M.distanceTo(z);this.boundingSphere.center=M,this.boundingSphere.radius=Math.max(h,n),"function"==typeof r&&r()}addVolumetricData(e,t,r){e=new s.VolumeData(e,t),this.addIsosurface(e,r)}finalize(){return F.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.geo}globj(e){var t;this.renderedShapeObj&&(e.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.hidden||(F.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.wireframe&&this.geo.setUpWireframe(),void 0!==this.color&&F.updateColor(this.geo,this.color),this.shapeObj=new i.Object3D,t=null,t=new(this.side==i.DoubleSide?i.MeshDoubleLambertMaterial:i.MeshLambertMaterial)({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:i.Coloring.VertexColors}),t=new i.Mesh(this.geo,t),this.shapeObj.add(t),this.linegeo&&0<this.linegeo.vertices&&(t=new i.LineBasicMaterial({linewidth:this.linewidth,color:this.color}),t=new i.Line(this.linegeo,t,i.LineStyle.LinePieces),this.shapeObj.add(t)),this.renderedShapeObj=this.shapeObj.clone(),e.add(this.renderedShapeObj))}removegl(e){this.renderedShapeObj&&(void 0!==this.renderedShapeObj.geometry&&this.renderedShapeObj.geometry.dispose(),void 0!==this.renderedShapeObj.material&&this.renderedShapeObj.material.dispose(),e.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}function c(i){if(i.vertexArr.length<64e3)return[i];var s=[{vertexArr:[],normalArr:[],faceArr:[]}],n=(i.colorArr&&(s.colorArr=[]),[]),a=[],o=0,l=i.faceArr;for(let r=0,e=l.length;r<e;r+=3){let t=s[o];for(let e=0;e<3;e++){var h=l[r+e];n[h]!==o&&(n[h]=o,a[h]=t.vertexArr.length,t.vertexArr.push(i.vertexArr[h]),i.normalArr&&i.normalArr[h]&&t.normalArr.push(i.normalArr[h]),i.colorArr&&i.colorArr[h]&&t.colorArr.push(i.colorArr[h])),t.faceArr.push(a[h])}64e3<=t.vertexArr.length&&(s.push({vertexArr:[],normalArr:[],faceArr:[]}),i.colorArr&&(s.colorArr=[]),o++)}return s}F.ISDONE=2,F.drawCustom=function(e,t,r){for(var i=r,s=i.vertexArr,n=i.faceArr,a=(0!==s.length&&0!==n.length||console.warn("Error adding custom shape component: No vertices and/or face indices supplied!"),r.color),o=(void 0===a&&(a=e.color),a=u.CC.color(a),c(i)),l=0,h=o.length;l<h;l++)F.addCustomGeo(e,t,o[l],o[l].colorArr||a,r.clickable)}},"./src/GLViewer.ts":(e,t,r)=>{r.r(t),r.d(t,{CONTEXTS_PER_VIEWPORT:()=>o,GLViewer:()=>L,createStereoViewer:()=>function(e){var t=this;if(e=(0,S.getElement)(e)){for(var e=l(e,{rows:1,cols:2,control_all:!0}),r=(this.glviewer1=e[0][0],this.glviewer2=e[0][1],this.glviewer1.setAutoEyeSeparation(!1),this.glviewer2.setAutoEyeSeparation(!0),this.glviewer1.linkViewer(this.glviewer2),this.glviewer2.linkViewer(this.glviewer1),Object.getOwnPropertyNames(this.glviewer1.__proto__).filter(function(e){return"function"==typeof t.glviewer1[e]})),i=0;i<r.length;i++)this[r[i]]=function(e){return function(){return[this.glviewer1[e].apply(this.glviewer1,arguments),this.glviewer2[e].apply(this.glviewer2,arguments)]}}(r[i]);this.setCoordinates=function(e,t,r){for(var i=0;i<e.length;i++)e[i].setCoordinates(t,r)},this.surfacesFinished=function(){return this.glviewer1.surfacesFinished()&&this.glviewer2.surfacesFinished()},this.isAnimated=function(){return this.glviewer1.isAnimated()||this.glviewer2.isAnimated()},this.render=function(e){this.glviewer1.render(),this.glviewer2.render(),e&&e(this)},this.getCanvas=function(){return this.glviewer1.getCanvas()}}},createViewer:()=>c,createViewerGrid:()=>l});var h=r("./node_modules/upng-js/UPNG.js"),a=r("./src/GLModel.ts"),x=r("./src/GLShape.ts"),w=r("./src/Gradient.ts"),s=r("./src/Label.ts"),A=r("./src/ProteinSurface4.ts"),i=r("./src/VolumeData.ts"),n=r("./src/VolumetricRender.ts"),T=r("./src/WebGL/index.ts"),E=r("./src/WebGL/math/index.ts"),F=r("./src/colors.ts"),S=r("./src/utilities.ts");const o=16;class C extends Array{constructor(e){super(...e)}getSymmetries(){if(0==this.length)return[];var e=this[0];return void 0===e.symmetries&&this.setSymmetries([new E.Matrix4]),e.symmetries}setSymmetries(e){void 0===e&&(e=[new E.Matrix4]);for(var t of this)t.symmetries=e,t.finished=!1}}class L{getWidth(){let e=this.container,t=e.offsetWidth;var r,i;return 0==t&&"none"===e.style.display&&(r=e.style.position,i=e.style.visibility,e.style.display="block",e.style.visibility="hidden",e.style.position="absolute",t=e.offsetWidth,e.style.display="none",e.style.visibility=i,e.style.position=r),t}getHeight(){let e=this.container,t=e.offsetHeight;var r,i;return 0==t&&"none"===e.style.display&&(r=e.style.position,i=e.style.visibility,e.style.display="block",e.style.visibility="hidden",e.style.position="absolute",t=e.offsetHeight,e.style.display="none",e.style.visibility=i,e.style.position=r),t}setupRenderer(){var e=Object.assign(Object.assign({},this.config),{preserveDrawingBuffer:!0,premultipliedAlpha:!1,containerWidth:this.WIDTH,containerHeight:this.HEIGHT});this.renderer=new T.Renderer(e),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.padding="0",this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0px",this.renderer.domElement.style.left="0px",this.renderer.domElement.style.zIndex="0"}initializeScene(){this.scene=new T.Scene,this.scene.fog=new T.Fog(this.bgColor,100,200),this.modelGroup=new T.Object3D,this.rotationGroup=new T.Object3D,this.rotationGroup.useQuaternion=!0,this.rotationGroup.quaternion=new E.Quaternion(0,0,0,1),this.rotationGroup.add(this.modelGroup),this.scene.add(this.rotationGroup);var e=new T.Light(16777215);e.position=new E.Vector3(.2,.2,1).normalize(),e.intensity=1,this.scene.add(e)}_handleLostContext(e){function t(e){return!((e=e.getBoundingClientRect()).right<0||e.bottom<0||e.top>(window.innerHeight||document.documentElement.clientHeight)||e.left>(window.innerWidth||document.documentElement.clientWidth))}if(t(this.container)){let e=0;for(var r of document.getElementsByTagName("canvas"))if(t(r)&&null!=r._3dmol_viewer&&(r._3dmol_viewer.resize(),(e+=1)>=o))break}}initContainer(e){this.container=e,this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.container.append(this.renderer.domElement),this.glDOM=this.renderer.domElement,(this.glDOM._3dmol_viewer=this).glDOM.addEventListener("webglcontextlost",this._handleLostContext.bind(this)),this.nomouse||(this.glDOM.addEventListener("mousedown",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("touchstart",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("wheel",this._handleMouseScroll.bind(this),{passive:!1}),this.glDOM.addEventListener("mousemove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("touchmove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("contextmenu",this._handleContextMenu.bind(this),{passive:!1}))}decAnim(){this.animated--,this.animated<0&&(this.animated=0)}incAnim(){this.animated++}nextSurfID(){var e,t,r=0;for(e in this.surfaces)this.surfaces.hasOwnProperty(e)&&(t=parseInt(e),isNaN(t)||r<t&&(r=t));return r+1}setSlabAndFog(){let e=this.camera.position.z-this.rotationGroup.position.z;e<1&&(e=1),this.camera.near=e+this.slabNear,!this.camera.ortho&&this.camera.near<1&&(this.camera.near=1),this.camera.far=e+this.slabFar,this.camera.near+1>this.camera.far&&(this.camera.far=this.camera.near+1),this.camera.fov=this.fov,this.camera.right=e*Math.tan(Math.PI/180*this.fov),this.camera.left=-this.camera.right,this.camera.top=this.camera.right/this.ASPECT,this.camera.bottom=-this.camera.top,this.camera.updateProjectionMatrix(),this.scene.fog.near=this.camera.near+this.fogStart*(this.camera.far-this.camera.near),this.scene.fog.far=this.camera.near+this.fogEnd*(this.camera.far-this.camera.near),this.config.disableFog&&(this.scene.fog.near=this.scene.fog.far)}show(e){if(this.renderer.setViewport(),this.scene&&(this.setSlabAndFog(),this.renderer.render(this.scene,this.camera),this.viewChangeCallback&&this.viewChangeCallback(this._viewer.getView()),!e&&0<this.linkedViewers.length))for(var t=this._viewer.getView(),r=0;r<this.linkedViewers.length;r++)this.linkedViewers[r].setView(t,!0)}updateClickables(){this.clickables.splice(0,this.clickables.length),this.hoverables.splice(0,this.hoverables.length),this.contextMenuEnabledObjects.splice(0,this.contextMenuEnabledObjects.length);for(let t=0,e=this.models.length;t<e;t++){let e=this.models[t];if(e){var r=e.selectedAtoms({clickable:!0}),i=e.selectedAtoms({hoverable:!0}),s=e.selectedAtoms({contextMenuEnabled:!0});for(let e=0;e<i.length;e++)this.hoverables.push(i[e]);for(let e=0;e<r.length;e++)this.clickables.push(r[e]);for(let e=0;e<s.length;e++)this.contextMenuEnabledObjects.push(s[e])}}for(let e=0,t=this.shapes.length;e<t;e++){var n=this.shapes[e];n&&n.clickable&&this.clickables.push(n),n&&n.hoverable&&this.hoverables.push(n),n&&n.contextMenuEnabled&&this.contextMenuEnabledObjects.push(n)}}handleClickSelection(e,t,r){e=this.targetedObjects(e,t,this.clickables);e.length&&void 0!==(t=e[0].clickable).callback&&("function"!=typeof t.callback&&(t.callback=(0,S.makeFunction)(t.callback)),"function"!=typeof t.callback||3===this.mouseButton&&this.contextMenuEnabledObjects.includes(t)&&this.userContextMenuHandler||t.callback(t,this._viewer,r,this.container,e))}canvasOffset(){let e=this.glDOM;var t=e.getBoundingClientRect(),r=e.ownerDocument,i=r.documentElement,r=r.defaultView;return{top:t.top+r.pageYOffset-i.clientTop,left:t.left+r.pageXOffset-i.clientLeft}}setHover(e,t,r){this.current_hover!=e&&(this.current_hover&&("function"!=typeof this.current_hover.unhover_callback&&(this.current_hover.unhover_callback=(0,S.makeFunction)(this.current_hover.unhover_callback)),this.current_hover.unhover_callback(this.current_hover,this._viewer,t,this.container,r)),(this.current_hover=e)&&void 0!==e.hover_callback&&("function"!=typeof e.hover_callback&&(e.hover_callback=(0,S.makeFunction)(e.hover_callback)),"function"==typeof e.hover_callback&&e.hover_callback(e,this._viewer,t,this.container,r)))}handleHoverSelection(e,t,r){0!=this.hoverables.length&&((e=this.targetedObjects(e,t,this.hoverables)).length?(t=e[0].clickable,this.setHover(t,r,e),this.current_hover=t):this.setHover(null))}handleHoverContinue(e,t){e=this.targetedObjects(e,t,this.hoverables);0!=e.length&&void 0!==e[0]||this.setHover(null),void 0!==e[0]&&e[0].clickable!==this.current_hover&&this.setHover(null)}closeEnoughForClick(e,{allowTolerance:t=e.targetTouches,tolerance:r=5}={}){var i,s=this.getX(e),n=this.getY(e);return t?(t=Math.abs(s-this.mouseStartX),i=Math.abs(n-this.mouseStartY),t<=r&&i<=r):s===this.mouseStartX&&n===this.mouseStartY}calcTouchDistance(e){var t=e.targetTouches[0].pageX-e.targetTouches[1].pageX,e=e.targetTouches[0].pageY-e.targetTouches[1].pageY;return Math.hypot(t,e)}getX(e){var t=e.pageX;return null==t&&(t=e.pageX),e.targetTouches&&e.targetTouches[0]?t=e.targetTouches[0].pageX:e.changedTouches&&e.changedTouches[0]&&(t=e.changedTouches[0].pageX),t}getY(e){var t=e.pageY;return null==t&&(t=e.pageY),e.targetTouches&&e.targetTouches[0]?t=e.targetTouches[0].pageY:e.changedTouches&&e.changedTouches[0]&&(t=e.changedTouches[0].pageY),t}isInViewer(e,t){if(null!=this.viewers){var r=this.WIDTH/this.cols,i=this.HEIGHT/this.rows,s=this.canvasOffset(),e=e-s.left,t=t-s.top,s=this.rows-Math.floor(t/i)-1,t=Math.floor(e/r);if(s!=this.row||t!=this.col)return!1}return!0}adjustZoomToLimits(e){var t;return this.config.lowerZoomLimit&&0<this.config.lowerZoomLimit&&((t=this.CAMERA_Z-this.config.lowerZoomLimit)<e&&(e=t)),this.config.upperZoomLimit&&0<this.config.upperZoomLimit&&(e<(t=this.CAMERA_Z-this.config.upperZoomLimit)&&(e=t)),e=e>this.CAMERA_Z-1?this.CAMERA_Z-1:e}static slerp(t,r,i){if(1==i)return r.clone();if(0==i)return t.clone();let e=t.x*r.x+t.y*r.y+t.z*r.z+t.w*r.w;if(.9995<e){let e=new E.Quaternion(t.x+i*(r.x-t.x),t.y+i*(r.y-t.y),t.z+i*(r.z-t.z),t.w+i*(r.w-t.w));return e.normalize(),e}e<0&&(r=r.clone().multiplyScalar(-1),e=-e),1<e?e=1:e<-1&&(e=-1);var i=Math.acos(e)*i,r=r.clone(),s=(r.sub(t.clone().multiplyScalar(e)),r.normalize(),Math.cos(i)),i=Math.sin(i),t=new E.Quaternion(t.x*s+r.x*i,t.y*s+r.y*i,t.z*s+r.z*i,t.w*s+r.w*i);return t.normalize(),t}constructor(e,t={}){this.nomouse=!1,this.glDOM=null,this.models=[],this.surfaces={},this.shapes=[],this.labels=[],this.clickables=[],this.hoverables=[],this.contextMenuEnabledObjects=[],this.current_hover=null,this.hoverDuration=500,this.longTouchDuration=1e3,this.viewer_frame=0,this.viewChangeCallback=null,this.stateChangeCallback=null,this.NEAR=1,this.FAR=800,this.CAMERA_Z=150,this.fov=20,this.linkedViewers=[],this.renderer=null,this.control_all=!1,this.scene=null,this.rotationGroup=null,this.modelGroup=null,this.fogStart=.4,this.fogEnd=1,this.slabNear=-50,this.slabFar=50,this.cq=new E.Quaternion(0,0,0,1),this.dq=new E.Quaternion(0,0,0,1),this.animated=0,this.animationTimers=new Set,this.isDragging=!1,this.mouseStartX=0,this.mouseStartY=0,this.touchDistanceStart=0,this.touchHold=!1,this.currentModelPos=0,this.cz=0,this.cslabNear=0,this.cslabFar=0,this.userContextMenuHandler=null,this.config=t,this.callback=this.config.callback,this.defaultcolors=this.config.defaultcolors,this.defaultcolors||(this.defaultcolors=F.elementColors.defaultColors),this.nomouse=Boolean(this.config.nomouse),this.bgColor=0,this.config.backgroundColor=this.config.backgroundColor||"#ffffff",void 0!==this.config.backgroundColor&&(this.bgColor=F.CC.color(this.config.backgroundColor).getHex()),this.config.backgroundAlpha=null==this.config.backgroundAlpha?1:this.config.backgroundAlpha,void(this.camerax=0)!==this.config.camerax&&(this.camerax="string"==typeof this.config.camerax?parseFloat(this.config.camerax):this.config.camerax),(this._viewer=this).container=e,null!=this.config.hoverDuration&&(this.hoverDuration=this.config.hoverDuration),void 0===this.config.antialias&&(this.config.antialias=!0),void 0===this.config.cartoonQuality&&(this.config.cartoonQuality=10),this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.setupRenderer(),this.row=null==this.config.row?0:this.config.row,this.col=null==this.config.col?0:this.config.col,this.cols=this.config.cols,this.rows=this.config.rows,this.viewers=this.config.viewers,this.control_all=this.config.control_all,this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.camera=new T.Camera(this.fov,this.ASPECT,this.NEAR,this.FAR,this.config.orthographic),this.camera.position=new E.Vector3(this.camerax,0,this.CAMERA_Z),this.lookingAt=new E.Vector3,this.camera.lookAt(this.lookingAt),this.raycaster=new T.Raycaster(new E.Vector3(0,0,0),new E.Vector3(0,0,0)),this.projector=new T.Projector,this.initializeScene(),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),this.scene.fog.color=F.CC.color(this.bgColor),document.body.addEventListener("mouseup",this._handleMouseUp.bind(this)),document.body.addEventListener("touchend",this._handleMouseUp.bind(this)),this.initContainer(this.container),this.config.style&&this.setViewStyle(this.config),window.addEventListener("resize",this.resize.bind(this)),void 0!==window.ResizeObserver&&(this.divwatcher=new window.ResizeObserver(this.resize.bind(this)),this.divwatcher.observe(this.container)),void 0!==window.IntersectionObserver&&(this.intwatcher=new window.IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&this.resize()})}),this.intwatcher.observe(this.container));try{"function"==typeof this.callback&&this.callback(this)}catch(e){console.log("error with glviewer callback: "+e)}}targetedObjects(e,t,r){e={x:e,y:t,z:-1};return 0==(r=Array.isArray(r)?r:this.selectedAtoms(r)).length?[]:(this.raycaster.setFromCamera(e,this.camera),this.raycaster.intersectObjects(this.modelGroup,r))}modelToScreen(e){let t=!1,i=(Array.isArray(e)||(e=[e],t=!0),this.renderer.getXRatio()),s=this.renderer.getYRatio();var r=this.col,n=this.row;let a=r*(this.WIDTH/i),o=(s-n-1)*(this.HEIGHT/s),l=[],h=this.canvasOffset();return e.forEach(e=>{let t=new E.Vector3(e.x,e.y,e.z);t.applyMatrix4(this.modelGroup.matrixWorld),this.projector.projectVector(t,this.camera);var e=this.WIDTH/i*(t.x+1)/2+h.left+a,r=-(this.HEIGHT/s)*(t.y-1)/2+h.top+o;l.push({x:e,y:r})}),l=t?l[0]:l}screenOffsetToModel(e,t,r){var e=e/this.WIDTH,t=t/this.HEIGHT,r=void 0===r?this.rotationGroup.position.z:r,i=this.rotationGroup.quaternion,r=new E.Vector3(0,0,r);return this.projector.projectVector(r,this.camera),r.x+=2*e,r.y-=2*t,this.projector.unprojectVector(r,this.camera),r.z=0,r.applyQuaternion(i),r}screenToModelDistance(e,t){var r=this.canvasOffset();let i=new E.Vector3(t.x,t.y,t.z);i.applyMatrix4(this.modelGroup.matrixWorld);t=i.clone();this.projector.projectVector(i,this.camera);let s=new E.Vector3(2*(e.x-r.left)/this.WIDTH-1,2*(e.y-r.top)/-this.HEIGHT+1,i.z);return this.projector.unprojectVector(s,this.camera),s.distanceTo(t)}setViewChangeCallback(e){"function"!=typeof e&&null!=e||(this.viewChangeCallback=e)}setStateChangeCallback(e){"function"!=typeof e&&null!=e||(this.stateChangeCallback=e)}getConfig(){return this.config}setConfig(e){(this.config=e).ambientOcclusion&&this.renderer.enableAmbientOcclusion(e.ambientOcclusion)}getInternalState(){var t={models:[],surfaces:[],shapes:[],labels:[]};for(let e=0;e<this.models.length;e++)this.models[e]&&(t.models[e]=this.models[e].getInternalState());return t}setInternalState(e){this.clear();var t=e.models;for(let e=0;e<t.length;e++)t[e]&&(this.models[e]=new a.GLModel(e,void 0,this),this.models[e].setInternalState(t[e]));this.render()}setZoomLimits(e,t){void 0!==e&&(this.config.lowerZoomLimit=e),t&&(this.config.upperZoomLimit=t),this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}setCameraParameters(e){void 0!==e.fov&&(this.fov=e.fov,this.camera.fov=this.fov),void 0!==e.z&&(this.CAMERA_Z=e.z,this.camera.z=this.CAMERA_Z),void 0!==e.orthographic&&(this.camera.ortho=e.orthographic),this.setSlabAndFog()}_handleMouseDown(r){if(r.preventDefault(),this.scene){var e=this.getX(r),i=this.getY(r);if(void 0!==e){this.isDragging=!0,this.mouseButton=r.which,this.mouseStartX=e,this.mouseStartY=i,this.touchHold=!0,this.touchDistanceStart=0,r.targetTouches&&2==r.targetTouches.length&&(this.touchDistanceStart=this.calcTouchDistance(r)),this.cq=this.rotationGroup.quaternion.clone(),this.cz=this.rotationGroup.position.z,this.currentModelPos=this.modelGroup.position.clone(),this.cslabNear=this.slabNear,this.cslabFar=this.slabFar;let t=this;r.targetTouches&&1===r.targetTouches.length&&(this.longTouchTimeout=setTimeout(function(){var e;1==t.touchHold&&(t.glDOM=t.renderer.domElement,e=r.targetTouches[0],e=new PointerEvent("contextmenu",Object.assign(Object.assign({},r),{pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY})),t.glDOM.dispatchEvent(e))},this.longTouchDuration))}}}_handleMouseUp(e){var t,r;this.touchHold=!1,this.isDragging&&this.scene&&(r=this.getX(e),t=this.getY(e),this.closeEnoughForClick(e)&&this.isInViewer(r,t)&&(r=this.mouseXY(r,t),this.handleClickSelection(r.x,r.y,e))),this.isDragging=!1}_handleMouseScroll(e){var t,r;e.preventDefault(),this.scene&&(t=this.getX(e),r=this.getY(e),void 0!==t&&(this.control_all||this.isInViewer(t,r))&&(t=.85*(this.CAMERA_Z-this.rotationGroup.position.z),r=1,e.ctrlKey&&(r=-1),e.detail?this.rotationGroup.position.z+=r*t*e.detail/10:e.wheelDelta&&(e=600*e.wheelDelta/(e.wheelDelta+600),this.rotationGroup.position.z-=r*t*e/400),this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()))}pngURI(){return this.getCanvas().toDataURL("image/png")}apngURI(s){let l=this;return s=s||1,new Promise(function(a){let e=0,t=l.viewChangeCallback,r=[],o=[],i=Date.now();l.viewChangeCallback=function(){o.push(Date.now()-i),i=Date.now(),r.push(new Promise(t=>{l.getCanvas().toBlob(function(e){e.arrayBuffer().then(t)},"image/png")})),(e+=1)==s&&(l.viewChangeCallback=t,Promise.all(r).then(t=>{let r=[];for(let e=0;e<t.length;e++){var i=(0,h.decode)(t[e]);r.push((0,h.toRGBA8)(i)[0])}var e=l.getCanvas().width,s=l.getCanvas().height,e=(0,h.encode)(r,e,s,0,o),s=new Blob([e],{type:"image/png"});let n=new FileReader;n.onload=function(e){a(e.target.result)},n.readAsDataURL(s)}))}})}getCanvas(){return this.glDOM}getRenderer(){return this.renderer}setHoverDuration(e){this.hoverDuration=e}mouseXY(e,t){var r=this.canvasOffset(),i=this.renderer.getXRatio(),s=this.renderer.getYRatio(),n=this.col,a=this.row,n=n*(this.WIDTH/i),a=(s-a-1)*(this.HEIGHT/s);return{x:(e-r.left-n)/(this.WIDTH/i)*2-1,y:2*-((t-r.top-a)/(this.HEIGHT/s))+1}}_handleMouseMove(r){clearTimeout(this.hoverTimeout),r.preventDefault();var i=this.getX(r),s=this.getY(r);if(void 0!==i){var n=this.renderer.getXRatio(),a=this.renderer.getYRatio();let e=this.mouseXY(i,s),t=this;null!==this.current_hover&&this.handleHoverContinue(e.x,e.y);var o,l,h,c,d=0;(this.control_all||this.isInViewer(i,s))&&this.scene&&(0<this.hoverables.length&&(this.hoverTimeout=setTimeout(function(){t.handleHoverSelection(e.x,e.y,r)},this.hoverDuration)),this.isDragging&&(r.targetTouches&&(1<r.targetTouches.length||1===r.targetTouches.length&&!this.closeEnoughForClick(r))&&clearTimeout(this.longTouchTimeout),o=(i-this.mouseStartX)/this.WIDTH,l=(s-this.mouseStartY)/this.HEIGHT,0!=this.touchDistanceStart&&r.targetTouches&&2==r.targetTouches.length?l=(d=2)*(this.calcTouchDistance(r)-this.touchDistanceStart)/(this.WIDTH+this.HEIGHT):r.targetTouches&&3==r.targetTouches.length&&(d=1),o*=n,l*=a,h=Math.hypot(o,l),3==d||3==this.mouseButton&&r.ctrlKey?(this.slabNear=this.cslabNear+100*o,this.slabFar=this.cslabFar-100*l):2==d||3==this.mouseButton||r.shiftKey?(c=.85*(this.CAMERA_Z-this.rotationGroup.position.z),this.rotationGroup.position.z=this.cz+l*(c=c<80?80:c),this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z)):1==d||2==this.mouseButton||r.ctrlKey?(c=this.screenOffsetToModel(n*(i-this.mouseStartX),a*(s-this.mouseStartY)),this.modelGroup.position.addVectors(this.currentModelPos,c)):0!==d&&1!=this.mouseButton||0===h||(n=Math.sin(h*Math.PI)/h,this.dq.x=Math.cos(h*Math.PI),this.dq.y=0,this.dq.z=n*o,this.dq.w=-n*l,this.rotationGroup.quaternion.set(1,0,0,0),this.rotationGroup.quaternion.multiply(this.dq),this.rotationGroup.quaternion.multiply(this.cq)),this.show()))}}_handleContextMenu(e){var t,r,i,s,n,a;e.preventDefault(),this.closeEnoughForClick(e)&&(n=this.mouseStartX,a=this.mouseStartY,s=this.canvasOffset(),r=(t=this.mouseXY(n,a)).x,t=t.y,i=null,(r=this.targetedObjects(r,t,this.contextMenuEnabledObjects)).length&&(i=r[0].clickable),s=this.canvasOffset(),n=this.mouseStartX-s.left,a=this.mouseStartY-s.top,this.userContextMenuHandler&&(this.userContextMenuHandler(i,n,a,r,e),this.isDragging=!1))}setContainer(e){e=(0,S.getElement)(e)||this.container;return this.initContainer(e),this}setBackgroundColor(e,t){(void 0===t||t<0||1<t)&&(t=1);e=F.CC.color(e);return this.scene.fog.color=e,this.bgColor=e.getHex(),this.renderer.setClearColorHex(e.getHex(),t),this.show(),this}setProjection(e){this.camera.ortho="orthographic"===e,this.setSlabAndFog()}setViewStyle(e){var t;return(e=e||{}).style=e.style||"",e.style.includes("outline")?this.renderer.enableOutline(e):this.renderer.disableOutline(),e.style.includes("ambientOcclusion")?(t={},e.strength&&(t.strength=e.strength),e.radius&&(t.radius=e.radius),this.renderer.enableAmbientOcclusion(t)):this.renderer.disableAmbientOcclusion(),this}updateSize(){this.renderer.setSize(this.WIDTH,this.HEIGHT),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.camera.aspect=this.ASPECT,this.camera.updateProjectionMatrix()}setWidth(e){return this.WIDTH=e||this.WIDTH,this.updateSize(),this}setHeight(e){return this.HEIGHT=e||this.HEIGHT,this.updateSize(),this}resize(){this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight();let r=!1;if(this.renderer.isLost()&&0<this.WIDTH&&0<this.HEIGHT){let e=!1,t=this.container.querySelector("canvas");t&&t!=this.renderer.getCanvas()?this.config.canvas=t:(t.remove(),this.config&&null!=this.config.canvas&&(delete this.config.canvas,e=!0)),this.setupRenderer(),this.initContainer(this.container),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),r=!0,e&&(this.config.canvas=this.renderer.getCanvas())}if(0==this.WIDTH||0==this.HEIGHT?this.animated&&this._viewer.pauseAnimate():this.animated&&this._viewer.resumeAnimate(),this.updateSize(),r){let i=this.renderer.supportedExtensions();if(i.regen=!0,this.viewers)for(let r=0,e=this.viewers.length;r<e;r++)for(let e=0,t=this.viewers[r].length;e<t;e++)this.viewers[r][e].render(null,i);this._viewer.render(null,i)}else 0<this.WIDTH&&0<this.HEIGHT&&this.show();return this}getModel(e){return void 0===e?0==this.models.length?null:this.models[this.models.length-1]:e instanceof a.GLModel?e:e in this.models?this.models[e]:0==this.models.length?null:this.models[this.models.length-1]}spin(e,t=1,r=!1){if(clearInterval(this.spinInterval),"boolean"==typeof(e=void 0===e?"y":e)){if(!e)return;e="y"}Array.isArray(e)&&(e={x:e[0],y:e[1],z:e[2]});var i=this;this.spinInterval=setInterval(function(){!i.getCanvas().isConnected&&i.renderer.isLost()&&clearInterval(i.spinInterval),(!r||i.container.checkVisibility&&i.container.checkVisibility())&&i.rotate(+t,e)},25)}animateMotion(i,s,n,a,o,l){var h=20,c=Math.ceil(i/h),d=(c<1&&(c=1),this.incAnim(),{mpos:this.modelGroup.position.clone(),rz:this.rotationGroup.position.z,rot:this.rotationGroup.quaternion.clone(),cam:this.lookingAt.clone()});if(s){let r=new Array(c);for(let t=0;t<c;t++){var u=(t+1)/c;let e={mpos:d.mpos,rz:d.rz,rot:d.rot};e.mpos=n.clone().sub(d.mpos).multiplyScalar(u).add(d.mpos),e.rz=d.rz+u*(a-d.rz),e.rot=L.slerp(d.rot,o,u),e.cam=l.clone().sub(d.cam).multiplyScalar(u).add(d.cam),r[t]=e}let t=0,i=this,s=function(){var e=r[t];t+=1,i.modelGroup.position=e.mpos,i.rotationGroup.position.z=e.rz,i.rotationGroup.quaternion=e.rot,i.camera.lookAt(e.cam),t<r.length?setTimeout(s,h):i.decAnim(),i.show()};setTimeout(s,h)}else{var p={},i=1/c;n&&(p.mpos=n.clone().sub(d.mpos).multiplyScalar(i)),void 0!==a&&null!=a&&(p.rz=i*(a-d.rz)),o&&(s=L.slerp(d.rot,o,i),p.rot=d.rot.clone().inverse().multiply(s)),l&&(p.cam=l.clone().sub(d.cam).multiplyScalar(i));let e=0,t=this,r=function(){e+=1,p.mpos&&t.modelGroup.position.add(p.mpos),p.rz&&(t.rotationGroup.position.z+=p.rz),p.rot&&t.rotationGroup.quaternion.multiply(p.rot),p.cam&&(t.lookingAt.add(p.cam),t.camera.lookAt(t.lookingAt)),e<c?setTimeout(r,h):t.decAnim(),t.show()};setTimeout(r,h)}}rotate(e,t="y",r=0,i=!1){"x"==t?t={x:1,y:0,z:0}:"y"==t?t={x:0,y:1,z:0}:"z"==t&&(t={x:0,y:0,z:1}),"vx"==t?t={vx:1,vy:0,vz:0}:"vy"==t?t={vx:0,vy:1,vz:0}:"vz"==t&&(t={vx:0,vy:0,vz:1}),void 0!==t.vx&&((a=new E.Vector3(t.vx,t.vy,t.vz)).applyQuaternion(this.rotationGroup.quaternion),t={x:a.x,y:a.y,z:a.z});var s,n,a=Math.PI*e/180,t=(e=a,a=Math.sin(e/2),e=Math.cos(e/2),n=t.x*a,s=t.y*a,a=t.z*a,new E.Quaternion(n,s,a,e).normalize());return r?(n=(new E.Quaternion).copy(this.rotationGroup.quaternion).multiply(t),this.animateMotion(r,i,this.modelGroup.position,this.rotationGroup.position.z,n,this.lookingAt)):(this.rotationGroup.quaternion.multiply(t),this.show()),this}surfacesFinished(){for(var e in this.surfaces)if(!this.surfaces[e][0].done)return!1;return!0}getView(){if(!this.modelGroup)return[0,0,0,0,0,0,0,1];var e=this.modelGroup.position,t=this.rotationGroup.quaternion;return[e.x,e.y,e.z,this.rotationGroup.position.z,t.x,t.y,t.z,t.w]}setView(e,t){return void 0!==e&&(e instanceof Array||8!==e.length)&&this.modelGroup&&this.rotationGroup&&(this.modelGroup.position.x=e[0],this.modelGroup.position.y=e[1],this.modelGroup.position.z=e[2],this.rotationGroup.position.z=e[3],this.rotationGroup.quaternion.x=e[4],this.rotationGroup.quaternion.y=e[5],this.rotationGroup.quaternion.z=e[6],this.rotationGroup.quaternion.w=e[7],void 0!==e[8]&&(this.rotationGroup.position.x=e[8],this.rotationGroup.position.y=e[9]),this.show(t)),this}render(e,t){this.renderer.setViewport(),this.updateClickables();var r,i=this.getView();for(this.stateChangeCallback&&this.stateChangeCallback(this.getInternalState()),t=t||this.renderer.supportedExtensions(),r=0;r<this.models.length;r++)this.models[r]&&this.models[r].globj(this.modelGroup,t);for(r=0;r<this.shapes.length;r++)this.shapes[r]&&(void 0===this.shapes[r].frame||this.viewer_frame<0||this.shapes[r].frame<0||this.shapes[r].frame==this.viewer_frame?this.shapes[r].globj(this.modelGroup,t):this.shapes[r].removegl(this.modelGroup));for(r=0;r<this.labels.length;r++)t.regen&&(this.labels[r].dispose(),this.modelGroup.remove(this.labels[r].sprite),this.labels[r].setContext(),this.modelGroup.add(this.labels[r].sprite)),this.labels[r]&&void 0!==this.labels[r].frame&&0<=this.labels[r].frame&&(this.modelGroup.remove(this.labels[r].sprite),(this.viewer_frame<0||this.labels[r].frame==this.viewer_frame)&&this.modelGroup.add(this.labels[r].sprite));for(r in this.surfaces)if(this.surfaces.hasOwnProperty(r))for(var s=this.surfaces[r],n=0;n<s.length;n++)if(s.hasOwnProperty(n)){var a=s[n].geo;if(!s[n].finished||t.regen){a.verticesNeedUpdate=!0,a.elementsNeedUpdate=!0,a.normalsNeedUpdate=!0,a.colorsNeedUpdate=!0,a.buffersNeedUpdate=!0,s[n].mat.needsUpdate=!0,s[n].done&&(s[n].finished=!0),s[n].lastGL&&this.modelGroup.remove(s[n].lastGL);var o=null,o=s[n].mat instanceof T.LineBasicMaterial?new T.Line(a,s[n].mat):("wireframe"in s.style&&s.style.wireframe&&a.setUpWireframe(),new T.Mesh(a,s[n].mat));if(s[n].mat.transparent&&0==s[n].mat.opacity?o.visible=!1:o.visible=!0,1<s[n].symmetries.length||1==s[n].symmetries.length&&!s[n].symmetries[0].isIdentity()){for(var l=new T.Object3D,h=0;h<s[n].symmetries.length;h++){var c=o.clone();c.matrix=s[n].symmetries[h],c.matrixAutoUpdate=!1,l.add(c)}s[n].lastGL=l,this.modelGroup.add(l)}else s[n].lastGL=o,this.modelGroup.add(o)}}return this.setView(i),"function"==typeof e&&e(this),this}getModelList(e){let r=[];if(void 0===e||void 0===e.model)for(let e=0;e<this.models.length;e++)this.models[e]&&r.push(this.models[e]);else{let t=e.model;Array.isArray(t)||(t=[t]);for(let e=0;e<t.length;e++){var i;"number"==typeof t[e]?((i=t[e])<0&&(i+=this.models.length),r.push(this.models[i])):r.push(t[e])}}return r}getAtomsFromSel(t){var r=[],i=this.getModelList(t=void 0===t?{}:t);for(let e=0;e<i.length;e++)r=r.concat(i[e].selectedAtoms(t));return r}atomIsSelected(e,t){for(var r=this.getModelList(t=void 0===t?{}:t),i=0;i<r.length;i++)if(r[i].atomIsSelected(e,t))return!0;return!1}selectedAtoms(e){return this.getAtomsFromSel(e)}getUniqueValues(e,t){var r,i=this.getAtomsFromSel(t=void 0===t?{}:t),s={};for(r in i)i[r].hasOwnProperty(e)&&(s[i[r][e]]=!0);return Object.keys(s)}pdbData(e){for(var t=this.getAtomsFromSel(e),r="",i=0,s=t.length;i<s;++i)r+=t[i].pdbline+"\n";return r}zoom(e=2,t=0,r=!1){e=(this.CAMERA_Z-this.rotationGroup.position.z)/e,e=this.CAMERA_Z-e;return 0<t?this.animateMotion(t,r,this.modelGroup.position,this.adjustZoomToLimits(e),this.rotationGroup.quaternion,this.lookingAt):(this.rotationGroup.position.z=this.adjustZoomToLimits(e),this.show()),this}translate(e,t,r=0,i=!1){var e=e/this.WIDTH,t=t/this.HEIGHT,s=new E.Vector3(0,0,-this.CAMERA_Z),e=(this.projector.projectVector(s,this.camera),s.x-=e,s.y-=t,this.projector.unprojectVector(s,this.camera),s.z=0,this.lookingAt.clone().add(s));return 0<r?this.animateMotion(r,i,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,e):(this.lookingAt=e,this.camera.lookAt(this.lookingAt),this.show()),this}translateScene(e,t,r=0,i=!1){e=this.screenOffsetToModel(e,t),t=this.modelGroup.position.clone().add(e);return 0<r?this.animateMotion(r,i,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=t,this.show()),this}fitSlab(e){var e=this.getAtomsFromSel(e=e||{}),e=(0,S.getExtent)(e),t=e[1][0]-e[0][0],r=e[1][1]-e[0][1],e=e[1][2]-e[0][2],t=Math.hypot(t,r,e);return this.slabNear=-(t=t<5?5:t)/1.9,this.slabFar=t/2,this}center(e={},t=0,r=!1){for(var i,s=this.getAtomsFromSel(e),n=(0,S.getExtent)(s),e=(0,S.isEmptyObject)(e)?(this.shapes.forEach(e=>{var t;e&&e.boundingSphere&&e.boundingSphere.center&&(t=e.boundingSphere.center,0<(e=e.boundingSphere.radius)?(s.push(new E.Vector3(t.x+e,t.y,t.z)),s.push(new E.Vector3(t.x-e,t.y,t.z)),s.push(new E.Vector3(t.x,t.y+e,t.z)),s.push(new E.Vector3(t.x,t.y-e,t.z)),s.push(new E.Vector3(t.x,t.y,t.z+e)),s.push(new E.Vector3(t.x,t.y,t.z-e))):s.push(t))}),n=(0,S.getExtent)(s),o=s,n):(o=this.getAtomsFromSel({}),(0,S.getExtent)(o)),a=new E.Vector3(n[2][0],n[2][1],n[2][2]),o=e[1][0]-e[0][0],l=e[1][1]-e[0][1],e=e[1][2]-e[0][2],h=Math.hypot(o,l,e),c=(this.slabNear=-(h=h<5?5:h)/1.9,this.slabFar=h/2,o=n[1][0]-n[0][0],l=n[1][1]-n[0][1],e=n[1][2]-n[0][2],(h=Math.hypot(o,l,e))<5&&(h=5),25),d=0;d<s.length;d++)s[d]&&c<(i=a.distanceToSquared(s[d]))&&(c=i);h=2*Math.sqrt(c),n=a.clone().multiplyScalar(-1);return 0<t?this.animateMotion(t,r,n,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=n,this.show()),this}zoomTo(e={},t=0,r=!1){let i=this.getAtomsFromSel(e),s=(0,S.getExtent)(i),n=s;if((0,S.isEmptyObject)(e)){var a=i&&i.length;if(this.shapes.forEach(e=>{var t;e&&e.boundingSphere&&(e.boundingSphere.box?(t=e.boundingSphere.box,i.push(new E.Vector3(t.min.x,t.min.y,t.min.z)),i.push(new E.Vector3(t.max.x,t.max.y,t.max.z))):e.boundingSphere.center&&(t=e.boundingSphere.center,0<(e=e.boundingSphere.radius)?(i.push(new E.Vector3(t.x+e,t.y,t.z)),i.push(new E.Vector3(t.x-e,t.y,t.z)),i.push(new E.Vector3(t.x,t.y+e,t.z)),i.push(new E.Vector3(t.x,t.y-e,t.z)),i.push(new E.Vector3(t.x,t.y,t.z+e)),i.push(new E.Vector3(t.x,t.y,t.z-e))):i.push(t)))}),n=(0,S.getExtent)(i),!a)for(let e=0;e<3;e++)s[2][e]=(n[0][e]+n[1][e])/2}else{a=this.getAtomsFromSel({});n=(0,S.getExtent)(a)}var o=new E.Vector3(s[2][0],s[2][1],s[2][2]),a=n[1][0]-n[0][0],l=n[1][1]-n[0][1],h=n[1][2]-n[0][2],c=Math.hypot(a,l,h),e=(this.slabNear=-(c=c<5?5:c)/1.9,this.slabFar=c/2,0===Object.keys(e).length&&(this.slabNear=Math.min(2*-c,-50),this.slabFar=Math.max(2*c,50)),this.config.minimumZoomToDistance||5),a=s[1][0]-s[0][0],l=s[1][1]-s[0][1],h=s[1][2]-s[0][2];(c=Math.hypot(a,l,h))<e&&(c=e);for(var d,u=e*e,p=0;p<i.length;p++)i[p]&&u<(d=o.distanceToSquared(i[p]))&&(u=d);c=2*Math.sqrt(u);a=o.clone().multiplyScalar(-1),l=-(.5*c/Math.tan(Math.PI/180*this.camera.fov/2)-this.CAMERA_Z),l=this.adjustZoomToLimits(l);return 0<t?this.animateMotion(t,r,a,l,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=a,this.rotationGroup.position.z=l,this.show()),this}setSlab(e,t){this.slabNear=e,this.slabFar=t}getSlab(){return{near:this.slabNear,far:this.slabFar}}addLabel(e,t={},r,i=!1){r&&(r=(0,S.getExtent)(this.getAtomsFromSel(r)),t.position={x:r[2][0],y:r[2][1],z:r[2][2]});r=new s.Label(e,t);return r.setContext(),this.modelGroup.add(r.sprite),this.labels.push(r),i||this.show(),r}addResLabels(e,t,r=!1){var i=this.labels.length;return this.applyToModels("addResLabels",e,t,r),this.show(),this.labels.slice(i)}addPropertyLabels(e,t,r){return this.applyToModels("addPropertyLabels",e,t,r),this.show(),this}removeLabel(e){for(var t=0;t<this.labels.length;t++)if(this.labels[t]==e){this.labels.splice(t,1),e.dispose(),this.modelGroup.remove(e.sprite);break}return this.show(),this}removeAllLabels(){for(var e=0;e<this.labels.length;e++)this.labels[e]&&this.labels[e].sprite&&this.modelGroup.remove(this.labels[e].sprite);return this.labels.splice(0,this.labels.length),this.show(),this}hideAllLabels(){for(var e=0;e<this.labels.length;e++)this.labels[e]&&this.labels[e].hide();return this.show(),this}showAllLabels(){for(var e=0;e<this.labels.length;e++)this.labels[e]&&this.labels[e].show();return this.show(),this}setLabelStyle(e,t){return this.modelGroup.remove(e.sprite),e.dispose(),e.stylespec=t,e.setContext(),this.modelGroup.add(e.sprite),this.show(),e}setLabelText(e,t){return this.modelGroup.remove(e.sprite),e.dispose(),e.text=t,e.setContext(),this.modelGroup.add(e.sprite),this.show(),e}addShape(e){e=new x.GLShape(e=e||{});return e.shapePosition=this.shapes.length,this.shapes.push(e),e}removeShape(e){if(!e)return this;for(e.removegl(this.modelGroup),delete this.shapes[e.shapePosition];0<this.shapes.length&&void 0===this.shapes[this.shapes.length-1];)this.shapes.pop();return this}removeAllShapes(){for(var e=0;e<this.shapes.length;e++){var t=this.shapes[e];t&&t.removegl(this.modelGroup)}return this.shapes.splice(0,this.shapes.length),this}getSelectionCenter(e){if(e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&e.hasOwnProperty("z"))return e;e=this.getAtomsFromSel(e);if(0==e.length)return{x:0,y:0,z:0};e=(0,S.getExtent)(e);return{x:e[0][0]+(e[1][0]-e[0][0])/2,y:e[0][1]+(e[1][1]-e[0][1])/2,z:e[0][2]+(e[1][2]-e[0][2])/2}}addSphere(e){(e=e||{}).center=this.getSelectionCenter(e.center);var t=new x.GLShape(e);return t.shapePosition=this.shapes.length,t.addSphere(e),this.shapes.push(t),t.finalize(),t}addBox(e={}){null!=e.corner&&(e.corner=this.getSelectionCenter(e.corner)),null!=e.center&&(e.center=this.getSelectionCenter(e.center));var t=new x.GLShape(e);return t.shapePosition=this.shapes.length,t.addBox(e),this.shapes.push(t),t.finalize(),t}addArrow(e={}){e.start=this.getSelectionCenter(e.start),e.end=this.getSelectionCenter(e.end);var t=new x.GLShape(e);return t.shapePosition=this.shapes.length,t.addArrow(e),this.shapes.push(t),t.finalize(),t}addCylinder(e={}){e.start=this.getSelectionCenter(e.start),e.end=this.getSelectionCenter(e.end);var t=new x.GLShape(e);return t.shapePosition=this.shapes.length,e.dashed?t.addDashedCylinder(e):t.addCylinder(e),this.shapes.push(t),t.finalize(),t}addCurve(e={}){var t=new x.GLShape(e);return t.shapePosition=this.shapes.length,t.addCurve(e),this.shapes.push(t),t.finalize(),t}addLine(e={}){e.start=this.getSelectionCenter(e.start),e.end=this.getSelectionCenter(e.end),e.wireframe=!0;var t=new x.GLShape(e);return t.shapePosition=this.shapes.length,e.dashed?t=this.addLineDashed(e,t):t.addLine(e),this.shapes.push(t),t.finalize(),t}addUnitCell(e,t){e=this.getModel(e),(t=t||{alabel:"a",blabel:"b",clabel:"c"}).box=t.box||{},t.astyle=t.astyle||{color:"red",radius:.1,midpos:-1},t.bstyle=t.bstyle||{color:"green",radius:.1,midpos:-1},t.cstyle=t.cstyle||{color:"blue",radius:.1,midpos:-1},t.alabelstyle=t.alabelstyle||{fontColor:"red",showBackground:!1,alignment:"center",inFront:!1},t.blabelstyle=t.blabelstyle||{fontColor:"green",showBackground:!1,alignment:"center",inFront:!1},t.clabelstyle=t.clabelstyle||{fontColor:"blue",showBackground:!1,alignment:"center",inFront:!1},e.unitCellObjects&&this.removeUnitCell(e),e.unitCellObjects={shapes:[],labels:[]};var r=e.getCrystData(),i=null;if(r){i=r.matrix||(s=r.a,a=r.b,h=r.c,l=r.alpha,c=r.beta,o=r.gamma,l=l*Math.PI/180,c=c*Math.PI/180,o=o*Math.PI/180,n=Math.cos(c),l=(Math.cos(l)-Math.cos(c)*Math.cos(o))/Math.sin(o),c=Math.sqrt(Math.max(0,1-n*n-l*l)),new E.Matrix3(s,a*Math.cos(o),h*n,0,a*Math.sin(o),h*l,0,0,h*c));var s,n,a,o,l,h,c,d=[new E.Vector3(0,0,0),new E.Vector3(1,0,0),new E.Vector3(0,1,0),new E.Vector3(0,0,1),new E.Vector3(1,1,0),new E.Vector3(0,1,1),new E.Vector3(1,0,1),new E.Vector3(1,1,1)];if(r.matrix4)for(let e=0;e<d.length;e++)r.size&&d[e].multiplyVectors(d[e],r.size),d[e]=d[e].applyMatrix4(r.matrix4);else for(let e=0;e<d.length;e++)d[e]=d[e].applyMatrix3(i);t.box&&!t.box.hidden&&(t.box.wireframe=!0,(s=new x.GLShape(t.box)).shapePosition=this.shapes.length,s.addLine({start:d[0],end:d[1]}),s.addLine({start:d[0],end:d[2]}),s.addLine({start:d[1],end:d[4]}),s.addLine({start:d[2],end:d[4]}),s.addLine({start:d[0],end:d[3]}),s.addLine({start:d[3],end:d[5]}),s.addLine({start:d[2],end:d[5]}),s.addLine({start:d[1],end:d[6]}),s.addLine({start:d[4],end:d[7]}),s.addLine({start:d[6],end:d[7]}),s.addLine({start:d[3],end:d[6]}),s.addLine({start:d[5],end:d[7]}),this.shapes.push(s),e.unitCellObjects.shapes.push(s),s.finalize()),t.astyle.hidden||(t.astyle.start=d[0],t.astyle.end=d[1],n=this.addArrow(t.astyle),e.unitCellObjects.shapes.push(n)),t.bstyle.hidden||(t.bstyle.start=d[0],t.bstyle.end=d[2],a=this.addArrow(t.bstyle),e.unitCellObjects.shapes.push(a)),t.cstyle.hidden||(t.cstyle.start=d[0],t.cstyle.end=d[3],o=this.addArrow(t.cstyle),e.unitCellObjects.shapes.push(o)),t.alabel&&(t.alabelstyle.position=d[1],l=this.addLabel(t.alabel,t.alabelstyle),e.unitCellObjects.labels.push(l)),t.blabel&&(t.blabelstyle.position=d[2],h=this.addLabel(t.blabel,t.blabelstyle),e.unitCellObjects.labels.push(h)),t.clabel&&(t.clabelstyle.position=d[3],c=this.addLabel(t.clabel,t.clabelstyle),e.unitCellObjects.labels.push(c))}}removeUnitCell(e){if((e=this.getModel(e)).unitCellObjects){let t=this;e.unitCellObjects.shapes.forEach(function(e){t.removeShape(e)}),e.unitCellObjects.labels.forEach(function(e){t.removeLabel(e)})}delete e.unitCellObjects}replicateUnitCell(e=3,t=e,r=t,a,i,s){var o=(a=this.getModel(a)).getCrystData();if(o){function l(e){return e%2==0?-e/2:Math.ceil(e/2)}var h=a.selectedAtoms({}),c=o.matrix;e<=1&&t<=1&&r<=1&&(s=!0,e=t=r=3);let n=function(e,t,r){return!1};if(s){const m=(new E.Matrix3).getInverse3(c);n=function(e,t,r){e=new E.Vector3(e,t,r).applyMatrix3(m);return!(-1e-4<e.x&&e.x<1.0001&&-1e-4<e.y&&e.y<1.0001&&-1e-4<e.z&&e.z<1.0001)}}for(let s=0;s<e;s++)for(let i=0;i<t;i++)for(let t=0;t<r;t++)if(0!=s||0!=i||0!=t){let e=new E.Vector3(l(s),l(i),l(t)),r=(e.applyMatrix3(c),[]);for(let t=0;t<h.length;t++){var d=h[t].x+e.x,u=h[t].y+e.y,p=h[t].z+e.z;if(!n(d,u,p)){let e={};for(var f in h[t])e[f]=h[t][f];e.x=d,e.y=u,e.z=p,r.push(e)}}a.addAtoms(r)}i&&a.assignBonds()}}addLineDashed(e,t){e.dashLength=e.dashLength||.5,e.gapLength=e.gapLength||.5,r=e.start?new E.Vector3(e.start.x||0,e.start.y||0,e.start.z||0):new E.Vector3(0,0,0),i=e.end?new E.Vector3(e.end.x,e.end.y||0,e.end.z||0):new E.Vector3(0,0,0);var r,i,s,n,a,o=new E.Vector3,l=new E.Vector3,h=new E.Vector3,c=r.clone(),d=0;for(o.subVectors(i,r),s=o.length(),o.normalize(),l=o.clone(),h=o.clone(),l.multiplyScalar(e.dashLength),h.multiplyScalar(e.gapLength),n=l.length(),a=h.length();d<s;){if(s<d+n){e.start=r,e.end=i,t.addLine(e);break}c.addVectors(r,l),e.start=r,e.end=c,t.addLine(e),r=c.clone(),d+=n,c.addVectors(r,h),r=c.clone(),d+=a}return t.finalize(),t}addCustom(e){var t=new x.GLShape(e=e||{});return t.shapePosition=this.shapes.length,t.addCustom(e),this.shapes.push(t),t.finalize(),t}addVolumetricData(e,t,r={}){e=new i.VolumeData(e,t);return r.hasOwnProperty("transferfn")?this.addVolumetricRender(e,r):this.addIsosurface(e,r)}addIsosurface(e,t={},r){var i=new x.GLShape(t);return i.shapePosition=this.shapes.length,i.addIsosurface(e,t,r,this),this.shapes.push(i),i}addVolumetricRender(e,t){e=new n.GLVolumetricRender(e,t=t||{},this);return e.shapePosition=this.shapes.length,this.shapes.push(e),e}hasVolumetricRender(){return this.renderer.supportsVolumetric()}enableFog(e){e?(this.scene.fog=new T.Fog(this.bgColor,100,200),this.config.disableFog=!1,null==(e=e).fogStart?this.fogStart=.4:this.fogStart=e.fogStart,null==e.fogEnd?this.fogEnd=1:this.fogEnd=e.fogEnd):(this.config.disableFog=!0,this.show())}setFrame(r){this.viewer_frame=r;let i=this;return new Promise(function(e){var t=i.models.map(function(e){return e.setFrame(r)});Promise.all(t).then(function(){e()})})}getFrame(){return this.viewer_frame}getNumFrames(){var t=0;for(let e=0;e<this.models.length;e++)this.models[e].getNumFrames()>t&&(t=this.models[e].getNumFrames());for(let e=0;e<this.shapes.length;e++)this.shapes[e].frame&&this.shapes[e].frame>=t&&(t=this.shapes[e].frame+1);for(let e=0;e<this.labels.length;e++)this.labels[e].frame&&this.labels[e].frame>=t&&(t=this.labels[e].frame+1);return t}getNextModelId(){return this.models.length}animate(e){this.incAnim();var t=100,r="forward",i=1/0,s=((e=e||{}).interval&&(t=e.interval),e.loop&&(r=e.loop),e.reps&&(i=e.reps),this.getNumFrames()),n=this,a=0,o=(e.startFrame&&(a=e.startFrame%s),1),l=(e.step&&(i/=o=e.step),0),h=s*i,c=new Date,d=function(e){c=new Date,"forward"==e?n.setFrame(a).then(function(){a=(a+o)%s,u()}):"backward"==e?n.setFrame(s-1-a).then(function(){a=(a+o)%s,u()}):n.setFrame(a).then(function(){o*=(a+=o)%(s-1)==0?-1:1,u()})},u=function(){var e;n.render(),n.getCanvas().isConnected?++l>=h||!n.isAnimated()?(p.cancel(),n.animationTimers.delete(p),n.decAnim()):(e=0<(e=t-((new Date).getTime()-c.getTime()))?e:0,p.cancel(),n.animationTimers.delete(p),p=new S.PausableTimer(d,e,r),n.animationTimers.add(p)):n.stopAnimate()},p=new S.PausableTimer(d,0,r);return this.animationTimers.add(p),this}stopAnimate(){return this.animated=0,this.animationTimers.forEach(function(e){e.cancel()}),this.animationTimers=new Set,this}pauseAnimate(){return this.animationTimers.forEach(function(e){e.pause()}),this}resumeAnimate(){return this.animationTimers.forEach(function(e){e.resume()}),this}isAnimated(){return 0<this.animated}getModelOpt(e){return e&&!e.defaultcolors?(e.defaultcolors=this.defaultcolors,e.cartoonQuality=e.cartoonQuality||this.config.cartoonQuality):void 0===e&&(e={defaultcolors:this.defaultcolors,cartoonQuality:this.config.cartoonQuality}),e}addModel(e,t="",r){r=this.getModelOpt(r);var i=new a.GLModel(this.models.length,r,this);return i.addMolData(e,t,r),this.models.push(i),i}addModels(e,t,r){(r=this.getModelOpt(r)).multimodel=!0,r.frames=!0;for(var i=a.GLModel.parseMolData(e,t,r),s=0;s<i.length;s++){var n=new a.GLModel(this.models.length,r,this);n.setAtomDefaults(i[s]),n.addFrame(i[s]),n.setFrame(0),i.modelData&&n.setModelData(i.modelData[s]),n.setDontDuplicateAtoms(!r.duplicateAssemblyAtoms),this.models.push(n)}return this.models}addModelsAsFrames(e,t,r){(r=this.getModelOpt(r)).multimodel=!0,r.frames=!0;var i=new a.GLModel(this.models.length,r,this);return i.addMolData(e,t,r),this.models.push(i),i}addAsOneMolecule(e,t,r){(r=this.getModelOpt(r)).multimodel=!0,r.onemol=!0;var i=new a.GLModel(this.models.length,r,this);return i.addMolData(e,t,r),this.models.push(i),i}removeModel(e){if(e=this.getModel(e)){for(e.removegl(this.modelGroup),delete this.models[e.getID()];0<this.models.length&&void 0===this.models[this.models.length-1];)this.models.pop();return this}}removeAllModels(){for(var e=0;e<this.models.length;e++){var t=this.models[e];t&&t.removegl(this.modelGroup)}return this.models.splice(0,this.models.length),this}exportJSON(t,e){var r={};return r.m=void 0===e?this.models.map(function(e){return e.toCDObject(t)}):[this.models[e].toCDObject()],JSON.stringify(r)}exportVRML(){var e=this.modelGroup,t=(this.applyToModels("removegl",this.modelGroup),this.modelGroup=new T.Object3D,this.render(null,{supportsImposters:!1,supportsAIA:!1,regen:!0}),"#VRML V2.0 utf8\n"+this.modelGroup.vrml()+"\n");return this.applyToModels("removegl",this.modelGroup),this.modelGroup=e,t}createModelFrom(e,t=!1){for(var r,i=new a.GLModel(this.models.length,this.defaultcolors,this),s=0;s<this.models.length;s++)this.models[s]&&(r=this.models[s].selectedAtoms(e),i.addAtoms(r),t&&this.models[s].removeAtoms(r));return this.models.push(i),i}applyToModels(e,t,r,i,s,n,a){for(var o=this.getModelList(t),l=0;l<o.length;l++)o[l][e](t,r,i,s,n,a)}setStyle(e,t){return void 0===t&&(t=e,e={}),this.applyToModels("setStyle",e,t,!1),this}addStyle(e,t){return void 0===t&&(t=e,e={}),this.applyToModels("setStyle",e,t,!0),this}setClickable(e,t,r){return this.applyToModels("setClickable",e,t,r),this}setHoverable(e,t,r,i){return this.applyToModels("setHoverable",e,t,r,i),this}enableContextMenu(e,t){return this.applyToModels("enableContextMenu",e,t),this}vibrate(e,t,r,i){return this.applyToModels("vibrate",e,t,r,i),this}setColorByProperty(e,t,r,i){return this.applyToModels("setColorByProperty",e,t,r,i),this}setColorByElement(e,t){return this.applyToModels("setColorByElement",e,t),this}static getAtomsWithin(t,r){var i=[];for(let e=0;e<t.length;e++){var s=t[e];void 0===s||s.x<r[0][0]||s.x>r[1][0]||s.y<r[0][1]||s.y>r[1][1]||s.z<r[0][2]||s.z>r[1][2]||i.push(s)}return i}static volume(e){return(e[1][0]-e[0][0])*(e[1][1]-e[0][1])*(e[1][2]-e[0][2])}carveUpExtent(e,r,i){let s=[],n={};for(let e=0,t=r.length;e<t;e++)n[r[e].index]=e;function a(r){let i=[];for(let e=0,t=r.length;e<t;e++)r[e].index in n&&i.push(n[r[e].index]);return i}function o(e){let t=[];return t[0]=[e[0][0],e[0][1],e[0][2]],t[1]=[e[1][0],e[1][1],e[1][2]],t}function l(e){var t,r,i;return L.volume(e)<L.maxVolume?[e]:(i=e[1][0]-e[0][0],r=e[1][1]-e[0][1],t=e[1][2]-e[0][2],i=r<i&&t<i?0:i<r&&t<r?1:2,t=o(e),r=o(e),e=(e[1][i]-e[0][i])/2+e[0][i],t[1][i]=e,r[0][i]=e,i=l(t),e=l(r),i.concat(e))}var h=l(e);for(let t=0,e=h.length;t<e;t++){let e=o(h[t]);e[0][0]-=6,e[0][1]-=6,e[0][2]-=6,e[1][0]+=6,e[1][1]+=6,e[1][2]+=6;var c=L.getAtomsWithin(r,e),d=L.getAtomsWithin(i,h[t]);s.push({extent:h[t],atoms:a(c),toshow:a(d)})}return s}static generateSurfaceMesh(r,e,t){var i=new T.Geometry(!0),s=i.updateGeoGroup(0),n=[];for(let e=0,t=r.length;e<t;e++){var a=r[e];a&&(void 0!==a.surfaceColor?n[e]=a.surfaceColor:a.color&&(n[e]=F.CC.color(a.color)))}var o=s.vertexArray,l=e.vertices;for(let e=0,t=l.length;e<t;e++){var h=3*s.vertices;o[h]=l[e].x,o[1+h]=l[e].y,o[2+h]=l[e].z,s.vertices++}var c=s.colorArray;let d=s.atomArray;if(t.voldata&&t.volscheme){var u=t.volscheme,p=t.voldata,f=u.range()||[-1,1];for(let e=0,t=l.length;e<t;e++){var m=l[e].atomid,g=p.getVal(l[e].x,l[e].y,l[e].z),g=F.CC.color(u.valueToHex(g,f)),v=3*e;c[v]=g.r,c[1+v]=g.g,c[2+v]=g.b,d[e]=r[m]}}else if(0<n.length)for(let e=0,t=l.length;e<t;e++){var b=l[e].atomid,_=3*e;c[_]=n[b].r,c[1+_]=n[b].g,c[2+_]=n[b].b,d[e]=r[b]}var y=e.faces,x=(s.faceidx=y.length,i.initTypedArrays(),s.vertexArray),w=s.normalArray;for(let e=0,t=y.length;e<t;e+=3){var A,S=3*y[e],C=3*y[e+1],L=3*y[e+2],M=new E.Vector3(x[S],x[1+S],x[2+S]),z=new E.Vector3(x[C],x[1+C],x[2+C]);(A=new E.Vector3(x[L],x[1+L],x[2+L])).subVectors(A,z),M.subVectors(M,z),A.cross(M),(z=A).normalize(),w[S]+=z.x,w[C]+=z.x,w[L]+=z.x,w[1+S]+=z.y,w[1+C]+=z.y,w[1+L]+=z.y,w[2+S]+=z.z,w[2+C]+=z.z,w[2+L]+=z.z}return s.faceArray=new Uint16Array(y),new T.Mesh(i,t)}static generateMeshSyncHelper(e,t,r,i,s,n){var a=new A.ProteinSurface;return a.initparm(t,1!==e,n),a.fillvoxels(s,r),a.buildboundary(),e!=A.SurfaceType.SES&&e!=A.SurfaceType.MS||(a.fastdistancemap(),a.boundingatom(!1),a.fillvoxelswaals(s,r)),a.marchingcube(e),a.getFacesAndVertices(i)}static getMatWithStyle(e){let t=null;for(var r in(t=new(e.onesided?T.MeshLambertMaterial:T.MeshDoubleLambertMaterial)).vertexColors=T.Coloring.VertexColors,e)"color"!==r&&"map"!==r&&e.hasOwnProperty(r)&&(t[r]=e[r]);return void 0!==e.opacity&&(1===e.opacity?t.transparent=!1:t.transparent=!0),void 0!==e.wireframe&&(t.wireframe=e.wireframe),t}addMesh(e){var e={geo:e.geometry,mat:e.material,done:!0,finished:!1},t=this.nextSurfID();return this.surfaces[t]=new C([e]),t}static shallowCopy(t){var r=[],i=t.length;for(let e=0;e<i;e++)r[e]=(0,S.extend)({},t[e]);return r}addSurface(e,p={},t={},r,f,i){let m=this.nextSurfID(),g=null,v=this,b=A.SurfaceType.VDW;"string"==typeof e?void 0!==L.surfaceTypeMap[e.toUpperCase()]?b=L.surfaceTypeMap[e]:console.log("Surface type : "+e+" is not recognized"):"number"==typeof e&&(b=e);var s=null,_=null,n=L.shallowCopy(this.getAtomsFromSel(t)),s=r?L.shallowCopy(this.getAtomsFromSel(r)):n,a=((0,S.adjustVolumeStyle)(p),!1);for(u=0;u<this.models.length;u++)if(this.models[u]){var o=this.models[u].getSymmetries();if(1<o.length||1==o.length&&!o[0].isIdentity()){a=!0;break}}function l(l,h,t){_=f?L.shallowCopy(v.getAtomsFromSel(f)):t;var r,e=(0,S.getExtent)(t,!0);if(p.map&&p.map.prop){var i=p.map.prop;let e=(0,w.getGradient)(p.map.scheme||p.map.gradient||new w.Gradient.RWB);e.range()||(0,S.getPropertyRange)(t,i);p.colorscheme={prop:i,gradient:e}}for(let e=0,t=h.length;e<t;e++)(r=h[e]).surfaceColor=(0,S.getColorFromStyle)(r,p);var s,o=L.volume(e),c=v.carveUpExtent(e,h,t),d=(_&&_.length&&0<_.length&&(s=(0,S.getExtent)(_,!0),c.sort(function(e,t){function r(e,t){var r=(e=e.extent)[1][0]-e[0][0],i=e[1][1]-e[0][1],e=e[1][2]-e[0][2],r=r-t[2][0],i=i-t[2][1],e=e-t[2][2];return(r*=r)+(i*=i)+(e*=e)}return r(e,s)-r(t,s)})),[]);for(let e=0,t=h.length;e<t;e++)r=h[e],d[e]={x:r.x,y:r.y,z:r.z,serial:e,elem:r.elem};if(i=!!A.syncSurface,"undefined"!=typeof $3Dmol&&void 0!==$3Dmol.SurfaceWorker||(console.log("$3Dmol.SurfaceWorker is not defined, using synchronous surface generation."),i=!0),i){var n=[];for(let e=0;e<c.length;e++)n.push(function(a){return new Promise(function(e){for(var t=L.generateMeshSyncHelper(b,c[a].extent,c[a].atoms,c[a].toshow,d,o),r=(0,x.splitMesh)({vertexArr:t.vertices,faceArr:t.faces}),i=0,s=r.length;i<s;i++){var t={vertices:r[i].vertexArr,faces:r[i].faceArr},n=L.generateSurfaceMesh(h,t,g);(0,S.mergeGeos)(l.geo,n)}v.render(),e()})}(e));return Promise.all(n).then(function(){return l.done=!0,v.render(),Promise.resolve(m)})}var u=[];b<0&&(b=0);for(let e=0,t=L.numWorkers;e<t;e++){var a=new Worker($3Dmol.SurfaceWorker);u.push(a),a.postMessage({type:-1,atoms:d,volume:o})}return new Promise(function(n,t){function r(e){for(var t=(0,x.splitMesh)({vertexArr:e.data.vertices,faceArr:e.data.faces}),r=0,i=t.length;r<i;r++){var s={vertices:t[r].vertexArr,faces:t[r].faceArr},s=L.generateSurfaceMesh(h,s,g);(0,S.mergeGeos)(l.geo,s)}v.render(),++a==c.length&&(l.done=!0,o(),n(m))}function i(e){o(),console.log(e.message+" ("+e.filename+":"+e.lineno+")"),t(e)}var a=0,o=function(){u&&u.length&&u.forEach(function(e){e&&e.terminate&&e.terminate()})};for(let e=0;e<c.length;e++){var s=u[e%u.length];s.onmessage=r,s.onerror=i,s.postMessage({type:b,expandedExtent:c[e].extent,extendedAtoms:c[e].atoms,atomsToShow:c[e].toshow})}})}p=p||{},g=L.getMatWithStyle(p);let h=new C([]);h.style=p,h.atomsel=t,h.allsel=r,h.focus=f;e=null;if(a){for(var c={},d={},u=0;u<this.models.length;u++)c[u]=[],d[u]=[];for(u=0;u<s.length;u++)c[s[u].model].push(s[u]);for(u=0;u<n.length;u++)d[n[u].model].push(n[u]);var y=[];for(u=0;u<this.models.length;u++)0<d[u].length&&(h.push({geo:new T.Geometry(!0),mat:g,done:!1,finished:!1,symmetries:this.models[u].getSymmetries()}),y.push(l(h[h.length-1],c[u],d[u])));e=Promise.all(y)}else h.push({geo:new T.Geometry(!0),mat:g,done:!1,finished:!1,symmetries:[new E.Matrix4]}),e=l(h[h.length-1],s,n);return this.surfaces[m]=h,e.surfid=m,i&&"function"==typeof i?(e.then(function(e){i(e)}),m):e}setSurfaceMaterialStyle(e,t){if((0,S.adjustVolumeStyle)(t),this.surfaces[e]){var r=this.surfaces[e];for(let e=0;e<r.length;e++){var i=r[e].mat=L.getMatWithStyle(t);if(r[e].mat.side=T.FrontSide,t.wireframe&&r[e].geo.setUpWireframe(),t.color){r[e].mat.color=F.CC.color(t.color),r[e].geo.colorsNeedUpdate=!0;var s=F.CC.color(t.color);r[e].geo.setColor(s)}else if(i.voldata&&i.volscheme){const l=i.volscheme,h=i.voldata,c=F.CC,d=l.range()||[-1,1];r[e].geo.setColors(function(e,t,r){e=h.getVal(e,t,r);return c.color(l.valueToHex(e,d))})}else{r[e].geo.colorsNeedUpdate=!0;for(var n of r[e].geo.geometryGroups)for(let e=0;e<n.vertices;e++){var a=(0,S.getColorFromStyle)(n.atomArray[e],t),o=3*e;n.colorArray[o]=a.r,n.colorArray[1+o]=a.g,n.colorArray[2+o]=a.b}}r[e].finished=!1}}return this}getSurface(e){return this.surfaces[e]}removeSurface(e){for(var t=this.surfaces[e],r=0;r<t.length;r++)t[r]&&t[r].lastGL&&(void 0!==t[r].geo&&t[r].geo.dispose(),void 0!==t[r].mat&&t[r].mat.dispose(),this.modelGroup.remove(t[r].lastGL));return delete this.surfaces[e],this.show(),this}removeAllSurfaces(){for(var e in this.surfaces)if(this.surfaces.hasOwnProperty(e)){for(var t=this.surfaces[e],r=0;r<t.length;r++)t[r]&&t[r].lastGL&&(void 0!==t[r].geo&&t[r].geo.dispose(),void 0!==t[r].mat&&t[r].mat.dispose(),this.modelGroup.remove(t[r].lastGL));delete this.surfaces[e]}return this.show(),this}jmolMoveTo(){var e=this.modelGroup.position,e="center { "+-e.x+" "+-e.y+" "+-e.z+" }; ",t=this.rotationGroup.quaternion;return e+="moveto .5 quaternion { "+t.x+" "+t.y+" "+t.z+" "+t.w+" };"}clear(){return this.removeAllSurfaces(),this.removeAllModels(),this.removeAllLabels(),this.removeAllShapes(),this.show(),this}mapAtomProperties(r,e){var i=this.getAtomsFromSel(e=e||{});if("function"==typeof r)for(let e=0,t=i.length;e<t;e++)r(i[e]);else for(let e=0,t=i.length;e<t;e++){var s=i[e];for(let t=0,e=r.length;t<e;t++){let e=r[t];if(e.props)for(var n in e.props)e.props.hasOwnProperty(n)&&this.atomIsSelected(s,e)&&(s.properties||(s.properties={}),s.properties[n]=e.props[n])}}return this}linkViewer(e){return this.linkedViewers.push(e),this}getPerceivedDistance(){return this.CAMERA_Z-this.rotationGroup.position.z}setPerceivedDistance(e){this.rotationGroup.position.z=this.CAMERA_Z-e}setAutoEyeSeparation(e,t){var r=this.getPerceivedDistance();return t=t||5,e||0<this.camera.position.x?this.camera.position.x=r*Math.tan(Math.PI/180*t):this.camera.position.x=-r*Math.tan(Math.PI/180*t),this.camera.lookAt(new E.Vector3(0,0,this.rotationGroup.position.z)),this.camera.position.x}setDefaultCartoonQuality(e){this.config.cartoonQuality=e}}function c(e,t){if(e=(0,S.getElement)(e)){t=t||{};try{return new L(e,t)}catch(e){throw"error creating viewer: "+e}}}function l(e,t={},r={}){if(e=(0,S.getElement)(e)){var i=[],s=document.createElement("canvas");r.rows=t.rows,r.cols=t.cols,r.control_all=null!=t.control_all&&t.control_all,e.appendChild(s);try{for(var n=0;n<t.rows;n++){for(var a=[],o=0;o<t.cols;o++){r.row=n,r.col=o,r.canvas=s,r.viewers=i,r.control_all=t.control_all;var l=c(e,(0,S.extend)({},r));a.push(l)}i.unshift(a)}}catch(e){throw"error creating viewer grid: "+e}return i}}L.numWorkers=4,L.maxVolume=64e3,L.surfaceTypeMap={VDW:A.SurfaceType.VDW,MS:A.SurfaceType.MS,SAS:A.SurfaceType.SAS,SES:A.SurfaceType.SES}},"./src/Gradient.ts":(e,t,r)=>{r.r(t),r.d(t,{CustomLinear:()=>c,Gradient:()=>u,GradientType:()=>s,ROYGB:()=>l,RWB:()=>n,Sinebow:()=>h,builtinGradients:()=>d,getGradient:()=>i,normalizeValue:()=>o});var a=r("./src/colors.ts");class s{}function o(e,t,r){return e<=t?{lo:e,hi:t,val:r=t<(r=r<e?e:r)?t:r}:{lo:t,hi:e,val:r=e-(r=(r=e<r?e:r)<t?t:r)+t}}function i(t){if(t instanceof s)return t;if(void 0!==t.gradient&&d[t.gradient])return r=void 0===t.min?-1:t.min,i=void 0===t.max?1:t.max,void 0===t.mid?void 0===t.colors?new d[t.gradient](r,i):new d[t.gradient](r,i,t.colors):new d[t.gradient](r,i,t.mid);if("string"==typeof t.gradient&&t.gradient.startsWith("linear_")){let e=t.gradient.split("_");e.shift();var r=void 0===t.min?-1:t.min,i=void 0===t.max?1:t.max;return new c(r,i,e)}return t}class n extends s{constructor(e,t,r){super(),this.gradient="RWB",this.mult=1,this.mid=r,this.min=e,void 0===(this.max=t)&&Array.isArray(e)&&2<=e.length?(this.max=e[1],this.min=e[0]):e&&t&&!Array.isArray(e)&&(this.min=e,this.max=t)}range(){return void 0!==this.min&&void 0!==this.max?[this.min,this.max]:null}valueToHex(e,t){if(e=this.mult*e,r=t?(n=t[0],t[1]):(n=this.min,this.max),void 0===e)return 16777215;var r,i,s=o(n,r,e),n=s.lo,a=((r=s.hi)+n)/2;return(e=s.val)<(a=t&&void 0!==t[2]?t[2]:void 0!==this.mid?this.mid:(n+r)/2)?16711680+256*(i=Math.floor(255*Math.sqrt((e-n)/(a-n))))+i:a<e?65536*(i=Math.floor(255*Math.sqrt(1-(e-a)/(r-a))))+256*i+255:16777215}}class l extends s{constructor(e,t){super(),this.gradient="ROYGB",this.mult=1,this.min=e,void 0===(this.max=t)&&Array.isArray(e)&&2<=e.length?(this.max=e[1],this.min=e[0]):e&&t&&!Array.isArray(e)&&(this.min=e,this.max=t)}valueToHex(e,t){if(e=this.mult*e,t=t?(r=t[0],t[1]):(r=this.min,this.max),void 0===e)return 16777215;var r,i=o(r,t,e),s=((r=i.lo)+(t=i.hi))/2,n=(r+s)/2,a=(s+t)/2;return(e=i.val)<n?16711680+256*Math.floor(255*Math.sqrt((e-r)/(n-r))):e<s?65536*Math.floor(255*Math.sqrt(1-(e-n)/(s-n)))+65280:e<a?+Math.floor(255*Math.sqrt((e-s)/(a-s)))+65280:0+256*Math.floor(255*Math.sqrt(1-(e-a)/(t-a)))+255}range(){return void 0!==this.min&&void 0!==this.max?[this.min,this.max]:null}}class h extends s{constructor(e,t){super(),this.gradient="Sinebow",this.mult=1,this.min=e,void 0===(this.max=t)&&Array.isArray(e)&&2<=e.length&&(this.max=e[1],this.min=e[0]),t<e&&(this.mult=-1,this.min*=-1,this.max*=-1)}valueToHex(e,t){if(e=this.mult*e,t=t?(i=t[0],t[1]):(i=this.min,this.max),void 0===e)return 16777215;var r=u.normalizeValue(i,t,e),i=r.lo,t=r.hi,r=5*(((e=r.val)-i)/(t-i))/6+.5,e=Math.sin(Math.PI*r),t=(e*=255*e,Math.sin(Math.PI*(r+1/3))),i=(t*=255*t,Math.sin(Math.PI*(r+2/3)));return i*=255*i,65536*Math.floor(e)+256*Math.floor(i)+ +Math.floor(t)}range(){return void 0!==this.min&&void 0!==this.max?[this.min,this.max]:null}}class c extends s{constructor(e,t,r){if(super(),this.gradient="linear",this.colors=new Array,e=Array.isArray(e)&&2<=e.length?(this.max=e[1],this.min=e[0],t):(this.min=e,this.max=t,r))for(var i of e)this.colors.push(a.CC.color(i));else this.colors.push(a.CC.color(0))}range(){return void 0!==this.min&&void 0!==this.max?[this.min,this.max]:null}valueToHex(e,t){t=t?(i=t[0],t[1]):(i=this.min,this.max);if(void 0===e)return 16777215;var r=o(i,t,e),i=r.lo,r=(t=r.hi,e=r.val,this.colors.length),t=(t-i)/r,s=Math.min(Math.floor((e-i)/t),r-1),r=Math.min(s+1,r-1),e=(e-i-s*t)/t,i=this.colors[s],t=this.colors[r];let n=new a.Color(i.r+e*(t.r-i.r),i.g+e*(t.g-i.g),i.b+e*(t.b-i.b));return n.getHex()}}const d={rwb:n,RWB:n,roygb:l,ROYGB:l,sinebow:h,linear:c};class u extends s{valueToHex(e,t){return 0}range(){return null}}u.RWB=n,u.ROYGB=l,u.Sinebow=h,u.CustomLinear=c,u.builtinGradients=d,u.normalizeValue=o,u.getGradient=i},"./src/Label.ts":(e,t,r)=>{r.r(t),r.d(t,{Label:()=>n,LabelCount:()=>s});var w=r("./src/WebGL/index.ts"),A=r("./src/Gradient.ts"),i=r("./src/colors.ts");let s=0;function S(e,t,r){return void 0!==e&&(e instanceof i.Color?r=e.scaled():void 0!==(r=i.CC.color(e)).scaled&&(r=r.scaled())),void 0!==t&&(r.a=parseFloat(t)),r}class n{constructor(e,t){this.id=s++,this.stylespec=t||{},this.canvas=document.createElement("canvas"),this.canvas.width=134,this.canvas.height=35,this.context=this.canvas.getContext("2d"),this.sprite=new w.Sprite,this.text=e,this.frame=this.stylespec.frame}getStyle(){return this.stylespec}hide(){this.sprite&&(this.sprite.visible=!1)}show(){this.sprite&&(this.sprite.visible=!0)}setContext(){var s=this.stylespec,e=void 0!==s.useScreen&&s.useScreen,t=s.showBackground,r=(void 0===(t="0"!==t&&"false"!==t?t:!1)&&(t=!0),s.font||"sans-serif"),i=parseInt(s.fontSize)?parseInt(s.fontSize):18,n=S(s.fontColor,s.fontOpacity,{r:255,g:255,b:255,a:1}),a=s.padding||4,o=s.borderThickness||0,l=S(s.backgroundColor,s.backgroundOpacity,{r:0,g:0,b:0,a:1}),h=S(s.borderColor,s.borderOpacity,l),c=s.position||{x:-10,y:1,z:1},d=void 0===s.inFront||s.inFront,u=("false"!==d&&"0"!==d||(d=!1),s.alignment||w.SpriteAlignment.topLeft),p=("string"==typeof u&&u in w.SpriteAlignment&&(u=w.SpriteAlignment[u]),"");s.bold&&(p="bold "),this.context.font=p+i+"px  "+r;var f,m,g=this.context.measureText(this.text).width,v=g+2.5*(o=t?o:0)+2*a,b=1.25*i+2*o+2*a;if(s.backgroundImage&&(f=s.backgroundImage,v<(_=s.backgroundWidth||f.width)&&(v=_),b<(_=s.backgroundHeight||f.height)&&(b=_)),this.canvas.width=v,this.canvas.height=b,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),p="",s.bold&&(p="bold "),this.context.font=p+i+"px  "+r,this.context.fillStyle="rgba("+l.r+","+l.g+","+l.b+","+l.a+")",this.context.strokeStyle="rgba("+h.r+","+h.g+","+h.b+","+h.a+")",s.backgroundGradient){let t=this.context.createLinearGradient(0,b/2,v,b/2),r=A.Gradient.getGradient(s.backgroundGradient);var _=r.range();let i=-1,e=1;_&&(i=_[0],e=_[1]);var y=e-i;for(let e=0;e<1.01;e+=.1){var x=S(r.valueToHex(i+y*e)),x="rgba("+x.r+","+x.g+","+x.b+","+x.a+")";t.addColorStop(e,x)}this.context.fillStyle=t}this.context.lineWidth=o,t&&(p=this.context,h=v-2*(l=r=o),_=b-2*o,t=6,m=0<o,p.beginPath(),p.moveTo(r+t,l),p.lineTo(r+h-t,l),p.quadraticCurveTo(r+h,l,r+h,l+t),p.lineTo(r+h,l+_-t),p.quadraticCurveTo(r+h,l+_,r+h-t,l+_),p.lineTo(r+t,l+_),p.quadraticCurveTo(r,l+_,r,l+_-t),p.lineTo(r,l+t),p.quadraticCurveTo(r,l,r+t,l),p.closePath(),p.fill(),m&&p.stroke()),s.backgroundImage&&this.context.drawImage(f,0,0,v,b),this.context.fillStyle="rgba("+n.r+","+n.g+","+n.b+","+n.a+")",this.context.fillText(this.text,o+a,i+o+a,g);h=new w.Texture(this.canvas);h.needsUpdate=!0,this.sprite.material=new w.SpriteMaterial({map:h,useScreenCoordinates:e,alignment:u,depthTest:!d,screenOffset:s.screenOffset||null}),this.sprite.scale.set(1,1,1),this.sprite.position.set(c.x,c.y,c.z)}dispose(){void 0!==this.sprite.material.map&&this.sprite.material.map.dispose(),void 0!==this.sprite.material&&this.sprite.material.dispose()}}},"./src/ProteinSurface4.ts":(e,t,r)=>{r.r(t),r.d(t,{MarchingCube:()=>a,MarchingCubeInitializer:()=>n,PointGrid:()=>c,ProteinSurface:()=>o,SurfaceType:()=>i,setSyncSurface:()=>function(e){s=e},syncSurface:()=>s});var i,A=r("./src/WebGL/math/index.ts"),s=((t=i=i||{})[t.VDW=1]="VDW",t[t.MS=2]="MS",t[t.SAS=3]="SAS",!(t[t.SES=4]="SES"));(0<=window.navigator.userAgent.indexOf("MSIE ")||0<=window.navigator.userAgent.indexOf("Trident/"))&&(s=!0);class n{constructor(){this.ISDONE=2,this.edgeTable=new Uint32Array([0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0]),this.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],this.edgeTable2=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],this.triTable2=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]]}march(s,l,n,e){var t=!!e.fulltable;let h=e.hasOwnProperty("origin")&&e.origin.hasOwnProperty("x")?e.origin:{x:0,y:0,z:0},c=!!e.voxel,d=e.matrix;var r=e.nX||0;let u=e.nY||0,p=e.nZ||0;var i=e.scale||1;let f=null,m=(f=e.unitCube||{x:i,y:i,z:i},new Int32Array(r*u*p)),a,o;for(a=0,o=m.length;a<o;++a)m[a]=-1;function g(t,r,i,e,s,n){let a={x:0,y:0,z:0},o=!!!(e&1<<s)&&!!(e&1<<n)?n:s;if(1&o&&i++,2&o&&r++,4&o&&t++,d){let e=new A.Vector3(t,r,i);e=e.applyMatrix4(d),a={x:e.x,y:e.y,z:e.z}}else a.x=h.x+f.x*t,a.y=h.y+f.y*r,a.z=h.z+f.z*i;return e=(u*t+r)*p+i,c?(l.push(a),l.length-1):(m[e]<0&&(m[e]=l.length,l.push(a)),m[e])}let v=new Int32Array(12);var b=t?this.edgeTable2:this.edgeTable,_=t?this.triTable2:this.triTable;for(a=0;a<r-1;++a)for(let i=0;i<u-1;++i)for(let r=0;r<p-1;++r){let t=0;for(let e=0;e<8;++e){var y=!!(s[(u*(a+((4&e)>>2))+i+((2&e)>>1))*p+r+(1&e)]&this.ISDONE);t|=y<<e}if(0!==t&&255!==t){var x=b[t];if(0!==x){var w=_[t];1&x&&(v[0]=g(a,i,r,t,0,1)),2&x&&(v[1]=g(a,i,r,t,1,3)),4&x&&(v[2]=g(a,i,r,t,3,2)),8&x&&(v[3]=g(a,i,r,t,2,0)),16&x&&(v[4]=g(a,i,r,t,4,5)),32&x&&(v[5]=g(a,i,r,t,5,7)),64&x&&(v[6]=g(a,i,r,t,7,6)),128&x&&(v[7]=g(a,i,r,t,6,4)),256&x&&(v[8]=g(a,i,r,t,0,4)),512&x&&(v[9]=g(a,i,r,t,1,5)),1024&x&&(v[10]=g(a,i,r,t,3,7)),2048&x&&(v[11]=g(a,i,r,t,2,6));for(let i=0;i<w.length;i+=3){let e=v[w[i]],t=v[w[i+1]],r=v[w[i+2]];c&&3<=i&&(l.push(l[e]),e=l.length-1,l.push(l[t]),t=l.length-1,l.push(l[r]),r=l.length-1),n.push(e),n.push(t),n.push(r)}}}}}laplacianSmooth(e,t,r){let i=new Array(t.length),s,n,a,o,l;for(s=0,n=t.length;s<n;s++)i[s]={x:0,y:0,z:0};let h=new Array(20),c;for(s=0;s<20;s++)h[s]=new Array(t.length);for(s=0,n=t.length;s<n;s++)h[0][s]=0;for(s=0,n=r.length/3;s<n;s++){var d=3*s,u=3*s+1,p=3*s+2;for(c=!0,a=0,o=h[0][r[d]];a<o;a++)if(r[u]==h[a+1][r[d]]){c=!1;break}for(c&&(h[0][r[d]]++,h[h[0][r[d]]][r[d]]=r[u]),c=!0,a=0,o=h[0][r[d]];a<o;a++)if(r[p]==h[a+1][r[d]]){c=!1;break}for(c&&(h[0][r[d]]++,h[h[0][r[d]]][r[d]]=r[p]),c=!0,a=0,o=h[0][r[u]];a<o;a++)if(r[d]==h[a+1][r[u]]){c=!1;break}for(c&&(h[0][r[u]]++,h[h[0][r[u]]][r[u]]=r[d]),c=!0,a=0,o=h[0][r[u]];a<o;a++)if(r[p]==h[a+1][r[u]]){c=!1;break}for(c&&(h[0][r[u]]++,h[h[0][r[u]]][r[u]]=r[p]),c=!0,a=0;a<h[0][r[p]];a++)if(r[d]==h[a+1][r[p]]){c=!1;break}for(c&&(h[0][r[p]]++,h[h[0][r[p]]][r[p]]=r[d]),c=!0,a=0,o=h[0][r[p]];a<o;a++)if(r[u]==h[a+1][r[p]]){c=!1;break}c&&(h[0][r[p]]++,h[h[0][r[p]]][r[p]]=r[u])}for(l=0;l<e;l++){for(s=0,n=t.length;s<n;s++)if(h[0][s]<3)i[s].x=t[s].x,i[s].y=t[s].y,i[s].z=t[s].z;else if(3==h[0][s]||4==h[0][s]){for(i[s].x=0,i[s].y=0,i[s].z=0,a=0,o=h[0][s];a<o;a++)i[s].x+=t[h[a+1][s]].x,i[s].y+=t[h[a+1][s]].y,i[s].z+=t[h[a+1][s]].z;i[s].x+=.5*t[s].x,i[s].y+=.5*t[s].y,i[s].z+=.5*t[s].z,i[s].x/=.5+h[0][s],i[s].y/=.5+h[0][s],i[s].z/=.5+h[0][s]}else{for(i[s].x=0,i[s].y=0,i[s].z=0,a=0,o=h[0][s];a<o;a++)i[s].x+=t[h[a+1][s]].x,i[s].y+=t[h[a+1][s]].y,i[s].z+=t[h[a+1][s]].z;i[s].x+=+t[s].x,i[s].y+=+t[s].y,i[s].z+=+t[s].z,i[s].x/=1+h[0][s],i[s].y/=1+h[0][s],i[s].z/=1+h[0][s]}for(s=0,n=t.length;s<n;s++)t[s].x=i[s].x,t[s].y=i[s].y,t[s].z=i[s].z}}}let a=new n;class c{constructor(e,t,r){this.data=new Int32Array(e*t*r*3),this.width=t,this.height=r}set(e,t,r,i){e=3*((e*this.width+t)*this.height+r);this.data[e]=i.ix,this.data[1+e]=i.iy,this.data[2+e]=i.iz}get(e,t,r){e=3*((e*this.width+t)*this.height+r);return{ix:this.data[e],iy:this.data[1+e],iz:this.data[2+e]}}}class o{constructor(){this.INOUT=1,this.ISDONE=2,this.ISBOUND=4,this.ptranx=0,this.ptrany=0,this.ptranz=0,this.probeRadius=1.4,this.defaultScaleFactor=2,this.scaleFactor=this.defaultScaleFactor,this.pHeight=0,this.pWidth=0,this.pLength=0,this.cutRadius=0,this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.pminx=0,this.pminy=0,this.pminz=0,this.pmaxx=0,this.pmaxy=0,this.pmaxz=0,this.depty={},this.widxz={},this.faces=[],this.verts=[],this.vdwRadii={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},this.nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])],o.MarchingCube||(o.MarchingCube=new n)}getVDWIndex(e){return e.elem&&void 0!==this.vdwRadii[e.elem]?e.elem:"X"}getFacesAndVertices(r){let i={};for(let e=0,t=r.length;e<t;e++)i[r[e]]=!0;let s=this.verts;for(let e=0,t=s.length;e<t;e++)s[e].x=s[e].x/this.scaleFactor-this.ptranx,s[e].y=s[e].y/this.scaleFactor-this.ptrany,s[e].z=s[e].z/this.scaleFactor-this.ptranz;let n=[];for(let t=0,e=this.faces.length;t<e;t+=3){var a=this.faces[t],o=this.faces[t+1],l=this.faces[t+2],h=s[a].atomid,c=s[o].atomid,d=s[l].atomid;let e=h;d<(e=c<e?c:e)&&(e=d),i[e]&&a!==o&&o!==l&&a!==l&&(n.push(a),n.push(o),n.push(l))}return this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,{vertices:s,faces:n}}initparm(e,t,r){1e6<r&&(this.scaleFactor=this.defaultScaleFactor/2);r=1/this.scaleFactor*5.5;this.pminx=e[0][0],this.pmaxx=e[1][0],this.pminy=e[0][1],this.pmaxy=e[1][1],this.pminz=e[0][2],this.pmaxz=e[1][2],t?(this.pminx-=this.probeRadius+r,this.pminy-=this.probeRadius+r,this.pminz-=this.probeRadius+r,this.pmaxx+=this.probeRadius+r,this.pmaxy+=this.probeRadius+r,this.pmaxz+=this.probeRadius+r):(this.pminx-=r,this.pminy-=r,this.pminz-=r,this.pmaxx+=r,this.pmaxy+=r,this.pmaxz+=r),this.pminx=Math.floor(this.pminx*this.scaleFactor)/this.scaleFactor,this.pminy=Math.floor(this.pminy*this.scaleFactor)/this.scaleFactor,this.pminz=Math.floor(this.pminz*this.scaleFactor)/this.scaleFactor,this.pmaxx=Math.ceil(this.pmaxx*this.scaleFactor)/this.scaleFactor,this.pmaxy=Math.ceil(this.pmaxy*this.scaleFactor)/this.scaleFactor,this.pmaxz=Math.ceil(this.pmaxz*this.scaleFactor)/this.scaleFactor,this.ptranx=-this.pminx,this.ptrany=-this.pminy,this.ptranz=-this.pminz,this.pLength=Math.ceil(this.scaleFactor*(this.pmaxx-this.pminx))+1,this.pWidth=Math.ceil(this.scaleFactor*(this.pmaxy-this.pminy))+1,this.pHeight=Math.ceil(this.scaleFactor*(this.pmaxz-this.pminz))+1,this.boundingatom(t),this.cutRadius=this.probeRadius*this.scaleFactor,this.vpBits=new Uint8Array(this.pLength*this.pWidth*this.pHeight),this.vpDistance=new Float64Array(this.pLength*this.pWidth*this.pHeight),this.vpAtomID=new Int32Array(this.pLength*this.pWidth*this.pHeight)}boundingatom(e){let t={};for(const a in this.vdwRadii){var i=this.vdwRadii[a],s=(t[a]=e?(i+this.probeRadius)*this.scaleFactor+.5:i*this.scaleFactor+.5,t[a]*t[a]);this.widxz[a]=Math.floor(t[a])+1,this.depty[a]=new Int32Array(this.widxz[a]*this.widxz[a]);let r=0;for(let t=0;t<this.widxz[a];t++)for(let e=0;e<this.widxz[a];e++){var n=t*t+e*e;s<n?this.depty[a][r]=-1:(n=Math.sqrt(s-n),this.depty[a][r]=Math.floor(n)),r++}}}fillvoxels(e,t){for(let e=0,t=this.vpBits.length;e<t;e++)this.vpBits[e]=0,this.vpDistance[e]=-1,this.vpAtomID[e]=-1;for(var r in t){r=e[t[r]];void 0!==r&&this.fillAtom(r,e)}for(let e=0,t=this.vpBits.length;e<t;e++)this.vpBits[e]&this.INOUT&&(this.vpBits[e]|=this.ISDONE)}fillAtom(n,a){var o=Math.floor(.5+this.scaleFactor*(n.x+this.ptranx)),l=Math.floor(.5+this.scaleFactor*(n.y+this.ptrany)),h=Math.floor(.5+this.scaleFactor*(n.z+this.ptranz)),c=this.getVDWIndex(n);let d=0;var u=this.pWidth*this.pHeight;for(let s=0,e=this.widxz[c];s<e;s++)for(let i=0;i<e;i++){if(-1!=this.depty[c][d])for(let r=-1;r<2;r++)for(let t=-1;t<2;t++)for(let e=-1;e<2;e++)if(0!==r&&0!==t&&0!==e){var p=r*s,f=e*i;for(let e=0;e<=this.depty[c][d];e++){var m=e*t,g=o+p,v=l+m,b=h+f;g<0||v<0||b<0||g>=this.pLength||v>=this.pWidth||b>=this.pHeight||(g=g*u+v*this.pHeight+b,this.vpBits[g]&this.INOUT?(v=a[this.vpAtomID[g]]).serial!=n.serial&&p*p+m*m+f*f<(b=o+p-Math.floor(.5+this.scaleFactor*(v.x+this.ptranx)))*b+(b=l+m-Math.floor(.5+this.scaleFactor*(v.y+this.ptrany)))*b+(m=h+f-Math.floor(.5+this.scaleFactor*(v.z+this.ptranz)))*m&&(this.vpAtomID[g]=n.serial):(this.vpBits[g]|=this.INOUT,this.vpAtomID[g]=n.serial))}}d++}}fillvoxelswaals(e,t){for(let e=0,t=this.vpBits.length;e<t;e++)this.vpBits[e]&=~this.ISDONE;for(var r in t){r=e[t[r]];void 0!==r&&this.fillAtomWaals(r,e)}}fillAtomWaals(n,a){let o=0;var l=Math.floor(.5+this.scaleFactor*(n.x+this.ptranx)),h=Math.floor(.5+this.scaleFactor*(n.y+this.ptrany)),c=Math.floor(.5+this.scaleFactor*(n.z+this.ptranz)),d=this.getVDWIndex(n),u=this.pWidth*this.pHeight;for(let s=0,e=this.widxz[d];s<e;s++)for(let i=0;i<e;i++){if(-1!=this.depty[d][o])for(let r=-1;r<2;r++)for(let t=-1;t<2;t++)for(let e=-1;e<2;e++)if(0!==r&&0!==t&&0!==e){var p=r*s,f=e*i;for(let e=0;e<=this.depty[d][o];e++){var m=e*t,g=l+p,v=h+m,b=c+f;g<0||v<0||b<0||g>=this.pLength||v>=this.pWidth||b>=this.pHeight||(g=g*u+v*this.pHeight+b,this.vpBits[g]&this.ISDONE?(v=a[this.vpAtomID[g]]).serial!=n.serial&&p*p+m*m+f*f<(b=l+p-Math.floor(.5+this.scaleFactor*(v.x+this.ptranx)))*b+(b=h+m-Math.floor(.5+this.scaleFactor*(v.y+this.ptrany)))*b+(m=c+f-Math.floor(.5+this.scaleFactor*(v.z+this.ptranz)))*m&&(this.vpAtomID[g]=n.serial):(this.vpBits[g]|=this.ISDONE,this.vpAtomID[g]=n.serial))}}o++}}buildboundary(){var s=this.pWidth*this.pHeight;for(let i=0;i<this.pLength;i++)for(let r=0;r<this.pHeight;r++)for(let t=0;t<this.pWidth;t++){var n=i*s+t*this.pHeight+r;if(this.vpBits[n]&this.INOUT){let e=0;for(;e<26;){var a=i+this.nb[e][0],o=r+this.nb[e][2],l=t+this.nb[e][1];if(-1<a&&a<this.pLength&&-1<l&&l<this.pWidth&&-1<o&&o<this.pHeight&&!(this.vpBits[a*s+l*this.pHeight+o]&this.INOUT)){this.vpBits[n]|=this.ISBOUND;break}e++}}}}fastdistancemap(){let i=new c(this.pLength,this.pWidth,this.pHeight);var s,n=this.pWidth*this.pHeight,r=this.cutRadius*this.cutRadius;let a=[],o=[],l;for(let r=0;r<this.pLength;r++)for(let t=0;t<this.pWidth;t++)for(let e=0;e<this.pHeight;e++)l=r*n+t*this.pHeight+e,this.vpBits[l]&=~this.ISDONE,this.vpBits[l]&this.INOUT&&this.vpBits[l]&this.ISBOUND&&(s={ix:r,iy:t,iz:e},i.set(r,t,e,s),a.push(s),this.vpDistance[l]=0,this.vpBits[l]|=this.ISDONE,this.vpBits[l]&=~this.ISBOUND);do{o=this.fastoneshell(a,i),a=[];for(let e=0,t=o.length;e<t;e++)l=n*o[e].ix+this.pHeight*o[e].iy+o[e].iz,this.vpBits[l]&=~this.ISBOUND,this.vpDistance[l]<=1.0404*r&&a.push({ix:o[e].ix,iy:o[e].iy,iz:o[e].iz})}while(0!==a.length);a=[],o=[],i=null;let e=this.scaleFactor-.5;var h=r-.5/(.1+(e=e<0?0:e));for(let r=0;r<this.pLength;r++)for(let t=0;t<this.pWidth;t++)for(let e=0;e<this.pHeight;e++)l=r*n+t*this.pHeight+e,this.vpBits[l]&=~this.ISBOUND,this.vpBits[l]&this.INOUT&&(this.vpBits[l]&this.ISDONE&&!(this.vpBits[l]&this.ISDONE&&this.vpDistance[l]>=h)||(this.vpBits[l]|=this.ISBOUND))}fastoneshell(r,i){let s,n,a,o,l,h,c,d,u,p=[];if(0===r.length)return p;let f={ix:-1,iy:-1,iz:-1};var m=this.pWidth*this.pHeight;for(let e=0,t=r.length;e<t;e++){s=r[e].ix,n=r[e].iy,a=r[e].iz,d=i.get(s,n,a);for(let e=0;e<6;e++)f.ix=s+this.nb[e][0],f.iy=n+this.nb[e][1],f.iz=a+this.nb[e][2],f.ix<this.pLength&&-1<f.ix&&f.iy<this.pWidth&&-1<f.iy&&f.iz<this.pHeight&&-1<f.iz&&(u=f.ix*m+this.pHeight*f.iy+f.iz,this.vpBits[u]&this.INOUT&&!(this.vpBits[u]&this.ISDONE)?(i.set(f.ix,f.iy,a+this.nb[e][2],d),o=f.ix-d.ix,l=f.iy-d.iy,h=f.iz-d.iz,c=o*o+l*l+h*h,this.vpDistance[u]=c,this.vpBits[u]|=this.ISDONE,this.vpBits[u]|=this.ISBOUND,p.push({ix:f.ix,iy:f.iy,iz:f.iz})):this.vpBits[u]&this.INOUT&&this.vpBits[u]&this.ISDONE&&(o=f.ix-d.ix,l=f.iy-d.iy,h=f.iz-d.iz,(c=o*o+l*l+h*h)<this.vpDistance[u]&&(i.set(f.ix,f.iy,f.iz,d),this.vpDistance[u]=c,this.vpBits[u]&this.ISBOUND||(this.vpBits[u]|=this.ISBOUND,p.push({ix:f.ix,iy:f.iy,iz:f.iz})))))}for(let e=0,t=r.length;e<t;e++){s=r[e].ix,n=r[e].iy,a=r[e].iz,d=i.get(s,n,a);for(let e=6;e<18;e++)f.ix=s+this.nb[e][0],f.iy=n+this.nb[e][1],f.iz=a+this.nb[e][2],f.ix<this.pLength&&-1<f.ix&&f.iy<this.pWidth&&-1<f.iy&&f.iz<this.pHeight&&-1<f.iz&&(u=f.ix*m+this.pHeight*f.iy+f.iz,this.vpBits[u]&this.INOUT&&!(this.vpBits[u]&this.ISDONE)?(i.set(f.ix,f.iy,a+this.nb[e][2],d),o=f.ix-d.ix,l=f.iy-d.iy,h=f.iz-d.iz,c=o*o+l*l+h*h,this.vpDistance[u]=c,this.vpBits[u]|=this.ISDONE,this.vpBits[u]|=this.ISBOUND,p.push({ix:f.ix,iy:f.iy,iz:f.iz})):this.vpBits[u]&this.INOUT&&this.vpBits[u]&this.ISDONE&&(o=f.ix-d.ix,l=f.iy-d.iy,h=f.iz-d.iz,(c=o*o+l*l+h*h)<this.vpDistance[u]&&(i.set(f.ix,f.iy,f.iz,d),this.vpDistance[u]=c,this.vpBits[u]&this.ISBOUND||(this.vpBits[u]|=this.ISBOUND,p.push({ix:f.ix,iy:f.iy,iz:f.iz})))))}for(let e=0,t=r.length;e<t;e++){s=r[e].ix,n=r[e].iy,a=r[e].iz,d=i.get(s,n,a);for(let e=18;e<26;e++)f.ix=s+this.nb[e][0],f.iy=n+this.nb[e][1],f.iz=a+this.nb[e][2],f.ix<this.pLength&&-1<f.ix&&f.iy<this.pWidth&&-1<f.iy&&f.iz<this.pHeight&&-1<f.iz&&(u=f.ix*m+this.pHeight*f.iy+f.iz,this.vpBits[u]&this.INOUT&&!(this.vpBits[u]&this.ISDONE)?(i.set(f.ix,f.iy,a+this.nb[e][2],d),o=f.ix-d.ix,l=f.iy-d.iy,h=f.iz-d.iz,c=o*o+l*l+h*h,this.vpDistance[u]=c,this.vpBits[u]|=this.ISDONE,this.vpBits[u]|=this.ISBOUND,p.push({ix:f.ix,iy:f.iy,iz:f.iz})):this.vpBits[u]&this.INOUT&&this.vpBits[u]&this.ISDONE&&(o=f.ix-d.ix,l=f.iy-d.iy,h=f.iz-d.iz,(c=o*o+l*l+h*h)<this.vpDistance[u]&&(i.set(f.ix,f.iy,f.iz,d),this.vpDistance[u]=c,this.vpBits[u]&this.ISBOUND||(this.vpBits[u]|=this.ISBOUND,p.push({ix:f.ix,iy:f.iy,iz:f.iz})))))}return p}marchingcubeinit(r){for(let e=0,t=this.vpBits.length;e<t;e++)1==r?this.vpBits[e]&=~this.ISBOUND:4==r?(this.vpBits[e]&=~this.ISDONE,this.vpBits[e]&this.ISBOUND&&(this.vpBits[e]|=this.ISDONE),this.vpBits[e]&=~this.ISBOUND):2==r?this.vpBits[e]&this.ISBOUND&&this.vpBits[e]&this.ISDONE?this.vpBits[e]&=~this.ISBOUND:this.vpBits[e]&this.ISBOUND&&!(this.vpBits[e]&this.ISDONE)&&(this.vpBits[e]|=this.ISDONE):3==r&&(this.vpBits[e]&=~this.ISBOUND)}marchingcube(e){this.marchingcubeinit(e),this.verts=[],this.faces=[],o.MarchingCube.march(this.vpBits,this.verts,this.faces,{smooth:1,nX:this.pLength,nY:this.pWidth,nZ:this.pHeight});var r=this.pWidth*this.pHeight;for(let e=0,t=this.verts.length;e<t;e++)this.verts[e].atomid=this.vpAtomID[this.verts[e].x*r+this.pHeight*this.verts[e].y+this.verts[e].z];o.MarchingCube.laplacianSmooth(1,this.verts,this.faces)}}o.MarchingCube=new n},"./src/SurfaceWorker.js":()=>{$3Dmol.workerString=function(){self.onmessage=function(e){var t,e=e.data,r=e.type;r<0?(self.atomData=e.atoms,self.volume=e.volume,self.ps=new ProteinSurface):((t=self.ps).initparm(e.expandedExtent,1!=r,self.volume),t.fillvoxels(self.atomData,e.extendedAtoms),t.buildboundary(),4!==r&&2!==r||(t.fastdistancemap(),t.boundingatom(!1),t.fillvoxelswaals(self.atomData,e.extendedAtoms)),t.marchingcube(r),r=t.getFacesAndVertices(e.atomsToShow),self.postMessage(r))}}.toString().replace(/(^.*?\{|\}$)/g,""),$3Dmol.workerString+=";\nfunction _classCallCheck() {};",$3Dmol.workerString+=";\n"+$3Dmol.Vector3.toString(),$3Dmol.workerString+=";\n"+$3Dmol.MarchingCubeInitializer.toString()+";\n\n",$3Dmol.workerString+=";\n"+$3Dmol.PointGrid.toString()+";\n",$3Dmol.workerString+=";\nvar ProteinSurface = "+$3Dmol.ProteinSurface.toString()+";\n",$3Dmol.SurfaceWorker=window.URL?window.URL.createObjectURL(new Blob([$3Dmol.workerString],{type:"text/javascript"})):void 0},"./src/VolumeData.ts":(e,t,r)=>{r.r(t),r.d(t,{VolumeData:()=>i});var o=r("./src/utilities.ts"),m=r("./src/WebGL/math/index.ts"),u=r("./src/parsers/VASP.ts"),s=r("./src/parsers/CUBE.ts"),l=r("./node_modules/pako/dist/pako.esm.mjs");class i{constructor(e,t,r){if(this.unit={x:1,y:1,z:1},this.origin={x:0,y:0,z:0},this.size={x:0,y:0,z:0},this.data=new Float32Array([]),this.matrix=null,this.inversematrix=null,this.isbinary=new Set(["ccp4","CCP4"]),this.getCoordinates=function(e){var t=e/(this.size.y*this.size.z),r=e%(this.size.y*this.size.z),e=e%this.size.z;return t*=this.unit.x,r*=this.unit.y,e*=this.unit.z,{x:t+=this.origin.x,y:r+=this.origin.y,z:e+=this.origin.z}},this.vasp=function(e){var t=e.replace(/^\s+/,"").split(/[\n\r]/),e=(0,u.VASP)(e)[0].length;if(0==e)return console.warn("No good formating of CHG or CHGCAR file, not atomic information provided in the file."),void(this.data=[]);var r=1.889725992,i=parseFloat(t[1]),s=t[2].replace(/^\s+/,"").split(/\s+/),n=new m.Vector3(parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2])).multiplyScalar(i*r),a=(s=t[3].replace(/^\s+/,"").split(/\s+/),new m.Vector3(parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2])).multiplyScalar(i*r)),s=(s=t[4].replace(/^\s+/,"").split(/\s+/),new m.Vector3(parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2])).multiplyScalar(i*r)),i=n.x*(a.y*s.z-s.y*a.z)-a.x*(n.y*s.z-s.y*n.z)+s.x*(n.y*a.z-a.y*n.z),o=1/(Math.abs(i)/Math.pow(r,3)),i=(t.splice(0,8+e+1),t[0].replace(/^\s+/,"").replace(/\s+/g," ").split(" ")),e=Math.abs(parseFloat(i[0])),l=Math.abs(parseFloat(i[1])),i=Math.abs(parseFloat(i[2])),h=this.origin=new m.Vector3(0,0,0);this.size={x:e,y:l,z:i},this.unit=new m.Vector3(n.x,a.y,s.z),n=n.multiplyScalar(1/(r*e)),a=a.multiplyScalar(1/(r*l)),s=s.multiplyScalar(1/(r*i)),0==n.y&&0==n.z&&0==a.x&&0==a.z&&0==s.x&&0==s.y||(this.matrix=new m.Matrix4(n.x,a.x,s.x,0,n.y,a.y,s.y,0,n.z,a.z,s.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,(new m.Matrix4).makeTranslation(h.x,h.y,h.z)),this.origin=new m.Vector3(0,0,0),this.unit=new m.Vector3(1,1,1)),t.splice(0,1);for(var r=t.join(" ").replace(/^\s+/,"").split(/[\s\r]+/),c=(r.splice(e*l*i+1),Float32Array.from(r,parseFloat)),d=0;d<c.length;d++)c[d]=c[d]*o*.036749309;this.data=c},this.dx=function(e){for(var t,r=e.split(/[\n\r]+/),i=/gridpositions\s+counts\s+(\d+)\s+(\d+)\s+(\d+)/,s=/^origin\s+(\S+)\s+(\S+)\s+(\S+)/,n=/^delta\s+(\S+)\s+(\S+)\s+(\S+)/,a=/data follows/,o=0,o=0;o<r.length;o++){var l=r[o];if(t=i.exec(l)){var h=parseInt(t[1]),c=parseInt(t[2]),d=parseInt(t[3]);this.size={x:h,y:c,z:d}}else if(t=n.exec(l)){h=parseFloat(t[1]);if(0==parseFloat(t[2])&&0==parseFloat(t[3])||console.warn("Non-orthogonal delta matrix not currently supported in dx format"),l=r[o+=1],null==(t=n.exec(l)))return void console.error("Parse error in dx delta matrix");c=parseFloat(t[2]);if(0==parseFloat(t[1])&&0==parseFloat(t[3])||console.warn("Non-orthogonal delta matrix not currently supported in dx format"),l=r[o+=1],null==(t=n.exec(l)))return void console.error("Parse error in dx delta matrix");d=parseFloat(t[3]);0==parseFloat(t[1])&&0==parseFloat(t[2])||console.warn("Non-orthogonal delta matrix not currently supported in dx format"),this.unit=new m.Vector3(h,c,d)}else if(t=s.exec(l)){var u=parseFloat(t[1]),p=parseFloat(t[2]),f=parseFloat(t[3]);this.origin=new m.Vector3(u,p,f)}else if(t=a.exec(l))break}o+=1,this.size&&this.origin&&this.unit&&this.size?(e=r.splice(o).join(" ").split(/[\s\r]+/),this.data=Float32Array.from(e,parseFloat)):console.error("Error parsing dx format")},t=t.toLowerCase(),/\.gz$/.test(t)){t=t.replace(/\.gz$/,"");try{e=this[t]&&this.isbinary.has(t)?("string"==typeof e&&(e=(0,o.base64ToArray)(e)),(0,l.inflate)(e)):new TextDecoder("utf-8").decode((0,l.inflate)(e))}catch(e){console.error(e)}}if(this[t]&&(this.isbinary.has(t)&&"string"==typeof e&&(e=(0,o.base64ToArray)(e)),this[t](e)),r){if(r.negate)for(let e=0,t=this.data.length;e<t;e++)this.data[e]=-this.data[e];if(r.normalize){var i=0;for(let e=0,t=this.data.length;e<t;e++)i+=this.data[e];var s=i/this.data.length,i=0;for(let e=0,t=this.data.length;e<t;e++){var n=this.data[e]-s;i+=n*n}var a=i/this.data.length;for(let e=0,t=this.data.length;e<t;e++)this.data[e]=(this.data[e]-s)/a}}}getIndex(e,t,r){var i;return this.matrix?(null==this.inversematrix&&(this.inversematrix=(new m.Matrix4).getInverse(this.matrix)),e=(i=(i=new m.Vector3(e,t,r)).applyMatrix4(this.inversematrix)).x,t=i.y,r=i.z):(e-=this.origin.x,t-=this.origin.y,r-=this.origin.z,e/=this.unit.x,t/=this.unit.y,r/=this.unit.z),e=Math.round(e),t=Math.round(t),r=Math.round(r),e<0||e>=this.size.x||t<0||t>=this.size.y||r<0||r>=this.size.z?-1:e*this.size.y*this.size.z+t*this.size.z+r}getVal(e,t,r){e=this.getIndex(e,t,r);return e<0?0:this.data[e]}cube(e){var t,r,i=e.split(/\r?\n/);i.length<6||(e=(0,s.CUBE)(e,{}).modelData[0].cryst,r=i[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),r=parseFloat(r[0]),t=Math.abs(r),this.origin=e.origin,this.size=e.size,this.unit=e.unit,this.matrix=e.matrix4,e=6,r<0&&e++,r=i.splice(t+e).join(" ").replace(/^\s+/,"").split(/[\s\r]+/),this.data=Float32Array.from(r,parseFloat))}ccp4(e){var t={},r=(e=new Int8Array(e),new Int32Array(e.buffer,0,56)),i=new Float32Array(e.buffer,0,56),s=new DataView(e.buffer);if(t.MAP=String.fromCharCode(s.getUint8(208),s.getUint8(209),s.getUint8(210),s.getUint8(211)),t.MACHST=[s.getUint8(212),s.getUint8(213)],17===t.MACHST[0]&&17===t.MACHST[1])for(var n=e.byteLength,a=0;a<n;a+=4)s.setFloat32(a,s.getFloat32(a),!0);t.NX=r[0],t.NY=r[1],t.NZ=r[2],t.MODE=r[3],t.NXSTART=r[4],t.NYSTART=r[5],t.NZSTART=r[6],t.MX=r[7],t.MY=r[8],t.MZ=r[9],t.xlen=i[10],t.ylen=i[11],t.zlen=i[12],t.alpha=i[13],t.beta=i[14],t.gamma=i[15],t.MAPC=r[16],t.MAPR=r[17],t.MAPS=r[18],t.DMIN=i[19],t.DMAX=i[20],t.DMEAN=i[21],t.ISPG=r[22],t.NSYMBT=r[23],t.LSKFLG=r[24],t.originX=i[49],t.originY=i[50],t.originZ=i[51],t.ARMS=i[54];var r=t,i=[r.xlen,0,0],o=[r.ylen*Math.cos(Math.PI/180*r.gamma),r.ylen*Math.sin(Math.PI/180*r.gamma),0],l=[r.zlen*Math.cos(Math.PI/180*r.beta),r.zlen*(Math.cos(Math.PI/180*r.alpha)-Math.cos(Math.PI/180*r.gamma)*Math.cos(Math.PI/180*r.beta))/Math.sin(Math.PI/180*r.gamma),0],i=(l[2]=Math.sqrt(r.zlen*r.zlen*Math.sin(Math.PI/180*r.beta)*Math.sin(Math.PI/180*r.beta)-l[1]*l[1]),[0,i,o,l]),o=[0,r.MX,r.MY,r.MZ],l=[0,r.MAPC,r.MAPR,r.MAPS],h=(this.matrix=new m.Matrix4,this.matrix.set(i[l[1]][0]/o[l[1]],i[l[2]][0]/o[l[2]],i[l[3]][0]/o[l[3]],0,i[l[1]][1]/o[l[1]],i[l[2]][1]/o[l[2]],i[l[3]][1]/o[l[3]],0,i[l[1]][2]/o[l[1]],i[l[2]][2]/o[l[2]],i[l[3]][2]/o[l[3]],0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,(new m.Matrix4).makeTranslation(r.NXSTART+r.originX,r.NYSTART+r.originY,r.NZSTART+r.originZ)),this.origin=new m.Vector3(0,0,0),this.unit=new m.Vector3(1,1,1),this.size={x:t.NX,y:t.NY,z:t.NZ},this.dimensionorder=[t.MAPC,t.MAPR,t.MAPS],new Float32Array(e.buffer,1024+t.NSYMBT)),c=t.NX,d=t.NY,u=t.NZ;this.data=new Float32Array(c*d*u);for(let r=0;r<c;r++)for(let t=0;t<d;t++)for(let e=0;e<u;e++)this.data[(r*d+t)*u+e]=h[(e*d+t)*c+r]}}},"./src/VolumetricRender.ts":(e,t,r)=>{r.r(t),r.d(t,{GLVolumetricRender:()=>F});var M=r("./src/WebGL/shapes/index.ts"),z=r("./src/WebGL/math/index.ts"),s=r("./src/WebGL/index.ts"),T=r("./src/colors.ts"),E=r("./src/GLShape.ts");class F{static interpolateArray(e,t){var r=[],i=(e.length-1)/(t-1);r[0]=e[0];for(var s,n=1;n<t-1;n++){var a=n*i,o=Math.floor(a),l=Math.ceil(a);r[n]=(s=e[o],l=e[l],s+(l-s)*(a-o))}return r[t-1]=e[e.length-1],r}constructor(s,r,e){this.hidden=!1,this.boundingSphere=new M.Sphere,this.renderedShapeObj=null,this.shapeObj=null,this.subsamples=5,this.data=null,this.transferfunctionbuffer=[],this.min=0,this.max=0,r=r||{};var t,i,n,a,o,l,h,c,d,u,p=Object.assign([],r.transferfn);this.subsamples=r.subsamples||5;p.forEach(function(e){e.value=parseFloat(e.value)}),p.sort(function(e,t){return e.value-t.value}),this.min=p[0].value,0==p.length&&p.push(p[0]),this.max=p[p.length-1].value;for(let e=0;e<p.length-1;e++)if(n=T.CC.color(p[e].color),a=T.CC.color(p[e+1].color),d=p[e].opacity,u=p[e+1].opacity,(t=Math.floor(256*(p[e].value-this.min)/(this.max-this.min)))!=(i=Math.floor(256*(p[e+1].value-this.min)/(this.max-this.min)))){o=F.interpolateArray([255*n.r,255*a.r],i-t),l=F.interpolateArray([255*n.g,255*a.g],i-t),h=F.interpolateArray([255*n.b,255*a.b],i-t),c=F.interpolateArray([255*d,255*u],i-t);for(let e=0;e<o.length;e++)this.transferfunctionbuffer.push(o[e]),this.transferfunctionbuffer.push(l[e]),this.transferfunctionbuffer.push(h[e]),this.transferfunctionbuffer.push(c[e])}if(this.transferfunctionbuffer=new Uint8ClampedArray(this.transferfunctionbuffer),s.matrix){let e=new z.Vector3(0,0,0),t=new z.Vector3(s.size.x,s.size.y,s.size.z),r=new z.Vector3(1,1,1);e.applyMatrix4(s.matrix),t.applyMatrix4(s.matrix),r.applyMatrix4(s.matrix).sub(e),this.extent=[[e.x,e.y,e.z],[t.x,t.y,t.z]];for(let e=1;e<7;e++)t.x=1&e?s.size.x:0,t.y=2&e?s.size.y:0,t.z=4&e?s.size.z:0,t.applyMatrix4(s.matrix),this.extent[0][0]=Math.min(this.extent[0][0],t.x),this.extent[0][1]=Math.min(this.extent[0][1],t.y),this.extent[0][2]=Math.min(this.extent[0][2],t.z),this.extent[1][0]=Math.max(this.extent[1][0],t.x),this.extent[1][1]=Math.max(this.extent[1][1],t.y),this.extent[1][2]=Math.max(this.extent[1][2],t.z);var f=t.x-e.x,m=t.y-e.y,g=t.z-e.z;this.maxdepth=Math.sqrt(f*f+m*m+g*g),this.minunit=Math.min(Math.min(r.x,r.y),r.z),this.texmatrix=(new z.Matrix4).identity().scale({x:s.size.x,y:s.size.y,z:s.size.z}),this.texmatrix=this.texmatrix.multiplyMatrices(s.matrix,this.texmatrix),this.texmatrix=this.texmatrix.getInverse(this.texmatrix)}else{this.texmatrix=(new z.Matrix4).identity();f=s.unit.x*s.size.x,m=s.unit.y*s.size.y,g=s.unit.z*s.size.z;this.texmatrix.makeTranslation(-s.origin.x/f,-s.origin.y/m,-s.origin.z/g),this.texmatrix.scale({x:1/f,y:1/m,z:1/g}),this.minunit=Math.min(Math.min(s.unit.x,s.unit.y),s.unit.z),this.extent=[[s.origin.x,s.origin.y,s.origin.z],[s.origin.x+f,s.origin.y+m,s.origin.z+g]],this.maxdepth=Math.sqrt(f*f+m*m+g*g)}f=new E.GLShape({});if(f.addBox({corner:{x:this.extent[0][0],y:this.extent[0][1],z:this.extent[0][2]},dimensions:{w:this.extent[1][0]-this.extent[0][0],h:this.extent[1][1]-this.extent[0][1],d:this.extent[1][2]-this.extent[0][2]}}),this.geo=f.finalize(),this.boundingSphere.center=new z.Vector3((this.extent[0][0]+this.extent[1][0])/2,(this.extent[0][1]+this.extent[1][1])/2,(this.extent[0][2]+this.extent[1][2])/2),this.boundingSphere.radius=this.maxdepth/2,void 0===r.coords&&void 0!==r.selection&&(e?r.coords=e.selectedAtoms(r.selection):console.log("Need to provide viewer to volumetric renderer if selection specified.")),void 0!==r.coords&&void 0!==r.seldist){let i=new Uint8Array(s.data.length);var v=r.seldist,b=v*v;for(let e=0,t=r.coords.length;e<t;e++){var _=r.coords[e],y=_.x-v,x=_.y-v,w=_.z-v,A=_.x+v,S=_.y+v,C=_.z+v;if(0<=s.getIndex(y,x,w)||0<=s.getIndex(A,S,C))for(let r=y;r<A;r+=this.minunit)for(let t=x;t<S;t+=this.minunit)for(let e=w;e<C;e+=this.minunit){var L=s.getIndex(r,t,e);0<=L&&!i[L]&&(r-_.x)*(r-_.x)+(t-_.y)*(t-_.y)+(e-_.z)*(e-_.z)<b&&(i[L]=1)}}for(let e=0,t=s.data.length;e<t;e++)0==i[e]&&(s.data[e]=1/0)}this.data=s}globj(e){var t,r,i;this.renderedShapeObj&&(e.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.hidden||(this.shapeObj=new s.Object3D,r=new s.Texture(this.data,!(t=null)),i=new s.Texture(this.transferfunctionbuffer,!1),r.needsUpdate=!0,i.needsUpdate=!0,i.flipY=!1,t=new s.VolumetricMaterial({transferfn:i,transfermin:this.min,transfermax:this.max,map:r,extent:this.extent,maxdepth:this.maxdepth,texmatrix:this.texmatrix,unit:this.minunit,subsamples:this.subsamples}),i=new s.Mesh(this.geo,t),this.shapeObj.add(i),this.renderedShapeObj=this.shapeObj.clone(),e.add(this.renderedShapeObj))}removegl(e){this.renderedShapeObj&&(void 0!==this.renderedShapeObj.geometry&&this.renderedShapeObj.geometry.dispose(),void 0!==this.renderedShapeObj.material&&this.renderedShapeObj.material.dispose(),e.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}},"./src/WebGL/Camera.ts":(e,t,r)=>{r.r(t),r.d(t,{Camera:()=>i});var t=r("./src/WebGL/core/index.ts"),n=r("./src/WebGL/math/index.ts");class i extends t.Object3D{constructor(e=50,t=1,r=.1,i=2e3,s=!1){super(),this.projectionMatrix=new n.Matrix4,this.projectionMatrixInverse=new n.Matrix4,this.matrixWorldInverse=new n.Matrix4,this.fov=e,this.aspect=t,this.near=r,this.far=i;t=this.position.z;this.right=t*Math.tan(Math.PI/180*e),this.left=-this.right,this.top=this.right/this.aspect,this.bottom=-this.top,this.ortho=!!s,this.updateProjectionMatrix()}lookAt(e){this.matrix.lookAt(this.position,e,this.up),this.rotationAutoUpdate&&(!1===this.useQuaternion&&this.rotation instanceof n.Vector3?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):console.error("Unimplemented math operation."))}updateProjectionMatrix(){this.ortho?this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far):this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}},"./src/WebGL/Fog.ts":(e,t,r)=>{r.r(t),r.d(t,{Fog:()=>s});var i=r("./src/colors.ts");class s{constructor(e,t=1,r=1e3){this.name="",this.color=new i.Color(e),this.near=t,this.far=r}clone(){return new s(this.color.getHex(),this.near,this.far)}}},"./src/WebGL/Renderer.ts":(e,t,r)=>{r.r(t),r.d(t,{Renderer:()=>m});var u=r("./src/WebGL/Camera.ts"),s=r("./src/WebGL/constants/Sides.ts"),i=r("./src/WebGL/constants/TextureConstants.ts"),p=r("./src/WebGL/core/index.ts"),n=r("./src/colors.ts"),a=r("./src/WebGL/materials/index.ts"),o=r("./src/WebGL/math/index.ts"),h=r("./src/WebGL/objects/index.ts"),l=r("./src/WebGL/shaders/index.ts"),c=r("./src/WebGL/SpritePlugin.ts"),d=null,f=null;class m{constructor(e){this.context=null,this.devicePixelRatio=1,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this._offscreen=null,this._bitmap=null,this._programs=[],this._programs_counter=0,this._webglversion=1,this._currentProgram=null,this._currentMaterialId=-1,this._currentGeometryGroupHash=null,this._currentCamera=null,this._geometryGroupCounter=0,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldDepthTest=-1,this._oldDepthWrite=-1,this._oldPolygonOffset=null,this._oldLineWidth=null,this._viewportWidth=0,this._viewportHeight=0,this._currentWidth=0,this._currentHeight=0,this._enabledAttributes={},this._vector3=new o.Vector3,this._worldInverse=new o.Matrix4,this._projInverse=new o.Matrix4,this._textureMatrix=new o.Matrix4,this._fullProjModelMatrix=new o.Matrix4,this._fullProjModelMatrixInv=new o.Matrix4,this._direction=new o.Vector3,this._lightsNeedUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},this.sprites=new c.SpritePlugin,this._screenshader=null,this._AOshader=null,this._blurshader=null,this._vertexattribpos=null,this._aovertexattribpos=null,this._blurvertexattribpos=null,this._screenQuadVBO=null,this._fb=null,this._targetTexture=null,this._depthTexture=null,this._shadingTexture=null,this._scratchTexture=null,this._upscale=null,this._AOstrength=1,this._AOradius=5,this.SHADE_TEXTURE=3,this.row=(e=e||{}).row,this.col=e.col,this.rows=e.rows,this.cols=e.cols,this._canvas=void 0!==e.canvas?e.canvas:document.createElement("canvas"),this._precision=void 0!==e.precision?e.precision:"highp",this._alpha=void 0===e.alpha||e.alpha,this._premultipliedAlpha=void 0===e.premultipliedAlpha||e.premultipliedAlpha,this._antialias=void 0!==e.antialias&&e.antialias,this._upscale=void 0!==e.upscale?e.upscale:this._antialias,this._preserveDrawingBuffer=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,this._clearColor=void 0!==e.clearColor?new n.Color(e.clearColor):new n.Color(0),this._clearAlpha=void 0!==e.clearAlpha?e.clearAlpha:0,this._outlineMaterial=new a.MeshOutlineMaterial(e.outline),this._outlineSphereImposterMaterial=new a.SphereImposterOutlineMaterial(e.outline),this._outlineStickImposterMaterial=new a.StickImposterOutlineMaterial(e.outline),this._outlineEnabled=!!e.outline,this._AOEnabled=!!e.ambientOcclusion,e.ambientOcclusion&&void 0!==e.ambientOcclusion.strength&&(this._AOstrength=parseFloat(e.ambientOcclusion.strength)),0==this._AOstrength&&(this._AOEnabled=!1),e.ambientOcclusion&&void 0!==e.ambientOcclusion.radius&&(this._AOradius=parseFloat(e.ambientOcclusion.radius)),this.domElement=this._canvas,this._canvas.id=e.id,0!=e.containerWidth&&0!=e.containerHeight&&(this.initGL(),this.setDefaultGLState(),this.context=this._gl,this.isWebGL1()?this._extInstanced=this._gl.getExtension("ANGLE_instanced_arrays"):this._extInstanced={vertexAttribDivisorANGLE:this._gl.vertexAttribDivisor.bind(this._gl),drawElementsInstancedANGLE:this._gl.drawElementsInstanced.bind(this._gl)},this._extFragDepth=this._gl.getExtension("EXT_frag_depth"),this._extFloatLinear=this._gl.getExtension("OES_texture_float_linear"),this._extColorBufferFloat=this._gl.getExtension("EXT_color_buffer_float"),this.sprites.init(this))}supportedExtensions(){return{supportsAIA:Boolean(this._extInstanced),supportsImposters:Boolean(this._extFragDepth)||!this.isWebGL1(),regen:!1}}getContext(){return this._gl}getCanvas(){return this._canvas}isLost(){return null==this._gl||this._gl.isContextLost()}getPrecision(){return this._precision}setClearColorHex(e,t){this._clearColor.setHex(e),this._clearAlpha=t,this.isLost()||this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}enableOutline(e){this._outlineMaterial=new a.MeshOutlineMaterial(e),this._outlineSphereImposterMaterial=new a.SphereImposterOutlineMaterial(e),this._outlineStickImposterMaterial=new a.StickImposterOutlineMaterial(e),this._outlineEnabled=!0}disableOutline(){this._outlineEnabled=!1}enableAmbientOcclusion(e){e&&(e.strength&&(this._AOstrength=e.strength),e.scale&&(this._AOradius=e.scale)),this._AOEnabled=0<this._AOstrength}disableAmbientOcclusion(){this._AOEnabled=!1}setViewport(){var e,t;this._offscreen&&(this._offscreen.width=this._canvas.width,this._offscreen.height=this._canvas.height),null==this.rows||null==this.cols||null==this.row||null==this.col||this.isLost()||(e=this._gl.drawingBufferWidth/this.cols,t=this._gl.drawingBufferHeight/this.rows,this._viewportWidth=e,this._viewportHeight=t,this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(e*this.col,t*this.row,e,t),this._gl.viewport(e*this.col,t*this.row,e,t))}setSize(e,t){this.devicePixelRatio=void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this._upscale&&this.devicePixelRatio<2&&(this.devicePixelRatio=2),this._canvas.width=e*this.devicePixelRatio,this._canvas.height=t*this.devicePixelRatio,this._canvas.style.width=e+"px",this._canvas.style.height=t+"px",null!=this.rows&&null!=this.cols&&null!=this.row&&null!=this.col?(this.isLost()||(this._viewportWidth=this._gl.drawingBufferWidth/this.cols,this._viewportHeight=this._gl.drawingBufferHeight/this.rows),this.setViewport()):(this._viewportWidth=this._canvas.width,this._viewportHeight=this._canvas.height,this.isLost()||this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight)),this.initFrameBuffer()}clear(e,t,r){var i=0;void 0!==e&&!e||(i|=this._gl.COLOR_BUFFER_BIT),void 0!==t&&!t||(i|=this._gl.DEPTH_BUFFER_BIT),void 0!==r&&!r||(i|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(i)}setMaterialFaces(e,t){var r=e.side===s.DoubleSide,i=e.side===s.BackSide;e.imposter||(i=t?!i:i),this._oldDoubleSided!==r&&(r?this._gl.disable(this._gl.CULL_FACE):this._gl.enable(this._gl.CULL_FACE),this._oldDoubleSided=r),this._oldFlipSided!==i&&(i?this._gl.frontFace(this._gl.CW):this._gl.frontFace(this._gl.CCW),this._oldFlipSided=i),this._gl.cullFace(this._gl.BACK)}setDepthTest(e){this._oldDepthTest!==e&&(e?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),this._oldDepthTest=e)}setDepthWrite(e){this._oldDepthWrite!==e&&(this._gl.depthMask(e),this._oldDepthWrite=e)}setBlending(e){e?(this._gl.enable(this._gl.BLEND),this._gl.blendEquationSeparate(this._gl.FUNC_ADD,this._gl.FUNC_ADD),this._gl.blendFuncSeparate(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)):this._gl.disable(this._gl.BLEND)}initMaterial(e,t,r,i){var s;e.addEventListener("dispose",this.onMaterialDispose.bind(this)),(s=e.shaderID)&&(s=l.ShaderLib[s],e.vertexShader=s.vertexShader,e.fragmentShader=s.fragmentShader,e.uniforms=l.ShaderUtils.clone(s.uniforms),e.shaded&&e.makeShaded(this.SHADE_TEXTURE)),s={wireframe:e.wireframe,fragdepth:e.imposter,volumetric:e.volumetric,shaded:e.shaded},e.program=this.buildProgram(e.fragmentShader,e.vertexShader,e.uniforms,s)}renderBuffer(e,t,r,i,s,n){var a,o,l;!i.visible||(e=this.setProgram(e,t,r,i,n,this))&&(t=e.attributes,r=!1,l=i.wireframe?1:0,(e=16777215*s.id+2*e.id+l)!==this._currentGeometryGroupHash&&(this._currentGeometryGroupHash=e,r=!0),r&&(this.disableAttributes(),0<=t.position&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.__webglVertexBuffer),this.enableAttribute(t.position),this._gl.vertexAttribPointer(t.position,3,this._gl.FLOAT,!1,0,0)),0<=t.color&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.__webglColorBuffer),this.enableAttribute(t.color),this._gl.vertexAttribPointer(t.color,3,this._gl.FLOAT,!1,0,0)),0<=t.normal&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.__webglNormalBuffer),this.enableAttribute(t.normal),this._gl.vertexAttribPointer(t.normal,3,this._gl.FLOAT,!1,0,0)),0<=t.offset&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.__webglOffsetBuffer),this.enableAttribute(t.offset),this._gl.vertexAttribPointer(t.offset,3,this._gl.FLOAT,!1,0,0)),0<=t.radius&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.__webglRadiusBuffer),this.enableAttribute(t.radius),this._gl.vertexAttribPointer(t.radius,1,this._gl.FLOAT,!1,0,0))),n instanceof h.Mesh?("instanced"===i.shaderID?(l=i.sphere.geometryGroups[0],r&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,l.vertexArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,s.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,l.normalArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,s.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,l.faceArray,this._gl.STATIC_DRAW)),a=l.faceidx,this._extInstanced.vertexAttribDivisorANGLE(t.offset,1),this._extInstanced.vertexAttribDivisorANGLE(t.radius,1),this._extInstanced.vertexAttribDivisorANGLE(t.color,1),this._extInstanced.drawElementsInstancedANGLE(this._gl.TRIANGLES,a,this._gl.UNSIGNED_SHORT,0,s.radiusArray.length),this._extInstanced.vertexAttribDivisorANGLE(t.offset,0),this._extInstanced.vertexAttribDivisorANGLE(t.radius,0),this._extInstanced.vertexAttribDivisorANGLE(t.color,0)):i.wireframe?(o=s.lineidx,this.setLineWidth(i.wireframeLinewidth),r&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,s.__webglLineBuffer),this._gl.drawElements(this._gl.LINES,o,this._gl.UNSIGNED_SHORT,0)):(a=s.faceidx,r&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,s.__webglFaceBuffer),this._gl.drawElements(this._gl.TRIANGLES,a,this._gl.UNSIGNED_SHORT,0)),this.info.render.calls++,this.info.render.vertices+=a,this.info.render.faces+=a/3):n instanceof h.Line&&(o=s.vertices,this.setLineWidth(i.linewidth),this._gl.drawArrays(this._gl.LINES,0,o),this.info.render.calls++))}clearShading(){this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this.clear(!1,!0,!1),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}setShading(r,e,i){var t=r.__lights,s=r.fog;let n=[];for(let e=0,t=r.__webglObjects.length;e<t;e++){var a=r.__webglObjects[e];a.render&&a[i]&&n.push(a)}0!=n.length&&(this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,null,0),this.renderObjects(r.__webglObjects,!0,i+"Depth",e,t,s,!1),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._scratchTexture,0),this.clear(!1,!0,!1),this._gl.useProgram(this._AOshader),this._currentProgram=this._AOshader,this.setDepthTest(-1),this.setDepthWrite(-1),t=this._AOshader.uniforms,this._gl.uniform1f(t.total_strength,this._AOstrength),this._gl.uniform1f(t.radius,this._AOradius),this._fullProjModelMatrix=new o.Matrix4,this._fullProjModelMatrixInv=new o.Matrix4,s=n[0].object,this._fullProjModelMatrix.multiplyMatrices(e.projectionMatrix,s._modelViewMatrix),this._fullProjModelMatrixInv.getInverse(this._fullProjModelMatrix),this._gl.uniformMatrix4fv(t.projectionMatrix,!1,this._fullProjModelMatrix.elements),this._gl.uniformMatrix4fv(t.projinv,!1,this._fullProjModelMatrixInv.elements),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._aovertexattribpos),this._gl.vertexAttribPointer(this._aovertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this.clear(!1,!0,!1),this._gl.useProgram(this._blurshader),this._currentProgram=this._blurshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._blurvertexattribpos),this._gl.vertexAttribPointer(this._blurvertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._scratchTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0))}render(r,i){if(i instanceof u.Camera==!1)console.error("Renderer.render: camera is not an instance of Camera.");else{var s,n,a,o,l,h=r.__lights,c=r.fog;if(this._currentMaterialId=-1,this._lightsNeedUpdate=!0,this.autoUpdateScene&&r.updateMatrixWorld(),void 0===i.parent&&i.updateMatrixWorld(),i.matrixWorldInverse.getInverse(i.matrixWorld),!this.isLost()){this.autoUpdateObjects&&this.initWebGLObjects(r),this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this._currentWidth=this._viewportWidth,this._currentHeight=this._viewportHeight,this.setViewport(),this.setFrameBuffer(),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.clear(!0,!0,!0),l=r.__webglObjects;let e=!1,t=this._AOEnabled;for(s=0,n=l.length;s<n;s++)o=(a=l[s]).object,a.render=!1,o.visible&&(this.setupMatrices(o,i),this.unrollBufferMaterial(a),a.render=!0,a.volumetric&&(e=!0),a.hasAO&&(t=!0));if(this.setBlending(!1),t&&this.setShading(r,i,"opaque"),this.renderObjects(r.__webglObjects,!0,"opaque",i,h,c,!1),t&&this.clearShading(),this.renderSprites(r,i,!1),this.renderObjects(r.__webglObjects,!0,"transparentDepth",i,h,c,!0),this.renderObjects(r.__webglObjects,!1,"transparent",i,h,c,!0),e&&this._fb&&(this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,null,0),this.renderObjects(r.__webglObjects,!1,"volumetric",i,h,c,!0)),this.renderFrameBuffertoScreen(),this.setDepthTest(!0),this.setDepthWrite(!0),this.renderSprites(r,i,!0),this._bitmap){const d=this._offscreen.transferToImageBitmap();this._bitmap.transferFromImageBitmap(d),d.close()}}}}setFrameBuffer(){var e,t;!this.isWebGL1()&&this._fb&&(e=this._viewportWidth,t=this._viewportHeight,this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,e,t),this._gl.viewport(0,0,e,t),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,e,t,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,e,t,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._shadingTexture&&(this._gl.deleteTexture(this._shadingTexture),this._shadingTexture=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,e,t,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.deleteTexture(this._scratchTexture),this._scratchTexture=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._scratchTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,e,t,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE)),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fb),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this._gl.clearDepth(1),this._gl.clear(this._gl.DEPTH_BUFFER_BIT),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0))}initFrameBuffer(){var e,t;this.isWebGL1()||(t=this._viewportWidth,e=this._viewportHeight,this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,t,e),this._gl.viewport(0,0,t,e),this._targetTexture=this._gl.createTexture(),this._depthTexture=this._gl.createTexture(),this._shadingTexture=this._gl.createTexture(),this._scratchTexture=this._gl.createTexture(),this._fb=this._gl.createFramebuffer(),t=this._antialias?l.ShaderLib.screenaa:l.ShaderLib.screen,this._screenshader=this.buildProgram(t.fragmentShader,t.vertexShader,t.uniforms,{}),this._vertexattribpos=this._gl.getAttribLocation(this._screenshader,"vertexPosition"),this._screenQuadVBO=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),this._gl.STATIC_DRAW),e=l.ShaderLib.ssao,this._AOshader=this.buildProgram(e.fragmentShader,e.vertexShader,e.uniforms,{}),this._aovertexattribpos=this._gl.getAttribLocation(this._AOshader,"vertexPosition"),t=l.ShaderLib.blur,this._blurshader=this.buildProgram(t.fragmentShader,t.vertexShader,t.uniforms,{}),this._blurvertexattribpos=this._gl.getAttribLocation(this._blurshader,"vertexPosition"))}renderFrameBuffertoScreen(){this.isWebGL1()||null===this._fb||(this.setViewport(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.useProgram(this._screenshader),this._currentProgram=this._screenshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._vertexattribpos),this._gl.vertexAttribPointer(this._vertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6))}initWebGLObjects(e){if(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]),e.__objectsAdded.length){for(;e.__objectsAdded.length;)this.addObject(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);this._currentGeometryGroupHash=-1}for(;e.__objectsRemoved.length;)this.removeObject(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,r=e.__webglObjects.length;t<r;t++)this.updateObject(e.__webglObjects[t].object)}getYRatio(){return void 0!==this.rows&&void 0!==this.row?this.rows:1}getXRatio(){return void 0!==this.cols&&void 0!==this.col?this.cols:1}getAspect(e,t){null!=e&&null!=t||(e=this._canvas.width,t=this._canvas.height);var r=e/t;return r=null!=this.rows&&null!=this.cols&&null!=this.row&&null!=this.col?e/this.cols/(t/this.rows):r}setTexture(e,t,r){var i,s,n,a,o;e.needsUpdate?(e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",this.onTextureDispose.bind(this)),e.__webglTexture=this._gl.createTexture(),this.info.memory.textures++),this._gl.activeTexture(this._gl.TEXTURE0+t),i=r?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D,this._gl.bindTexture(i,e.__webglTexture),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e.flipY),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,e.unpackAlignment),this._gl.pixelStorei(this._gl.PACK_ALIGNMENT,e.unpackAlignment),i=this.paramToGL(e.format),s=this.paramToGL(e.type),r?(this.setTextureParameters(this._gl.TEXTURE_3D,e),this._gl.texImage3D(this._gl.TEXTURE_3D,0,this._gl.R32F,e.image.size.z,e.image.size.y,e.image.size.x,0,this._gl.RED,this._gl.FLOAT,e.image.data)):(a=(n=e.image).width,o=n.height,void 0===a&&(a=n.length,i==this._gl.RGBA&&(a/=4),o=1),this.setTextureParameters(this._gl.TEXTURE_2D,e),this.isWebGL1()?this._gl.texImage2D(this._gl.TEXTURE_2D,0,i,i,s,e.image):this._gl.texImage2D(this._gl.TEXTURE_2D,0,i,a,o,0,i,s,e.image)),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()):(this._gl.activeTexture(this._gl.TEXTURE0+t),r?this._gl.bindTexture(this._gl.TEXTURE_3D,e.__webglTexture):this._gl.bindTexture(this._gl.TEXTURE_2D,e.__webglTexture))}supportsVolumetric(){return!this.isWebGL1()}enableAttribute(e){this._enabledAttributes[e]||(this._gl.enableVertexAttribArray(e),this._enabledAttributes[e]=!0)}disableAttributes(){for(var e in this._enabledAttributes)this._enabledAttributes[e]&&(this._gl.disableVertexAttribArray(e),this._enabledAttributes[e]=!1)}setPolygonOffset(e,t,r){this._oldPolygonOffset!==e&&(e?this._gl.enable(this._gl.POLYGON_OFFSET_FILL):this._gl.disable(this._gl.POLYGON_OFFSET_FILL))}setLineWidth(e){e!==this._oldLineWidth&&(this._gl.lineWidth(e),this._oldLineWidth=e)}deallocateGeometry(e){if((e.__webglInit=void 0)!==e.__webglVertexBuffer&&this._gl.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglColorBuffer&&this._gl.deleteBuffer(e.__webglColorBuffer),void 0!==e.geometryGroups)for(var t=0,r=e.groups;t<r;t++){var i=e.geometryGroups[t];void 0!==i.__webglVertexBuffer&&this._gl.deleteBuffer(i.__webglVertexBuffer),void 0!==i.__webglColorBuffer&&this._gl.deleteBuffer(i.__webglColorBuffer),void 0!==i.__webglNormalBuffer&&this._gl.deleteBuffer(i.__webglNormalBuffer),void 0!==i.__webglFaceBuffer&&this._gl.deleteBuffer(i.__webglFaceBuffer),void 0!==i.__webglLineBuffer&&this._gl.deleteBuffer(i.__webglLineBuffer)}}deallocateMaterial(e){var t=e.program;if(void 0!==t){e.program=void 0;var r,i=!1;for(n=0,a=this._programs.length;n<a;n++)if((r=this._programs[n]).program===t){r.usedTimes--,0===r.usedTimes&&(i=!0);break}if(!0===i){for(var s=[],n=0,a=this._programs.length;n<a;n++)(r=this._programs[n]).program!==t&&s.push(r);this._programs=s,this._gl.deleteProgram(t),this.info.memory.programs--}}}deallocateTexture(e){e.image&&e.image.__webglTextureCube?this._gl.deleteTexture(e.image.__webglTextureCube):e.__webglInit&&(e.__webglInit=!1,this._gl.deleteTexture(e.__webglTexture))}onGeometryDispose(e){e=e.target;e.removeEventListener("dispose",this.onGeometryDispose),this.deallocateGeometry(e),this.info.memory.geometries--}onTextureDispose(e){e=e.target;e.removeEventListener("dispose",this.onTextureDispose),this.deallocateTexture(e),this.info.memory.textures--}onMaterialDispose(e){e=e.target;e.removeEventListener("dispose",this.onMaterialDispose),this.deallocateMaterial(e)}getShader(e,t){var r;return this.isWebGL1()||t.startsWith("#version")||(t=t.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),t="#version 300 es\n"+(t=(t=(t=(t=(t="fragment"==e?t.replace(/varying/g,"in"):t.replace(/varying/g,"out")).replace(/attribute/g,"in")).replace(/texture2D/g,"texture")).replace(/\/\/DEFINEFRAGCOLOR/g,"out vec4 glFragColor;")).replace(/gl_FragColor/g,"glFragColor"))),"fragment"===e?r=this._gl.createShader(this._gl.FRAGMENT_SHADER):"vertex"===e&&(r=this._gl.createShader(this._gl.VERTEX_SHADER)),null==r?null:(this._gl.shaderSource(r,t),this._gl.compileShader(r),this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS)?r:(console.error(this._gl.getShaderInfoLog(r)),console.error("could not initialize shader"),null))}buildProgram(e,t,r,i){var s,n,a,o,l=[];for(s in l.push(e),l.push(t),i)l.push(s),l.push(i[s]);for(o=l.join(),s=0,n=this._programs.length;s<n;s++){var h=this._programs[s];if(h.code===o)return h.usedTimes++,h.program}if(this.isWebGL1()&&i.volumetric)throw new Error("Volumetric rendering requires webgl2 which is not supported by your hardware.");if(null==(a=this._gl.createProgram()))return null;var c,d,u,p="precision "+this._precision+" float;",f=[i.volumetric?"#version 300 es":"",p].join("\n"),p=[i.volumetric?"#version 300 es":"",i.fragdepth&&this.isWebGL1()?"#extension GL_EXT_frag_depth: enable":"",i.shaded?"#define SHADED 1":"",i.wireframe?"#define WIREFRAME 1":"",p].join("\n"),p=this.getShader("fragment",p+e),e=this.getShader("vertex",f+t);for(d in null!=e&&this._gl.attachShader(a,e),null!=p&&this._gl.attachShader(a,p),this._gl.linkProgram(a),this._gl.getProgramParameter(a,this._gl.LINK_STATUS)||console.error("Could not initialize shader"),a.uniforms={},a.attributes={},c=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","vWidth","vHeight"],r)c.push(d);for(u=0;u<c.length;u++){var m=c[u];a.uniforms[m]=this._gl.getUniformLocation(a,m)}for(c=["position","normal","color","lineDistance","offset","radius"],u=0;u<c.length;u++){var g=c[u];a.attributes[g]=this._gl.getAttribLocation(a,g)}return a.id=this._programs_counter++,this._programs.push({program:a,code:o,usedTimes:1}),this.info.memory.programs=this._programs.length,a}setProgram(e,t,r,i,s,n){if(i.needsUpdate&&(i.program&&this.deallocateMaterial(i),this.initMaterial(i,t,r,s),i.needsUpdate=!1),null==i.program)return null;var a=!1,o=i.program,l=o.uniforms,h=i.uniforms;return o!=this._currentProgram&&(this._gl.useProgram(o),this._currentProgram=o,a=!0),i.id!=this._currentMaterialId&&(this._currentMaterialId=i.id,a=!0),e!=this._currentCamera&&(this._currentCamera=e,a=!0),l.projectionMatrix&&this._gl.uniformMatrix4fv(l.projectionMatrix,!1,e.projectionMatrix.elements),l.modelViewMatrix&&this._gl.uniformMatrix4fv(l.modelViewMatrix,!1,s._modelViewMatrix.elements),l.normalMatrix&&this._gl.uniformMatrix3fv(l.normalMatrix,!1,s._normalMatrix.elements),l.projinv&&(this._projInverse.getInverse(e.projectionMatrix),this._gl.uniformMatrix4fv(l.projinv,!1,this._projInverse.elements)),l.viewMatrix&&this._gl.uniformMatrix4fv(l.viewMatrix,!1,e.matrixWorldInverse.elements),l.vWidth&&this._gl.uniform1f(l.vWidth,this._viewportWidth),l.vHeight&&this._gl.uniform1f(l.vHeight,this._viewportHeight),a&&(h.fogColor.value=r.color,h.fogNear.value=r.near,h.fogFar.value=r.far,i.shaderID.startsWith("lambert")||"instanced"===i.shaderID||i.shaderID.endsWith("imposter")?(this._lightsNeedUpdate&&(this.setupLights(o,t),this._lightsNeedUpdate=!1),h.directionalLightColor.value=this._lights.directional.colors,h.directionalLightDirection.value=this._lights.directional.positions):i.shaderID.endsWith("outline")?(h.outlineColor.value=i.outlineColor,h.outlineWidth.value=i.outlineWidth,h.outlinePushback.value=i.outlinePushback,h.outlineMaxPixels.value=i.outlineMaxPixels*this.devicePixelRatio):"volumetric"===i.shaderID&&(s._modelViewMatrix.getScale(this._direction),this._worldInverse.getInverse(s._modelViewMatrix),this._projInverse.getInverse(e.projectionMatrix),this._textureMatrix.multiplyMatrices(s.material.texmatrix,this._worldInverse),this._gl.uniformMatrix4fv(l.textmat,!1,this._textureMatrix.elements),this._gl.uniformMatrix4fv(l.projinv,!1,this._projInverse.elements),a=Math.min(Math.min(this._direction.x,this._direction.y),this._direction.z),h.step.value=s.material.unit*a,h.maxdepth.value=s.material.maxdepth*a,h.transfermax.value=s.material.transfermax,h.transfermin.value=s.material.transfermin,h.subsamples.value=s.material.subsamples,n.setTexture(s.material.transferfn,4,!1),n.setTexture(s.material.map,3,!0),this._gl.activeTexture(this._gl.TEXTURE5),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture)),h.opacity.value=i.opacity,this.loadMaterialUniforms(l,h)),h.shading&&(3==h.shading.value?(this._gl.activeTexture(this._gl.TEXTURE0+this.SHADE_TEXTURE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture)):console.error("Invalid shading textures.")),o}loadMaterialUniforms(e,t){var r,i,s,n;for(r in t)e[r]&&(i=t[r].type,s=t[r].value,n=e[r],"f"===i?this._gl.uniform1f(n,s):"i"===i?this._gl.uniform1i(n,s):"fv"===i?this._gl.uniform3fv(n,s):"c"===i?this._gl.uniform3f(n,s.r,s.g,s.b):"f4"===i&&this._gl.uniform4f(n,s[0],s[1],s[2],s[3]))}addObject(e,t){var r,i,s,n;if(!e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new o.Matrix4,e._normalMatrix=new o.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",this.onGeometryDispose.bind(this))),e instanceof h.Mesh||e instanceof h.Line))for(r=0,i=(s=e.geometry).geometryGroups.length;r<i;r++)(n=s.geometryGroups[r]).id=this._geometryGroupCounter++,n.__webglVertexBuffer||(e instanceof h.Mesh?(this.createMeshBuffers(n),s.elementsNeedUpdate=!0,s.normalsNeedUpdate=!0):e instanceof h.Line&&this.createLineBuffers(n),s.verticesNeedUpdate=!0,s.colorsNeedUpdate=!0);if(!e.__webglActive){if(e instanceof h.Mesh||e instanceof h.Line)for(r=0,i=(s=e.geometry).geometryGroups.length;r<i;r++)n=s.geometryGroups[r],this.addBuffer(t.__webglObjects,n,e);else e instanceof h.Sprite&&t.__webglSprites.push(e);e.__webglActive=!0}}updateObject(e){var t,r=e.geometry;if(e instanceof h.Mesh||e instanceof h.Line){for(var i=0,s=r.geometryGroups.length;i<s;i++)t=r.geometryGroups[i],(r.verticesNeedUpdate||r.elementsNeedUpdate||r.colorsNeedUpdate||r.normalsNeedUpdate)&&this.setBuffers(t,this._gl.STATIC_DRAW);r.verticesNeedUpdate=!1,r.elementsNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.buffersNeedUpdate=!1}}removeObject(e,t){e instanceof h.Mesh||e instanceof h.Line?this.removeInstances(t.__webglObjects,e):e instanceof h.Sprite&&this.removeInstancesDirect(t.__webglSprites,e),e.__webglActive=!1}removeInstances(e,t){for(var r=e.length-1;0<=r;--r)e[r].object===t&&e.splice(r,1)}removeInstancesDirect(e,t){for(var r=e.length-1;0<=r;--r)e[r]===t&&e.splice(r,1)}unrollBufferMaterial(t){var r=t.object.material;if(r.volumetric)t.opaque=null,t.transparent=null,t.volumetric=r;else if(r.transparent){if(t.opaque=null,t.volumetric=null,!(t.transparent=r).wireframe){let e=r.clone();e.opacity=0,t.transparentDepth=e}}else{if(t.opaque=r,t.transparent=null,t.volumetric=null,!r.wireframe){let e=r.clone();e.opacity=0,t.opaqueDepth=e}r.hasAO&&(t.hasAO=!0),(this._AOEnabled||t.hasAO)&&(t.opaqueShaded=r.clone(),t.opaqueShaded.shaded=!0)}}setBuffers(e,t){var r=e.vertexArray,i=e.colorArray;void 0!==e.__webglOffsetBuffer?this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e.__webglOffsetBuffer):this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,r,t),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e.__webglColorBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,i,t),e.normalArray&&void 0!==e.__webglNormalBuffer&&(r=e.normalArray,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,r,t)),e.radiusArray&&void 0!==e.__webglRadiusBuffer&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e.__webglRadiusBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,e.radiusArray,t)),e.faceArray&&void 0!==e.__webglFaceBuffer&&(i=e.faceArray,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,t)),e.lineArray&&void 0!==e.__webglLineBuffer&&(r=e.lineArray,this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,t))}createMeshBuffers(e){e.radiusArray&&(e.__webglRadiusBuffer=this._gl.createBuffer()),e.useOffset&&(e.__webglOffsetBuffer=this._gl.createBuffer()),e.__webglVertexBuffer=this._gl.createBuffer(),e.__webglNormalBuffer=this._gl.createBuffer(),e.__webglColorBuffer=this._gl.createBuffer(),e.__webglFaceBuffer=this._gl.createBuffer(),e.__webglLineBuffer=this._gl.createBuffer(),this.info.memory.geometries++}createLineBuffers(e){e.__webglVertexBuffer=this._gl.createBuffer(),e.__webglColorBuffer=this._gl.createBuffer(),this.info.memory.geometries++}addBuffer(e,t,r){e.push({buffer:t,object:r,opaque:null,transparent:null})}setupMatrices(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getInverse(e._modelViewMatrix),e._normalMatrix.transpose()}filterFallback(e){return this._gl.LINEAR}setTextureParameters(e,t){e==this._gl.TEXTURE_2D?(this._gl.texParameteri(e,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(e,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(e,this._gl.TEXTURE_MAG_FILTER,this.filterFallback(t.magFilter)),this._gl.texParameteri(e,this._gl.TEXTURE_MIN_FILTER,this.filterFallback(t.minFilter))):(this._gl.texParameteri(e,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(e,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(e,this._gl.TEXTURE_WRAP_R,this._gl.CLAMP_TO_EDGE),this._extColorBufferFloat&&this._extFloatLinear?(this._gl.texParameteri(e,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(e,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR)):(this._gl.texParameteri(e,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(e,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST)))}paramToGL(e){return e===i.UnsignedByteType?this._gl.UNSIGNED_BYTE:e===i.RGBAFormat?this._gl.RGBA:e===i.NearestFilter?this._gl.NEAREST:0}setupLights(e,t){for(var r,i,s,n=this._lights,a=n.directional.colors,o=n.directional.positions,l=0,h=0,c=0,d=t.length;c<d;c++)i=(r=t[c]).color,s=r.intensity,r instanceof p.Light&&(this._direction.getPositionFromMatrix(r.matrixWorld),this._vector3.getPositionFromMatrix(r.target.matrixWorld),this._direction.sub(this._vector3),this._direction.normalize(),0===this._direction.x&&0===this._direction.y&&0===this._direction.z||(o[h]=this._direction.x,o[h+1]=this._direction.y,o[h+2]=this._direction.z,a[h]=i.r*s,a[h+1]=i.g*s,a[h+2]=i.b*s,h+=3,l++));n.ambient[0]=0,n.ambient[1]=0,n.ambient[2]=0,n.directional.length=l}initGL(){try{if(!OffscreenCanvas||null!=this.rows&&null!=this.cols&&null!=this.row&&null!=this.col){if(!(this._gl=this._canvas.getContext("webgl2",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("experimental-webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer})))throw"Error creating WebGL context."}else null!=f&&!f.isContextLost()||(d=new OffscreenCanvas(this._canvas.width,this._canvas.height),f=d.getContext("webgl2",{alpha:!0,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer})),this._offscreen=d,this._gl=f,this._bitmap=this._canvas.getContext("bitmaprenderer",{alpha:!0});var e=this._gl.getParameter(this._gl.VERSION);this._webglversion=parseInt(e[6])}catch(e){console.error(e)}}isWebGL1(){return 1==this._webglversion}setDefaultGLState(){this._gl.clearDepth(1),this._gl.clearStencil(0),this._gl.enable(this._gl.DEPTH_TEST),this._gl.depthFunc(this._gl.LEQUAL),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.CULL_FACE),this._gl.enable(this._gl.BLEND),this._gl.blendEquation(this._gl.FUNC_ADD),this._gl.blendFunc(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}renderObjects(e,t,r,i,s,n,a){for(var o,l,h,c,d,u=t?(c=e.length-1,d=-1):(c=0,d=e.length,1),p=c;p!==d;p+=u)if((f=e[p]).render&&(o=f.object,l=f.buffer,h=f[r],h=(f.hasAO||this._AOEnabled)&&f[r+"Shaded"]?f[r+"Shaded"]:h)){this.setBlending(a),this.setDepthTest(h.depthTest),this.setDepthWrite(h.depthWrite),this.setPolygonOffset(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits);var f=o._modelViewMatrix.isReflected();if(this.setMaterialFaces(h,f),this.renderBuffer(i,s,n,h,l,o),(this._outlineEnabled||h.outline)&&!h.wireframe&&"basic"!==h.shaderID&&0!==h.opacity){let e=this._outlineMaterial;"sphereimposter"==h.shaderID?e=this._outlineSphereImposterMaterial:"stickimposter"==h.shaderID&&(e=this._outlineStickImposterMaterial),this.renderBuffer(i,s,n,e,l,o)}}}renderSprites(e,t,r){this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1,this._lightsNeedUpdate=!0,this.sprites.render(e,t,this._currentWidth,this._currentHeight,r),this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1}}},"./src/WebGL/SpritePlugin.ts":(e,t,r)=>{r.r(t),r.d(t,{SpritePlugin:()=>s});var i=r("./src/WebGL/shaders/index.ts");class s{constructor(){this.sprite={vertices:null,faces:null,vertexBuffer:null,elementBuffer:null,program:null,attributes:{},uniforms:null}}init(e){this.gl=e.context,this.renderer=e,this.precision=e.getPrecision(),this.sprite.vertices=new Float32Array(16),this.sprite.faces=new Uint16Array(6);e=0;this.sprite.vertices[e++]=-1,this.sprite.vertices[e++]=-1,this.sprite.vertices[e++]=0,this.sprite.vertices[e++]=0,this.sprite.vertices[e++]=1,this.sprite.vertices[e++]=-1,this.sprite.vertices[e++]=1,this.sprite.vertices[e++]=0,this.sprite.vertices[e++]=1,this.sprite.vertices[e++]=1,this.sprite.vertices[e++]=1,this.sprite.vertices[e++]=1,this.sprite.vertices[e++]=-1,this.sprite.vertices[e++]=1,this.sprite.vertices[e++]=0,this.sprite.vertices[+e]=1,e=0,this.sprite.faces[e++]=0,this.sprite.faces[e++]=1,this.sprite.faces[e++]=2,this.sprite.faces[e++]=0,this.sprite.faces[+e]=2,this.sprite.faces[5]=3,this.sprite.vertexBuffer=this.gl.createBuffer(),this.sprite.elementBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.sprite.vertices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.faces,this.gl.STATIC_DRAW),this.sprite.program=this.createProgram(i.ShaderLib.sprite,this.precision||1),this.sprite.attributes={};const t={};this.sprite.attributes.position=this.gl.getAttribLocation(this.sprite.program,"position"),this.sprite.attributes.uv=this.gl.getAttribLocation(this.sprite.program,"uv"),t.uvOffset=this.gl.getUniformLocation(this.sprite.program,"uvOffset"),t.uvScale=this.gl.getUniformLocation(this.sprite.program,"uvScale"),t.rotation=this.gl.getUniformLocation(this.sprite.program,"rotation"),t.scale=this.gl.getUniformLocation(this.sprite.program,"scale"),t.alignment=this.gl.getUniformLocation(this.sprite.program,"alignment"),t.color=this.gl.getUniformLocation(this.sprite.program,"color"),t.map=this.gl.getUniformLocation(this.sprite.program,"map"),t.opacity=this.gl.getUniformLocation(this.sprite.program,"opacity"),t.useScreenCoordinates=this.gl.getUniformLocation(this.sprite.program,"useScreenCoordinates"),t.screenPosition=this.gl.getUniformLocation(this.sprite.program,"screenPosition"),t.modelViewMatrix=this.gl.getUniformLocation(this.sprite.program,"modelViewMatrix"),t.projectionMatrix=this.gl.getUniformLocation(this.sprite.program,"projectionMatrix"),t.fogNear=this.gl.getUniformLocation(this.sprite.program,"fogNear"),t.fogFar=this.gl.getUniformLocation(this.sprite.program,"fogFar"),t.fogColor=this.gl.getUniformLocation(this.sprite.program,"fogColor"),t.alphaTest=this.gl.getUniformLocation(this.sprite.program,"alphaTest"),this.sprite.uniforms=t}render(e,t,n,a,o){if(!this.gl)throw new Error("WebGLRenderer not initialized");let l=[];null!=(c=null==e?void 0:e.__webglSprites)&&c.forEach(e=>{(o&&0==e.material.depthTest||!o&&e.material.depthTest)&&l.push(e)});var h=l.length;if(h){var c=this.sprite.attributes,d=this.sprite.uniforms;if(!d)throw new Error("Uniforms not defined");var u,p,f=.5*n,m=.5*a,c=(this.gl.useProgram(this.sprite.program),this.gl.enableVertexAttribArray(c.position),this.gl.enableVertexAttribArray(c.uv),this.gl.disable(this.gl.CULL_FACE),this.gl.enable(this.gl.BLEND),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.vertexAttribPointer(c.position,2,this.gl.FLOAT,!1,16,0),this.gl.vertexAttribPointer(c.uv,2,this.gl.FLOAT,!1,16,8),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.uniformMatrix4fv(d.projectionMatrix,!1,t.projectionMatrix.elements),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.uniform1i(d.map,0),e.fog);c?(this.gl.uniform3f(d.fogColor,c.color.r,c.color.g,c.color.b),this.gl.uniform1f(d.fogNear,c.near),this.gl.uniform1f(d.fogFar,c.far)):(this.gl.uniform1f(d.fogNear,0),this.gl.uniform1f(d.fogFar,0));let r,i,s=[];for(u=0;u<h;u++)r=l[u],(i=r.material)&&(0!=i.depthTest||o)&&r.visible&&0!==i.opacity&&(i.useScreenCoordinates?r.z=-r.position.z:(r._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,r.matrixWorld),r.z=-r._modelViewMatrix.elements[14]));for(l.sort(b),u=0;u<h;u++)if(r=l[u],(i=r.material)&&r.visible&&0!==i.opacity&&i.map&&i.map.image&&i.map.image.width){this.gl.uniform1f((null==d?void 0:d.alphaTest)||null,i.alphaTest);var g=i.map.image.width,v=i.map.image.height;s[0]=g*this.renderer.devicePixelRatio/n,s[1]=v*this.renderer.devicePixelRatio/a,!0===i.useScreenCoordinates?(this.gl.uniform1i(d.useScreenCoordinates,1),this.gl.uniform3f(d.screenPosition,(r.position.x*this.renderer.devicePixelRatio-f)/f,(m-r.position.y*this.renderer.devicePixelRatio)/m,Math.max(0,Math.min(1,r.position.z)))):(this.gl.uniform1i(d.useScreenCoordinates,0),this.gl.uniformMatrix4fv(d.modelViewMatrix,!1,r._modelViewMatrix.elements)),p=1/(i.scaleByViewport?a:1),s[0]*=p*r.scale.x,s[1]*=p*r.scale.y;let e=null==(p=null===i||void 0===i?void 0:i.alignment)?void 0:p.x,t=null==(p=null===i||void 0===i?void 0:i.alignment)?void 0:p.y;i.screenOffset&&(e=(e||0)+2*i.screenOffset.x/g,t=(t||0)+2*i.screenOffset.y/v),this.gl.uniform2f(d.uvScale,(null==(p=null===i||void 0===i?void 0:i.uvScale)?void 0:p.x)||1,(null==(g=null===i||void 0===i?void 0:i.uvScale)?void 0:g.y)||1),this.gl.uniform2f(d.uvOffset,(null==(v=null===i||void 0===i?void 0:i.uvOffset)?void 0:v.x)||0,(null==(p=null===i||void 0===i?void 0:i.uvOffset)?void 0:p.y)||0),this.gl.uniform2f(d.alignment,e||0,t||0),this.gl.uniform1f(d.opacity,i.opacity),this.gl.uniform3f(d.color,(null==(g=null===i||void 0===i?void 0:i.color)?void 0:g.r)||0,(null==(v=null===i||void 0===i?void 0:i.color)?void 0:v.g)||0,(null==(p=null===i||void 0===i?void 0:i.color)?void 0:p.b)||0),this.gl.uniform1f(d.rotation,r.rotation),this.gl.uniform2fv(d.scale,s),this.renderer.setDepthTest(i.depthTest),this.renderer.setDepthWrite(i.depthWrite),this.renderer.setTexture(i.map,0),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0)}this.gl.enable(this.gl.CULL_FACE)}}createProgram(e,t){if(!this.gl)throw new Error("WebGL Rendering context not found");var r=this.gl.createProgram();if(!r)throw new Error("Error creating webgl program");var i=this.gl.createShader(this.gl.FRAGMENT_SHADER),s=this.gl.createShader(this.gl.VERTEX_SHADER);if(!i)throw new Error("Unable to create fragment shader SpritePlugin.createProgram");if(!s)throw new Error("Unable to create vertex shader SpritePlugin.createProgram");t="precision "+t+" float;\n";if(this.gl.shaderSource(i,t+e.fragmentShader),this.gl.shaderSource(s,t+e.vertexShader),this.gl.compileShader(i),this.gl.compileShader(s),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)&&this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS))return this.gl.attachShader(r,i),this.gl.attachShader(r,s),this.gl.linkProgram(r),this.gl.getProgramParameter(r,this.gl.LINK_STATUS)||console.error("Could not initialize shader"),r;throw new Error(`Error compiling shader: 
      ${this.gl.getShaderInfoLog(i)} 
      `+this.gl.getShaderInfoLog(s))}}function b(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}},"./src/WebGL/constants/Coloring.ts":(e,t,r)=>{var i;r.r(t),r.d(t,{Coloring:()=>i}),(r=i=i||{})[r.NoColors=0]="NoColors",r[r.FaceColors=1]="FaceColors",r[r.VertexColors=2]="VertexColors"},"./src/WebGL/constants/Shading.ts":(e,t,r)=>{var i;r.r(t),r.d(t,{Shading:()=>i}),(r=i=i||{})[r.NoShading=0]="NoShading",r[r.FlatShading=1]="FlatShading",r[r.SmoothShading=2]="SmoothShading"},"./src/WebGL/constants/Sides.ts":(e,t,r)=>{r.r(t),r.d(t,{BackSide:()=>s,DoubleSide:()=>n,FrontSide:()=>i});const i=0,s=1,n=2},"./src/WebGL/constants/SpriteAlignment.ts":(e,t,r)=>{r.r(t),r.d(t,{SpriteAlignment:()=>i});t=r("./src/WebGL/math/index.ts");const i={topLeft:new t.Vector2(1,-1),topCenter:new t.Vector2(0,-1),topRight:new t.Vector2(-1,-1),centerLeft:new t.Vector2(1,0),center:new t.Vector2(0,0),centerRight:new t.Vector2(-1,0),bottomLeft:new t.Vector2(1,1),bottomCenter:new t.Vector2(0,1),bottomRight:new t.Vector2(-1,1)}},"./src/WebGL/constants/TextureConstants.ts":(e,t,r)=>{r.r(t),r.d(t,{ClampToEdgeWrapping:()=>i,FloatType:()=>l,LinearFilter:()=>s,LinearMipMapLinearFilter:()=>a,NearestFilter:()=>n,R32Format:()=>d,RFormat:()=>c,RGBAFormat:()=>h,UnsignedByteType:()=>o});const i=1001,s=1006,n=1007,a=1008,o=1009,l=1010,h=1021,c=1022,d=1023},"./src/WebGL/constants/TextureOperations.ts":(e,t,r)=>{var i;r.r(t),r.d(t,{TextureOperations:()=>i}),(r=i=i||{})[r.MultiplyOperation=0]="MultiplyOperation",r[r.MixOperation=1]="MixOperation",r[r.AddOperation=2]="AddOperation"},"./src/WebGL/constants/index.ts":(e,t,r)=>{r.r(t),r.d(t,{BackSide:()=>s.BackSide,ClampToEdgeWrapping:()=>o.ClampToEdgeWrapping,Coloring:()=>i.Coloring,DoubleSide:()=>s.DoubleSide,FloatType:()=>o.FloatType,FrontSide:()=>s.FrontSide,LinearFilter:()=>o.LinearFilter,LinearMipMapLinearFilter:()=>o.LinearMipMapLinearFilter,NearestFilter:()=>o.NearestFilter,R32Format:()=>o.R32Format,RFormat:()=>o.RFormat,RGBAFormat:()=>o.RGBAFormat,Shading:()=>n.Shading,SpriteAlignment:()=>a.SpriteAlignment,TextureOperations:()=>l.TextureOperations,UnsignedByteType:()=>o.UnsignedByteType});var i=r("./src/WebGL/constants/Coloring.ts"),s=r("./src/WebGL/constants/Sides.ts"),n=r("./src/WebGL/constants/Shading.ts"),a=r("./src/WebGL/constants/SpriteAlignment.ts"),o=r("./src/WebGL/constants/TextureConstants.ts"),l=r("./src/WebGL/constants/TextureOperations.ts")},"./src/WebGL/core/EventDispatcher.ts":(e,t,r)=>{r.r(t),r.d(t,{EventDispatcher:()=>i});class i{constructor(){this.listeners={}}dispatchEvent(e){var t=this.listeners[e.type];if(void 0!==t){e.target=this;for(var r=0,i=t.length;r<i;r++)t[r].call(this,e)}}removeEventListener(e,t){t?-1!==(t=this.listeners[e].indexOf(t))&&this.listeners[e].splice(t,1):this.listeners[e]=[]}addEventListener(e,t){void 0===this.listeners[e]&&(this.listeners[e]=[]),-1===this.listeners[e].indexOf(t)&&this.listeners[e].push(t)}}},"./src/WebGL/core/Geometry.ts":(e,t,r)=>{r.r(t),r.d(t,{Geometry:()=>o,GeometryGroup:()=>a,GeometryIDCount:()=>l});var i=r("./src/WebGL/materials/LineBasicMaterial.ts"),t=r("./src/WebGL/core/EventDispatcher.ts"),c=r("./src/WebGL/math/index.ts"),n=r("./src/colors.ts");const s=65535;class a{constructor(e=0){this.vertexArray=null,this.colorArray=null,this.normalArray=null,this.radiusArray=null,this.faceArray=null,this.lineArray=null,this.atomArray=Array(),this.vertices=0,this.faceidx=0,this.lineidx=0,this.__inittedArrays=!1,this.id=e}setColor(e){var t=this.vertexArray,r=this.colorArray;if(!t)throw new Error("vertex array not initialized");if(!r)throw new Error("color array not initialized");for(var i=n.CC.color(e),s=0;s<t.length;s+=3)r[s]=i.r,r[s+1]=i.g,r[s+2]=i.b}setColors(e){var t=this.vertexArray,r=this.colorArray;if(!t)throw new Error("vertex array not initialized");if(!r)throw new Error("color array not initialized");if(t.length!=r.length)console.log("Cannot re-color geometry group due to mismatched lengths.");else for(var i=0;i<t.length;i+=3){var s=e(t[i],t[i+1],t[i+2]);s instanceof n.Color||(s=n.CC.color(s)),r[i]=s.r,r[i+1]=s.g,r[i+2]=s.b}}getNumVertices(){return this.vertices}getVertices(){return this.vertexArray}getCentroid(){if(!this.vertexArray)throw new Error("vertex array not initialized");for(var e,t,r,i=new c.Vector3,s=0;s<this.vertices;++s)e=this.vertexArray[r=3*s],t=this.vertexArray[1+r],r=this.vertexArray[2+r],i.x+=e,i.y+=t,i.z+=r;return i.divideScalar(this.vertices),i}setNormals(){var e=this.faceArray,t=this.vertexArray,r=this.normalArray;if(this.vertices&&this.faceidx){if(!e)throw new Error("face array not initialized");if(!t)throw new Error("vertex array not initialized");if(!r)throw new Error("normal array not initialized");for(var i,s,n,a,o,l,h=0;h<e.length/3;++h)i=3*e[3*h],s=3*e[3*h+1],n=3*e[3*h+2],a=new c.Vector3(t[i],t[1+i],t[2+i]),l=new c.Vector3(t[s],t[1+s],t[2+s]),o=new c.Vector3(t[n],t[1+n],t[2+n]),a.subVectors(a,l),o.subVectors(o,l),o.cross(a),(l=o).normalize(),r[i]+=l.x,r[s]+=l.x,r[n]+=l.x,r[1+i]+=l.y,r[1+s]+=l.y,r[1+n]+=l.y,r[2+i]+=l.z,r[2+s]+=l.z,r[2+n]+=l.z}}setLineIndices(){if(this.faceidx&&(!this.lineArray||this.lineArray.length!=2*this.faceidx||this.lineidx!=2*this.faceidx)){var e=this.faceArray,t=this.lineArray=new Uint16Array(2*this.faceidx);if(this.lineidx=2*this.faceidx,!e)throw new Error("face array not initialized");for(var r=0;r<this.faceidx/3;++r){var i=3*r,s=2*i,n=e[i],a=e[1+i],i=e[2+i];t[s]=n,t[1+s]=a,t[2+s]=n,t[3+s]=i,t[4+s]=a,t[5+s]=i}}}vrml(s,e){var n,a,o,l,h,c="",t=(c+=s+"Shape {\n"+s+" appearance Appearance {\n"+s+"  material Material {\n"+s+"   diffuseColor "+(null==(t=null==e?void 0:e.color)?void 0:t.r)+" "+(null==(t=null==e?void 0:e.color)?void 0:t.g)+" "+(null==(t=null==e?void 0:e.color)?void 0:t.b)+"\n",e.wireframe&&this.colorArray&&(c+=s+"    emissiveColor "+(t=this.colorArray)[0]+" "+t[1]+" "+t[2]+"\n"),null!=e&&e.transparent&&(c+=s+"   transparency "+(1-e.opacity)+"\n"),c=c+(s+"  }\n")+(s+" }\n"),s);if(s+=" ",e instanceof i.LineBasicMaterial||e.wireframe){c+=s+"geometry IndexedLineSet {\n"+s+" colorPerVertex TRUE\n"+s+" coord Coordinate {\n"+s+"  point [\n";let t,r,i;for(let e=0;e<this.vertices;++e){var d=3*e;t=null==(n=this.vertexArray)?void 0:n[d],r=null==(n=this.vertexArray)?void 0:n[1+d],i=null==(n=this.vertexArray)?void 0:n[2+d],c+=s+"   "+t+" "+r+" "+i+",\n"}if(c=c+(s+"  ]\n")+(s+" }\n"),this.colorArray&&!e.wireframe){c+=s+" color Color {\n"+s+"  color [\n";for(let e=0;e<this.vertices;++e){var u=3*e;t=this.colorArray[u],r=this.colorArray[1+u],i=this.colorArray[2+u],c+=s+"   "+t+" "+r+" "+i+",\n"}c=c+(s+"  ]\n")+(s+" }\n")}if(c+=s+" coordIndex [\n",e.wireframe&&this.faceArray)for(let e=0;e<this.faceidx;e+=3)t=null==(a=this.faceArray)?void 0:a[e],r=null==(a=this.faceArray)?void 0:a[e+1],i=null==(a=this.faceArray)?void 0:a[e+2],c+=s+"  "+t+", "+r+", "+i+", -1,\n";else for(let e=0;e<this.vertices-1;e+=2)c+=s+"  "+e+", "+(e+1)+", -1,\n";c=c+(s+" ]\n")+(s+"}\n")}else{c=c+(s+"geometry IndexedFaceSet {\n"+s+" colorPerVertex TRUE\n"+s+" normalPerVertex TRUE\n"+s+" solid FALSE\n")+(s+" coord Coordinate {\n"+s+"  point [\n");let t,r,i;for(let e=0;e<this.vertices;++e){var p=3*e;t=null==(o=this.vertexArray)?void 0:o[p],r=null==(o=this.vertexArray)?void 0:o[1+p],i=null==(o=this.vertexArray)?void 0:o[2+p],c+=s+"   "+t+" "+r+" "+i+",\n"}c=(c+=s+"  ]\n")+(s+" }\n")+(s+" normal Normal {\n"+s+"  vector [\n");for(let e=0;e<this.vertices;++e){var f=3*e;t=null==(l=this.normalArray)?void 0:l[f],r=null==(l=this.normalArray)?void 0:l[1+f],i=null==(l=this.normalArray)?void 0:l[2+f],c+=s+"   "+t+" "+r+" "+i+",\n"}if(c=c+(s+"  ]\n")+(s+" }\n"),this.colorArray){c+=s+" color Color {\n"+s+"  color [\n";for(let e=0;e<this.vertices;++e){var m=3*e;t=this.colorArray[m],r=this.colorArray[1+m],i=this.colorArray[2+m],c+=s+"   "+t+" "+r+" "+i+",\n"}c=c+(s+"  ]\n")+(s+" }\n")}c+=s+" coordIndex [\n";for(let e=0;e<this.faceidx;e+=3)t=null==(h=this.faceArray)?void 0:h[e],r=null==(h=this.faceArray)?void 0:h[e+1],i=null==(h=this.faceArray)?void 0:h[e+2],c+=s+"  "+t+", "+r+", "+i+", -1,\n";c=c+(s+" ]\n")+(s+"}\n")}return c+=t+"}"}truncateArrayBuffers(e=!0,t=!1){var r=this.vertexArray,i=this.colorArray,s=this.normalArray,n=this.faceArray,a=this.lineArray,o=this.radiusArray;this.vertexArray=(null==r?void 0:r.subarray(0,3*this.vertices))||null,this.colorArray=(null==i?void 0:i.subarray(0,3*this.vertices))||null,e?(this.normalArray=(null==s?void 0:s.subarray(0,3*this.vertices))||null,this.faceArray=(null==n?void 0:n.subarray(0,this.faceidx))||null,0<this.lineidx?this.lineArray=(null==a?void 0:a.subarray(0,this.lineidx))||null:this.lineArray=new Uint16Array(0)):(this.normalArray=new Float32Array(0),this.faceArray=new Uint16Array(0),this.lineArray=new Uint16Array(0)),o&&(this.radiusArray=o.subarray(0,this.vertices)),t&&(this.normalArray&&(this.normalArray=new Float32Array(this.normalArray)),this.faceArray&&(this.faceArray=new Uint16Array(this.faceArray)),this.lineArray&&(this.lineArray=new Uint16Array(this.lineArray)),this.vertexArray&&(this.vertexArray=new Float32Array(this.vertexArray)),this.colorArray&&(this.colorArray=new Float32Array(this.colorArray)),this.radiusArray&&(this.radiusArray=new Float32Array(this.radiusArray))),this.__inittedArrays=!0}}class o extends t.EventDispatcher{constructor(e=!1,t=!1,r=!1){super(),this.name="",this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.buffersNeedUpdate=!1,this.imposter=!1,this.instanced=!1,this.geometryGroups=[],this.groups=0,this.id=l++,this.mesh=e,this.radii=t,this.offset=r}updateGeoGroup(e=0){var t=0<this.groups?this.geometryGroups[this.groups-1]:null;return t=!t||t.vertices+e>((null==(e=null==t?void 0:t.vertexArray)?void 0:e.length)||0)/3?this.addGeoGroup():t}vrml(e,t){for(var r="",i=this.geometryGroups.length,s=0;s<i;s++)r+=this.geometryGroups[s].vrml(e,t)+",\n";return r}addGeoGroup(){var e=new a(this.geometryGroups.length);return this.geometryGroups.push(e),this.groups=this.geometryGroups.length,e.vertexArray=new Float32Array(3*s),e.colorArray=new Float32Array(3*s),this.mesh&&(e.normalArray=new Float32Array(3*s),e.faceArray=new Uint16Array(6*s),e.lineArray=new Uint16Array(6*s)),this.radii&&(e.radiusArray=new Float32Array(s)),e.useOffset=this.offset,e}setUpNormals(...e){for(var t=0;t<this.groups;t++)this.geometryGroups[t].setNormals(...e)}setColors(...e){for(var t=this.geometryGroups.length,r=0;r<t;r++)this.geometryGroups[r].setColors(...e)}setColor(...e){for(var t=this.geometryGroups.length,r=0;r<t;r++)this.geometryGroups[r].setColor(...e)}setUpWireframe(...e){for(var t=this.geometryGroups.length,r=0;r<t;r++)this.geometryGroups[r].setLineIndices(...e)}initTypedArrays(){for(var e=0;e<this.groups;e++){var t=this.geometryGroups[e];!0!==t.__inittedArrays&&t.truncateArrayBuffers(this.mesh,!1)}}dispose(){this.dispatchEvent({type:"dispose"})}get vertices(){for(var e=0,t=0;t<this.groups;t++)e+=this.geometryGroups[t].vertices;return e}}let l=0},"./src/WebGL/core/Object3D.ts":(e,t,r)=>{r.r(t),r.d(t,{Light:()=>l,Object3D:()=>a,Object3DIDCount:()=>n,Scene:()=>o});var i=r("./src/WebGL/math/index.ts"),s=r("./src/colors.ts");let n=0;class a{constructor(){this.id=n++,this.name="",this.children=[],this.position=new i.Vector3,this.rotation=new i.Vector3,this.matrix=new i.Matrix4,this.matrixWorld=new i.Matrix4,this.quaternion=new i.Quaternion,this.eulerOrder="XYZ",this.up=new i.Vector3(0,1,0),this.scale=new i.Vector3(1,1,1),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.rotationAutoUpdate=!0,this.useQuaternion=!1,this.visible=!0}lookAt(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&(!0===this.useQuaternion?console.error("Unimplemented math operation."):this.rotation instanceof i.Vector3&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder))}add(e){if(e===this)console.error("Can't add $3Dmol.Object3D to itself");else{(e.parent=this).children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof o&&t.__addObject(e)}}remove(e){var t=this.children.indexOf(e);if(-1!==t){e.parent=void 0,this.children.splice(t,1);for(var r=this;void 0!==r.parent;)r=r.parent;void 0!==r&&r instanceof o&&r.__removeObject(e)}}vrml(e){e=e||" ";var t,r=2*Math.atan2(this.quaternion.lengthxyz(),this.quaternion.w),i=0,s=0,n=0,a=(0!=r&&(t=Math.sin(r/2),i=this.quaternion.x/t,s=this.quaternion.y/t,n=this.quaternion.z/t),e+"Transform {\n"+e+" center "+this.position.x+" "+this.position.y+" "+this.position.z+"\n"+e+" rotation "+i+" "+s+" "+n+" "+r+"\n"+e+" children [\n");this.geometry&&(a+=this.geometry.vrml(e,this.material));for(var o=0;o<this.children.length;o++)a+=this.children[o].vrml(e+" ")+",\n";return a=a+" ]\n"+"}"}updateMatrix(){this.matrix.setPosition(this.position),!1===this.useQuaternion&&this.rotation instanceof i.Vector3?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1;for(var t=0;t<this.children.length;t++)this.children[t].updateMatrixWorld(!0)}clone(e){(e=void 0===e?new a:e).name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.rotation instanceof i.Vector3&&this.rotation instanceof i.Vector3?e.rotation.copy(this.rotation):e.rotation=this.rotation,e.eulerOrder=this.eulerOrder,e.scale.copy(this.scale),e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.quaternion.copy(this.quaternion),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.useQuaternion=this.useQuaternion,e.visible=this.visible;for(var t=0;t<this.children.length;t++){var r=this.children[t];e.add(r.clone())}return e}setVisible(e){this.visible=e;for(var t=0;t<this.children.length;t++)this.children[t].setVisible(e)}}class o extends a{constructor(){super(...arguments),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]}__addObject(e){var t;e instanceof l?(-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target)):-1===this.__objects.indexOf(e)&&(this.__objects.push(e),this.__objectsAdded.push(e),-1!==(t=this.__objectsRemoved.indexOf(e))&&this.__objectsRemoved.splice(t,1));for(var r=0;r<e.children.length;r++)this.__addObject(e.children[r])}__removeObject(e){var t;e instanceof l?-1!==(t=this.__lights.indexOf(e))&&this.__lights.splice(t,1):-1!==(t=this.__objects.indexOf(e))&&(this.__objects.splice(t,1),this.__objectsRemoved.push(e),-1!==this.__objectsAdded.indexOf(e)&&this.__objectsAdded.splice(t,1));for(var r=0;r<e.children.length;r++)this.__removeObject(e.children[r])}}class l extends a{constructor(e,t=1){super(),this.position=new i.Vector3(0,1,0),this.target=new a,this.castShadow=!1,this.onlyShadow=!1,this.color=new s.Color(e),this.intensity=t}}},"./src/WebGL/core/Projector.ts":(e,t,r)=>{r.r(t),r.d(t,{Projector:()=>s});const i=new(r("./src/WebGL/math/index.ts").Matrix4);class s{static unprojectVector(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),i.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),e.applyProjection(i)}static projectVector(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),i.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(i)}projectVector(e,t){return s.projectVector(e,t)}unprojectVector(e,t){return s.unprojectVector(e,t)}}},"./src/WebGL/core/Raycaster.ts":(e,t,r)=>{r.r(t),r.d(t,{Raycaster:()=>a,intersectObject:()=>o});var s=r("./src/WebGL/math/index.ts"),M=r("./src/WebGL/shapes/index.ts");const n=(e,t)=>e.distance-t.distance,i=new s.Matrix4;class a{constructor(e,t,r,i){this.precision=1e-4,this.linePrecision=.2,this.ray=new s.Ray(e,t),0<this.ray.direction.lengthSq()&&this.ray.direction.normalize(),this.near=i||0,this.far=r||1/0}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.ortho?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,e.z),t.projectionMatrixInverse.getInverse(t.projectionMatrix),i.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),this.ray.direction.applyProjection(i),this.ray.direction.sub(this.ray.origin).normalize())}intersectObjects(e,t){for(var r=[],i=0,s=t.length;i<s;i++)o(e,t[i],this,r);return r.sort(n),r}}const z=e=>Math.min(Math.max(e,-1),1);var T=new M.Sphere,E=new M.Cylinder,F=new M.Triangle,D=new s.Vector3,k=new s.Vector3,I=new s.Vector3,O=new s.Vector3,R=new s.Vector3;function o(e,t,r,i){if(R.getPositionFromMatrix(e.matrixWorld),void 0===t.intersectionShape)return i;if(t.hidden)return i;var s,n,a,o,l,h,c,d,u,p,f,m,g,v=t.intersectionShape,b=r.linePrecision,_=(b*=e.matrixWorld.getMaxScaleOnAxis())*b;if(void 0!==t.boundingSphere&&t.boundingSphere instanceof M.Sphere&&(T.copy(t.boundingSphere),T.applyMatrix4(e.matrixWorld),!r.ray.isIntersectionSphere(T)))return i;for(s=0,n=v.triangle.length;s<n;s++)v.triangle[s]instanceof M.Triangle&&(F.copy(v.triangle[s]),F.applyMatrix4(e.matrixWorld),d=F.getNormal(),0<=(y=r.ray.direction.dot(d))||(D.subVectors(F.a,r.ray.origin),(o=d.dot(D)/y)<0||(k.copy(r.ray.direction).multiplyScalar(o).add(r.ray.origin),k.sub(F.a),I.copy(F.b).sub(F.a),O.copy(F.c).sub(F.a),d=I.dot(O),u=I.lengthSq(),p=O.lengthSq(),(f=(u*k.dot(O)-d*k.dot(I))/(u*p-d*d))<0||1<f||(l=(k.dot(I)-f*d)/u)<0||1<l||1<l+f||i.push({clickable:t,distance:o}))));for(s=0,n=v.cylinder.length;s<n;s++)v.cylinder[s]instanceof M.Cylinder&&(E.copy(v.cylinder[s]),E.applyMatrix4(e.matrixWorld),D.subVectors(E.c1,r.ray.origin),a=D.dot(E.direction),S=D.dot(r.ray.direction),0!=(x=1-(y=z(r.ray.direction.dot(E.direction)))*y)&&(h=(y*S-a)/x,c=(S-y*a)/x,k.copy(E.direction).multiplyScalar(h).add(E.c1),I.copy(r.ray.direction).multiplyScalar(c).add(r.ray.origin),(m=O.subVectors(k,I).lengthSq())<=(g=E.radius*E.radius)&&((l=y*(f=o=(L=(y*a-S)*(y*a-S)-x*(D.lengthSq()-a*a-g))<=0?Math.sqrt(m):(S-y*a-Math.sqrt(L))/x)-a)<0||l*l>E.lengthSq()||f<0||i.push({clickable:t,distance:o}))));for(s=0,n=v.line.length;s<n;s+=2){k.copy(v.line[s]),k.applyMatrix4(e.matrixWorld),I.copy(v.line[s+1]),I.applyMatrix4(e.matrixWorld),O.subVectors(I,k);var y,x,w=O.lengthSq(),A=(O.normalize(),D.subVectors(k,r.ray.origin),D.dot(O)),S=D.dot(r.ray.direction);0!==(x=1-(y=z(r.ray.direction.dot(O)))*y)&&(c=(S-y*A)/x,k.add(O.multiplyScalar(h=(y*S-A)/x)),I.copy(r.ray.direction).multiplyScalar(c).add(r.ray.origin),(m=O.subVectors(I,k).lengthSq())<_&&h*h<w&&i.push({clickable:t,distance:c}))}for(s=0,n=v.sphere.length;s<n;s++)if(v.sphere[s]instanceof M.Sphere&&(T.copy(v.sphere[s]),T.applyMatrix4(e.matrixWorld),r.ray.isIntersectionSphere(T))){k.subVectors(T.center,r.ray.origin);var C=k.dot(r.ray.direction),L=C*C-(k.lengthSq()-T.radius*T.radius);if(C<0)return i;o=L<=0?C:C-Math.sqrt(L),i.push({clickable:t,distance:o})}return i}},"./src/WebGL/core/Texture.ts":(e,t,r)=>{r.r(t),r.d(t,{Texture:()=>a,TextureIdCount:()=>o});var i=r("./src/WebGL/constants/TextureConstants.ts"),s=r("./src/WebGL/math/index.ts"),t=r("./src/WebGL/core/EventDispatcher.ts"),n=r("./src/WebGL/core/UVMapping.ts");class a extends t.EventDispatcher{constructor(e,t){super(),this.id=o++,this.name="",this.image=e,this.mapping=new n.UVMapping,this.wrapS=i.ClampToEdgeWrapping,this.wrapT=i.ClampToEdgeWrapping,this.anisotropy=1,t?(this.format=i.RFormat,this.type=i.FloatType,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.magFilter=i.NearestFilter,this.minFilter=i.NearestFilter):(this.format=i.RGBAFormat,this.type=i.UnsignedByteType,this.offset=new s.Vector2(0,0),this.repeat=new s.Vector2(1,1),this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.magFilter=i.LinearFilter,this.minFilter=i.LinearMipMapLinearFilter),this.needsUpdate=!1,this.onUpdate=null}clone(e=new a){return e.image=this.image,e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e}dispose(){this.dispatchEvent({type:"dispose"})}}let o=0},"./src/WebGL/core/UVMapping.ts":(e,t,r)=>{r.r(t),r.d(t,{UVMapping:()=>i});class i{}},"./src/WebGL/core/index.ts":(e,t,r)=>{r.r(t),r.d(t,{EventDispatcher:()=>i.EventDispatcher,Geometry:()=>s.Geometry,GeometryGroup:()=>s.GeometryGroup,GeometryIDCount:()=>s.GeometryIDCount,Light:()=>n.Light,Object3D:()=>n.Object3D,Object3DIDCount:()=>n.Object3DIDCount,Projector:()=>a.Projector,Raycaster:()=>o.Raycaster,Scene:()=>n.Scene,Texture:()=>l.Texture,TextureIdCount:()=>l.TextureIdCount,UVMapping:()=>h.UVMapping,intersectObject:()=>o.intersectObject});var i=r("./src/WebGL/core/EventDispatcher.ts"),s=r("./src/WebGL/core/Geometry.ts"),n=r("./src/WebGL/core/Object3D.ts"),a=r("./src/WebGL/core/Projector.ts"),o=r("./src/WebGL/core/Raycaster.ts"),l=r("./src/WebGL/core/Texture.ts"),h=r("./src/WebGL/core/UVMapping.ts")},"./src/WebGL/index.ts":(e,t,r)=>{r.r(t),r.d(t,{BackSide:()=>i.BackSide,Camera:()=>c.Camera,ClampToEdgeWrapping:()=>i.ClampToEdgeWrapping,Coloring:()=>i.Coloring,Cylinder:()=>h.Cylinder,DoubleSide:()=>i.DoubleSide,EventDispatcher:()=>s.EventDispatcher,FloatType:()=>i.FloatType,Fog:()=>d.Fog,FrontSide:()=>i.FrontSide,Geometry:()=>s.Geometry,GeometryGroup:()=>s.GeometryGroup,GeometryIDCount:()=>s.GeometryIDCount,ImposterMaterial:()=>n.ImposterMaterial,InstancedMaterial:()=>n.InstancedMaterial,Light:()=>s.Light,Line:()=>o.Line,LineBasicMaterial:()=>n.LineBasicMaterial,LineStyle:()=>o.LineStyle,LinearFilter:()=>i.LinearFilter,LinearMipMapLinearFilter:()=>i.LinearMipMapLinearFilter,Material:()=>n.Material,MaterialIdCount:()=>n.MaterialIdCount,Matrix3:()=>a.Matrix3,Matrix4:()=>a.Matrix4,Mesh:()=>o.Mesh,MeshDoubleLambertMaterial:()=>n.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>n.MeshLambertMaterial,MeshOutlineMaterial:()=>n.MeshOutlineMaterial,NearestFilter:()=>i.NearestFilter,Object3D:()=>s.Object3D,Object3DIDCount:()=>s.Object3DIDCount,Projector:()=>s.Projector,Quaternion:()=>a.Quaternion,R32Format:()=>i.R32Format,RFormat:()=>i.RFormat,RGBAFormat:()=>i.RGBAFormat,Ray:()=>a.Ray,Raycaster:()=>s.Raycaster,Renderer:()=>u.Renderer,Scene:()=>s.Scene,ShaderLib:()=>l.ShaderLib,ShaderUtils:()=>l.ShaderUtils,Shading:()=>i.Shading,Sphere:()=>h.Sphere,SphereImposterMaterial:()=>n.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>n.SphereImposterOutlineMaterial,Sprite:()=>o.Sprite,SpriteAlignment:()=>i.SpriteAlignment,SpriteMaterial:()=>n.SpriteMaterial,SpritePlugin:()=>p.SpritePlugin,StickImposterMaterial:()=>n.StickImposterMaterial,StickImposterOutlineMaterial:()=>n.StickImposterOutlineMaterial,Texture:()=>s.Texture,TextureIdCount:()=>s.TextureIdCount,TextureOperations:()=>i.TextureOperations,Triangle:()=>h.Triangle,UVMapping:()=>s.UVMapping,UnsignedByteType:()=>i.UnsignedByteType,Vector2:()=>a.Vector2,Vector3:()=>a.Vector3,VolumetricMaterial:()=>n.VolumetricMaterial,basic:()=>l.basic,clamp:()=>a.clamp,clone:()=>l.clone,conversionMatrix3:()=>a.conversionMatrix3,degToRad:()=>a.degToRad,instanced:()=>l.instanced,intersectObject:()=>s.intersectObject,lambert:()=>l.lambert,lambertdouble:()=>l.lambertdouble,outline:()=>l.outline,screen:()=>l.screen,screenaa:()=>l.screenaa,sphereimposter:()=>l.sphereimposter,sphereimposteroutline:()=>l.sphereimposteroutline,sprite:()=>l.sprite,stickimposter:()=>l.stickimposter,stickimposteroutline:()=>l.stickimposteroutline,volumetric:()=>l.volumetric});var i=r("./src/WebGL/constants/index.ts"),s=r("./src/WebGL/core/index.ts"),n=r("./src/WebGL/materials/index.ts"),a=r("./src/WebGL/math/index.ts"),o=r("./src/WebGL/objects/index.ts"),l=r("./src/WebGL/shaders/index.ts"),h=r("./src/WebGL/shapes/index.ts"),c=r("./src/WebGL/Camera.ts"),d=r("./src/WebGL/Fog.ts"),u=r("./src/WebGL/Renderer.ts"),p=r("./src/WebGL/SpritePlugin.ts")},"./src/WebGL/materials/ImposterMaterial.ts":(e,t,r)=>{r.r(t),r.d(t,{ImposterMaterial:()=>o});var i=r("./src/WebGL/constants/Coloring.ts"),s=r("./src/WebGL/constants/Shading.ts"),n=r("./src/colors.ts"),a=r("./src/WebGL/math/index.ts"),t=r("./src/WebGL/materials/Material.ts");class o extends t.Material{constructor(e){super(),this.color=new n.Color(16777215),this.ambient=new n.Color(1048575),this.emissive=new n.Color(0),this.imposter=!0,this.wrapAround=!1,this.wrapRGB=new a.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=s.Shading.SmoothShading,this.shaderID=null,this.vertexColors=i.Coloring.NoColors,this.skinning=!1,this.setValues(e)}clone(e=new o){return super.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.shaderID=this.shaderID,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e}}},"./src/WebGL/materials/InstancedMaterial.ts":(e,t,r)=>{r.r(t),r.d(t,{InstancedMaterial:()=>o});var i=r("./src/WebGL/constants/Coloring.ts"),s=r("./src/WebGL/constants/Shading.ts"),n=r("./src/colors.ts"),a=r("./src/WebGL/math/index.ts"),t=r("./src/WebGL/materials/Material.ts");class o extends t.Material{constructor(e){super(),this.color=new n.Color(16777215),this.ambient=new n.Color(1048575),this.emissive=new n.Color(0),this.wrapAround=!1,this.wrapRGB=new a.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=s.Shading.SmoothShading,this.shaderID="instanced",this.vertexColors=i.Coloring.NoColors,this.skinning=!1,this.sphere=null,this.setValues(e)}clone(e=new o){return super.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.shaderID=this.shaderID,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e.sphere=this.sphere,e}}},"./src/WebGL/materials/LineBasicMaterial.ts":(e,t,r)=>{r.r(t),r.d(t,{LineBasicMaterial:()=>s});var i=r("./src/colors.ts"),t=r("./src/WebGL/materials/Material.ts");class s extends t.Material{constructor(e){super(),this.color=new i.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.shaderID="basic",this.setValues(e)}clone(e=new s){return super.clone.call(this,e),e.color.copy(this.color),e}}},"./src/WebGL/materials/Material.ts":(e,t,r)=>{r.r(t),r.d(t,{Material:()=>a,MaterialIdCount:()=>o});var i=r("./src/WebGL/constants/Sides.ts"),t=r("./src/WebGL/core/index.ts"),s=r("./src/WebGL/math/index.ts"),n=r("./src/colors.ts");class a extends t.EventDispatcher{constructor(){super(...arguments),this.id=o++,this.name="",this.side=i.FrontSide,this.opacity=1,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.visible=!0,this.needsUpdate=!0,this.outline=!1,this.wireframe=!1,this.shaded=!1}setValues(e={}){if(void 0!==e)for(var t in e){var r,i=e[t];void 0===i?console.warn("$3Dmol.Material: '"+t+"' parameter is undefined."):t in this&&((r=this[t])instanceof n.Color&&i instanceof n.Color?r.copy(i):r instanceof n.Color?r.set(i):r instanceof s.Vector3&&i instanceof s.Vector3?r.copy(i):this[t]=i)}}clone(e=new a){return e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e}makeShaded(e){this.shaded=!0,this.uniforms&&(this.uniforms.shading={type:"i",value:e},this.uniforms.vWidth={type:"f",value:1},this.uniforms.vHeight={type:"f",value:1})}dispose(){this.dispatchEvent({type:"dispose"})}}let o=0},"./src/WebGL/materials/MeshDoubleLambertMaterial.ts":(e,t,r)=>{r.r(t),r.d(t,{MeshDoubleLambertMaterial:()=>s});var i=r("./src/WebGL/constants/Sides.ts"),t=r("./src/WebGL/materials/MeshLambertMaterial.ts");class s extends t.MeshLambertMaterial{constructor(e){super(e),this.shaderID="lambertdouble",this.side=i.DoubleSide,this.outline=!1}clone(e=new s){return super.clone.call(this,e),e}}},"./src/WebGL/materials/MeshLambertMaterial.ts":(e,t,r)=>{r.r(t),r.d(t,{MeshLambertMaterial:()=>o});var i=r("./src/WebGL/constants/Coloring.ts"),s=r("./src/WebGL/constants/Shading.ts"),t=r("./src/WebGL/materials/Material.ts"),n=r("./src/colors.ts"),a=r("./src/WebGL/math/index.ts");class o extends t.Material{constructor(e){super(),this.color=new n.Color(16777215),this.ambient=new n.Color(1048575),this.emissive=new n.Color(0),this.wrapAround=!1,this.wrapRGB=new a.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=s.Shading.SmoothShading,this.shaderID="lambert",this.vertexColors=i.Coloring.NoColors,this.skinning=!1,this.setValues(e)}clone(e=new o){return super.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.shaderID=this.shaderID,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e}}},"./src/WebGL/materials/MeshOutlineMaterial.ts":(e,t,r)=>{r.r(t),r.d(t,{MeshOutlineMaterial:()=>s});var i=r("./src/colors.ts"),t=r("./src/WebGL/materials/Material.ts");class s extends t.Material{constructor(e){super(),e=e||{},this.fog=!0,this.shaderID="outline",this.wireframe=!1,this.outlineColor=i.CC.color(e.color||new i.Color(0,0,0)),this.outlineWidth=e.width||.1,this.outlinePushback=e.pushback||1,this.outlineMaxPixels=e.maxpixels||0}clone(e=new s){return super.clone.call(this,e),e.fog=this.fog,e.shaderID=this.shaderID,e.wireframe=this.wireframe,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.outlinePushback=this.outlinePushback,e.outlineMaxPixels=this.outlineMaxPixels,e}}},"./src/WebGL/materials/SphereImposterMaterial.ts":(e,t,r)=>{r.r(t),r.d(t,{SphereImposterMaterial:()=>i});t=r("./src/WebGL/materials/ImposterMaterial.ts");class i extends t.ImposterMaterial{constructor(e){super(e),this.shaderID="sphereimposter",this.setValues(e)}clone(e=new i){return super.clone.call(this,e),e}}},"./src/WebGL/materials/SphereImposterOutlineMaterial.ts":(e,t,r)=>{r.r(t),r.d(t,{SphereImposterOutlineMaterial:()=>s});var i=r("./src/colors.ts"),t=r("./src/WebGL/materials/ImposterMaterial.ts");class s extends t.ImposterMaterial{constructor(e){super(e),e=e||{},this.shaderID="sphereimposteroutline",this.outlineColor=i.CC.color(e.color||new i.Color(0,0,0)),this.outlineWidth=e.width||.1,this.outlinePushback=e.pushback||1,this.outlineMaxPixels=e.maxpixels||0,this.setValues(e)}clone(e=new s){return super.clone.call(this,e),e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.outlinePushback=this.outlinePushback,e.outlineMaxPixels=this.outlineMaxPixels,e}}},"./src/WebGL/materials/SpriteMaterial.ts":(e,t,r)=>{r.r(t),r.d(t,{SpriteMaterial:()=>o});var i=r("./src/WebGL/constants/SpriteAlignment.ts"),s=r("./src/WebGL/core/Texture.ts"),n=r("./src/colors.ts"),a=r("./src/WebGL/math/index.ts"),t=r("./src/WebGL/materials/Material.ts");class o extends t.Material{constructor(e){super(),this.color=new n.Color(16777215),this.map=new s.Texture,this.useScreenCoordinates=!0,this.fog=!1,this.uvOffset=new a.Vector2(0,0),this.uvScale=new a.Vector2(1,1),this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.screenOffset=this.screenOffset,this.scaleByViewPort=!this.sizeAttenuation,this.alignment=i.SpriteAlignment.center.clone(),this.setValues(e),void 0===(e=e||{}).depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===e.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===e.scaleByViewPort&&(this.scaleByViewPort=!this.sizeAttenuation)}clone(e=new o){return super.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.useScreenCoordinates=this.useScreenCoordinates,e.screenOffset=this.screenOffset,e.sizeAttenuation=this.sizeAttenuation,e.scaleByViewport=this.scaleByViewPort,e.alignment.copy(this.alignment),e.uvOffset.copy(this.uvOffset),e}}},"./src/WebGL/materials/StickImposterMaterial.ts":(e,t,r)=>{r.r(t),r.d(t,{StickImposterMaterial:()=>i});t=r("./src/WebGL/materials/ImposterMaterial.ts");class i extends t.ImposterMaterial{constructor(e){super(e),this.shaderID="stickimposter",this.setValues(e)}clone(e=new i){return super.clone.call(this,e),e}}},"./src/WebGL/materials/StickImposterOutlineMaterial.ts":(e,t,r)=>{r.r(t),r.d(t,{StickImposterOutlineMaterial:()=>s});var i=r("./src/colors.ts"),t=r("./src/WebGL/materials/ImposterMaterial.ts");class s extends t.ImposterMaterial{constructor(e={}){super(e),this.shaderID="stickimposteroutline",this.outlineColor=new i.Color(0,0,0),this.outlineWidth=.1,this.outlinePushback=1,this.outlineMaxPixels=0,e.color&&(this.outlineColor=i.CC.color(e.color)),e.width&&(this.outlineWidth=e.width),e.pushback&&(this.outlinePushback=e.pushback),e.maxpixels&&(this.outlineMaxPixels=e.maxpixels),this.setValues(e)}clone(e=new s){return super.clone.call(this,e),e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.outlinePushback=this.outlinePushback,e.outlineMaxPixels=this.outlineMaxPixels,e}}},"./src/WebGL/materials/VolumetricMaterial.ts":(e,t,r)=>{r.r(t),r.d(t,{VolumetricMaterial:()=>n});var i=r("./src/WebGL/constants/Sides.ts"),s=r("./src/colors.ts"),t=r("./src/WebGL/materials/Material.ts");class n extends t.Material{constructor(e){super(),this.transparent=!1,this.volumetric=!0,this.color=new s.Color(16777215),this.transferfn=null,this.map=void 0,this.extent=[],this.maxdepth=100,this.unit=0,this.texmatrix=null,this.transfermin=-1,this.transfermax=1,this.subsamples=5,this.shaderID="volumetric",this.side=i.FrontSide,this.setValues(e)}clone(e=new n){return super.clone.call(this,e),e.transparent=this.transparent,e.volumetric=this.volumetric,e.color=this.color,e.transferfn=this.transferfn,e.map=this.map,e.extent=this.extent,e.maxdepth=this.maxdepth,e.unit=this.unit,e.texmatrix=this.texmatrix,e.transfermin=this.transfermin,e.transfermax=this.transfermax,e.subsamples=this.subsamples,e.shaderID=this.shaderID,e.side=this.side,e}}},"./src/WebGL/materials/index.ts":(e,t,r)=>{r.r(t),r.d(t,{ImposterMaterial:()=>i.ImposterMaterial,InstancedMaterial:()=>s.InstancedMaterial,LineBasicMaterial:()=>n.LineBasicMaterial,Material:()=>a.Material,MaterialIdCount:()=>a.MaterialIdCount,MeshDoubleLambertMaterial:()=>o.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>l.MeshLambertMaterial,MeshOutlineMaterial:()=>h.MeshOutlineMaterial,SphereImposterMaterial:()=>c.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>d.SphereImposterOutlineMaterial,SpriteMaterial:()=>u.SpriteMaterial,StickImposterMaterial:()=>p.StickImposterMaterial,StickImposterOutlineMaterial:()=>f.StickImposterOutlineMaterial,VolumetricMaterial:()=>m.VolumetricMaterial});var i=r("./src/WebGL/materials/ImposterMaterial.ts"),s=r("./src/WebGL/materials/InstancedMaterial.ts"),n=r("./src/WebGL/materials/LineBasicMaterial.ts"),a=r("./src/WebGL/materials/Material.ts"),o=r("./src/WebGL/materials/MeshDoubleLambertMaterial.ts"),l=r("./src/WebGL/materials/MeshLambertMaterial.ts"),h=r("./src/WebGL/materials/MeshOutlineMaterial.ts"),c=r("./src/WebGL/materials/SphereImposterMaterial.ts"),d=r("./src/WebGL/materials/SphereImposterOutlineMaterial.ts"),u=r("./src/WebGL/materials/SpriteMaterial.ts"),p=r("./src/WebGL/materials/StickImposterMaterial.ts"),f=r("./src/WebGL/materials/StickImposterOutlineMaterial.ts"),m=r("./src/WebGL/materials/VolumetricMaterial.ts")},"./src/WebGL/math/Quaternion.ts":(e,t,r)=>{r.r(t),r.d(t,{Quaternion:()=>i});class i{constructor(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}inverse(){return this.conjugate().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthxyz(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){var e=this.length();return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(this.x*=e=1/e,this.y*=e,this.z*=e,this.w*=e),this}multiply(e){return this.multiplyQuaternions(this,e)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}multiplyQuaternions(e,t){var r=e.x,i=e.y,s=e.z,e=e.w,n=t.x,a=t.y,o=t.z,t=t.w;return this.x=r*t+e*n+i*o-s*a,this.y=i*t+e*a+s*n-r*o,this.z=s*t+e*o+r*a-i*n,this.w=e*t-r*n-i*a-s*o,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}clone(){return new i(this.x,this.y,this.z,this.w)}setFromEuler(e){var t=Math.cos(e.x/2),r=Math.cos(e.y/2),i=Math.cos(e.z/2),s=Math.sin(e.x/2),n=Math.sin(e.y/2),e=Math.sin(e.z/2);return this.x=s*r*i+t*n*e,this.y=t*n*i-s*r*e,this.z=t*r*e+s*n*i,this.w=t*r*i-s*n*e,this}}},"./src/WebGL/math/Vector2.ts":(e,t,r)=>{r.r(t),r.d(t,{Vector2:()=>i});class i{constructor(e,t){this.x=e||0,this.y=t||0}set(e,t){return this.x=e,this.y=t,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}copy(e){return this.x=e.x,this.y=e.y,this}clone(){return new i(this.x,this.y)}}},"./src/WebGL/math/index.ts":(e,t,r)=>{r.r(t),r.d(t,{Matrix3:()=>l.Matrix3,Matrix4:()=>l.Matrix4,Quaternion:()=>i.Quaternion,Ray:()=>l.Ray,Vector2:()=>s.Vector2,Vector3:()=>l.Vector3,clamp:()=>n.clamp,conversionMatrix3:()=>a.conversionMatrix3,degToRad:()=>o.degToRad});var i=r("./src/WebGL/math/Quaternion.ts"),s=r("./src/WebGL/math/Vector2.ts"),n=r("./src/WebGL/math/utils/clamp.ts"),a=r("./src/WebGL/math/utils/conversionMatrix3.ts"),o=r("./src/WebGL/math/utils/degToRad.ts"),l=r("./src/WebGL/math/math.ts")},"./src/WebGL/math/math.ts":(e,t,r)=>{r.r(t),r.d(t,{Matrix3:()=>u,Matrix4:()=>i,Ray:()=>p,Vector3:()=>d});var s,n,a,o,l,h=r("./src/WebGL/math/utils/degToRad.ts"),c=r("./src/WebGL/math/utils/clamp.ts");class i{constructor(e=1,t=0,r=0,i=0,s=0,n=1,a=0,o=0,l=0,h=0,c=1,d=0,u=0,p=0,f=0,m=1){void 0!==e&&"number"!=typeof e?this.elements=new Float32Array(e):(this.elements=new Float32Array(16),this.elements[0]=e,this.elements[4]=t,this.elements[8]=r,this.elements[12]=i,this.elements[1]=s,this.elements[5]=n,this.elements[9]=a,this.elements[13]=o,this.elements[2]=l,this.elements[6]=h,this.elements[10]=c,this.elements[14]=d,this.elements[3]=u,this.elements[7]=p,this.elements[11]=f,this.elements[15]=m)}makeScale(e,t,r){throw new Error("Method not implemented.")}set(e,t,r,i,s,n,a,o,l,h,c,d,u,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=s,g[5]=n,g[9]=a,g[13]=o,g[2]=l,g[6]=h,g[10]=c,g[14]=d,g[3]=u,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}copy(e){e=e.elements;return this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this}matrix3FromTopLeft(){var e=this.elements;return new u(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10])}setRotationFromEuler(e,t){const r=this.elements;var i,s,n,a,{x:e,y:o,z:l}=e,h=Math.cos(e),e=Math.sin(e),c=Math.cos(o),o=Math.sin(o),d=Math.cos(l),l=Math.sin(l);return void 0===t||"XYZ"===t?(i=h*d,s=h*l,n=e*d,a=e*l,r[0]=c*d,r[4]=-c*l,r[8]=o,r[1]=s+n*o,r[5]=i-a*o,r[9]=-e*c,r[2]=a-i*o,r[6]=n+s*o,r[10]=h*c):console.error("Error with matrix4 setRotationFromEuler. Order: "+t),this}setRotationFromQuaternion(e){const t=this.elements;var{x:e,y:r,z:i,w:s}=e,n=e+e,a=r+r,o=i+i,l=e*n,h=e*a,e=e*o,c=r*a,r=r*o,i=i*o,n=s*n,a=s*a,s=s*o;return t[0]=1-(c+i),t[4]=h-s,t[8]=e+a,t[1]=h+s,t[5]=1-(l+i),t[9]=r-n,t[2]=e-a,t[6]=r+n,t[10]=1-(l+c),this}multiplyMatrices(e,t){e=e.elements,t=t.elements;const r=this.elements;var i=e[0],s=e[4],n=e[8],a=e[12],o=e[1],l=e[5],h=e[9],c=e[13],d=e[2],u=e[6],p=e[10],f=e[14],m=e[3],g=e[7],v=e[11],e=e[15],b=t[0],_=t[4],y=t[8],x=t[12],w=t[1],A=t[5],S=t[9],C=t[13],L=t[2],M=t[6],z=t[10],T=t[14],E=t[3],F=t[7],D=t[11],t=t[15];return r[0]=i*b+s*w+n*L+a*E,r[4]=i*_+s*A+n*M+a*F,r[8]=i*y+s*S+n*z+a*D,r[12]=i*x+s*C+n*T+a*t,r[1]=o*b+l*w+h*L+c*E,r[5]=o*_+l*A+h*M+c*F,r[9]=o*y+l*S+h*z+c*D,r[13]=o*x+l*C+h*T+c*t,r[2]=d*b+u*w+p*L+f*E,r[6]=d*_+u*A+p*M+f*F,r[10]=d*y+u*S+p*z+f*D,r[14]=d*x+u*C+p*T+f*t,r[3]=m*b+g*w+v*L+e*E,r[7]=m*_+g*A+v*M+e*F,r[11]=m*y+g*S+v*z+e*D,r[15]=m*x+g*C+v*T+e*t,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}makeTranslation(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}snap(e){var t=Math.pow(10,4);const r=this.elements;for(let e=0;e<16;e++){var i=Math.round(r[e]);i===Math.round(r[e]*t)/t&&(r[e]=i)}return this}transpose(){const e=this.elements;var t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e){const t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}translate(e){const t=this.elements;return t[12]+=e.x,t[13]+=e.y,t[14]+=e.z,this}getInverse(e,t){const r=this.elements;var e=e.elements,i=e[0],s=e[4],n=e[8],a=e[12],o=e[1],l=e[5],h=e[9],c=e[13],d=e[2],u=e[6],p=e[10],f=e[14],m=e[3],g=e[7],v=e[11],e=e[15],e=(r[0]=h*f*g-c*p*g+c*u*v-l*f*v-h*u*e+l*p*e,r[4]=a*p*g-n*f*g-a*u*v+s*f*v+n*u*e-s*p*e,r[8]=n*c*g-a*h*g+a*l*v-s*c*v-n*l*e+s*h*e,r[12]=a*h*u-n*c*u-a*l*p+s*c*p+n*l*f-s*h*f,r[1]=c*p*m-h*f*m-c*d*v+o*f*v+h*d*e-o*p*e,r[5]=n*f*m-a*p*m+a*d*v-i*f*v-n*d*e+i*p*e,r[9]=a*h*m-n*c*m-a*o*v+i*c*v+n*o*e-i*h*e,r[13]=n*c*d-a*h*d+a*o*p-i*c*p-n*o*f+i*h*f,r[2]=l*f*m-c*u*m+c*d*g-o*f*g-l*d*e+o*u*e,r[6]=a*u*m-s*f*m-a*d*g+i*f*g+s*d*e-i*u*e,r[10]=s*c*m-a*l*m+a*o*g-i*c*g-s*o*e+i*l*e,r[14]=a*l*d-s*c*d-a*o*u+i*c*u+s*o*f-i*l*f,r[3]=h*u*m-l*p*m-h*d*g+o*p*g+l*d*v-o*u*v,r[7]=s*p*m-n*u*m+n*d*g-i*p*g-s*d*v+i*u*v,r[11]=n*l*m-s*h*m-n*o*g+i*h*g+s*o*v-i*l*v,r[15]=s*h*d-n*l*d+n*o*u-i*h*u-s*o*p+i*l*p,i*r[0]+o*r[4]+d*r[8]+m*r[12]);if(0!=e)return this.multiplyScalar(1/e),this;a="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(a);return console.warn(a),this.identity(),this}isReflected(){var e=this.elements,t=e[0],r=e[4],i=e[8],s=e[1],n=e[5],a=e[9],o=e[2],l=e[6],e=e[10];return t*n*e+s*l*i+o*r*a-o*n*i-s*r*e-t*l*a<0}scale(e){const t=this.elements;var r=e["x"],i=e["y"],e=e["z"];return t[0]*=r,t[4]*=i,t[8]*=e,t[1]*=r,t[5]*=i,t[9]*=e,t[2]*=r,t[6]*=i,t[10]*=e,t[3]*=r,t[7]*=i,t[11]*=e,this}getMaxScaleOnAxis(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,e)))}makeFrustum(e,t,r,i,s,n){const a=this.elements;var o=2*s/(i-r),l=(t+e)/(t-e),i=(i+r)/(i-r),r=-(n+s)/(n-s),n=-2*n*s/(n-s);return a[0]=2*s/(t-e),a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=o,a[9]=i,a[13]=0,a[2]=0,a[6]=0,a[10]=r,a[14]=n,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makePerspective(e,t,r,i){var e=r*Math.tan((0,h.degToRad)(.5*e)),s=-e;return this.makeFrustum(s*t,e*t,s,e,r,i)}makeOrthographic(e,t,r,i,s,n){const a=this.elements;var o=1/(t-e),l=1/(r-i),h=1/(n-s),t=(t+e)*o,e=(r+i)*l,r=(n+s)*h;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-t,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-e,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-r,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}isEqual(e){var e=e.elements,t=this.elements;return t[0]===e[0]&&t[4]===e[4]&&t[8]===e[8]&&t[12]===e[12]&&t[1]===e[1]&&t[5]===e[5]&&t[9]===e[9]&&t[13]===e[13]&&t[2]===e[2]&&t[6]===e[6]&&t[10]===e[10]&&t[14]===e[14]&&t[3]===e[3]&&t[7]===e[7]&&t[11]===e[11]&&t[15]===e[15]}clone(){var e=this.elements;return new i(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}isIdentity(){var e=this.elements;return 1===e[0]&&0===e[4]&&0===e[8]&&0===e[12]&&0===e[1]&&1===e[5]&&0===e[9]&&0===e[13]&&0===e[2]&&0===e[6]&&1===e[10]&&0===e[14]&&0===e[3]&&0===e[7]&&0===e[11]&&1===e[15]}isNearlyIdentity(e){const t=this.clone().snap(e);return t.isIdentity()}getScale(e){var t=this.elements;return e=e||new d,a.set(t[0],t[1],t[2]),o.set(t[4],t[5],t[6]),l.set(t[8],t[9],t[10]),e.x=a.length(),e.y=o.length(),e.z=l.length(),e}lookAt(e,t,r){const i=this.elements;return l.subVectors(e,t).normalize(),0===l.length()&&(l.z=1),a.crossVectors(r,l).normalize(),0===a.length()&&(l.x+=1e-4,a.crossVectors(r,l).normalize()),o.crossVectors(l,a),i[0]=a.x,i[4]=o.x,i[8]=l.x,i[1]=a.y,i[5]=o.y,i[9]=l.y,i[2]=a.z,i[6]=o.z,i[10]=l.z,this}compose(e,t,r){const i=this.elements;return s.identity(),s.setRotationFromQuaternion(t),n.makeScale(r.x,r.y,r.z),this.multiplyMatrices(s,n),i[12]=e.x,i[13]=e.y,i[14]=e.z,this}}s=new i,n=new i;class d{constructor(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0,this.atomid=void 0}set(e,t,r){return this.x=e,this.y=t,this.z=r,this}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}divideScalar(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):(this.x=0,this.y=0,this.z=0),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,r=this.y-e.y,e=this.z-e.z;return t*t+r*r+e*e}applyMatrix3(e){var t=this["x"],r=this["y"],i=this["z"],e=e.elements;return this.x=e[0]*t+e[3]*r+e[6]*i,this.y=e[1]*t+e[4]*r+e[7]*i,this.z=e[2]*t+e[5]*r+e[8]*i,this}applyMatrix4(e){var t=this["x"],r=this["y"],i=this["z"],e=e.elements;return this.x=e[0]*t+e[4]*r+e[8]*i+e[12],this.y=e[1]*t+e[5]*r+e[9]*i+e[13],this.z=e[2]*t+e[6]*r+e[10]*i+e[14],this}applyProjection(e){var t=this["x"],r=this["y"],i=this["z"],e=e.elements,s=e[3]*t+e[7]*r+e[11]*i+e[15];return this.x=(e[0]*t+e[4]*r+e[8]*i+e[12])/s,this.y=(e[1]*t+e[5]*r+e[9]*i+e[13])/s,this.z=(e[2]*t+e[6]*r+e[10]*i+e[14])/s,this}applyQuaternion(e){var t=this["x"],r=this["y"],i=this["z"],s=e.x,n=e.y,a=e.z,e=e.w;const o={},l=(o.x=2*(r*a-i*n),o.y=2*(i*s-t*a),o.z=2*(t*n-r*s),{});return l.x=o.y*a-o.z*n,l.y=o.z*s-o.x*a,l.z=o.x*n-o.y*s,this.x=t+e*o.x+l.x,this.y=r+e*o.y+l.y,this.z=i+e*o.z+l.z,this}negate(){return this.multiplyScalar(-1)}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.divideScalar(this.length())}cross(e){var t=this["x"],r=this["y"],i=this["z"];return this.x=r*e.z-i*e.y,this.y=i*e.x-t*e.z,this.z=t*e.y-r*e.x,this}crossVectors(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this}equals(e){return this.x==e.x&&this.y==e.y&&this.z==e.z}getPositionFromMatrix(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this}setEulerFromRotationMatrix(e,t){var e=e.elements,r=e[0],i=e[4],s=e[8],n=e[5],a=e[9],o=e[6],e=e[10];return void 0===t||"XYZ"===t?(this.y=Math.asin((0,c.clamp)(s,-1,1)),Math.abs(s)<.99999?(this.x=Math.atan2(-a,e),this.z=Math.atan2(-i,r)):(this.x=Math.atan2(o,n),this.z=0)):console.error("Error with vector's setEulerFromRotationMatrix: Unknown order: "+t),this}rotateAboutVector(e,t){e.normalize();var r=Math.cos(t),t=Math.sin(t);const i=this.clone().multiplyScalar(r);t=e.clone().cross(this).multiplyScalar(t),e=e.clone().multiplyScalar(e.clone().dot(this)).multiplyScalar(1-r),r=i.add(t).add(e);return this.x=r.x,this.y=r.y,this.z=r.z,this}setFromMatrixPosition(e){e=e.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}transformDirection(e){var t=this["x"],r=this["y"],i=this["z"],e=e.elements;return this.x=e[0]*t+e[4]*r+e[8]*i,this.y=e[1]*t+e[5]*r+e[9]*i,this.z=e[2]*t+e[6]*r+e[10]*i,this.normalize()}clone(){return new d(this.x,this.y,this.z)}unproject(e){const t=s;return t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyMatrix4(t)}}a=new d,o=new d,l=new d;class u{constructor(e=1,t=0,r=0,i=0,s=1,n=0,a=0,o=0,l=1){this.elements=new Float32Array(9),this.set(e,t,r,i,s,n,a,o,l)}set(e,t,r,i,s,n,a,o,l){const h=this.elements;return h[0]=e,h[3]=t,h[6]=r,h[1]=i,h[4]=s,h[7]=n,h[2]=a,h[5]=o,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){e=e.elements;this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}getInverse3(e){e=e.elements;const t=this.elements;t[0]=e[4]*e[8]-e[5]*e[7],t[3]=e[6]*e[5]-e[3]*e[8],t[6]=e[3]*e[7]-e[6]*e[4],t[1]=e[7]*e[2]-e[1]*e[8],t[4]=e[0]*e[8]-e[6]*e[2],t[7]=e[1]*e[6]-e[0]*e[7],t[2]=e[1]*e[5]-e[2]*e[4],t[5]=e[2]*e[3]-e[0]*e[5],t[8]=e[0]*e[4]-e[1]*e[3];e=e[0]*t[0]+e[3]*t[1]+e[6]*t[2];return this.multiplyScalar(1/e),this}getInverse(e,t){e=e.elements;const r=this.elements;r[0]=e[10]*e[5]-e[6]*e[9],r[1]=-e[10]*e[1]+e[2]*e[9],r[2]=e[6]*e[1]-e[2]*e[5],r[3]=-e[10]*e[4]+e[6]*e[8],r[4]=e[10]*e[0]-e[2]*e[8],r[5]=-e[6]*e[0]+e[2]*e[4],r[6]=e[9]*e[4]-e[5]*e[8],r[7]=-e[9]*e[0]+e[1]*e[8],r[8]=e[5]*e[0]-e[1]*e[4];e=e[0]*r[0]+e[1]*r[3]+e[2]*r[6];if(0!=e)return this.multiplyScalar(1/e),this;e="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(e);return console.warn(e),this.identity(),this}getDeterminant(){var e=this.elements;return e[0]*e[4]*e[8]+e[1]*e[5]*e[6]+e[2]*e[3]*e[7]-e[2]*e[4]*e[6]-e[1]*e[3]*e[8]-e[0]*e[5]*e[7]}transpose(){var e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}clone(){var e=this.elements;return new u(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}getMatrix4(){var e=this.elements;return new i(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0)}}class p{constructor(e,t){this.origin=void 0!==e?e:new d,this.direction=void 0!==t?t:new d}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){const r=t||new d;return r.copy(this.direction).multiplyScalar(e).add(this.origin)}recast(e){var t=a;return this.origin.copy(this.at(e,t)),this}closestPointToPoint(e,t){const r=t||new d;r.subVectors(e,this.origin);t=r.dot(this.direction);return r.copy(this.direction).multiplyScalar(t).add(this.origin)}distanceToPoint(e){const t=a;var r=t.subVectors(e,this.origin).dot(this.direction);return t.copy(this.direction).multiplyScalar(r).add(this.origin),t.distanceTo(e)}isIntersectionCylinder(){}isIntersectionSphere(e){return this.distanceToPoint(e.center)<=e.radius}isIntersectionPlane(e){return 0!==e.normal.dot(this.direction)||0===e.distanceToPoint(this.origin)}distanceToPlane(e){var t=e.normal.dot(this.direction);return 0===t?0===e.distanceToPoint(this.origin)?0:void 0:-(this.origin.dot(e.normal)+e.constant)/t}intersectPlane(e,t){e=this.distanceToPlane(e);if(void 0!==e)return this.at(e,t)}applyMatrix4(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this}clone(){return(new p).copy(this)}}},"./src/WebGL/math/utils/clamp.ts":(e,t,r)=>{r.r(t),r.d(t,{clamp:()=>function(e,t,r){return Math.min(Math.max(e,t),r)}})},"./src/WebGL/math/utils/conversionMatrix3.ts":(e,t,r)=>{r.r(t),r.d(t,{conversionMatrix3:()=>function(e,t,r,i,s,n){i=i*Math.PI/180,s=s*Math.PI/180,n=n*Math.PI/180;var a=e=>e*e,i=Math.cos(i),s=Math.cos(s),o=Math.cos(n),n=Math.sin(n),e=new l.Matrix3(e,t*o,r*s,0,t*n,r*(i-s*o)/n,0,0,r*Math.sqrt(1-a(i)-a(s)-a(o)+2*i*s*o)/n);return e}});var l=r("./src/WebGL/math/math.ts")},"./src/WebGL/math/utils/degToRad.ts":(e,t,r)=>{r.r(t),r.d(t,{degToRad:()=>function(e){return e*i}});const i=Math.PI/180},"./src/WebGL/objects/Line.ts":(e,i,t)=>{t.r(i),t.d(i,{Line:()=>n,LineStyle:()=>s});var s,r,i=t("./src/WebGL/materials/index.ts"),t=t("./src/WebGL/core/index.ts");(r=s=s||{})[r.LineStrip=0]="LineStrip",r[r.LinePieces=1]="LinePieces";class n extends t.Object3D{constructor(e,t=new i.LineBasicMaterial({color:16777215*Math.random()}),r=s.LineStrip){super(),this.geometry=e,this.material=t,this.type=r}clone(e=new n(this.geometry,this.material,this.type)){return super.clone.call(this,e),e}}},"./src/WebGL/objects/Mesh.ts":(e,t,r)=>{r.r(t),r.d(t,{Mesh:()=>i});t=r("./src/WebGL/core/index.ts");class i extends t.Object3D{constructor(e,t){super(),this.geometry=e,this.material=t}clone(e){return void 0===e&&(e=new i(this.geometry,this.material)),super.clone.call(this,e),e}}},"./src/WebGL/objects/Sprite.ts":(e,t,r)=>{r.r(t),r.d(t,{Sprite:()=>s});var t=r("./src/WebGL/materials/index.ts"),i=r("./src/WebGL/core/index.ts");class s extends i.Object3D{constructor(e=new t.SpriteMaterial){super(),this.material=e,this.rotation3d=this.rotation,this.rotation=0}updateMatrix(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),1===this.scale.x&&1===this.scale.y||this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}clone(e=new s(this.material)){return i.Object3D.prototype.clone.call(this,e),e}}},"./src/WebGL/objects/index.ts":(e,t,r)=>{r.r(t),r.d(t,{Line:()=>i.Line,LineStyle:()=>i.LineStyle,Mesh:()=>s.Mesh,Sprite:()=>n.Sprite});var i=r("./src/WebGL/objects/Line.ts"),s=r("./src/WebGL/objects/Mesh.ts"),n=r("./src/WebGL/objects/Sprite.ts")},"./src/WebGL/shaders/ShaderType.ts":(e,t,r)=>{r.r(t)},"./src/WebGL/shaders/index.ts":(e,t,r)=>{r.r(t),r.d(t,{ShaderLib:()=>i.ShaderLib,ShaderUtils:()=>s.ShaderUtils,basic:()=>i.basic,clone:()=>s.clone,instanced:()=>i.instanced,lambert:()=>i.lambert,lambertdouble:()=>i.lambertdouble,outline:()=>i.outline,screen:()=>i.screen,screenaa:()=>i.screenaa,sphereimposter:()=>i.sphereimposter,sphereimposteroutline:()=>i.sphereimposteroutline,sprite:()=>i.sprite,stickimposter:()=>i.stickimposter,stickimposteroutline:()=>i.stickimposteroutline,volumetric:()=>i.volumetric});var i=r("./src/WebGL/shaders/lib/index.ts"),s=r("./src/WebGL/shaders/utils/index.ts");r("./src/WebGL/shaders/ShaderType.ts")},"./src/WebGL/shaders/lib/basic/basic.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="uniform mat4 viewMatrix;\nuniform float opacity;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvarying vec3 vColor;\nvarying vec4 mvPosition;\n\n//DEFINEFRAGCOLOR\nvoid main() {\n    gl_FragColor = vec4( vColor, opacity );\n    if(fogNear != fogFar) {\n        float depth = -mvPosition.z;\n        float fogFactor = smoothstep( fogNear, fogFar, depth );\n        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n    }\n}"},"./src/WebGL/shaders/lib/basic/basic.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\n\nattribute vec3 position;\nattribute vec3 color;\n\nvarying vec3 vColor;\nvarying vec4 mvPosition;\n\nvoid main() {\n\n    vColor = color;\n    mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n\n}"},"./src/WebGL/shaders/lib/basic/index.ts":(e,t,r)=>{r.r(t),r.d(t,{basic:()=>s});var t=r("./src/WebGL/shaders/lib/basic/uniforms.ts"),i=r("./src/WebGL/shaders/lib/basic/basic.frag");const s={vertexShader:r("./src/WebGL/shaders/lib/basic/basic.vert").default.replace("#define GLSLIFY 1",""),fragmentShader:i.default.replace("#define GLSLIFY 1",""),uniforms:t.uniforms}},"./src/WebGL/shaders/lib/basic/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new(r("./src/colors.ts").Color)(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}},"./src/WebGL/shaders/lib/blur/blur.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="const float INV_TOTAL_SAMPLES_FACTOR = 1.0 / 9.0;\nuniform highp sampler2D inTex;\nvarying highp vec2 vTexCoords;\n    \nvoid main() {\n \n vec2 texelSize = 1.0 / vec2(textureSize(inTex,0));\n float blurred_visibility_factor = 0.0f;\n for (int t = -1; t <= 1; ++t) {\n  for (int s = -1; s <= 1; ++s) {\n   vec2 offset = vec2(float(s), float(t)) * texelSize;\n   blurred_visibility_factor += texture2D(inTex, vTexCoords + offset).r;\n  }\n }\n    \n gl_FragDepthEXT = blurred_visibility_factor * INV_TOTAL_SAMPLES_FACTOR;\n \n}"},"./src/WebGL/shaders/lib/blur/blur.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="attribute vec2 vertexPosition;\nvarying highp vec2 vTexCoords;\nconst vec2 scale = vec2(0.5, 0.5);\n\nvoid main() {\n   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range\n   gl_Position = vec4(vertexPosition, 0.0, 1.0);\n}\n        "},"./src/WebGL/shaders/lib/blur/index.ts":(e,t,r)=>{r.r(t),r.d(t,{blur:()=>s});var t=r("./src/WebGL/shaders/lib/blur/uniforms.ts"),i=r("./src/WebGL/shaders/lib/blur/blur.frag"),r=r("./src/WebGL/shaders/lib/blur/blur.vert");const s={fragmentShader:i.default,vertexShader:r.default,uniforms:t.uniforms}},"./src/WebGL/shaders/lib/blur/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});const i={}},"./src/WebGL/shaders/lib/index.ts":(e,t,r)=>{r.r(t),r.d(t,{ShaderLib:()=>g,basic:()=>i.basic,instanced:()=>s.instanced,lambert:()=>n.lambert,lambertdouble:()=>a.lambertdouble,outline:()=>o.outline,screen:()=>l.screen,screenaa:()=>h.screenaa,sphereimposter:()=>c.sphereimposter,sphereimposteroutline:()=>d.sphereimposteroutline,sprite:()=>u.sprite,stickimposter:()=>p.stickimposter,stickimposteroutline:()=>f.stickimposteroutline,volumetric:()=>m.volumetric});var i=r("./src/WebGL/shaders/lib/basic/index.ts"),s=r("./src/WebGL/shaders/lib/instanced/index.ts"),n=r("./src/WebGL/shaders/lib/lambert/index.ts"),a=r("./src/WebGL/shaders/lib/lambertdouble/index.ts"),o=r("./src/WebGL/shaders/lib/outline/index.ts"),l=r("./src/WebGL/shaders/lib/screen/index.ts"),h=r("./src/WebGL/shaders/lib/screenaa/index.ts"),c=r("./src/WebGL/shaders/lib/sphereimposter/index.ts"),d=r("./src/WebGL/shaders/lib/sphereimposteroutline/index.ts"),u=r("./src/WebGL/shaders/lib/sprite/index.ts"),p=r("./src/WebGL/shaders/lib/stickimposter/index.ts"),f=r("./src/WebGL/shaders/lib/stickimposteroutline/index.ts"),m=r("./src/WebGL/shaders/lib/volumetric/index.ts"),t=r("./src/WebGL/shaders/lib/ssao/index.ts"),r=r("./src/WebGL/shaders/lib/blur/index.ts");const g={basic:i.basic,blur:r.blur,instanced:s.instanced,lambert:n.lambert,lambertdouble:a.lambertdouble,outline:o.outline,screen:l.screen,screenaa:h.screenaa,ssao:t.ssao,sphereimposter:c.sphereimposter,sphereimposteroutline:d.sphereimposteroutline,sprite:u.sprite,stickimposter:p.stickimposter,stickimposteroutline:f.stickimposteroutline,volumetric:m.volumetric}},"./src/WebGL/shaders/lib/instanced/index.ts":(e,t,r)=>{r.r(t),r.d(t,{instanced:()=>s});var t=r("./src/WebGL/shaders/lib/instanced/uniforms.ts"),i=r("./src/WebGL/shaders/lib/instanced/instanced.frag"),r=r("./src/WebGL/shaders/lib/instanced/instanced.vert");const s={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:r.default.replace("#define GLSLIFY 1",""),uniforms:t.uniforms}},"./src/WebGL/shaders/lib/instanced/instanced.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="uniform mat4 viewMatrix;\nuniform float opacity;\n\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\n#ifdef SHADED\nuniform highp sampler2D shading;\n#endif\nvarying vec3 vLightFront;\nvarying vec3 vColor;\n//DEFINEFRAGCOLOR\n\nvoid main() {\n\n    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );\n\n    #ifndef WIREFRAME\n    gl_FragColor.xyz *= vLightFront;\n    #endif\n\n#ifdef SHADED\n    ivec2 dim = textureSize(shading,0);\n    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;\n    vColor *= shadowFactor;\n#endif\n    gl_FragColor = gl_FragColor * vec4( vColor, opacity );\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n    float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n\n}\n\n\n"},"./src/WebGL/shaders/lib/instanced/instanced.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 directionalLightColor[ 1 ];\nuniform vec3 directionalLightDirection[ 1 ];\n\nattribute vec3 offset;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float radius;\n\nvarying vec3 vColor;\nvarying vec3 vLightFront;\n\nvoid main() {\n\n    vColor = color;\n\n    vec3 objectNormal = normal;\n    vec3 transformedNormal = normalMatrix * objectNormal;\n    vec4 mvPosition = modelViewMatrix * vec4( position * radius + offset, 1.0 );\n\n    vLightFront = vec3( 0.0 );\n\n    transformedNormal = normalize( transformedNormal );\n\n    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\n    vec3 dirVector = normalize( lDirection.xyz );\n    float dotProduct = dot( transformedNormal, dirVector );\n    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;\n\n    gl_Position = projectionMatrix * mvPosition;\n}\n\n"},"./src/WebGL/shaders/lib/instanced/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new(r("./src/colors.ts").Color)(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/lambert/index.ts":(e,t,r)=>{r.r(t),r.d(t,{lambert:()=>s});var t=r("./src/WebGL/shaders/lib/lambert/uniforms.ts"),i=r("./src/WebGL/shaders/lib/lambert/lambert.frag"),r=r("./src/WebGL/shaders/lib/lambert/lambert.vert");const s={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:r.default.replace("#define GLSLIFY 1",""),uniforms:t.uniforms}},"./src/WebGL/shaders/lib/lambert/lambert.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="uniform mat4 viewMatrix;\nuniform float opacity;\n\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\n#ifdef SHADED\nuniform highp sampler2D shading;\n#endif\nvarying vec3 vLightFront;\nvarying vec3 vColor;\nvarying vec4 mvPosition;\n\n\n//DEFINEFRAGCOLOR\n\nvoid main() {\n\n    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );\n\n    #ifndef WIREFRAME\n    gl_FragColor.xyz *= vLightFront;\n    #endif\n#ifdef SHADED\n    ivec2 dim = textureSize(shading,0);\n    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;\n    vColor *= shadowFactor;\n#endif\n    gl_FragColor = gl_FragColor * vec4( vColor, opacity );\n\n    if(fogNear != fogFar) {\n        float depth = -mvPosition.z;\n        float fogFactor = smoothstep( fogNear, fogFar, depth );\n        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n    }\n\n}"},"./src/WebGL/shaders/lib/lambert/lambert.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 directionalLightColor[ 1 ];\nuniform vec3 directionalLightDirection[ 1 ];\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\n\nvarying vec3 vColor;\nvarying vec3 vLightFront;\nvarying vec4 mvPosition;\n\nvoid main() {\n\n    vColor = color;\n\n    vec3 objectNormal = normal;\n    vec3 transformedNormal = normalMatrix * objectNormal;\n    mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n    vLightFront = vec3( 0.0 );\n\n    transformedNormal = normalize( transformedNormal );\n\n    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\n    vec3 dirVector = normalize( lDirection.xyz );\n    float dotProduct = dot( transformedNormal, dirVector );\n    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;\n\n    gl_Position = projectionMatrix * mvPosition;\n}"},"./src/WebGL/shaders/lib/lambert/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new(r("./src/colors.ts").Color)(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/lambertdouble/index.ts":(e,t,r)=>{r.r(t),r.d(t,{lambertdouble:()=>s});var t=r("./src/WebGL/shaders/lib/lambertdouble/uniforms.ts"),i=r("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag"),r=r("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert");const s={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:r.default.replace("#define GLSLIFY 1",""),uniforms:t.uniforms}},"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\n#ifdef SHADED\nuniform highp sampler2D shading;\n#endif\n\nuniform mat4 viewMatrix;\nuniform float opacity;\n\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\n\nvarying vec3 vLightFront;\nvarying vec3 vLightBack;\n\nvarying vec3 vColor;\nvarying vec4 mvPosition;\n\n//DEFINEFRAGCOLOR\n\nvoid main() {\n\n    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );\n\n    #ifndef WIREFRAME\n    if ( gl_FrontFacing )\n       gl_FragColor.xyz *= vLightFront;\n    else\n       gl_FragColor.xyz *= vLightBack;\n    #endif\n\n    vec3 color = vColor;\n#ifdef SHADED\n    ivec2 dim = textureSize(shading,0);\n    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;\n    color *= shadowFactor;\n#endif\n    gl_FragColor = gl_FragColor * vec4( color, opacity );\n\n    if(fogNear != fogFar) {\n        float depth = -mvPosition.z;\n        float fogFactor = smoothstep( fogNear, fogFar, depth );\n        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n    }\n\n}\n\n\n"},"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 directionalLightColor[ 1 ];\nuniform vec3 directionalLightDirection[ 1 ];\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\n\nvarying vec3 vColor;\nvarying vec3 vLightFront;\nvarying vec3 vLightBack;\nvarying vec4 mvPosition;\n\nvoid main() {\n\n    vColor = color;\n\n    vec3 objectNormal = normal;\n    vec3 transformedNormal = normalMatrix * objectNormal;\n    mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n    vLightFront = vec3( 0.0 );\n    vLightBack = vec3( 0.0 );\n\n    transformedNormal = normalize( transformedNormal );\n\n    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\n    vec3 dirVector = normalize( lDirection.xyz );\n    float dotProduct = dot( transformedNormal, dirVector );\n    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n    vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;\n    vLightBack += directionalLightColor[ 0 ] * directionalLightWeightingBack;\n\n    gl_Position = projectionMatrix * mvPosition;\n}\n\n"},"./src/WebGL/shaders/lib/lambertdouble/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new(r("./src/colors.ts").Color)(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/outline/index.ts":(e,t,r)=>{r.r(t),r.d(t,{outline:()=>s});var t=r("./src/WebGL/shaders/lib/outline/uniforms.ts"),i=r("./src/WebGL/shaders/lib/outline/outline.frag"),r=r("./src/WebGL/shaders/lib/outline/outline.vert");const s={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:r.default.replace("#define GLSLIFY 1",""),uniforms:t.uniforms}},"./src/WebGL/shaders/lib/outline/outline.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\n\nuniform float opacity;\nuniform vec3 outlineColor;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\n\nvarying vec4 mvPosition;\n//DEFINEFRAGCOLOR\n\nvoid main() {\n    gl_FragColor = vec4( outlineColor, 1 );\n\n    if(fogNear != fogFar) {\n        float depth = -mvPosition.z;\n        float fogFactor = smoothstep( fogNear, fogFar, depth );\n        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n    }\n}\n\n\n"},"./src/WebGL/shaders/lib/outline/outline.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float outlineWidth;\nuniform float outlinePushback;\nuniform float vWidth;\nuniform float vHeight;\nuniform float outlineMaxPixels;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\n\nvarying vec4 mvPosition;\n\nvoid main() {\n\n    vec4 norm = modelViewMatrix*vec4(normalize(normal),0.0);\n    mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    mvPosition.xy += norm.xy*outlineWidth;\n    vec4 outpos = projectionMatrix * mvPosition;\n\n    if(outlineMaxPixels > 0.0) {\n        vec4 unadjusted = projectionMatrix*modelViewMatrix * vec4( position, 1.0 );\n        float w = outpos.w;\n        //normalize homogeneous coords\n        unadjusted /= unadjusted.w;\n        outpos /= outpos.w;\n        vec2 diff = outpos.xy-unadjusted.xy;\n        //put into pixels\n        diff.x *= vWidth;\n        diff.y *= vHeight;\n        if ( length(diff) > outlineMaxPixels) {\n            vec2 ndiff = normalize(diff)*outlineMaxPixels;\n            ndiff.x /= vWidth;\n            ndiff.y /= vHeight;\n            outpos.xy = unadjusted.xy;\n            outpos.xy += ndiff;\n        }\n        outpos *= w; //if I don't do this things blow up\n    }\n    gl_Position = outpos;\n    mvPosition.z -= outlinePushback; //go backwards in model space\n    vec4 pushpos = projectionMatrix*mvPosition; //project to get z in projection space, I'm probably missing some simple math to do the same thing..\n    gl_Position.z = gl_Position.w*pushpos.z/pushpos.w;\n}\n\n"},"./src/WebGL/shaders/lib/outline/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});t=r("./src/colors.ts");const i={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new t.Color(0,0,0)},fogColor:{type:"c",value:new t.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0}}},"./src/WebGL/shaders/lib/screen/index.ts":(e,t,r)=>{r.r(t),r.d(t,{screen:()=>s});var t=r("./src/WebGL/shaders/lib/screen/uniforms.ts"),i=r("./src/WebGL/shaders/lib/screen/screen.frag"),r=r("./src/WebGL/shaders/lib/screen/screen.vert");const s={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:r.default.replace("#define GLSLIFY 1",""),uniforms:t.uniforms}},"./src/WebGL/shaders/lib/screen/screen.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="uniform sampler2D colormap;\nvarying highp vec2 vTexCoords;\nuniform vec2 dimensions;\n//DEFINEFRAGCOLOR\nvoid main (void) {\n   gl_FragColor = texture2D(colormap, vTexCoords);\n\n   //gl_FragColor.g = gl_FragColor.b =  gl_FragColor.r; //debug shading \n}\n        "},"./src/WebGL/shaders/lib/screen/screen.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="attribute vec2 vertexPosition;\nvarying highp vec2 vTexCoords;\nconst vec2 scale = vec2(0.5, 0.5);\n\nvoid main() {\n   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range\n   gl_Position = vec4(vertexPosition, 0.0, 1.0);\n}\n        "},"./src/WebGL/shaders/lib/screen/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});const i={}},"./src/WebGL/shaders/lib/screenaa/index.ts":(e,t,r)=>{r.r(t),r.d(t,{screenaa:()=>s});var t=r("./src/WebGL/shaders/lib/screenaa/uniforms.ts"),i=r("./src/WebGL/shaders/lib/screenaa/screenaa.frag"),r=r("./src/WebGL/shaders/lib/screenaa/screenaa.vert");const s={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:r.default.replace("#define GLSLIFY 1",""),uniforms:t.uniforms}},"./src/WebGL/shaders/lib/screenaa/screenaa.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\n        \nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nvarying highp vec2 vTexCoords;\n\n// adapted from https://github.com/kosua20/Rendu\n// MIT License Copyright (c) 2017 Simon Rodriguez\n// by way of molstar (https://github.com/molstar/molstar/blob/master/src/mol-gl/shader/fxaa.frag.ts)\n\n#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))\n\nfloat rgb2luma(vec3 rgb){\n    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));\n}\n\nfloat sampleLuma(vec2 uv) {\n    return rgb2luma(texture2D(tColor, uv).rgb);\n}\n\nfloat sampleLuma(vec2 uv, float uOffset, float vOffset) {\n    uv += vec2(uOffset, vOffset);\n    return sampleLuma(uv);\n}\n\n//DEFINEFRAGCOLOR\nvoid main(void) {\n    ivec2 dim = textureSize(tColor,0);\n    vec2 dimensions = vec2(float(dim.x),float(dim.y));\n    vec2 inverseScreenSize = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);\n    vec2 coords = vTexCoords;\n\n    vec4 colorCenter = texture2D(tColor, coords);\n    float dEdgeThresholdMin = 0.0312;\n    float dEdgeThresholdMax = 0.125;\n    int dIterations = 12;\n    float dSubpixelQuality = 0.3;\n\n    // Luma at the current fragment\n    float lumaCenter = rgb2luma(colorCenter.rgb);\n\n    // Luma at the four direct neighbours of the current fragment.\n    float lumaDown = sampleLuma(coords, 0.0, -inverseScreenSize.y);\n    float lumaUp = sampleLuma(coords, 0.0, inverseScreenSize.y);\n    float lumaLeft = sampleLuma(coords, -inverseScreenSize.x, 0.0);\n    float lumaRight = sampleLuma(coords, inverseScreenSize.x, 0.0);\n\n    // Find the maximum and minimum luma around the current fragment.\n    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));\n    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));\n\n    // Compute the delta.\n    float lumaRange = lumaMax - lumaMin;\n\n    // If the luma variation is lower that a threshold (or if we are in a really dark area),\n    // we are not on an edge, don't perform any AA.\n    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {\n        gl_FragColor = colorCenter;\n        return;\n    }\n\n    // Query the 4 remaining corners lumas.\n    float lumaDownLeft = sampleLuma(coords, -inverseScreenSize.x, -inverseScreenSize.y);\n    float lumaUpRight = sampleLuma(coords, inverseScreenSize.x, inverseScreenSize.y);\n    float lumaUpLeft = sampleLuma(coords, -inverseScreenSize.x, inverseScreenSize.y);\n    float lumaDownRight = sampleLuma(coords, inverseScreenSize.x, -inverseScreenSize.y);\n\n    // Combine the four edges lumas (using intermediary variables for future computations\n    // with the same values).\n    float lumaDownUp = lumaDown + lumaUp;\n    float lumaLeftRight = lumaLeft + lumaRight;\n\n    // Same for corners\n    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;\n    float lumaDownCorners = lumaDownLeft + lumaDownRight;\n    float lumaRightCorners = lumaDownRight + lumaUpRight;\n    float lumaUpCorners = lumaUpRight + lumaUpLeft;\n\n    // Compute an estimation of the gradient along the horizontal and vertical axis.\n    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);\n    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);\n\n    // Is the local edge horizontal or vertical ?\n    bool isHorizontal = (edgeHorizontal >= edgeVertical);\n\n    // Choose the step size (one pixel) accordingly.\n    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;\n\n    // Select the two neighboring texels lumas in the opposite direction to the local edge.\n    float luma1 = isHorizontal ? lumaDown : lumaLeft;\n    float luma2 = isHorizontal ? lumaUp : lumaRight;\n    // Compute gradients in this direction.\n    float gradient1 = luma1 - lumaCenter;\n    float gradient2 = luma2 - lumaCenter;\n\n    // Which direction is the steepest ?\n    bool is1Steepest = abs(gradient1) >= abs(gradient2);\n\n    // Gradient in the corresponding direction, normalized.\n    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));\n\n    // Average luma in the correct direction.\n    float lumaLocalAverage = 0.0;\n    if(is1Steepest){\n        // Switch the direction\n        stepLength = -stepLength;\n        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);\n    } else {\n        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);\n    }\n\n    // Shift UV in the correct direction by half a pixel.\n    vec2 currentUv = coords;\n    if(isHorizontal){\n        currentUv.y += stepLength * 0.5;\n    } else {\n        currentUv.x += stepLength * 0.5;\n    }\n\n    // Compute offset (for each iteration step) in the right direction.\n    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);\n    // Compute UVs to explore on each side of the edge, orthogonally.\n    // The QUALITY allows us to step faster.\n    vec2 uv1 = currentUv - offset * QUALITY(0);\n    vec2 uv2 = currentUv + offset * QUALITY(0);\n\n    // Read the lumas at both current extremities of the exploration segment,\n    // and compute the delta wrt to the local average luma.\n    float lumaEnd1 = sampleLuma(uv1);\n    float lumaEnd2 = sampleLuma(uv2);\n    lumaEnd1 -= lumaLocalAverage;\n    lumaEnd2 -= lumaLocalAverage;\n\n    // If the luma deltas at the current extremities is larger than the local gradient,\n    // we have reached the side of the edge.\n    bool reached1 = abs(lumaEnd1) >= gradientScaled;\n    bool reached2 = abs(lumaEnd2) >= gradientScaled;\n    bool reachedBoth = reached1 && reached2;\n\n    // If the side is not reached, we continue to explore in this direction.\n    if(!reached1){\n        uv1 -= offset * QUALITY(1);\n    }\n    if(!reached2){\n        uv2 += offset * QUALITY(1);\n    }\n\n    // If both sides have not been reached, continue to explore.\n    if(!reachedBoth){\n        for(int i = 2; i < dIterations; i++){\n            // If needed, read luma in 1st direction, compute delta.\n            if(!reached1){\n                lumaEnd1 = sampleLuma(uv1);\n                lumaEnd1 = lumaEnd1 - lumaLocalAverage;\n            }\n            // If needed, read luma in opposite direction, compute delta.\n            if(!reached2){\n                lumaEnd2 = sampleLuma(uv2);\n                lumaEnd2 = lumaEnd2 - lumaLocalAverage;\n            }\n            // If the luma deltas at the current extremities is larger than the local gradient,\n            // we have reached the side of the edge.\n            reached1 = abs(lumaEnd1) >= gradientScaled;\n            reached2 = abs(lumaEnd2) >= gradientScaled;\n            reachedBoth = reached1 && reached2;\n\n            // If the side is not reached, we continue to explore in this direction,\n            // with a variable quality.\n            if(!reached1){\n                uv1 -= offset * QUALITY(i);\n            }\n            if(!reached2){\n                uv2 += offset * QUALITY(i);\n            }\n\n            // If both sides have been reached, stop the exploration.\n            if(reachedBoth){\n                break;\n            }\n        }\n    }\n\n    // Compute the distances to each side edge of the edge (!).\n    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);\n    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);\n\n    // In which direction is the side of the edge closer ?\n    bool isDirection1 = distance1 < distance2;\n    float distanceFinal = min(distance1, distance2);\n\n    // Thickness of the edge.\n    float edgeThickness = (distance1 + distance2);\n\n    // Is the luma at center smaller than the local average ?\n    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;\n\n    // If the luma at center is smaller than at its neighbour,\n    // the delta luma at each end should be positive (same variation).\n    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;\n    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;\n\n    // Only keep the result in the direction of the closer side of the edge.\n    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;\n\n    // UV offset: read in the direction of the closest side of the edge.\n    float pixelOffset = - distanceFinal / edgeThickness + 0.5;\n\n    // If the luma variation is incorrect, do not offset.\n    float finalOffset = correctVariation ? pixelOffset : 0.0;\n\n    // Sub-pixel shifting\n    // Full weighted average of the luma over the 3x3 neighborhood.\n    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);\n    // Ratio of the delta between the global average and the center luma,\n    // over the luma range in the 3x3 neighborhood.\n    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);\n    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;\n    // Compute a sub-pixel offset based on this delta.\n    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);\n\n    // Pick the biggest of the two offsets.\n    finalOffset = max(finalOffset, subPixelOffsetFinal);\n\n    // Compute the final UV coordinates.\n    vec2 finalUv = coords;\n    if(isHorizontal){\n        finalUv.y += finalOffset * stepLength;\n    } else {\n        finalUv.x += finalOffset * stepLength;\n    }\n\n    // Read the color at the new UV coordinates, and use it.\n    gl_FragColor = texture2D(tColor, finalUv);\n}        \n\n/* old fxaa implementation\nuniform highp sampler2D colormap;\nvarying highp vec2 vTexCoords;\n\n\n// Basic FXAA implementation based on the code on geeks3d.com \n#define FXAA_REDUCE_MIN (1.0/ 128.0)\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#define FXAA_SPAN_MAX 8.0\n\n\nvec4 applyFXAA(vec2 fragCoord, highp sampler2D tex)\n{\n    vec4 color;\n    ivec2 dim = textureSize(tex,0);\n    vec2 dimensions = vec2(float(dim.x),float(dim.y));\n    vec2 inverseVP = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);\n    vec4 rgbNW = texture2D(tex, fragCoord + vec2(-1.0, -1.0) * inverseVP);\n    vec4 rgbNE = texture2D(tex, fragCoord + vec2(1.0, -1.0) * inverseVP);\n    vec4 rgbSW = texture2D(tex, fragCoord + vec2(-1.0, 1.0) * inverseVP);\n    vec4 rgbSE = texture2D(tex, fragCoord + vec2(1.0, 1.0) * inverseVP);\n    vec4 rgbM  = texture2D(tex, fragCoord );\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW.xyz, luma);\n    float lumaNE = dot(rgbNE.xyz, luma);\n    float lumaSW = dot(rgbSW.xyz, luma);\n    float lumaSE = dot(rgbSE.xyz, luma);\n    float lumaM  = dot(rgbM.xyz,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                        (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n            max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n            dir * rcpDirMin)) * inverseVP;\n\n    vec4 rgbA = 0.5 * (\n        texture2D(tex, fragCoord + dir * (1.0 / 3.0 - 0.5)) +\n        texture2D(tex, fragCoord  + dir * (2.0 / 3.0 - 0.5)));\n    vec4 rgbB = rgbA * 0.5 + 0.25 * (\n        texture2D(tex, fragCoord  + dir * -0.5) +\n        texture2D(tex, fragCoord  + dir * 0.5));\n\n    float lumaB = dot(rgbB.xyz, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = rgbA;\n    else\n        color = rgbB;\n\n    return color;\n}\n\n\n//DEFINEFRAGCOLOR\nvoid main (void) {\n    ivec2 dim = textureSize(colormap,0);\n\n  gl_FragColor = applyFXAA(vTexCoords, colormap);\n}\n        \n*/"},"./src/WebGL/shaders/lib/screenaa/screenaa.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="attribute vec2 vertexPosition;\nvarying highp vec2 vTexCoords;\nconst vec2 scale = vec2(0.5, 0.5);\n\nvoid main() {\n   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range\n   gl_Position = vec4(vertexPosition, 0.0, 1.0);\n}\n        "},"./src/WebGL/shaders/lib/screenaa/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});const i={}},"./src/WebGL/shaders/lib/sphereimposter/index.ts":(e,t,r)=>{r.r(t),r.d(t,{sphereimposter:()=>s});var t=r("./src/WebGL/shaders/lib/sphereimposter/uniforms.ts"),i=r("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag");const s={vertexShader:r("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert").default.replace("#define GLSLIFY 1",""),fragmentShader:i.default.replace("#define GLSLIFY 1",""),uniforms:t.uniforms}},"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\nuniform mat4 viewMatrix;\nuniform float opacity;\nuniform mat4 projectionMatrix;\n\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nuniform float uDepth;\nuniform vec3 directionalLightColor[ 1 ];\n\nvarying vec3 vColor;\nvarying vec2 mapping;\nvarying float rval;\nvarying vec3 vLight;\nvarying vec3 center;\n\n#ifdef SHADED\nuniform highp sampler2D shading;\n#endif\n\n//DEFINEFRAGCOLOR\n\nvoid main() {\n    float lensqr = dot(mapping,mapping);\n    float rsqr = rval*rval;\n    if(lensqr > rsqr)\n       discard;\n    float z = sqrt(rsqr-lensqr);\n    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z);\n    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);\n    float ndcDepth = clipPos.z / clipPos.w;\n    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;\n    vec3 norm = normalize(vec3(mapping.x,mapping.y,z));\n    float dotProduct = dot( norm, vLight );\n    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n    vec3 vLight = directionalLightColor[ 0 ] * directionalLightWeighting;\n    vec3 color = vLight*vColor;\n#ifdef SHADED\n    ivec2 dim = textureSize(shading,0);\n    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;\n    color *= shadowFactor;\n#endif    \n    gl_FragColor = vec4(color, opacity*opacity );\n\n    if(fogNear != fogFar) {\n        float depth = -cameraPos.z;\n        float fogFactor = smoothstep( fogNear, fogFar, depth );\n        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n    }\n     \n}\n\n"},"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 directionalLightColor[ 1 ];\nuniform vec3 directionalLightDirection[ 1 ];\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\n\nvarying vec2 mapping;\nvarying vec3 vColor;\nvarying float rval;\nvarying vec3 vLight;\nvarying vec3 center;\n\nvoid main() {\n\n    vColor = color;\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    center = mvPosition.xyz;\n    vec4 projPosition = projectionMatrix * mvPosition;\n    vec4 adjust = projectionMatrix* vec4(normal,0.0); adjust.z = 0.0; adjust.w = 0.0;\n    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\n    vLight = normalize( lDirection.xyz );\n    mapping = normal.xy;\n    rval = abs(normal.x);\n    gl_Position = projPosition+adjust;\n\n}\n"},"./src/WebGL/shaders/lib/sphereimposter/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new(r("./src/colors.ts").Color)(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/sphereimposteroutline/index.ts":(e,t,r)=>{r.r(t),r.d(t,{sphereimposteroutline:()=>s});var t=r("./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts"),i=r("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag"),r=r("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert");const s={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:r.default.replace("#define GLSLIFY 1",""),uniforms:t.uniforms}},"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\n\nuniform float opacity;\nuniform vec3 outlineColor;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nuniform mat4 projectionMatrix;\nvarying vec2 mapping;\nvarying float rval;\nvarying vec3 center;\n\nuniform float outlinePushback;\n\n//DEFINEFRAGCOLOR\n\nvoid main() {\n    float lensqr = dot(mapping,mapping);\n    float rsqr = rval*rval;\n    if(lensqr > rsqr)\n       discard;\n    float z = sqrt(rsqr-lensqr);\n    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z-outlinePushback);\n    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);\n    float ndcDepth = clipPos.z / clipPos.w;\n    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;\n    gl_FragColor = vec4(outlineColor, 1 );\n\n    if(fogNear != fogFar) {\n        float depth = -cameraPos.z;\n        float fogFactor = smoothstep( fogNear, fogFar, depth );\n        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n    }\n}\n\n\n"},"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float outlineWidth;\nuniform float outlinePushback;\nuniform float outlineMaxPixels;\nuniform float vWidth;\nuniform float vHeight;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\n\nvarying vec2 mapping;\nvarying float rval;\nvarying vec3 center;\n\nvoid main() {\n\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    center = mvPosition.xyz;\n    vec4 projPosition = projectionMatrix * mvPosition;\n    vec2 norm = normal.xy + vec2(sign(normal.x)*outlineWidth,sign(normal.y)*outlineWidth);\n\n    vec4 adjust = projectionMatrix* vec4(norm,normal.z,1.0); \n    mapping = norm.xy;\n    rval = abs(norm.x);\n    gl_Position = projPosition+vec4(adjust.xy,0.0,0.0);\n\n    if(outlineMaxPixels > 0.0) {\n        vec4 unadjusted = projectionMatrix*vec4(center.x+normal.x, center.y,center.z,1.0); \n        vec4 ccoord = projectionMatrix*vec4(center.xyz,1.0);\n        adjust = projectionMatrix* vec4(center.x+norm.x,center.y,center.z,1.0); \n        //subtract center \n        unadjusted.xyz -= ccoord.xyz;\n        adjust.xyz -= ccoord.xyz;\n        unadjusted /= unadjusted.w;\n        adjust /= adjust.w;\n        float diff = abs(adjust.x-unadjusted.x);\n        diff *= vWidth;\n        if(diff > outlineMaxPixels) {\n            \n            float fixlen = abs(unadjusted.x) + outlineMaxPixels/vWidth;\n            //adjsut reval by ratio of lengths\n            rval *= fixlen/abs(adjust.x);\n        }\n\n    }\n}\n\n"},"./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});t=r("./src/colors.ts");const i={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new t.Color(0,0,0)},fogColor:{type:"c",value:new t.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0}}},"./src/WebGL/shaders/lib/sprite/index.ts":(e,t,r)=>{r.r(t),r.d(t,{sprite:()=>s});var t=r("./src/WebGL/shaders/lib/sprite/uniforms.ts"),i=r("./src/WebGL/shaders/lib/sprite/sprite.frag"),r=r("./src/WebGL/shaders/lib/sprite/sprite.vert");const s={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:r.default.replace("#define GLSLIFY 1",""),uniforms:t.uniforms}},"./src/WebGL/shaders/lib/sprite/sprite.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\n\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\n\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\n\nvarying vec2 vUV;\n//DEFINEFRAGCOLOR\n\nvoid main() {\n\n    vec4 texture = texture2D(map, vUV);\n\n    if (texture.a <= alphaTest) discard;\n\n    gl_FragColor = vec4(color * texture.xyz, texture.a * opacity);\n\n    if (fogNear != fogFar) {\n\n        float depth = gl_FragCoord.z / gl_FragCoord.w; //probably wrong\n        float fogFactor = smoothstep(fogNear, fogFar, depth);        \n        gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n    }\n}\n\n"},"./src/WebGL/shaders/lib/sprite/sprite.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\n\nuniform int useScreenCoordinates;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\n\nattribute vec2 position;\nattribute vec2 uv;\n\nvarying vec2 vUV;\n\nvoid main() {\n\n    vUV = uvOffset + uv * uvScale;\n\n    vec2 alignedPosition = position + alignment;\n\n    vec2 rotatedPosition;\n    rotatedPosition.x = ( cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y ) * scale.x;\n    rotatedPosition.y = ( sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y ) * scale.y;\n\n    vec4 finalPosition;\n\n    if(useScreenCoordinates != 0) {\n        finalPosition = vec4(screenPosition.xy + rotatedPosition, screenPosition.z, 1.0);\n    }\n\n    else {\n        finalPosition = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0); finalPosition /= finalPosition.w;\n        finalPosition.xy += rotatedPosition; \n    }\n\n    gl_Position = finalPosition;\n\n}\n\n"},"./src/WebGL/shaders/lib/sprite/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});const i={}},"./src/WebGL/shaders/lib/ssao/index.ts":(e,t,r)=>{r.r(t),r.d(t,{ssao:()=>s});var t=r("./src/WebGL/shaders/lib/ssao/uniforms.ts"),i=r("./src/WebGL/shaders/lib/ssao/ssao.frag"),r=r("./src/WebGL/shaders/lib/ssao/ssao.vert");const s={fragmentShader:i.default,vertexShader:r.default,uniforms:t.uniforms}},"./src/WebGL/shaders/lib/ssao/ssao.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="uniform sampler2D depthmap;\nvarying highp vec2 vTexCoords;\nuniform float vWidth;\nuniform float vHeight;\nuniform float total_strength;\nuniform float radius;\nuniform mat4 projinv;\nuniform mat4 projectionMatrix;\n\n//code for pseudorandom vector from chatgpt\nfloat hash(vec3 p) {\n    p = fract(p * vec3(0.1031, 0.1030, 0.0973));\n    p += dot(p, p.yzx + 33.33);\n    return fract((p.x + p.y) * p.z);\n}\n\n// Generate a pseudorandom vec3 from a seed vec3\nvec3 pseudorandomVec3(vec3 seed) {\n    vec3 randomVec;\n    randomVec.x = hash(seed);\n    randomVec.y = hash(seed + vec3(1.0, 0.0, 17.1));\n    randomVec.z = hash(seed + vec3(0.0, 13.23, 0.0));\n    return randomVec;\n}\n\nvoid main(void)\n{   \n   const float base = 0.2;\n   const float area = 0.75;\n   const int cycles = 1;\n\n   const int samples = 64;\n   vec3 sample_sphere[64] = vec3[](\n      vec3(0.091258,-0.510164,0.000000),\n      vec3(-0.204347,-0.872967,0.187199),\n      vec3(0.009690,-0.263696,-0.110414),\n      vec3(0.175208,-0.563987,0.228527),\n      vec3(-0.001824,-0.003113,-0.000323),\n      vec3(0.411134,-0.719869,-0.261530),\n      vec3(-0.074272,-0.377368,0.276290),\n      vec3(-0.147773,-0.381587,-0.284529),\n      vec3(0.173317,-0.199635,0.063295),\n      vec3(-0.186452,-0.199460,0.076965),\n      vec3(0.143985,-0.308160,-0.307687),\n      vec3(0.053194,-0.148286,0.169589),\n      vec3(-0.547656,-0.486476,-0.317378),\n      vec3(0.020804,-0.015092,-0.004574),\n      vec3(-0.038006,-0.043165,0.054059),\n      vec3(-0.094795,-0.443908,-0.731525),\n      vec3(0.547552,-0.396466,0.461477),\n      vec3(-0.176886,-0.089989,0.007315),\n      vec3(0.074401,-0.048840,-0.074039),\n      vec3(-0.008240,-0.075697,0.178197),\n      vec3(-0.307880,-0.185053,-0.368943),\n      vec3(0.309520,-0.108483,0.041646),\n      vec3(-0.773478,-0.292946,0.538166),\n      vec3(0.184487,-0.231594,-0.820065),\n      vec3(0.207318,-0.100531,0.361797),\n      vec3(-0.173306,-0.037737,-0.055289),\n      vec3(0.548102,-0.105342,-0.253237),\n      vec3(-0.119342,-0.043907,0.285162),\n      vec3(-0.270247,-0.087861,-0.751357),\n      vec3(0.449312,-0.039777,0.236146),\n      vec3(-0.743773,-0.036095,0.196056),\n      vec3(0.148819,-0.004300,-0.231448),\n      vec3(0.008773,0.000809,0.051047),\n      vec3(-0.461467,0.027390,-0.357386),\n      vec3(0.169626,0.013338,-0.014053),\n      vec3(-0.043786,0.007095,0.047331),\n      vec3(0.004821,0.140371,-0.988260),\n      vec3(0.092402,0.023994,0.101860),\n      vec3(-0.295335,0.061530,-0.027372),\n      vec3(0.024903,0.007537,-0.018901),\n      vec3(-0.081463,0.125402,0.447794),\n      vec3(-0.397119,0.231805,-0.631062),\n      vec3(0.163853,0.059014,0.044905),\n      vec3(-0.495220,0.214357,0.254139),\n      vec3(0.306123,0.373687,-0.825715),\n      vec3(0.021665,0.026737,0.053220),\n      vec3(-0.208231,0.117129,-0.098685),\n      vec3(0.139749,0.080968,-0.043086),\n      vec3(-0.153599,0.182814,0.262090),\n      vec3(-0.159673,0.496777,-0.743568),\n      vec3(0.134797,0.117152,0.095753),\n      vec3(-0.155626,0.120533,0.019395),\n      vec3(0.042311,0.054462,-0.049709),\n      vec3(0.001257,0.031288,0.034468),\n      vec3(-0.002271,0.003199,-0.002304),\n      vec3(0.662104,0.717307,0.033854),\n      vec3(-0.373100,0.576021,0.308274),\n      vec3(0.024233,0.231316,-0.173688),\n      vec3(0.161311,0.420217,0.234273),\n      vec3(-0.045248,0.078031,-0.010411),\n      vec3(0.167453,0.376942,-0.094872),\n      vec3(-0.056194,0.433247,0.173218),\n      vec3(-0.016224,0.123149,-0.035569),\n      vec3(0.067127,0.407641,0.028479)\n   );\n\n   float depth = texture2D(depthmap, vTexCoords).r;\n   if(depth == 1.0) {\n      discard;\n   }\n\n   vec4 screen_position = vec4(vTexCoords, depth,1.0);\n   vec4 pos = projinv*screen_position;\n   pos /= pos.w;\n   vec3 position = pos.xyz;\n\n   //approximate the normal from the depth map; I find this simpler\n   //than trying to recompute the exact normal within every possible object shader\n\n   //pixel offset positions in screen space\n   ivec2 dim = textureSize(depthmap,0);\n   vec2 offset1 = vec2(0.0,1.0/float(dim.y));\n   vec2 offset2 = vec2(1.0/float(dim.x),0.0);\n   float depth1 = texture2D(depthmap, vTexCoords + offset1).r;\n   float depth2 = texture2D(depthmap, vTexCoords + offset2).r;\n   \n   vec3 p1 = vec3(screen_position.xy+offset1, depth1 - depth);\n   vec3 p2 = vec3(screen_position.xy+offset2, depth2 - depth);\n\n   //convert to model space\n   vec4 pos1 = projinv*vec4(p1,1);\n   pos1 /= pos1.w;\n   vec4 pos2 = projinv*vec4(p2,1);\n   pos2 /= pos2.w;\n\n   vec3 normal = normalize(cross(pos1.xyz-position, pos2.xyz-position)); //model normal, important we normalize in model space\n\n   //pseudo random number\n\n   float occlusion = 0.0;\n   for(int c = 0; c < cycles; c++) {\n   vec3 random = normalize(pseudorandomVec3(position+float(c)));\n   for(int i=0; i < samples; i++) {\n\n      vec3 ray = radius * reflect(sample_sphere[i],random);\n      vec3 hemi_ray = position + sign(dot(ray,normal)) * ray; //model space\n      vec4 hemi_screen = projectionMatrix*vec4(hemi_ray,1.0);\n      hemi_screen /= hemi_screen.w;\n      \n      float occ_depth = texture2D(depthmap, clamp(hemi_screen.xy,0.0,1.0)).r;\n      float difference = hemi_screen.z - occ_depth;\n      \n      occlusion += step(0.0, difference) * (1.0-smoothstep(0.0, area, difference));\n   }\n   }\n   float ao = 1.0 - total_strength * occlusion * (1.0 / float(cycles*samples));\n   gl_FragDepthEXT = clamp(ao+base,0.0,1.0);\n\n}"},"./src/WebGL/shaders/lib/ssao/ssao.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="attribute vec2 vertexPosition;\nvarying highp vec2 vTexCoords;\nconst vec2 scale = vec2(0.5, 0.5);\n\nvoid main() {\n   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range\n   gl_Position = vec4(vertexPosition, 0.0, 1.0);\n}\n        "},"./src/WebGL/shaders/lib/ssao/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});const i={total_strength:{type:"f",value:1},radius:{type:"f",value:5},projinv:{type:"mat4",value:[]}}},"./src/WebGL/shaders/lib/stickimposter/index.ts":(e,t,r)=>{r.r(t),r.d(t,{stickimposter:()=>n});var t=r("./src/WebGL/shaders/lib/stickimposter/uniforms.ts"),i=r("./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag"),s=r("./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag"),r=r("./src/WebGL/shaders/lib/stickimposter/stickimposter.vert");const n={fragmentShader:[i.default,s.default].join("\n"),vertexShader:r.default,uniforms:t.uniforms}},"./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="    float dotProduct = dot( norm, vLight );\n    vec3 light = vec3( max( dotProduct, 0.0 ) );\n    color *= light;\n#ifdef SHADED\n    ivec2 dim = textureSize(shading,0);\n    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;\n    color *= shadowFactor;\n#endif    \n    gl_FragColor = vec4(color, opacity*opacity );\n    if(fogNear != fogFar) {\n        float depth = -qi.z;\n        float fogFactor = smoothstep( fogNear, fogFar, depth );\n        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n    }\n}"},"./src/WebGL/shaders/lib/stickimposter/stickimposter.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 directionalLightColor[ 1 ];\nuniform vec3 directionalLightDirection[ 1 ];\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float radius;\n\nvarying vec3 vColor;\nvarying vec3 vLight;\nvarying vec3 cposition;\nvarying vec3 p1;\nvarying vec3 p2;\nvarying float r;\n\nvoid main() {\n\n    vColor = color; vColor.z = abs(vColor.z); //z indicates which vertex and so would vary\n    r = abs(radius);\n    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder\n    vec4 pt = modelViewMatrix*vec4(position, 1.0);\n    vec4 mvPosition = pt;\n    p1 = pt.xyz; p2 = to.xyz;\n    vec3 norm = to.xyz-pt.xyz;\n    float mult = 1.1; //slop to account for perspective of sphere\n    if(length(p1) > length(p2)) { //billboard at level of closest point\n       mvPosition = to;\n    }\n    vec3 n = normalize(mvPosition.xyz);\n    bool isperspective = (projectionMatrix[3][3] == 0.0);\n//intersect with the plane defined by the camera looking at the billboard point\n    if(color.z >= 0.0) { //p1\n       if(isperspective) { //perspective\n         vec3 pnorm = normalize(p1);\n         float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);\n         mvPosition.xyz = p1+t*pnorm; \n       } else { //orthographic\n         mvPosition.xyz = p1;\n       }\n    } else {\n      if(isperspective) { //perspective\n         vec3 pnorm = normalize(p2);\n         float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);\n         mvPosition.xyz = p2+t*pnorm;\n       } else { //orthographic\n         mvPosition.xyz = p2;\n       } \n       mult *= -1.0;\n    }\n\n    if(isperspective) { //perspective\n      vec3 cr = normalize(cross(mvPosition.xyz,norm))*radius;\n      vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*radius;\n      mvPosition.xyz +=  mult*(cr + doublecr).xyz;\n    } else {\n      vec3 cr = normalize(cross(vec3(0.0,0.0,-1.0),norm))*radius;\n      vec3 doublecr = normalize(cross(vec3(0.0,0.0,-1.0),cr))*radius;\n      mvPosition.xyz +=  mult*(cr + doublecr).xyz;     \n    }\n\n    cposition = mvPosition.xyz;\n    gl_Position = projectionMatrix * mvPosition;\n    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );\n    vLight = normalize( lDirection.xyz )*directionalLightColor[0]; //not really sure this is right, but color is always white so..\n}\n\n"},"./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="uniform float opacity;\nuniform mat4 projectionMatrix;\n\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\n\nvarying vec3 vLight;\nvarying vec3 vColor;\nvarying vec3 cposition;\nvarying vec3 p1;\nvarying vec3 p2;\nvarying float r;\n\n#ifdef SHADED\nuniform highp sampler2D shading;\n#endif\n\n//DEFINEFRAGCOLOR\n\n//cylinder-ray intersection testing taken from http://mrl.nyu.edu/~dzorin/cg05/lecture12.pdf\n//also useful: http://stackoverflow.com/questions/9595300/cylinder-impostor-in-glsl\n//with a bit more care (caps) this could be a general cylinder imposter (see also outline)\nvoid main() {\n    vec3 color = abs(vColor);\n    vec3 pos = cposition;\n    vec3 p = pos; //ray point\n    vec3 v = vec3(0.0,0.0,-1.0); //ray normal - orthographic\n    if(projectionMatrix[3][3] == 0.0) v = normalize(pos); //ray normal - perspective\n    vec3 pa = p1; //cyl start\n    vec3 va = normalize(p2-p1); //cyl norm\n    vec3 tmp1 = v-(dot(v,va)*va);\n    vec3 deltap = p-pa;\n    float A = dot(tmp1,tmp1);\n    if(A == 0.0) discard;\n    vec3 tmp2 = deltap-(dot(deltap,va)*va);\n    float B = 2.0*dot(tmp1, tmp2);\n    float C = dot(tmp2,tmp2)-r*r;\n//quadratic equation!\n    float det = (B*B) - (4.0*A*C);\n    if(det < 0.0) discard;\n    float sqrtDet = sqrt(det);\n    float posT = (-B+sqrtDet)/(2.0*A);\n    float negT = (-B-sqrtDet)/(2.0*A);\n    float intersectionT = min(posT,negT);\n    vec3 qi = p+v*intersectionT;\n    float dotp1 = dot(va,qi-p1);\n    float dotp2 = dot(va,qi-p2);\n    vec3 norm;\n    if( dotp1 < 0.0 || dotp2 > 0.0) { //(p-c)^2 + 2(p-c)vt +v^2+t^2 - r^2 = 0\n       vec3 cp;\n       if( dotp1 < 0.0) {  \n//        if(vColor.x < 0.0 ) discard; //color sign bit indicates if we should cap or not\n        cp = p1;\n       } else {\n//          if(vColor.y < 0.0 ) discard;\n          cp = p2;\n       }\n       vec3 diff = p-cp;\n       A = dot(v,v);\n       B = dot(diff,v)*2.0;\n       C = dot(diff,diff)-r*r;\n       det = (B*B) - (4.0*C);\n       if(det < 0.0) discard;\n       sqrtDet = sqrt(det);\n       posT = (-B+sqrtDet)/(2.0);\n       negT = (-B-sqrtDet)/(2.0);\n       float t = min(posT,negT);\n       qi = p+v*t; \n       norm = normalize(qi-cp); \n    } else {\n       norm = normalize(qi-(dotp1*va + p1));\n    }\n    vec4 clipPos = projectionMatrix * vec4(qi, 1.0);\n    float ndcDepth = clipPos.z / clipPos.w;\n    float depth = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;\n    gl_FragDepthEXT = depth;"},"./src/WebGL/shaders/lib/stickimposter/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new(r("./src/colors.ts").Color)(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/stickimposteroutline/index.ts":(e,t,r)=>{r.r(t),r.d(t,{stickimposteroutline:()=>n});var t=r("./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts"),i=r("./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag"),s=r("./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.partial.frag"),r=r("./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert");const n={fragmentShader:i.default+s.default,vertexShader:r.default,uniforms:t.uniforms}},"./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.partial.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\n    gl_FragColor = vec4(color, opacity*opacity );\n    if(fogNear != fogFar) {\n        float depth = -qi.z;\n        float fogFactor = smoothstep( fogNear, fogFar, depth );\n        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n    }\n}"},"./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 directionalLightColor[ 1 ];\nuniform vec3 directionalLightDirection[ 1 ];\nuniform vec3 outlineColor;\nuniform float outlineWidth;\nuniform float outlinePushback;\nuniform float outlineMaxPixels;\nuniform float vWidth;\nuniform mat4 projinv;\n\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float radius;\n\nvarying vec3 vColor;\nvarying vec3 vLight;\nvarying vec3 cposition;\nvarying vec3 p1;\nvarying vec3 p2;\nvarying float r;\n\nvoid main() {\n\n    vColor = outlineColor;\n    float rad = radius+sign(radius)*outlineWidth;\n    r = abs(rad);\n\n    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder\n    vec4 pt = modelViewMatrix*vec4(position, 1.0);\n//pushback\n    float scale = 1.0;\n    if(projectionMatrix[3][3] != 0.0) { //orthographic\n        to.z -= outlinePushback;\n        pt.z -= outlinePushback;\n    } else { //perspective\n        vec4 midbefore = pt;\n        if(length(to.xyz) < length(pt)) {\n            midbefore = to;\n        }\n        vec4 midafter = midbefore;\n        midafter.xyz += normalize(midbefore.xyz)*outlinePushback;\n\n        to.xyz += normalize(to.xyz)*outlinePushback;\n        pt.xyz += normalize(pt.xyz)*outlinePushback;\n\n        //figure out a scaling factor for radius to account for perspective setback\n        vec4 midbeforer = vec4(midbefore.x+rad,midbefore.y, midbefore.z, midbefore.w);\n        vec4 midafterr = vec4(midafter.x+rad,midafter.y, midafter.z, midafter.w);\n\n        vec4 mb = projectionMatrix*midbefore;\n        vec4 mbr = projectionMatrix*midbeforer;\n        vec4 ma = projectionMatrix*midafter;\n        vec4 mar = projectionMatrix*midafterr;\n        mb /= mb.w;\n        mbr /= mbr.w;\n        ma /= ma.w;\n        mar /= mar.w;\n        scale = abs((mbr.x-mb.x)/(mar.x-ma.x));\n        rad *= scale;\n        r = abs(rad);\n    }\n    vec4 mvPosition = pt;\n    p1 = pt.xyz; p2 = to.xyz;\n    vec3 norm = to.xyz-pt.xyz;\n    float mult = 1.1; //slop to account for perspective of sphere\n    if(length(p1) > length(p2)) { //billboard at level of closest point\n       mvPosition = to;\n    }\n\n    vec3 n = normalize(mvPosition.xyz);\n//intersect with the plane defined by the camera looking at the billboard point\n    if(color.z >= 0.0) { //p1\n       vec3 pnorm = normalize(p1);\n       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);\n       mvPosition.xyz = p1+t*pnorm;\n    } else {\n       vec3 pnorm = normalize(p2);\n       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);\n       mvPosition.xyz = p2+t*pnorm;\n       mult *= -1.0;\n    }\n\n    if(outlineMaxPixels > 0.0) {\n        vec4 cpos = mvPosition;\n        vec4 unadjusted = projectionMatrix*vec4(cpos.x+abs(scale*radius), cpos.y,cpos.z,cpos.w); \n        vec4 ccoord = projectionMatrix*cpos;\n        vec4 adjust = projectionMatrix*vec4(cpos.x+r,cpos.y,cpos.z,cpos.w); \n        unadjusted /= unadjusted.w;\n        adjust /= adjust.w;\n        unadjusted.xyz -= ccoord.xyz/ccoord.w;\n        adjust.xyz -= ccoord.xyz/ccoord.w;\n        float diff = abs(adjust.x-unadjusted.x);\n        diff *= vWidth; //this should now be in pixels\n        if(diff > outlineMaxPixels) {\n            float fixlen = abs(unadjusted.x) + outlineMaxPixels/vWidth; \n            vec4 pcoord = ccoord;\n            pcoord.x += fixlen*pcoord.w;\n            vec4 altc = projinv*pcoord;\n            r= abs(altc.x-cpos.x);\n        }\n    }\n\n    vec3 cr = normalize(cross(mvPosition.xyz,norm))*rad;\n    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*rad;\n    mvPosition.xy +=  mult*(cr + doublecr).xy;\n    cposition = mvPosition.xyz;\n    gl_Position = projectionMatrix * mvPosition;\n    vLight = vec3(1.0,1.0,1.0);\n}\n\n"},"./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});t=r("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new t.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineColor:{type:"c",value:new t.Color(0,0,0)},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0},projinv:{type:"mat4",value:[]}}},"./src/WebGL/shaders/lib/volumetric/index.ts":(e,t,r)=>{r.r(t),r.d(t,{volumetric:()=>s});var t=r("./src/WebGL/shaders/lib/volumetric/uniforms.ts"),i=r("./src/WebGL/shaders/lib/volumetric/volumetric.frag"),r=r("./src/WebGL/shaders/lib/volumetric/volumetric.vert");const s={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:r.default.replace("#define GLSLIFY 1",""),uniforms:t.uniforms}},"./src/WebGL/shaders/lib/volumetric/uniforms.ts":(e,t,r)=>{r.r(t),r.d(t,{uniforms:()=>i});const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new(r("./src/colors.ts").Color)(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},data:{type:"i",value:3},colormap:{type:"i",value:4},depthmap:{type:"i",value:5},step:{type:"f",value:1},maxdepth:{type:"f",value:100},subsamples:{type:"f",value:5},textmat:{type:"mat4",value:[]},projinv:{type:"mat4",value:[]},transfermin:{type:"f",value:-.2},transfermax:{type:"f",value:.2}}},"./src/WebGL/shaders/lib/volumetric/volumetric.frag":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="\nuniform highp sampler3D data;\nuniform highp sampler2D colormap;\nuniform highp sampler2D depthmap;\n\n\nuniform mat4 textmat;\nuniform mat4 projinv;\nuniform mat4 projectionMatrix;\n\nuniform float step;\nuniform float subsamples;\nuniform float maxdepth;\nuniform float transfermin;\nuniform float transfermax;\nin  vec4 mvPosition;\nout vec4 color;\nvoid main(void) {\n\n   vec4 pos = mvPosition;\n   bool seengood = false;\n   float i = 0.0;\n   color = vec4(1,1,1,0);\n   float increment = 1.0/subsamples;\n   float maxsteps = (maxdepth*subsamples/step);\n//there's probably a better way to do this..\n//calculate farthest possible point in model coordinates\n   vec4 maxpos = vec4(pos.x,pos.y,pos.z-maxdepth,1.0);\n// convert to projection\n   maxpos = projectionMatrix*maxpos;\n   vec4 startp = projectionMatrix*pos;\n// homogonize\n   maxpos /= maxpos.w;\n   startp /= startp.w;\n//take x,y from start and z from max\n   maxpos = vec4(startp.x,startp.y,maxpos.z,1.0);\n//convert back to model space\n   maxpos = projinv*maxpos;\n   maxpos /= maxpos.w;\n   float incr = step/subsamples;\n//get depth from depthmap\n//startp is apparently [-1,1]\n   vec2 tpos = startp.xy/2.0+0.5;\n   float depth = texture(depthmap, tpos).r;\n//compute vector between start and end\n   vec4 direction = maxpos-pos;\n   for( i = 0.0; i <= maxsteps; i++) {\n      vec4 pt = (pos+(i/maxsteps)*direction);\n      vec4 ppt = projectionMatrix*pt;\n      float ptdepth = ppt.z/ppt.w;\n      ptdepth = ((gl_DepthRange.diff * ptdepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;\n      if(ptdepth > depth) break;\n      pt = textmat*pt;\n//       pt /= pt.w;\n      if(pt.x >= -0.01 && pt.y >= -0.01 && pt.z >= -0.01 && pt.x <= 1.01 && pt.y <= 1.01 && pt.z <= 1.01) {\n         seengood = true;\n      } else if(seengood) {\n         break;\n      }\n      if( pt.x < -0.01 || pt.x > 1.01 || pt.y < -0.01 || pt.y > 1.01 || pt.z < -0.01 || pt.z > 1.01  ){\n          color.a = 0.0;\n          continue;\n      }\n      else {\n         float val = texture(data, pt.zyx).r;\n         if(isinf(val)) continue; //masked out\n         float cval = (val-transfermin)/(transfermax-transfermin); //scale to texture 0-1 range\n         vec4 val_color = texture(colormap, vec2(cval,0.5));\n         color.rgb = color.rgb*color.a + (1.0-color.a)*val_color.a*val_color.rgb;\n         color.a += (1.0 - color.a) * val_color.a; \n         if(color.a > 0.0) color.rgb /= color.a;\n//          color = vec4(pt.x, pt.y, pt.z, 1.0);\n      }\n//       color = vec4(pt.x, pt.y, pt.z, 0.0)\n    }\n}\n\n        "},"./src/WebGL/shaders/lib/volumetric/volumetric.vert":(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});const i="uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\n\nin vec3 position;\nout vec4 mvPosition;\nvoid main() {\n\n    mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix*mvPosition;\n}\n"},"./src/WebGL/shaders/utils/clone.ts":(e,t,r)=>{r.r(t),r.d(t,{clone:()=>function(e){let t={};for(const i in e){t[i]={},t[i].type=e[i].type;var r=e[i].value;r instanceof s.Color?t[i].value=r.clone():"number"==typeof r?t[i].value=r:r instanceof Array?t[i].value=[]:console.error("Error copying shader uniforms from ShaderLib: unknown type for uniform")}return t}});var s=r("./src/colors.ts")},"./src/WebGL/shaders/utils/index.ts":(e,t,r)=>{r.r(t),r.d(t,{ShaderUtils:()=>s,clone:()=>i.clone});var i=r("./src/WebGL/shaders/utils/clone.ts");const s={clone:i.clone}},"./src/WebGL/shapes/Cylinder.ts":(e,t,r)=>{r.r(t),r.d(t,{Cylinder:()=>n});var i=r("./src/WebGL/math/index.ts");let s=new i.Vector3;class n{constructor(e=new i.Vector3,t=new i.Vector3,r=0){this.c1=e,this.c2=t,this.radius=r,this.direction=(new i.Vector3).subVectors(this.c2,this.c1).normalize()}copy(e){return this.c1.copy(e.c1),this.c2.copy(e.c2),this.direction.copy(e.direction),this.radius=e.radius,this}lengthSq(){return s.subVectors(this.c2,this.c1).lengthSq()}applyMatrix4(e){return this.direction.add(this.c1).applyMatrix4(e),this.c1.applyMatrix4(e),this.c2.applyMatrix4(e),this.direction.sub(this.c1).normalize(),this.radius=this.radius*e.getMaxScaleOnAxis(),this}}},"./src/WebGL/shapes/Sphere.ts":(e,t,r)=>{r.r(t),r.d(t,{Sphere:()=>s});var i=r("./src/WebGL/math/index.ts");class s{constructor(e={x:0,y:0,z:0},t=0){this.center=new i.Vector3(e.x,e.y,e.z),this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new s).copy(this)}}},"./src/WebGL/shapes/Triangle.ts":(e,i,t)=>{t.r(i),t.d(i,{Triangle:()=>s});i=t("./src/WebGL/math/index.ts");const r=new i.Vector3;class s{constructor(e=new i.Vector3,t=new i.Vector3,r=new i.Vector3){this.a=e,this.b=t,this.c=r}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}applyMatrix4(e){return this.a.applyMatrix4(e),this.b.applyMatrix4(e),this.c.applyMatrix4(e),this}getNormal(){var e=this.a.clone();return e.sub(this.b),r.subVectors(this.c,this.b),e.cross(r),e.normalize(),e}}},"./src/WebGL/shapes/index.ts":(e,t,r)=>{r.r(t),r.d(t,{Cylinder:()=>s.Cylinder,Sphere:()=>i.Sphere,Triangle:()=>n.Triangle});var i=r("./src/WebGL/shapes/Sphere.ts"),s=r("./src/WebGL/shapes/Cylinder.ts"),n=r("./src/WebGL/shapes/Triangle.ts")},"./src/autoload.ts":(e,t,r)=>{r.r(t),r.d(t,{autoinit:()=>i,autoload:()=>s,processing_autoinit:()=>U,viewers:()=>N});var R=r("./src/GLViewer.ts"),G=r("./src/ProteinSurface4.ts"),P=r("./src/utilities.ts"),B=r("./src/colors.ts"),i=!1,U=!1,N={};function s(E,F){var D,k,I,O;(i=null!=document.querySelector(".viewer_3Dmoljs")?!0:i)&&(U=!0,E=null!=E?E:null,O=0,document.querySelectorAll(".viewer_3Dmoljs").forEach(t=>{var s=[],n=[],a="",o=("static"==t.style.position&&(t.style.position="relative"),null),e=(I=null,t.dataset.pdb?(s.push("https://files.rcsb.org/view/"+t.dataset.pdb+".pdb"),n.push("pdb")):t.dataset.cid?(n.push("sdf"),s.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+t.dataset.cid+"/SDF?record_type=3d")):(t.dataset.href||t.dataset.url)&&(a=t.dataset.href||t.dataset.url,s.push(a),"gz"==(I=a.substring(a.lastIndexOf(".")+1))&&(r=a.substring(0,a.lastIndexOf(".")).lastIndexOf("."),I=a.substring(r+1)),n.push(I),"/"==(r=a.substring(a.lastIndexOf("/")+1,a.lastIndexOf(".")))&&(r=a.substring(a.lastIndexOf("/")+1)),t.dataset[n[n.length-1]]=r),t.dataset);for(D in e)"pdb"===D.substring(0,3)&&"pdb"!==D?(s.push("https://files.rcsb.org/view/"+e[D]+".pdb"),n.push("pdb")):"href"===D.substring(0,4)&&"href"!==D?(a=e[D],s.push(a),n.push(a.substring(a.lastIndexOf(".")+1))):"cid"===D.substring(0,3)&&"cid"!==D&&(s.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e[D]+"/SDF?record_type=3d"),n.push("sdf"));var l={},r=(t.dataset.options&&(l=(0,P.specStringToObject)(t.dataset.options)),B.CC.color(t.dataset.backgroundcolor)),i=null==(i=t.dataset.backgroundalpha)?1:parseFloat(i),h={line:{}},c=(t.dataset.style&&(h=(0,P.specStringToObject)(t.dataset.style)),{}),d=(t.dataset.select&&(c=(0,P.specStringToObject)(t.dataset.select)),[]),u=[],p=[],f={},m=null,g=t.dataset,v=/style(.+)/,b=/surface(.*)/,_=/labelres(.*)/,y=[];for(k in g)Object.prototype.hasOwnProperty.call(g,k)&&y.push(k);for(y.sort(),D=0;D<y.length;D++){k=y[D];var x,w,A,S=v.exec(k);S&&(x="select"+S[1],w=(0,P.specStringToObject)(g[x]),A=(0,P.specStringToObject)(g[k]),d.push([w,A])),(S=b.exec(k))&&(x="select"+S[1],w=(0,P.specStringToObject)(g[x]),A=(0,P.specStringToObject)(g[k]),u.push([w,A])),(S=_.exec(k))&&(x="select"+S[1],w=(0,P.specStringToObject)(g[x]),A=(0,P.specStringToObject)(g[k]),p.push([w,A])),"zoomto"==k&&(f=(0,P.specStringToObject)(g[k])),"spin"==k&&(m=(0,P.specStringToObject)(g[k]))}function C(i){for(i.setStyle(c,h),o&&o.createSelectionAndStyle(c,h),D=0;D<d.length;D++){var e=d[D][0]||{},t=d[D][1]||{line:{}};i.setStyle(e,t),o&&o.createSelectionAndStyle(c,h)}for(D=0;D<u.length;D++){let t=u[D][0]||{},r=u[D][1]||{},e=i;o?e.addSurface(G.SurfaceType.VDW,r,t,t).then(e=>{o.loadSurface("VDW",t,r,e)}):i.addSurface(G.SurfaceType.VDW,r,t,t)}for(D=0;D<p.length;D++){var r=p[D][0]||{},s=p[D][1]||{};i.addResLabels(r,s)}i.render(),i.zoomTo(f),m&&i.spin(m.axis,m.speed)}var L,M;let z=E;try{var T=(0,P.specStringToObject)(t.dataset.config)||{};void 0===T.backgroundColor&&(T.backgroundColor=r),void 0===T.backgroundAlpha&&(T.backgroundAlpha=i),null==z?z=N[t.id||O++]=(0,R.createViewer)(t,T):(z.setBackgroundColor(r,i),z.setConfig(T),o&&o.initiateUI()),t.dataset.ui&&$3Dmol.StateManager&&(o=new $3Dmol.StateManager(z))}catch(e){console.log(e),t.textContent="WebGL appears to be disabled."}if(0!=s.length){let r=0,i=(L=t,M=z,function(e){a=s[r];var t=L.dataset.type||L.dataset.datatype||n[r];if(M.addModel(e,t,l),o&&(e=L.dataset[n[r]],o.setModelTitle(e)),(r+=1)<s.length)(0,P.get)(s[r]).then(i);else{if(C(M),L.dataset.callback){let e=(0,P.makeFunction)(L.dataset.callback);e(M)}U=!1,F&&F(M)}});(I&&I.endsWith("gz")?(0,P.getbin):(0,P.get))(s[0]).then(i)}else{if(t.dataset.element&&(r="#"+t.dataset.element,T=(i=document.querySelector(r))?i.textContent:"",I=t.dataset.type||t.dataset.datatype,z.addModel(T,I,l)),C(z),t.dataset.callback){let e=(0,P.makeFunction)(t.dataset.callback);e(z)}U=!1,F&&F(z)}}))}document.onreadystatechange=()=>{"complete"===document.readyState&&s()}},"./src/colors.ts":(e,t,r)=>{r.r(t),r.d(t,{CC:()=>n,Color:()=>i,builtinColorSchemes:()=>c,chains:()=>h,elementColors:()=>o,htmlColors:()=>a,residues:()=>l,ssColors:()=>s});class i{constructor(e,t,r){return this.r=0,this.g=0,this.b=0,1<arguments.length&&"number"==typeof e?(this.r=e||0,this.g=t||0,this.b=r||0,this):this.set(e||0)}set(e){return e instanceof i?e.clone():("number"==typeof e?this.setHex(e):"object"==typeof e&&(this.r=(null==e?void 0:e.r)||0,this.g=(null==e?void 0:e.g)||0,this.b=(null==e?void 0:e.b)||0),this)}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}getHex(){return Math.round(255*this.r)<<16|Math.round(255*this.g)<<8|Math.round(255*this.b)}clone(){return new i(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}scaled(){var e={};return e.r=Math.round(255*this.r),e.g=Math.round(255*this.g),e.b=Math.round(255*this.b),e.a=1,e}}class n{static color(e){if(!e)return n.cache[0];if(e instanceof i)return e;if("number"==typeof e&&void 0!==n.cache[e])return n.cache[e];if(e&&Array.isArray(e))return e.map(n.color);var e=n.getHex(e),t=new i(e);return n.cache[e]=t}static getHex(t){if(Array.isArray(t))return t.map(n.getHex);if("string"!=typeof t)return t;{let e=t;if(!isNaN(parseInt(e)))return parseInt(e);if(7==(e=4==(e=e.trim()).length&&"#"==e[0]?"#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]:e).length&&"#"==e[0])return parseInt(e.substring(1),16);let r=n.rgbRegEx.exec(e);if(r){""!=r[1]&&console.log("WARNING: Opacity value in rgba ignored.  Specify separately as opacity attribute.");let t=0;for(let e=2;e<5;e++){t*=256;var i=r[e].endsWith("%")?255*parseFloat(r[e])/100:parseFloat(r[e]);t+=Math.round(i)}return t}var s=a[e.toLowerCase()];return void 0!==s?s:(console.error("color not found",t.toLowerCase(),a),0)}}}n.rgbRegEx=/rgb(a?)\(\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)/i,n.cache={0:new i(0)};const a={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgrey:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,grey:8421504,green:32768,greenyellow:11403055,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgrey:13882323,lightgreen:9498256,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074,b:255,g:32768,r:16711680,c:49087,m:12517567,y:12566272,k:0,w:16777215},s={pyMol:{h:16711680,s:16776960,c:65280},Jmol:{h:16711808,s:16762880,c:16777215}};r={H:16777215,He:16761035,HE:16761035,Li:11674146,LI:11674146,B:65280,C:13158600,N:9408511,O:15728640,F:14329120,Na:255,NA:255,Mg:2263842,MG:2263842,Al:8421520,AL:8421520,Si:14329120,SI:14329120,P:16753920,S:16762930,Cl:65280,CL:65280,Ca:8421520,CA:8421520,Ti:8421520,TI:8421520,Cr:8421520,CR:8421520,Mn:8421520,MN:8421520,Fe:16753920,FE:16753920,Ni:10824234,NI:10824234,Cu:10824234,CU:10824234,Zn:10824234,ZN:10824234,Br:10824234,BR:10824234,Ag:8421520,AG:8421520,I:10494192,Ba:16753920,BA:16753920,Au:14329120,AU:14329120};const o={defaultColor:16716947,Jmol:{H:16777215,He:14286847,HE:14286847,Li:13402367,LI:13402367,Be:12779264,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Ne:11789301,NE:11789301,Na:11230450,NA:11230450,Mg:9109248,MG:9109248,Al:12560038,AL:12560038,Si:1578e4,SI:1578e4,P:16744448,S:16777008,Cl:2093087,CL:2093087,Ar:8442339,AR:8442339,K:9388244,Ca:4062976,CA:4062976,Sc:15132390,SC:15132390,Ti:12567239,TI:12567239,V:10921643,Cr:9083335,CR:9083335,Mn:10255047,MN:10255047,Fe:14706227,FE:14706227,Co:15765664,CO:15765664,Ni:5296208,NI:5296208,Cu:13140019,CU:13140019,Zn:8224944,ZN:8224944,Ga:12750735,GA:12750735,Ge:6721423,GE:6721423,As:12419299,AS:12419299,Se:16752896,SE:16752896,Br:10889513,BR:10889513,Kr:6076625,KR:6076625,Rb:7351984,RB:7351984,Sr:65280,SR:65280,Y:9764863,Zr:9756896,ZR:9756896,Nb:7586505,NB:7586505,Mo:5551541,MO:5551541,Tc:3907230,TC:3907230,Ru:2396047,RU:2396047,Rh:687500,RH:687500,Pd:27013,PD:27013,Ag:12632256,AG:12632256,Cd:16767375,CD:16767375,In:10909043,IN:10909043,Sn:6717568,SN:6717568,Sb:10380213,SB:10380213,Te:13924864,TE:13924864,I:9699476,Xe:4366e3,XE:4366e3,Cs:5707663,CS:5707663,Ba:51456,BA:51456,La:7394559,LA:7394559,Ce:16777159,CE:16777159,Pr:14286791,PR:14286791,Nd:13107143,ND:13107143,Pm:10747847,PM:10747847,Sm:9437127,SM:9437127,Eu:6422471,EU:6422471,Gd:4587463,GD:4587463,Tb:3211207,TB:3211207,Dy:2097095,DY:2097095,Ho:65436,HO:65436,Er:58997,ER:58997,Tm:54354,TM:54354,Yb:48952,YB:48952,Lu:43812,LU:43812,Hf:5096191,HF:5096191,Ta:5089023,TA:5089023,W:2200790,Re:2522539,RE:2522539,Os:2516630,OS:2516630,Ir:1528967,IR:1528967,Pt:13684960,PT:13684960,Au:16765219,AU:16765219,Hg:12105936,HG:12105936,Tl:10900557,TL:10900557,Pb:5724513,PB:5724513,Bi:10375093,BI:10375093,Po:11230208,PO:11230208,At:7688005,AT:7688005,Rn:4358806,RN:4358806,Fr:4325478,FR:4325478,Ra:32e3,RA:32e3,Ac:7384058,AC:7384058,Th:47871,TH:47871,Pa:41471,PA:41471,U:36863,Np:33023,NP:33023,Pu:27647,PU:27647,Am:5528818,AM:5528818,Cm:7888099,CM:7888099,Bk:9064419,BK:9064419,Cf:10565332,CF:10565332,Es:11739092,ES:11739092,Fm:11739066,FM:11739066,Md:11734438,MD:11734438,No:12389767,NO:12389767,Lr:13041766,LR:13041766,Rf:13369433,RF:13369433,Db:13697103,DB:13697103,Sg:14221381,SG:14221381,Bh:14680120,BH:14680120,Hs:15073326,HS:15073326,Mt:15400998,MT:15400998},rasmol:r,defaultColors:Object.assign({},r),greenCarbon:Object.assign(Object.assign({},r),{C:65280}),cyanCarbon:Object.assign(Object.assign({},r),{C:65535}),magentaCarbon:Object.assign(Object.assign({},r),{C:16711935}),yellowCarbon:Object.assign(Object.assign({},r),{C:16776960}),whiteCarbon:Object.assign(Object.assign({},r),{C:16777215}),orangeCarbon:Object.assign(Object.assign({},r),{C:16753920}),purpleCarbon:Object.assign(Object.assign({},r),{C:8388736}),blueCarbon:Object.assign(Object.assign({},r),{C:255})},l={amino:{ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,ASX:16738740,GLX:16738740},shapely:{ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935},nucleic:{A:10526975,G:16740464,I:8454143,C:16747595,T:10551200,U:16744576}},h={atom:{A:12636415,B:11599792,C:16761032,D:16777088,E:16761087,F:11596016,G:16765040,H:15761536,I:16113331,J:49151,K:13458524,L:6737322,M:10145074,N:15631086,O:52945,P:65407,Q:3978097,R:139,S:12433259,T:25600,U:8388608,V:8421376,W:8388736,X:32896,Y:12092939,Z:11674146},hetatm:{A:9478351,B:8441752,C:13602992,D:13619056,E:13603023,F:8437952,G:13607008,H:12603504,I:12955267,J:42959,K:11881548,L:5682578,M:9090346,N:12481214,O:46753,P:53103,Q:3447649,R:187,S:10854235,T:37888,U:11534336,V:11579392,W:11534512,X:45232,Y:15250963,Z:12726834}},c={ssPyMol:{prop:"ss",map:s.pyMol},ssJmol:{prop:"ss",map:s.Jmol},Jmol:{prop:"elem",map:o.Jmol},amino:{prop:"resn",map:l.amino},shapely:{prop:"resn",map:l.shapely},nucleic:{prop:"resn",map:l.nucleic},chain:{prop:"chain",map:h.atom},rasmol:{prop:"elem",map:o.rasmol},default:{prop:"elem",map:o.defaultColors},greenCarbon:{prop:"elem",map:o.greenCarbon},chainHetatm:{prop:"chain",map:h.hetatm},cyanCarbon:{prop:"elem",map:o.cyanCarbon},magentaCarbon:{prop:"elem",map:o.magentaCarbon},purpleCarbon:{prop:"elem",map:o.purpleCarbon},whiteCarbon:{prop:"elem",map:o.whiteCarbon},orangeCarbon:{prop:"elem",map:o.orangeCarbon},yellowCarbon:{prop:"elem",map:o.yellowCarbon},blueCarbon:{prop:"elem",map:o.blueCarbon}}},"./src/exporter.js":e=>{"object"==typeof e.exports&&(e.exports=window.$3Dmol)},"./src/glcartoon.ts":(e,t,r)=>{r.r(t),r.d(t,{drawCartoon:()=>function(R,G,r,P=10){let i=P,B=P;var e,t,s,n,a,o,l,h,c,d,u,p,f,m,g,v,b,_,y,x=new Y.Geometry(!0),w=new Y.Geometry(!0),A=[],S=[],C=1,L=!1,M={};for(y in Z.Gradient.builtinGradients)Z.Gradient.builtinGradients.hasOwnProperty(y)&&(M[y]=new Z.Gradient.builtinGradients[y](r[1],r[0]));function z(e,t){return r&&"spectrum"===t.color?(t.colorscheme in M?M[t.colorscheme]:M.sinebow).valueToHex(e.resi):(0,K.getColorFromStyle)(e,t).getHex()}for(h=0;h<i;h++)S[h]=[];var U=!1,T=!1,E=[];for(h in G){var N;"C"===(n=G[h]).elem&&"CA"===n.atom&&((N=te(s,n))&&"s"===n.ss?U=!0:U&&(s&&t&&s.style.cartoon.arrows&&t.style.cartoon.arrows&&(s.ss="arrow end",t.ss="arrow start"),U=!1),N&&("h"===s.ss||"tube start"==s.ss)&&s.style.cartoon.tubes?!T&&"tube start"!=s.ss&&n.style.cartoon.tubes&&(n.ss="tube start",T=!0):T&&("tube start"===s.ss?s.ss="tube end":t&&t.style.cartoon.tubes&&(t.ss="tube end"),T=!1),t=s,s=n),n&&n.atom in se&&E.push(n)}T&&s.style.cartoon.tubes&&(s.ss="tube end",T=!1);function j(e){0<S[0].length&&J(w,S,A,B,l,0,S.style);var t=[],r=null;if(e){for(h=0;h<i;h++)t[h]=S[h][S[h].length-1];r=A[A.length-1]}for(S=[],h=0;h<i;h++)S[h]=[];if(A=[],e){for(h=0;h<i;h++)S[h].push(t[h]);A.push(r)}re(R,w,C,L,!0),re(R,x,C,L,!1),w=new Y.Geometry(!0),x=new Y.Geometry(!0)}s=void 0;let V=[];for(var F=0;F<E.length;F++){var D,k,I,W=(n=E[F]).resn.trim(),O=W in oe;if(C=1,e=n.style.cartoon,s&&s.style.cartoon&&(C=s.style.cartoon.opacity),s&&s.style.cartoon&&s.style.cartoon.outline&&(L=s.style.cartoon.outline),!s||!s.style.cartoon||n.style.cartoon&&s.style.cartoon.opacity==n.style.cartoon.opacity||j(s.chain==n.chain),s&&n&&!te(s,n)&&s.chain&&s.chain==n.chain&&!s.hetflag&&!n.hetflag&&s.reschain+1==n.reschain&&V.push([s,n]),"trace"===e.style)n.hetflag||("C"===n.elem&&"CA"===n.atom||O&&"P"===n.atom||"BB"===n.atom)&&(o=z(n,e),l=(0,K.isNumeric)(e.thickness)?e.thickness:Q,te(s,n)&&(o==a?(D=Me.CC.color(o),X.GLDraw.drawCylinder(x,s,n,l,D,2,2)):(D=(new q.Vector3).addVectors(s,n).multiplyScalar(.5),k=Me.CC.color(a),I=Me.CC.color(o),X.GLDraw.drawCylinder(x,s,D,l,k,2,0),X.GLDraw.drawCylinder(x,D,n,l,I,0,2))),!0!==n.clickable&&!n.hoverable||void 0===n.intersectionShape||(k=new q.Vector3(n.x,n.y,n.z),n.intersectionShape.sphere.push(new Le.Sphere(k,l))),s=n,a=o);else{if(ee(n)||O&&("P"===n.atom||0==n.atom.indexOf("O5"))){if(_)if("tube end"===n.ss)_=!1,b=new q.Vector3(n.x,n.y,n.z),X.GLDraw.drawCylinder(x,v,b,2,Me.CC.color(a),1,1),n.ss="h";else{if(s.chain==n.chain&&"tube end"!==s.ss)continue;_=!1,s.ss="h",b=new q.Vector3(s.x,s.y,s.z),X.GLDraw.drawCylinder(x,v,b,2,Me.CC.color(a),1,1)}if(s&&(!te(s,n)||"tube start"===s.ss)){for("tube start"===s.ss&&(_=!0,v=new q.Vector3(s.x,s.y,s.z),s.ss="h"),g&&(m=p?(new q.Vector3).addVectors(s,p).multiplyScalar(.5):new q.Vector3(s.x,s.y,s.z),X.GLDraw.drawCylinder(x,m,g,$,Me.CC.color(g.color),0,2),ie(S,i,!0,p,f,u,s,E,F),A.push(o),g=m=null),0<S[0].length&&J(w,S,A,B,l,0,S.style),S=[],h=0;h<i;h++)S[h]=[];A=[]}void 0!==s&&s.rescode==n.rescode&&s.resi==n.resi||(g&&null!=s&&(I=(m=(new q.Vector3).addVectors(s,n).multiplyScalar(.5)).clone().sub(g).multiplyScalar(.02),m.add(I),X.GLDraw.drawCylinder(x,m,g,$,Me.CC.color(g.color),0,2),g=m=null),o=z(n,e),A.push(o),l=(0,K.isNumeric)(e.thickness)?e.thickness:Q,s=n,(c=new q.Vector3(s.x,s.y,s.z)).resi=s.resi,a=o),!0!==n.clickable&&!0!==n.hoverable||void 0!==n.intersectionShape&&void 0!==n.intersectionShape.triangle||(n.intersectionShape={sphere:null,cylinder:[],line:[],triangle:[]})}else null!=s&&(ee(s)&&"O"===n.atom||O&&"P"===s.atom&&("OP2"===n.atom||"O2P"===n.atom)||O&&0==s.atom.indexOf("O5")&&0==n.atom.indexOf("C5"))?((d=new q.Vector3(n.x,n.y,n.z)).resi=n.resi,"OP2"!==n.atom&&"O2P"!==n.atom||(f=new q.Vector3(n.x,n.y,n.z))):O&&0==n.atom.indexOf("O3")?p=new q.Vector3(n.x,n.y,n.z):("N1"===n.atom&&W in ne||"N3"===n.atom&&W in ae)&&((g=new q.Vector3(n.x,n.y,n.z)).color=(0,K.getColorFromStyle)(n,e).getHex());d&&c&&d.resi===c.resi&&(ie(S,i,!0,c,d,u,s,E,F),u=d,d=c=null,A.push(o))}}g&&(m=p?(new q.Vector3).addVectors(s,p).multiplyScalar(.5):new q.Vector3(s.x,s.y,s.z),X.GLDraw.drawCylinder(x,m,g,$,Me.CC.color(g.color),0,2),ie(S,i,!0,p,f,u,s,E,F),A.push(o));j(!1);for(var H of V)!function(s,n){if(s.style.cartoon.gapcutoff&&s.style.cartoon.gapcutoff==n.style.cartoon.gapcutoff){var a=s.style.cartoon.gapcutoff,o=n.resi-s.resi;if(0<o&&o<a){var a=n.x-s.x,l=n.y-s.y,h=n.z-s.z,a=Math.sqrt(a*a+l*l+h*h),l=a/(2*o);let e=new q.Vector3(s.x,s.y,s.z);h=a/l;let t=new q.Vector3((n.x-s.x)/h,(n.y-s.y)/h,(n.z-s.z)/h),r=(e.add({x:t.x/2,y:t.y/2,z:t.z/2}),e.clone().add(t)),i=(t.multiplyScalar(2),(0,K.extend)({},s));for(var c=0;c<o;c++){i.resi+=1;var d=z(i,i.style.cartoon);X.GLDraw.drawCylinder(x,e,r,.25,Me.CC.color(d),X.CAP.FLAT,X.CAP.FLAT),e.add(t),r.add(t)}j(!1)}}}(H[0],H[1])},subdivide_spline:()=>ze});var q=r("./src/WebGL/math/index.ts"),Le=r("./src/WebGL/shapes/index.ts"),Y=r("./src/WebGL/index.ts"),Z=r("./src/Gradient.ts"),Me=r("./src/colors.ts"),X=r("./src/GLDraw.ts"),K=r("./src/utilities.ts");function ze(e,t){var r,i,s,n,a,o,l,h=[],c=e;for((c=[]).push(e[0]),i=e.length-(r=1);r<i;r++){var d,u=e[r],p=e[r+1];u.smoothen?((d=new q.Vector3((u.x+p.x)/2,(u.y+p.y)/2,(u.z+p.z)/2)).atom=u.atom,c.push(d)):c.push(u)}for(c.push(e[e.length-1]),r=-1,s=c.length;r<=s-3;r++)if(n=c[-1===r?0:r],u=c[r+1],p=c[r+2],a=c[r===s-3?s-1:r+3],o=(new q.Vector3).subVectors(p,n).multiplyScalar(.5),l=(new q.Vector3).subVectors(a,u).multiplyScalar(.5),!p.skip)for(var f=0;f<t;f++){var m=1/t*f,g=u.x+m*o.x+m*m*(-3*u.x+3*p.x-2*o.x-l.x)+m*m*m*(2*u.x-2*p.x+o.x+l.x),v=u.y+m*o.y+m*m*(-3*u.y+3*p.y-2*o.y-l.y)+m*m*m*(2*u.y-2*p.y+o.y+l.y),m=u.z+m*o.z+m*m*(-3*u.z+3*p.z-2*o.z-l.z)+m*m*m*(2*u.z-2*p.z+o.z+l.z),g=new q.Vector3(g,v,m);g.atom=(f<t/2?u:p).atom,h.push(g)}return h.push(c[c.length-1]),h}const g=.5,v=1.3,b=.8,Q=.4,$=.4;function Te(e,t,r,i){for(var s=0,n=t.length;s<n;s++){var a,o=Math.round(s*(i.length-1)/n),l=Me.CC.color(i[o]),o=e.updateGeoGroup(2),h=o.vertexArray,c=o.colorArray,d=o.faceArray;h[a=3*(u=o.vertices)]=t[s].x,h[1+a]=t[s].y,h[2+a]=t[s].z,h[3+a]=r[s].x,h[4+a]=r[s].y,h[5+a]=r[s].z;for(var u,p=0;p<6;++p)c[a+3*p]=l.r,c[1+a+3*p]=l.g,c[2+a+3*p]=l.b;0<s&&(d[h=o.faceidx]=(u=[u,u+1,u-1,u-2])[0],d[h+1]=u[1],d[h+2]=u[3],d[h+3]=u[1],d[h+4]=u[2],d[h+5]=u[3],o.faceidx+=6),o.vertices+=2}}function J(R,G,P,B,U,N,e){if("edged"===(e=e&&"default"!==e?e:"rectangle")){var j=R,V=G,W=P,H=B,q=U;if(!(V.length<2)){var t=V[0],Y=V[V.length-1];if(t=ze(t,H),Y=ze(Y,H),!q)return void Te(j,t,Y,W);for(var r,Z,X,i,s,n,a,K,o=[],Q=[[0,2,-6,-8],[-4,-2,6,4],[7,-1,-5,3],[-3,5,1,-7]],l=0,$=t.length;l<$;l++){var J,h=Math.round(l*(W.length-1)/$),c=Me.CC.color(W[h]);for(o.push(h=t[l]),o.push(h),o.push(r=Y[l]),o.push(r),l<$-1&&(J=t[l+1].clone().sub(t[l]),J=Y[l].clone().sub(t[l]).cross(J).normalize().multiplyScalar(q)),o.push(Z=t[l].clone().add(J)),o.push(Z),o.push(X=Y[l].clone().add(J)),o.push(X),void 0!==h.atom&&(i=h.atom),_=(v=j.updateGeoGroup(8)).vertexArray,y=v.colorArray,x=v.faceArray,_[w=3*(b=v.vertices)]=h.x,_[w+1]=h.y,_[w+2]=h.z,_[w+3]=h.x,_[w+4]=h.y,_[w+5]=h.z,_[w+6]=r.x,_[w+7]=r.y,_[w+8]=r.z,_[w+9]=r.x,_[w+10]=r.y,_[w+11]=r.z,_[w+12]=Z.x,_[w+13]=Z.y,_[w+14]=Z.z,_[w+15]=Z.x,_[w+16]=Z.y,_[w+17]=Z.z,_[w+18]=X.x,_[w+19]=X.y,_[w+20]=X.z,_[w+21]=X.x,_[w+22]=X.y,_[w+23]=X.z,d=0;d<8;++d)y[w+3*d]=c.r,y[w+1+3*d]=c.g,y[w+2+3*d]=c.b;if(0<l)for(var ee=void 0!==s&&void 0!==i&&s.serial!==i.serial,d=0;d<4;d++){var u,te,re,p,ie,f,m,g=[b+Q[d][0],b+Q[d][1],b+Q[d][2],b+Q[d][3]];x[m=v.faceidx]=g[0],x[m+1]=g[1],x[m+2]=g[3],x[m+3]=g[1],x[m+4]=g[2],x[m+5]=g[3],v.faceidx+=6,(i.clickable||s.clickable||i.hoverable||s.hoverable)&&(u=o[g[3]].clone(),te=o[g[0]].clone(),re=o[g[2]].clone(),p=o[g[1]].clone(),u.atom=o[g[3]].atom||null,re.atom=o[g[2]].atom||null,te.atom=o[g[0]].atom||null,p.atom=o[g[1]].atom||null,ee?(g=u.clone().add(te).multiplyScalar(.5),ie=re.clone().add(p).multiplyScalar(.5),f=u.clone().add(p).multiplyScalar(.5),d%2==0?((s.clickable||s.hoverable)&&(n=new Le.Triangle(g,f,u),a=new Le.Triangle(ie,re,f),K=new Le.Triangle(f,re,u),s.intersectionShape.triangle.push(n),s.intersectionShape.triangle.push(a),s.intersectionShape.triangle.push(K)),(i.clickable||i.hoverable)&&(n=new Le.Triangle(te,p,f),a=new Le.Triangle(p,ie,f),K=new Le.Triangle(te,f,g),i.intersectionShape.triangle.push(n),i.intersectionShape.triangle.push(a),i.intersectionShape.triangle.push(K))):((i.clickable||i.hoverable)&&(n=new Le.Triangle(g,f,u),a=new Le.Triangle(ie,re,f),K=new Le.Triangle(f,re,u),i.intersectionShape.triangle.push(n),i.intersectionShape.triangle.push(a),i.intersectionShape.triangle.push(K)),(s.clickable||s.hoverable)&&(n=new Le.Triangle(te,p,f),a=new Le.Triangle(p,ie,f),K=new Le.Triangle(te,f,g),s.intersectionShape.triangle.push(n),s.intersectionShape.triangle.push(a),s.intersectionShape.triangle.push(K)))):(i.clickable||i.hoverable)&&(n=new Le.Triangle(te,p,u),a=new Le.Triangle(p,re,u),i.intersectionShape.triangle.push(n),i.intersectionShape.triangle.push(a)))}v.vertices+=8,s=i}var v,b,se=o.length-8,_=(v=j.updateGeoGroup(8)).vertexArray,y=v.colorArray,x=v.faceArray,w=3*(b=v.vertices);for(m=v.faceidx,l=0;l<4;l++){o.push(o[2*l]),o.push(o[se+2*l]);var ne=o[2*l],ae=o[se+2*l];_[w+6*l]=ne.x,_[w+1+6*l]=ne.y,_[w+2+6*l]=ne.z,_[w+3+6*l]=ae.x,_[w+4+6*l]=ae.y,_[w+5+6*l]=ae.z,y[w+6*l]=c.r,y[w+1+6*l]=c.g,y[w+2+6*l]=c.b,y[w+3+6*l]=c.r,y[w+4+6*l]=c.g,y[w+5+6*l]=c.b}se+=8,a=[b+1,b+5,b+7,b+3],x[m]=(n=[b,b+2,b+6,b+4])[0],x[m+1]=n[1],x[m+2]=n[3],x[m+3]=n[1],x[m+4]=n[2],x[m+5]=n[3],x[m+6]=a[0],x[m+7]=a[1],x[m+8]=a[3],x[m+9]=a[1],x[m+10]=a[2],x[m+11]=a[3],v.faceidx+=12,v.vertices+=8}}else if("rectangle"===e||"oval"===e||"parabola"===e){var A,oe,le=R,S=G,he=P,ce=B,de=U,ue=e,C=S.length;if(!(C<2||S[0].length<2)){for(A=0;A<C;A++)S[A]=ze(S[A],ce);if(oe=S[0].length,!de)return void!Te(le,S[0],S[C-1],he);for(var pe,fe,L,M,me,ge=[],ve=[],be=[],z=0;z<C;z++)ge.push(.25+1.5*Math.sqrt((C-1)*z-Math.pow(z,2))/(C-1)),ve.push(.5),be.push(2*(Math.pow(z/C,2)-z/C)+.6);var T,E,F,_e,ye,xe,we,D,k,Ae=[];for(z=0;z<2*C-1;z++)Ae[z]=[z,z+1,z+1-2*C,z-2*C];Ae[2*C-1]=[z,z+1-2*C,z+1-4*C,z-2*C];let t=le.updateGeoGroup();for(A=0;A<oe;A++){var Se,Ce,I=le.groups;let e=!1;for(t=le.updateGeoGroup(2*C),I!=le.groups&&0<A&&(A-=1,e=!0),I=Math.round(A*(he.length-1)/oe),ye=Me.CC.color(he[I]),I=L,me=M,L=[],M=[],pe=[],void 0!==S[0][A].atom&&(_e=S[0][A].atom,"oval"===ue?fe=ge:"rectangle"===ue?fe=ve:"parabola"===ue&&(fe=be)),fe=fe||ve,z=0;z<C;z++)Se=A<oe-1?S[z][A+1].clone().sub(S[z][A]):S[z][A-1].clone().sub(S[z][A]).negate(),Ce=z<C-1?S[z+1][A].clone().sub(S[z][A]):S[z-1][A].clone().sub(S[z][A]).negate(),pe[z]=Ce.cross(Se).normalize().multiplyScalar(de*fe[z]);for(z=0;z<C;z++)L[z]=S[z][A].clone().add(pe[z].clone().negate());for(z=0;z<C;z++)M[z]=S[z][A].clone().add(pe[z]);for(xe=t.vertexArray,we=t.colorArray,D=t.faceArray,E=3*(T=t.vertices),z=0;z<C;z++)xe[E+3*z+0]=L[z].x,xe[E+3*z+1]=L[z].y,xe[E+3*z+2]=L[z].z;for(z=0;z<C;z++)xe[E+3*z+0+3*C]=M[C-1-z].x,xe[E+3*z+1+3*C]=M[C-1-z].y,xe[E+3*z+2+3*C]=M[C-1-z].z;for(z=0;z<2*C;++z)we[E+3*z+0]=ye.r,we[E+3*z+1]=ye.g,we[E+3*z+2]=ye.b;if(0<A&&!e){for(z=0;z<2*C;z++)k=[T+Ae[z][0],T+Ae[z][1],T+Ae[z][2],T+Ae[z][3]],D[F=t.faceidx]=k[0],D[F+1]=k[1],D[F+2]=k[3],D[F+3]=k[1],D[F+4]=k[2],D[F+5]=k[3],t.faceidx+=6;if(_e.clickable||_e.hoverable){var O=[];for(z in O.push(new Le.Triangle(I[0],L[0],L[C-1])),O.push(new Le.Triangle(I[0],L[C-1],I[C-1])),O.push(new Le.Triangle(I[C-1],L[C-1],M[C-1])),O.push(new Le.Triangle(I[C-1],M[C-1],me[C-1])),O.push(new Le.Triangle(M[0],me[0],me[C-1])),O.push(new Le.Triangle(M[C-1],M[0],me[C-1])),O.push(new Le.Triangle(L[0],I[0],me[0])),O.push(new Le.Triangle(M[0],L[0],me[0])),O)_e.intersectionShape.triangle.push(O[z])}}t.vertices+=2*C}for(xe=t.vertexArray,we=t.colorArray,D=t.faceArray,E=3*(T=t.vertices),F=t.faceidx,A=0;A<C-1;A++)k=[A,A+1,2*C-2-A,2*C-1-A],D[F=t.faceidx]=k[0],D[F+1]=k[1],D[F+2]=k[3],D[F+3]=k[1],D[F+4]=k[2],D[F+5]=k[3],t.faceidx+=6;for(A=0;A<C-1;A++)k=[T-1-A,T-2-A,T-2*C+A+1,T-2*C+A],D[F=t.faceidx]=k[0],D[F+1]=k[1],D[F+2]=k[3],D[F+3]=k[1],D[F+4]=k[2],D[F+5]=k[3],t.faceidx+=6}}}function ee(e){return e&&"C"===e.elem&&"CA"===e.atom}function te(e,t){if(e&&t&&e.chain===t.chain){if(!(e.hetflag||t.hetflag||e.reschain!==t.reschain||e.resi!==t.resi&&e.resi!==t.resi-1))return!0;if(e.resi<t.resi){var r=e.x-t.x,i=e.y-t.y,s=e.z-t.z,r=r*r+i*i+s*s;if("CA"==e.atom&&"CA"==t.atom&&r<16)return!0;if(("P"==e.atom||"P"==t.atom)&&r<64)return!0}}return!1}function re(e,t,r,i,s){null!=t&&0!=t.vertices&&(s&&(t.initTypedArrays(),t.setUpNormals()),(s=new Y.MeshDoubleLambertMaterial).vertexColors=Y.Coloring.FaceColors,"number"==typeof r&&0<=r&&r<1&&(s.transparent=!0,s.opacity=r),s.outline=i,r=new Y.Mesh(t,s),e.add(r))}function ie(e,t,r,i,s,n,a,o,l){var h,c,d,u;if(i&&s&&a){for(var p=s.sub(i),f=(p.normalize(),o[l]),m=l+1;m<o.length&&(f=o[m]).atom!=a.atom;m++);for((f=f?new q.Vector3(f.x,f.y,f.z):new q.Vector3(0,0,0)).sub(i),"arrow start"===a.ss&&(l=f.clone().multiplyScalar(.3).cross(s),i.add(l),s=f.clone().cross(p).normalize(),p.rotateAboutVector(s,.43)),a.style.cartoon.ribbon?h=a.style.cartoon.thickness||Q:a.style.cartoon.width?h=a.style.cartoon.width:"c"===a.ss?h="P"===a.atom?b:g:"arrow start"===a.ss?(h=v,u=!0):h="arrow end"===a.ss||"h"===a.ss&&a.style.cartoon.tubes||"tube start"===a.ss?g:v,null!=n&&p.dot(n)<0&&p.negate(),p.multiplyScalar(h),m=0;m<t;m++)(d=new q.Vector3(i.x+(c=2*m/(t-1)-1)*p.x,i.y+c*p.y,i.z+c*p.z)).atom=a,r&&"s"===a.ss&&(d.smoothen=!0),e[m].push(d);if(u)for(p.multiplyScalar(2),m=0;m<t;m++)(d=new q.Vector3(i.x+(c=2*m/(t-1)-1)*p.x,i.y+c*p.y,i.z+c*p.z)).atom=a,d.smoothen=!1,d.skip=!0,e[m].push(d);l=a.style.cartoon.style||"default",e.style?e.style!=l&&(console.log("Warning: a cartoon chain's strand-style is ambiguous"),e.style="default"):e.style=l,"arrow start"!==a.ss&&"arrow end"!==a.ss||(a.ss="s")}}const se={C:!0,CA:!0,O:!0,P:!0,OP2:!0,O2P:!0,"O5'":!0,"O3'":!0,"C5'":!0,"C2'":!0,"O5*":!0,"O3*":!0,"C5*":!0,"C2*":!0,N1:!0,N3:!0},ne={DA:!0,DG:!0,A:!0,G:!0},ae={DT:!0,DC:!0,U:!0,C:!0,T:!0},oe={DA:!0,DG:!0,A:!0,G:!0,DT:!0,DC:!0,U:!0,C:!0,T:!0}},"./src/index.ts":(e,t,r)=>{r.r(t),r.d(t,{CAP:()=>i.CAP,CC:()=>i.CC,CONTEXTS_PER_VIEWPORT:()=>i.CONTEXTS_PER_VIEWPORT,Color:()=>i.Color,CustomLinear:()=>i.CustomLinear,Cylinder:()=>i.Cylinder,GLDraw:()=>i.GLDraw,GLModel:()=>i.GLModel,GLShape:()=>i.GLShape,GLViewer:()=>i.GLViewer,GLVolumetricRender:()=>i.GLVolumetricRender,Gradient:()=>i.Gradient,GradientType:()=>i.GradientType,Label:()=>i.Label,LabelCount:()=>i.LabelCount,MarchingCube:()=>i.MarchingCube,MarchingCubeInitializer:()=>i.MarchingCubeInitializer,Matrix3:()=>i.Matrix3,Matrix4:()=>i.Matrix4,Parsers:()=>i.Parsers,PausableTimer:()=>i.PausableTimer,PointGrid:()=>i.PointGrid,ProteinSurface:()=>i.ProteinSurface,Quaternion:()=>i.Quaternion,ROYGB:()=>i.ROYGB,RWB:()=>i.RWB,Ray:()=>i.Ray,Sinebow:()=>i.Sinebow,Sphere:()=>i.Sphere,SurfaceType:()=>i.SurfaceType,Triangle:()=>i.Triangle,Vector2:()=>i.Vector2,Vector3:()=>i.Vector3,VolumeData:()=>i.VolumeData,adjustVolumeStyle:()=>i.adjustVolumeStyle,applyPartialCharges:()=>i.applyPartialCharges,autoinit:()=>i.autoinit,autoload:()=>i.autoload,base64ToArray:()=>i.base64ToArray,bondLength:()=>i.bondLength,builtinColorSchemes:()=>i.builtinColorSchemes,builtinGradients:()=>i.builtinGradients,chains:()=>i.chains,clamp:()=>i.clamp,conversionMatrix3:()=>i.conversionMatrix3,createStereoViewer:()=>i.createStereoViewer,createViewer:()=>i.createViewer,createViewerGrid:()=>i.createViewerGrid,deepCopy:()=>i.deepCopy,degToRad:()=>i.degToRad,download:()=>i.download,drawCartoon:()=>i.drawCartoon,elementColors:()=>i.elementColors,extend:()=>i.extend,get:()=>i.get,getAtomProperty:()=>i.getAtomProperty,getColorFromStyle:()=>i.getColorFromStyle,getElement:()=>i.getElement,getExtent:()=>i.getExtent,getGradient:()=>i.getGradient,getPropertyRange:()=>i.getPropertyRange,getbin:()=>i.getbin,htmlColors:()=>i.htmlColors,inflateString:()=>i.inflateString,isEmptyObject:()=>i.isEmptyObject,isNumeric:()=>i.isNumeric,makeFunction:()=>i.makeFunction,mergeGeos:()=>i.mergeGeos,normalizeValue:()=>i.normalizeValue,partialCharges:()=>i.partialCharges,processing_autoinit:()=>i.processing_autoinit,residues:()=>i.residues,setBondLength:()=>i.setBondLength,setSyncSurface:()=>i.setSyncSurface,specStringToObject:()=>i.specStringToObject,splitMesh:()=>i.splitMesh,ssColors:()=>i.ssColors,subdivide_spline:()=>i.subdivide_spline,syncSurface:()=>i.syncSurface,viewers:()=>i.viewers});var i=r("./src/3Dmol.ts");window&&(window.$3Dmol=t)},"./src/parsers/BCIF.ts":(e,t,r)=>{r.r(t),r.d(t,{BCIF:()=>function(t,p){var f=!p.keepH,m=p.altLoc||"A",r=!p.noComputeSecondaryStructure;var g=!p.doAssembly,i=void 0===p.assignBonds||p.assignBonds;if("string"==typeof t)try{t=(0,n.base64ToArray)(t)}catch(e){const s=new TextEncoder;t=s.encode(t)}else t=new Uint8Array(t);var v=h.decodeMsgpack(t);31==v&&(t=(0,n.inflateString)(t,!1),v=h.decodeMsgpack(t));var b=[],_=b.modelData=[],y=v.dataBlocks.length;if(0==y)return b;p.multimodel||(y=1);for(let u=0;u<y;u++){var H=b.length;const U=[];_.push({symmetries:[]}),b.push([]);var q=v.dataBlocks[u];const N=Object.create(null);for(const j of q.categories)N[j.name.substr(1)]=(0,be.Category)(j);let r={},e=N.struct_conf;if(e){let t=e.getField("conf_type_id");var Y=e.getField("beg_label_asym_id"),Z=e.getField("beg_label_seq_id"),X=e.getField("end_label_seq_id");for(let e=0;e<t.length;e++)if(t[e].startsWith("H")){var x=Y[e],w=Z[e],A=X[e];x in r||(r[x]={}),r[x][w]="h1";for(let e=w+1;e<A;e++)r[x][e]="h";r[x][A]="h2"}}let t=N.struct_sheet_range;if(t){var K=t.getField("id"),Q=t.getField("beg_label_asym_id"),$=t.getField("beg_label_seq_id"),J=t.getField("end_label_seq_id");for(let e=0;e<K.length;e++){var S=Q[e],C=$[e],L=J[e];S in r||(r[S]={}),r[S][C]="s1";for(let e=C+1;e<L;e++)r[S][e]="s";r[S][L]="s2"}}let i=N.pdbx_struct_oper_list;var M=i.getField("id");if(M&&!g){var ee=i.getField("matrix[1][1]"),te=i.getField("matrix[1][2]"),re=i.getField("matrix[1][3]"),ie=i.getField("matrix[2][1]"),se=i.getField("matrix[2][2]"),ne=i.getField("matrix[2][3]"),ae=i.getField("matrix[3][1]"),oe=i.getField("matrix[3][2]"),le=i.getField("matrix[3][3]"),he=i.getField("vector[1]"),ce=i.getField("vector[2]"),de=i.getField("vector[3]");for(let e=0;e<M.length;e++){var ue=new _e.Matrix4(ee[e],te[e],re[e],he[e],ie[e],se[e],ne[e],ce[e],ae[e],oe[e],le[e],de[e]);_[_.length-1].symmetries.push(ue)}}var z=new xe(N.chem_comp_bond);let s=new Ae;var T=new we(N.struct_conn);let n=N.atom_site;var pe=n.rowCount,E=n.getField("group_PDB"),fe=n.getField("Cartn_x"),me=n.getField("Cartn_y"),ge=n.getField("Cartn_z"),F=n.getField("auth_asym_id"),D=n.getField("label_asym_id"),k=n.getField("auth_seq_id"),I=n.getField("label_seq_id");let a=n.getField("auth_comp_id"),o=n.getField("label_comp_id"),l=n.getField("auth_atom_id"),h=n.getField("label_atom_id"),c=n.getField("type_symbol");var O=n.getField("B_iso_or_equiv"),ve=n.getField("id"),R=n.getField("label_alt_id"),G=n.getField("pdbx_PDB_model_num");let d=G?G[0]:0;for(let t=0;t<pe;t++)if(void 0===E||"TER"!==E[t]){if(G&&G[t]!=d){if(d=G[t],!p.multimodel)break;p.onemol||(b.push([]),_.push(_[_.length-1]),d=G[t],s.setBonds(z,T),s=new Ae)}const V={};V.x=fe[t],V.y=me[t],V.z=ge[t],V.chain=F?F[t]:D?D[t]:void 0,V.lchain=D?D[t]:void 0,V.resi=k?k[t]:I?I[t]:void 0,V.lresi=I?I[t]:void 0,V.resn=a?a[t].trim():o?o[t].trim():void 0,V.lresn=o?o[t].trim():void 0,V.atom=l?l[t].replace(/"/gm,""):h?h[t].replace(/"/gm,""):void 0,V.icode=R?R[t]:void 0,V.altLoc=V.icode,V.hetflag=!E||"HETA"===E[t]||"HETATM"===E[t];let e="X";c&&(e=c[t].replace(/\(?\+?\d+.*/,"")),V.elem=e[0].toUpperCase()+e.substring(1,2).toLowerCase(),O&&(V.b=O[t]),f&&"H"==V.elem||""!=V.altLoc&&V.altLoc!=m&&"*"!=m||(V.bonds=[],V.ss="c",V.serial=ve[t],V.model=d,V.bondOrder=[],V.properties={},V.index=b[b.length-1].length,U[V.serial]=[b.length,V.index],b[b.length-1].push(V),s.add(V))}if(s.setBonds(z,T),!(0,ye.isEmpty)(r))for(let e=H;e<b.length;e++){var P,B=b[e];for(let e=0;e<B.length;e++){const W=B[e];void 0!==W&&W.lchain in r&&W.lresi in r[W.lchain]&&(P=r[W.lchain][W.lresi],W.ss=P[0],1<P.length&&("1"==P[1]?W.ssbegin=!0:"2"==P[1]&&(W.ssend=!0)))}}p.multimodel&&u<y-1&&(p.onemol||(b.push([]),_.push({symmetries:[]})))}for(let e=0;e<b.length;e++)!i||p.duplicateAssemblyAtoms&&!p.dontConnectDuplicatedAtoms||(0,l.assignPDBBonds)(b[e],p),r&&(0,a.computeSecondaryStructure)(b[e],p.hbondCutoff),(0,o.processSymmetries)(_[e].symmetries,b[e],p,_[e].cryst),p.duplicateAssemblyAtoms&&!p.dontConnectDuplicatedAtoms&&i&&(0,l.assignPDBBonds)(b[e],p);return b}});var n=r("./src/utilities.ts"),a=r("./src/parsers/utils/computeSecondaryStructure.ts"),o=r("./src/parsers/utils/processSymmetries.ts"),be=r("./src/parsers/cifutils/category.ts"),l=r("./src/parsers/utils/assignPDBBonds.ts"),_e=r("./src/WebGL/index.ts"),ye=r("./src/parsers/utils/isEmpty.ts"),h=r("./src/vendor/mmtf.js");class xe{constructor(e){if(this.C={},e){var r=e.getField("comp_id"),i=e.getField("atom_id_1"),s=e.getField("atom_id_2"),n=e.getField("value_order");for(let t=0;t<r.length;t++){var a=r[t],o=i[t],l=s[t],h=n[t];let e=1;"doub"==h?e=2:"trip"==h&&(e=3),null==this.C[a]&&(this.C[a]={}),null==this.C[a][o]&&(this.C[a][o]={}),null==this.C[a][l]&&(this.C[a][l]={}),this.C[a][o][l]=e,this.C[a][l][o]=e}}}order(e,t,r){return void 0!==this.C[e]&&void 0!==this.C[e][t]&&void 0!==this.C[e][t][r]?this.C[e][t][r]:0}}class we{constructor(e){if(this.C=[],e){var t,r=e.getField("conn_type_id"),i=e.getField("ptnr1_label_asym_id"),s=e.getField("ptnr1_label_seq_id"),n=e.getField("ptnr1_label_comp_id"),a=e.getField("ptnr1_label_atom_id"),o=e.getField("ptnr2_label_asym_id"),l=e.getField("ptnr2_label_seq_id"),h=e.getField("ptnr2_label_comp_id"),c=e.getField("ptnr2_label_atom_id"),d=e.getField("pdbx_value_order");for(let e=0;e<r.length;e++)"disulf"!=r[e]&&"covale"!=r[e]||(t=!d||""==d[e]?1:parseInt(d[e]),this.C.push([[i[e],s[e],n[e],a[e]],[o[e],l[e],h[e],c[e]],t]))}}}class Ae{constructor(){this.R={}}add(e){null==this.R[e.lchain]&&(this.R[e.lchain]={}),null==this.R[e.lchain][e.lresi]&&(this.R[e.lchain][e.lresi]={}),null==this.R[e.lchain][e.lresi][e.lresn]&&(this.R[e.lchain][e.lresi][e.lresn]=[]),this.R[e.lchain][e.lresi][e.lresn].push(e),this.R[e.lchain][e.lresi][e.lresn][e.atom]=e}geta([e,t,r,i]){if(void 0!==this.R[e]&&void 0!==this.R[e][t]&&void 0!==this.R[e][t][r])return this.R[e][t][r][i]}setBonds(n,e){for(var t in this.R)for(var r in this.R[t])for(var a in this.R[t][r]){var o=this.R[t][r][a];for(let s=0;s<o.length;s++)for(let i=s+1;i<o.length;i++){let e=o[s],t=o[i],r=n.order(a,e.atom,t.atom);0<(r=e.altLoc!=t.altLoc&&""!=e.altLoc&&""!=t.altLoc?0:r)&&(e.bonds.push(t.index),t.bonds.push(e.index),e.bondOrder.push(r),t.bondOrder.push(r))}}for(var i of e.C){var s=i[0],l=i[1],i=i[2];let e=this.geta(s),t=this.geta(l);null!=e&&null!=t&&(e.bonds.push(t.index),t.bonds.push(e.index),e.bondOrder.push(i),t.bondOrder.push(i))}}}},"./src/parsers/CDJSON.ts":(e,t,r)=>{r.r(t),r.d(t,{CDJSON:()=>function(e,t){var i=[[]];"string"==typeof e&&(e=JSON.parse(e));for(var e=e.m,r=e[0].a,s=e[0].b,n=e[0].s,a=void 0!==t&&void 0!==t.parseStyle?t.parseStyle:void 0!==n,o=i[i.length-1].length,l=0;l<r.length;l++){var h=r[l],c={},d=(c.id=h.i,c.x=h.x,c.y=h.y,c.z=h.z||0,c.bonds=[],c.bondOrder=[],h.l||"C");c.elem=d[0].toUpperCase()+d.substring(1).toLowerCase(),c.serial=i[i.length-1].length,a&&(c.style=n[h.s||0]),i[i.length-1].push(c)}for(let r=0;r<s.length;r++){var u=s[r],p=u.b+o,f=u.e+o,u=u.o||1;let e=i[i.length-1][p],t=i[i.length-1][f];e.bonds.push(f),e.bondOrder.push(u),t.bonds.push(p),t.bondOrder.push(u)}return i}})},"./src/parsers/CIF.ts":(e,t,r)=>{r.r(t),r.d(t,{CIF:()=>function(e,t={}){const r=[],s=!t.doAssembly,n=r.modelData=[],i=void 0===t.assignBonds||t.assignBonds;const a=e.split(/\r?\n|\r/),o=[];let l=!1;for(let e=0;e<a.length;e++){var h=a[e].split("#")[0];if(l?";"===h[0]&&(l=!1):";"===h[0]&&(l=!0),l||""!==h){if(!l&&"_"===(h=h.trim())[0]){var c=h.split(/\s/)[0].indexOf(".");if(-1<c){let e=h.split("");e[c]="_",h=(h=e.join("")).substring(0,c)+"_"+h.substring(c+1)}}o.push(h)}}let d=0;for(;d<o.length;){for(;!o[d].startsWith("data_")||"data_global"===o[d];)d++;d++;const z={};for(;d<o.length&&!o[d].startsWith("data_");)if(void 0===o[d][0])d++;else if("_"===o[d][0]){var u=o[d].split(/\s/)[0].toLowerCase();const T=z[u]=z[u]||[],E=o[d].substring(o[d].indexOf(u)+u.length);if(""===E)if(d++,";"===o[d][0]){let e=o[d].substring(1);for(d++;";"!==o[d];)e=e+"\n"+o[d],d++;T.push(e)}else T.push(o[d]);else T.push(E.trim());d++}else if("loop_"===o[d].substring(0,5)){d++;const F=[];for(;""===o[d]||"_"===o[d][0];){var p;""!==o[d]&&(p=o[d].split(/\s/)[0].toLowerCase(),p=z[p]=z[p]||[],F.push(p)),d++}let t=0;for(;d<o.length&&"_"!==o[d][0]&&!o[d].startsWith("loop_")&&!o[d].startsWith("data_");){var f=function(e,t){const r=[];let i=0,s=0;for(;s<e.length;){for(;e.substring(s,s+t.length)!==t&&s<e.length;)if("'"===e[s]){for(s++;s<e.length&&"'"!==e[s];)s++;for(;e.substring(s,s+t.length)!==t&&s<e.length;)s++}else if('"'===e[s]){for(s++;s<e.length&&'"'!==e[s];)s++;s++}else s++;r.push(e.substring(i,s)),i=s+=t.length}return r}(o[d]," ");for(let e=0;e<f.length;e++)""!==f[e]&&(F[t].push(f[e]),t=(t+1)%F.length);d++}}else d++;n.push({symmetries:[]}),r.push([]);var m,g,v,b,_,y,x,w=(void 0!==z._atom_site_id?z._atom_site_id:z._atom_site_label).length;let i;void 0!==z._cell_length_a&&(m=parseFloat(z._cell_length_a),g=parseFloat(z._cell_length_b),v=parseFloat(z._cell_length_c),b=parseFloat(z._cell_angle_alpha)||90,_=parseFloat(z._cell_angle_beta)||90,y=parseFloat(z._cell_angle_gamma)||90,i=(0,X.conversionMatrix3)(m,g,v,b,_,y),n[n.length-1].cryst={a:m,b:g,c:v,alpha:b,beta:_,gamma:y});for(let t=0;t<w;t++)if(void 0===z._atom_site_group_pdb||"TER"!==z._atom_site_group_pdb[t]){const D={};void 0!==z._atom_site_cartn_x?(D.x=parseFloat(z._atom_site_cartn_x[t]),D.y=parseFloat(z._atom_site_cartn_y[t]),D.z=parseFloat(z._atom_site_cartn_z[t])):(x=Q(i,parseFloat(z._atom_site_fract_x[t]),parseFloat(z._atom_site_fract_y[t]),parseFloat(z._atom_site_fract_z[t])),D.x=x.x,D.y=x.y,D.z=x.z),D.chain=z._atom_site_auth_asym_id?z._atom_site_auth_asym_id[t]:z._atom_site_label_asym_id?z._atom_site_label_asym_id[t]:void 0,D.lchain=z._atom_site_label_asym_id?z._atom_site_label_asym_id[t]:void 0,D.resi=z._atom_site_auth_seq_id?parseInt(z._atom_site_auth_seq_id[t]):z._atom_site_label_seq_id?z._atom_site_label_seq_id[t]:void 0,D.resn=z._atom_site_auth_comp_id?z._atom_site_auth_comp_id[t].trim():z._atom_site_label_comp_id?z._atom_site_label_comp_id[t].trim():void 0,D.atom=z._atom_site_auth_atom_id?z._atom_site_auth_atom_id[t].replace(/"/gm,""):z._atom_site_label_atom_id?z._atom_site_label_atom_id[t].replace(/"/gm,""):void 0,D.hetflag=!z._atom_site_group_pdb||"HETA"===z._atom_site_group_pdb[t]||"HETATM"===z._atom_site_group_pdb[t],z._atom_site_b_iso_or_equiv&&(D.b=parseFloat(z._atom_site_b_iso_or_equiv[t]));let e="X";z._atom_site_type_symbol?e=z._atom_site_type_symbol[t].replace(/\(?\+?\d+.*/,""):z._atom_site_label&&(e=z._atom_site_label[t].split("_")[0].replace(/\(?\d+.*/,"")),D.elem=e[0].toUpperCase()+e.substring(1,2).toLowerCase(),D.bonds=[],D.ss="c",D.serial=t,D.bondOrder=[],D.properties={},r[r.length-1].push(D)}if(void 0!==z._pdbx_struct_oper_list_id&&!s)for(let e=0;e<z._pdbx_struct_oper_list_id.length;e++){var A=parseFloat(z["_pdbx_struct_oper_list_matrix[1][1]"][e]),S=parseFloat(z["_pdbx_struct_oper_list_matrix[1][2]"][e]),R=parseFloat(z["_pdbx_struct_oper_list_matrix[1][3]"][e]),G=parseFloat(z["_pdbx_struct_oper_list_vector[1]"][e]),P=parseFloat(z["_pdbx_struct_oper_list_matrix[2][1]"][e]),B=parseFloat(z["_pdbx_struct_oper_list_matrix[2][2]"][e]),U=parseFloat(z["_pdbx_struct_oper_list_matrix[2][3]"][e]),N=parseFloat(z["_pdbx_struct_oper_list_vector[2]"][e]),j=parseFloat(z["_pdbx_struct_oper_list_matrix[3][1]"][e]),V=parseFloat(z["_pdbx_struct_oper_list_matrix[3][2]"][e]),W=parseFloat(z["_pdbx_struct_oper_list_matrix[3][3]"][e]),H=parseFloat(z["_pdbx_struct_oper_list_vector[3]"][e]),A=new X.Matrix4(A,S,R,G,P,B,U,N,j,V,W,H);n[n.length-1].symmetries.push(A)}if(void 0!==z._symmetry_equiv_pos_as_xyz&&!s)for(let e=0;e<z._symmetry_equiv_pos_as_xyz.length;e++){const k=z._symmetry_equiv_pos_as_xyz[e].replace(/["' ]/g,""),I=k.split(",").map(function(e){return e.replace(/-/g,"+-")});let r=new X.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1);for(let t=0;t<3;t++){var C,L=I[t].split("+");for(let e=0;e<L.length;e++){const O=L[e];""!==O&&(C=function(e){var t=e.match("-"),e=(e=e.replace(/[-xyz]/g,"")).split("/");let r,i;return i=void 0===e[1]?1:parseInt(e[1]),(r=""===e[0]?1:parseInt(e[0]))/i*(t?-1:1)}(O),O.match("x")?r.elements[t+0]=C:O.match("y")?r.elements[t+4]=C:O.match("z")?r.elements[t+8]=C:r.elements[t+12]=C)}}var M=i.getMatrix4(),q=(new X.Matrix4).getInverse(M,!0);r=(new X.Matrix4).multiplyMatrices(r,q),r=(new X.Matrix4).multiplyMatrices(M,r),n[n.length-1].symmetries.push(r)}}for(let e=0;e<r.length;e++)!i||t.duplicateAssemblyAtoms&&!t.dontConnectDuplicatedAtoms||(0,K.assignPDBBonds)(r[e],t),(0,Y.computeSecondaryStructure)(r[e],t.hbondCutoff),(0,Z.processSymmetries)(n[e].symmetries,r[e],t,n[e].cryst),t.duplicateAssemblyAtoms&&!t.dontConnectDuplicatedAtoms&&i&&(0,K.assignPDBBonds)(r[e],t);return r}});var Y=r("./src/parsers/utils/computeSecondaryStructure.ts"),Z=r("./src/parsers/utils/processSymmetries.ts"),X=r("./src/WebGL/index.ts"),K=r("./src/parsers/utils/assignPDBBonds.ts");const Q=function(e,t,r,i){return new X.Vector3(t,r,i).applyMatrix3(e)}},"./src/parsers/CUBE.ts":(e,t,r)=>{r.r(t),r.d(t,{CUBE:()=>function(e,t){t=t||{};const r=[[]];let i=e.split(/\r?\n/);e=void 0===t.assignBonds||t.assignBonds;if(i.length<6)return r;var s=i[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var n=Math.abs(parseFloat(s[0]));let a={origin:void 0,size:void 0,unit:void 0,matrix4:void 0,matrix:void 0};const o=a.origin=new y.Vector3(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3])),l=(s=i[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),0<(s=i[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" "))[0]?.529177:1),h=(o.multiplyScalar(l),Math.abs(s[0])),c=new y.Vector3(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3])).multiplyScalar(l),d=(s=i[4].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),Math.abs(s[0])),u=new y.Vector3(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3])).multiplyScalar(l),p=(s=i[5].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),Math.abs(s[0])),f=new y.Vector3(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3])).multiplyScalar(l);a.size={x:h,y:d,z:p},a.unit=new y.Vector3(c.x,u.y,f.z),0==c.y&&0==c.z&&0==u.x&&0==u.z&&0==f.x&&0==f.y||(a.matrix4=new y.Matrix4(c.x,u.x,f.x,0,c.y,u.y,f.y,0,c.z,u.z,f.z,0,0,0,0,1),s=(new y.Matrix4).makeTranslation(o.x,o.y,o.z),a.matrix4=a.matrix4.multiplyMatrices(s,a.matrix4),a.matrix=a.matrix4.matrix3FromTopLeft(),a.origin=new y.Vector3(0,0,0),a.unit=new y.Vector3(1,1,1));r.modelData=[{cryst:a}],i=i.splice(6,n);for(var m=r[r.length-1].length,g=m+i.length,v=m;v<g;++v){var b={};b.serial=v;var _=i[v-m].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");b.elem=w.anumToSymbol[_[0]],b.x=parseFloat(_[2])*l,b.y=parseFloat(_[3])*l,b.z=parseFloat(_[4])*l,b.hetflag=!0,b.bonds=[],b.bondOrder=[],b.properties={},r[r.length-1].push(b)}if(e)for(let e=0;e<r.length;e++)(0,x.assignBonds)(r[e],t);return r}});var y=r("./src/WebGL/index.ts"),x=r("./src/parsers/utils/assignBonds.ts"),w=r("./src/parsers/utils/anumToSymbol.ts")},"./src/parsers/GRO.ts":(e,t,r)=>{r.r(t),r.d(t,{GRO:()=>function(e,t){const r=[],i=e.split(/\r?\n|\r/);for(;0<i.length;){var s=parseInt(i[1]);if(i.length<3||isNaN(s)||s<=0||i.length<s+3)break;const o=[];r.push(o);let t=2;var n=o.length,a=n+s;for(let e=n;e<a;e++){const l=i[t++],h={};h.serial=e,h.atom=l.slice(10,15).trim(),h.elem=(0,p.atomNameToElem)(h.atom,!0),h.x=10*parseFloat(l.slice(20,28)),h.y=10*parseFloat(l.slice(28,36)),h.z=10*parseFloat(l.slice(36,44)),h.resi=parseInt(l.slice(0,5)),h.resn=l.slice(5,10).trim(),h.bonds=[],h.bondOrder=[],h.properties={},44<l.length&&(h.dx=10*parseFloat(l.slice(44,52)),h.dy=10*parseFloat(l.slice(52,60)),h.dz=10*parseFloat(l.slice(60,68))),o[e]=h}if(i.length<=t+3){const c=i[t++],d=c.trim().split(/\s+/);if(3===d.length){for(let e=0;e<3;e++)d[e]=(10*parseFloat(d[e])).toString();r.box=d}}i.splice(0,++t)}for(let e=0;e<r.length;e++)(0,u.assignPDBBonds)(r[e],t);return r}});var u=r("./src/parsers/utils/assignPDBBonds.ts"),p=r("./src/parsers/utils/atomNameToElem.ts")},"./src/parsers/LAMMPSTRJ.ts":(e,t,r)=>{r.r(t),r.d(t,{LAMMPSTRJ:()=>function(e,t){const r=[],i=e.split(/\r?\n|\r/);let s=0,n=0,a=0;for(;a<i.length-9;){for(var o=a;o<i.length;o++)if(i[o].match(/ITEM: NUMBER OF ATOMS/)&&(n=parseInt(i[o+1])),i[o].match(/ITEM: ATOMS/)){s=o+1;break}var l=i[s-1].replace("ITEM: ATOMS ","").split(" ");r.push([]);for(let e=s;e<s+n;e++){const d={},u={};var h=i[e].split(" ");for(let e=0;e<h.length;e++){var c=f[l[e]];void 0!==c&&("serial"===c?d[c]=parseInt(h[e]):"x"===c||"y"===c||"z"===c?d[c]=parseFloat(h[e]):"charge"===c||"radius"===c?u[c]=parseFloat(h[e]):d[c]=h[e]),d.properties=u,d.bonds=[],d.bondOrder=[]}r[r.length-1][e-s]=d}a=s+n-1}if(t.assignBonds)for(let e=0;e<r.length;e++)(0,p.assignBonds)(r[e],t);return r}});var p=r("./src/parsers/utils/assignBonds.ts");const f={id:"serial",type:"atom",element:"elem",q:"charge",radius:"radius",x:"x",xu:"x",xs:"x",xsu:"x",y:"y",yu:"y",ys:"y",ysu:"y",z:"z",zu:"z",zs:"z",zsu:"z"}},"./src/parsers/MMTF.ts":(e,t,r)=>{r.r(t),r.d(t,{MMTFparser:()=>function(e,t){var R=!t.keepH,r=t.altLoc||"A",G=!!t.noSecondaryStructure,P=!t.noComputeSecondaryStructure,i=!t.doAssembly,B=t.assemblyIndex||0;e="string"==typeof e?(0,ge.base64ToArray)(e):new Uint8Array(e);var s,n,a,o,l,h,c=ye.decode(e),d=[[]],u=d.modelData=[],p=0,f=0,m=0,g=c.secStructList,U=c.bFactorList,v=c.altLocList,N=c.occupancyList,b=c.bondAtomList,j=c.bondOrderList,_=c.numModels;if(0==_)return d;t.multimodel||(_=1);var V=[];if(!i&&c.bioAssemblyList&&0<c.bioAssemblyList.length){var W=c.bioAssemblyList[B].transformList;for(s=0,h=W.length;s<h;s++){var H=new ve.Matrix4(W[s].matrix);H.transpose(),V.push(H)}}var q=null;c.unitCell&&(e=c.unitCell,q={a:e[0],b:e[1],c:e[2],alpha:e[3],beta:e[4],gamma:e[5]});let Y=[];c.entityList.forEach(t=>{t.chainIndexList.forEach(e=>{Y[e]="polymer"==t.type})});var Z=0;for(l=0;l<_;l++){var X=c.chainsPerModel[l],y=d[d.length-1],x=[];for(u.push({symmetries:V,cryst:q}),s=0;s<X;++s){var K=c.groupsPerChain[p],Q=xe(c.chainIdList.subarray(4*p,4*p+4)),$=(c.chainNameList&&(Q=xe(c.chainNameList.subarray(4*p,4*p+4))),f),J="";for(n=0;n<K;++n){var w,A=c.groupList[c.groupTypeList[f]],ee=A.atomNameList.length,S=0,te=!1,re=!1,ie=(g&&(S=g[f],w=we(S),0!=f&&w==J||(te=!0),J=w,((C=f+1)>=g.length||we(g[C]!=w))&&(re=!0)),c.groupIdList[f]),se=A.groupName,C=A.chemCompType,ne=m,ae=Ae.has(C)||!Y[p];for(a=0;a<ee;++a){var L,M,z,oe,le,T,he,ce,de,ue=A.elementList[a];R&&"H"==ue?m+=1:(L="",M=(U&&(L=U[m]),""),z=(v&&v[m]&&(M=String.fromCharCode(v[m])),""),N&&(z=N[m]),""!=M&&M!=r&&"*"!=r||(oe=c.atomIdList[m],le=A.atomNameList[a],T=0,A.atomChargeList&&(T=A.atomChargeList[a]),he=c.xCoordList[m],ce=c.yCoordList[m],de=c.zCoordList[m],x[m]=y.length,y.push({resn:se,x:he,y:ce,z:de,elem:ue,hetflag:ae,chain:Q,resi:ie,icode:M,rescode:ie+(" "!=M?"^"+M:""),serial:oe,altLoc:M,index:m,atom:le,bonds:[],ss:we(S),ssbegin:te,ssend:re,bondOrder:[],properties:{charge:T,occupancy:z},b:L})),m+=1)}var pe=A.bondAtomList;for(a=0,o=A.bondOrderList.length;a<o;++a){var E=ne+pe[2*a],F=ne+pe[2*a+1],fe=A.bondOrderList[a],E=x[E],F=x[F],D=y[E],k=y[F];D&&k&&(D.bonds.push(F),D.bondOrder.push(fe),k.bonds.push(E),k.bondOrder.push(fe))}f+=1}for(f=$,n=0;n<K;++n)f+=1;p+=1}if(b)for(let r=Z,e=b.length;r<e;r+=2){var I=b[r],O=b[r+1],me=j?j[r/2]:1;if(m<=I){Z=r;break}I=x[I],O=x[O];let e=y[I],t=y[O];e&&t&&(e.bonds.push(O),e.bondOrder.push(me),t.bonds.push(I),t.bondOrder.push(me))}!t.multimodel||t.onemol||d.push([])}if(!i)for(let e=0;e<d.length;e++)(0,_e.processSymmetries)(u[e].symmetries,d[e],t,u[e].cryst);P&&!G&&(0,be.computeSecondaryStructure)(d,t.hbondCutoff);return d}});var ge=r("./src/utilities.ts"),ve=r("./src/WebGL/index.ts"),be=r("./src/parsers/utils/computeSecondaryStructure.ts"),_e=r("./src/parsers/utils/processSymmetries.ts"),ye=r("./src/vendor/mmtf.js"),xe=function(e){return String.fromCharCode.apply(null,e).replace(/\0/g,"")},we=function(e){return 0==e||2==e||4==e?"h":3==e?"s":"c"};let Ae=new Set(["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","NON-POLYMER","OTHER","PEPTIDE-LIKE","SACCHARIDE"])},"./src/parsers/MOL2.ts":(e,t,r)=>{r.r(t),r.d(t,{MOL2:()=>function(e,t){var r=[[]],i=!1;void 0!==t.keepH&&(i=!t.keepH);var s=e.search(/@<TRIPOS>MOLECULE/),n=e.search(/@<TRIPOS>ATOM/);if(-1==s||-1==n)return r;var a,o,l=e.substring(s).split(/\r?\n|\r/);for(;0<l.length;){var h=[],c=l[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),d=parseInt(c[0]),u=0,p=(1<c.length&&(u=parseInt(c[1])),4);for(a=3;a<l.length;a++)if("@<TRIPOS>ATOM"==l[a]){p=a+1;break}var f=r[r.length-1].length,m=f+d;for(a=f;a<m;a++){o=l[p++],c=o.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var g,v,b={},_=c[5];_=void 0!==L[_]?L[_]:(_=_.split(".")[0])[0].toUpperCase()+_.substring(1).toLowerCase(),b.atom=c[1],b.elem=_,"H"==b.elem&&i||(_=r[r.length-1].length,g=parseInt(c[0]),b.serial=g,b.x=parseFloat(c[2]),b.y=parseFloat(c[3]),b.z=parseFloat(c[4]),b.atom=c[5],v=parseFloat(c[8]),b.index=_,b.bonds=[],b.bondOrder=[],b.properties={charge:v,partialCharge:v},h[g]=_,r[r.length-1].push(b))}for(var y=!1;p<l.length;)if("@<TRIPOS>BOND"==l[p++]){y=!0;break}if(y&&u)for(a=0;a<u;a++){o=l[p++],c=o.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var x=parseInt(c[1]),w=r[r.length-1][h[x]],A=parseInt(c[2]),S=r[r.length-1][h[A]],C=parseInt(c[3]);isNaN(C)&&(C=1),void 0!==w&&void 0!==S&&(w.bonds.push(h[A]),w.bondOrder.push(C),S.bonds.push(h[x]),S.bondOrder.push(C))}if(!t.multimodel)break;t.onemol||r.push([]),l.splice(0,p),e=l.join("\n")}return r}});let L={"C.1":"C",C1:"C","C.2":"C",C2:"C","C.3":"C",C3:"C","C.ar":"C",Car:"C","C.cat":"C",Ccat:"C","H.spc":"H",Hspc:"H","H.t3p":"H",Ht3p:"H","N.1":"N",N1:"N","N.2":"N",N2:"N","N.3":"N",N3:"N","N.4":"N",N4:"N","N.am":"N",Nam:"N","N.ar":"N",Nar:"N","N.p13":"N",Np13:"N","O.2":"O",O2:"O","O.3":"O",O3:"O","O.co2":"O",Oco2:"O","O.spc":"O",Ospc:"O","O.t3p":"O",Ot3p:"O","P.3":"P",P3:"P","S.2":"S",S2:"S","S.3":"S",S3:"S","S.o":"S",So:"S","S.o2":"S",So2:"S"}},"./src/parsers/PDB.ts":(e,t,r)=>{r.r(t),r.d(t,{PDB:()=>function(e,t){t=t||{};var r=[],i={},s=(r.modelData=[],e.split(/\r?\n|\r/));for(;0<s.length;){var n=(0,u.getSinglePDB)(s,t,i),a=n[0],o=n[1];if(s=n[2],0!=a.length){if(t.multimodel&&t.onemol&&0<r.length)for(var l=r[0].length,h=0;h<a.length;h++){var c=a[h];c.index=h;for(var d=0;d<c.bonds.length;d++)c.bonds[d]+=l;r[0].push(c)}else r.modelData.push(o),r.push(a);if(!t.multimodel)break}}return r}});var u=r("./src/parsers/utils/getSinglePDB.ts")},"./src/parsers/PQR.ts":(e,t,r)=>{r.r(t),r.d(t,{PQR:()=>function(e,t){var r,i,s=[[]],n=!t.noSecondaryStructure,a=(s.modelData=[{symmetries:[]}],[]),o=e.split(/\r?\n|\r/);for(let e=0;e<o.length;e++){var l=(r=o[e].replace(/^\s*/,"")).substring(0,6);if(0==l.indexOf("END")){if(!t.multimodel)break;t.onemol||s.push([])}else if("ATOM  "==l||"HETATM"==l){var h=parseInt(r.substring(6,11));let e=r.substring(12,16).replace(/ /g,"");var c=r.substring(17,20).trim(),d=r.substring(21,22),u=parseInt(r.substring(22,26)),p=r.substring(30).trim().split(/\s+/),f=parseFloat(p[0]),m=parseFloat(p[1]),g=parseFloat(p[2]),v=parseFloat(p[3]),p=parseFloat(p[4]),b=e[0];1<e.length&&e[1].toUpperCase()!=e[1]&&(b=e.substring(0,2)),i="H"==r[0],a[h]=s[s.length-1].length,s[s.length-1].push({resn:c,x:f,y:m,z:g,elem:b,hetflag:i,chain:d,resi:u,serial:h,atom:e,bonds:[],ss:"c",bondOrder:[],properties:{charge:v,partialCharge:v,radius:p},pdbline:r})}else if("CONECT"==l){var c=parseInt(r.substring(6,11)),_=s[s.length-1][a[c]];for(let e=0;e<4;e++){var y=parseInt(r.substring([11,16,21,26][e],[11,16,21,26][e]+5)),x=s[s.length-1][a[y]];void 0!==_&&void 0!==x&&(_.bonds.push(a[y]),_.bondOrder.push(1))}}}for(let e=0;e<s.length;e++)(0,w.assignPDBBonds)(s[e],t),n&&(0,A.computeSecondaryStructure)(s[e],t.hbondCutoff);return s}});var w=r("./src/parsers/utils/assignPDBBonds.ts"),A=r("./src/parsers/utils/computeSecondaryStructure.ts")},"./src/parsers/PRMTOP.ts":(e,t,r)=>{r.r(t),r.d(t,{PRMTOP:()=>function(e){var t,n=[],r=0,a=e.split(/\r?\n|\r/);{if(!(0<a.length&&a[0].includes("VERSION")))return[];var i=a.filter(function(e){return e.includes("POINTERS")||e.includes("ATOM_NAME")||e.includes("CHARGE")||e.includes("RADII")||e.includes("BONDS_INC_HYDROGEN")||e.includes("BONDS_WITHOUT_HYDROGEN")||e.includes("RESIDUE_LABEL")||e.includes("RESIDUE_POINTER")}),o=p("POINTERS");if(-1==o)return[];var l=f(o),s=parseInt(a[o+1].slice(0,l[1])),h=parseInt(a[o+2].slice(l[1],l[0]+l[1]));if(isNaN(s)||s<=0)return[];if(-1==(o=p("ATOM_NAME")))return[];var c=(l=f(o))[0];for(let e=0;e<s/l[0];e++){e==parseInt(s/l[0])&&(c=s%l[0]);for(let t=0;t<c;t++){let e={};var d={charge:"",radii:""};e.serial=r,e.x=0,e.y=0,e.z=0,e.atom=a[o+1].slice(l[1]*t,l[1]*(t+1)).trim(),e.elem=a[o+1].slice(l[1]*t,l[1]*t+1).trim(),e.properties=d,e.bonds=[],e.bondOrder=[],e.index=n.length,n.push(e),r++}o++}if(-1!=(o=p("CHARGE"))){l=f(o),c=l[r=0];for(let e=0;e<s/l[0];e++){e==parseInt(s/l[0])&&(c=s%l[0]);for(let e=0;e<c;e++)n[r].properties.charge=parseFloat(a[o+1].slice(l[1]*e,l[1]*(e+1))),r++;o++}}o=p("RESIDUE_POINTER");var u=[];if(-1!=o){l=f(o),c=l[0],o+=1;for(let e=0;e<h/l[0];e++){e==parseInt(h/l[0])&&(c=h%l[0]);for(let e=0;e<c;e++)u.push(parseInt(a[o].slice(l[1]*e,l[1]*(e+1))));o++}if(-1!=(o=p("RESIDUE_LABEL"))){let t=[];l=f(o),c=l[0],o+=1;for(let e=0;e<h/l[0];e++){e==parseInt(h/l[0])&&(c=h%l[0]);for(let e=0;e<c;e++)t.push(a[o].slice(l[1]*e,l[1]*(e+1)).trim());o++}let r=0,i=0,s="";u.push(n.length+1);for(let e=0;e<n.length;e++)e+1>=u[r]&&(s=t[r],r+=1,i+=1),n[e].resi=i,n[e].resn=s}}if(-1!=(o=p("RADII"))){l=f(o),c=l[r=0];for(let e=0;e<s/l[0];e++){e==parseInt(s/l[0])&&(c=s%l[0]);for(let e=0;e<c;e++)n[r].properties.radii=parseFloat(a[o+1].slice(l[1]*e,l[1]*(e+1))),r++;o++}}if(-1!=(o=p("BONDS_WITHOUT_HYDROGEN")))for(l=f(o),c=l[r=0],o+=1;!a[o].match(/^%FLAG/);){a[o+1].match(/^%FLAG/)&&(c=s%l[0]);for(let e=0;e<c;e++)r%3==0?t=parseInt(a[o].slice(l[1]*e,l[1]*(e+1))/3):r%3==1&&(n[t].bonds.push(parseInt(a[o].slice(l[1]*e,l[1]*(e+1))/3)),n[t].bondOrder.push(1)),r++;o++}if(-1!=(o=p("BONDS_INC_HYDROGEN")))for(l=f(o),c=l[r=0],o+=1;!a[o].match(/^%FLAG/);){a[o+1].match(/^%FLAG/)&&(c=s%l[0]);for(let e=0;e<c;e++)r%3==0?t=parseInt(a[o].slice(l[1]*e,l[1]*(e+1))/3):r%3==1&&(n[t].bonds.push(parseInt(a[o].slice(l[1]*e,l[1]*(e+1))/3)),n[t].bonds.push(1)),r++;o++}}function p(t){var e=a.indexOf(i.filter(function(e){return e.includes(t)})[0]);if(Number.isInteger(e)&&0<e){for(;!a[e].includes("FORMAT");)e++;return e}return-1}function f(e){var t=a[e].match(/\((\d*)\S*/),r=a[e].match(/[a-zA-Z](\d*)\)\s*/);return null==r&&(r=a[e].match(/[a-zA-Z](\d*)\.\d*\)\s*/)),[parseInt(t[1]),parseInt(r[1])]}return[n]}})},"./src/parsers/SDF.ts":(e,t,r)=>{r.r(t),r.d(t,{SDF:()=>function(e,t){var r="V2000",e=e.split(/\r?\n|\r/);3<e.length&&38<e[3].length&&(r=e[3].substring(34,39));{if("V2000"===r)return i(e,t);if("V3000"===r)return s(e,t)}return[[""]]}});var i=function(e,t){var r=[[]],i=!1;for(void 0!==t.keepH&&(i=!t.keepH);0<e.length&&!(e.length<4);){var s=parseInt(e[3].substring(0,3));if(isNaN(s)||s<=0)break;var n=parseInt(e[3].substring(3,6)),a=4;if(e.length<4+s+n)break;for(var o=[],l=r[r.length-1].length,h=l+s,c=l;c<h;c++,a++){var d,u={},p=(d=e[a]).substring(31,34).replace(/ /g,"");u.atom=u.elem=p[0].toUpperCase()+p.substring(1).toLowerCase(),"H"===u.elem&&i||(o[u.serial=c]=r[r.length-1].length,u.x=parseFloat(d.substring(0,10)),u.y=parseFloat(d.substring(10,20)),u.z=parseFloat(d.substring(20,30)),u.hetflag=!0,u.bonds=[],u.bondOrder=[],u.properties={},u.index=r[r.length-1].length,r[r.length-1].push(u))}for(c=0;c<n;c++,a++){d=e[a];var f=o[parseInt(d.substring(0,3))-1+l],m=o[parseInt(d.substring(3,6))-1+l],g=parseFloat(d.substring(6));void 0!==f&&void 0!==m&&(r[r.length-1][f].bonds.push(m),r[r.length-1][f].bondOrder.push(g),r[r.length-1][m].bonds.push(f),r[r.length-1][m].bondOrder.push(g))}if(!t.multimodel)break;for(t.onemol||r.push([]);"$$$$"!==e[a]&&a<e.length;)a++;e.splice(0,++a)}return r},s=function(e,t){var r=[[]],i=!1;for(void 0!==t.keepH&&(i=!t.keepH);0<e.length&&!(e.length<8)&&e[4].startsWith("M  V30 BEGIN CTAB")&&e[5].startsWith("M  V30 COUNTS")&&!(e[5].length<14);){var s=e[5].substring(13).match(/\S+/g);if(s.length<2)break;var n=parseInt(s[0]);if(isNaN(n)||n<=0)break;var a=parseInt(s[1]),o=7;if(e.length<8+n+a)break;for(var l=[],h=r[r.length-1].length,c=h+n,d=h;d<c;d++,o++){var u,p,f=e[o].substring(6).match(/\S+/g);4<f.length&&(u={},p=f[1].replace(/ /g,""),u.atom=u.elem=p[0].toUpperCase()+p.substring(1).toLowerCase(),"H"===u.elem&&i||(l[u.serial=d]=r[r.length-1].length,u.x=parseFloat(f[2]),u.y=parseFloat(f[3]),u.z=parseFloat(f[4]),u.hetflag=!0,u.bonds=[],u.bondOrder=[],u.properties={},u.index=r[r.length-1].length,r[r.length-1].push(u)))}if("M  V30 END ATOM"!==e[o])break;if(o++,0===a||"M  V30 BEGIN BOND"!==e[o])break;for(o++,d=0;d<a;d++,o++){var m,g,v=e[o].substring(6).match(/\S+/g);3<v.length&&(m=l[parseInt(v[2])-1+h],g=l[parseInt(v[3])-1+h],v=parseFloat(v[1]),void 0!==m&&void 0!==g&&(r[r.length-1][m].bonds.push(g),r[r.length-1][m].bondOrder.push(v),r[r.length-1][g].bonds.push(m),r[r.length-1][g].bondOrder.push(v)))}if(!t.multimodel)break;for(t.onemol||r.push([]);"$$$$"!==e[o]&&o<e.length;)o++;e.splice(0,++o)}return r}},"./src/parsers/VASP.ts":(e,t,r)=>{r.r(t),r.d(t,{VASP:()=>function(e,t={}){var r=[[]],i={};var s=void 0===t.assignBonds||t.assignBonds;var n=e.replace(/^\s+/,"").split(/\r?\n/);if(n.length<3)return r;{if(!n[1].match(/\d+/))return console.log("Warning: second line of the vasp structure file must be a number"),r;i.length=parseFloat(n[1])}if(i.length<0)return console.log("Warning: Vasp implementation for negative lattice lengths is not yet available"),r;i.xVec=new Float32Array(n[2].replace(/^\s+/,"").split(/\s+/)),i.yVec=new Float32Array(n[3].replace(/^\s+/,"").split(/\s+/)),i.zVec=new Float32Array(n[4].replace(/^\s+/,"").split(/\s+/));var e=new v.Matrix3(i.xVec[0],i.xVec[1],i.xVec[2],i.yVec[0],i.yVec[1],i.yVec[2],i.zVec[0],i.zVec[1],i.zVec[2]),a=(e.multiplyScalar(i.length),r.modelData=[{symmetries:[],cryst:{matrix:e}}],n[5].trim().split(/\s+/)),o=new Int16Array(n[6].trim().split(/\s+/)),l=n[7].trim(),e=!1;l.match(/S/)&&(e=!0,l=n[8].trim());if("c"==l.toLowerCase()[0])l="cartesian";else{if("d"!=l.toLowerCase()[0])return console.log("Warning: Unknown vasp mode in POSCAR file: mode must be either C(artesian) or D(irect)"),r;l="direct"}if(a.length!=o.length)return console.log("Warning: declaration of atomary species wrong:"),console.log(a),console.log(o),r;e?n.splice(0,9):n.splice(0,8);for(var h=0,c=0,d=a.length;c<d;c++){for(var u=a[c],p=0,f=o[c];p<f;p++){var m=new Float32Array(n[h+p].trim().split(/\s+/)),g={};g.elem=u,"cartesian"==l?(g.x=i.length*m[0],g.y=i.length*m[1],g.z=i.length*m[2]):(g.x=i.length*(m[0]*i.xVec[0]+m[1]*i.yVec[0]+m[2]*i.zVec[0]),g.y=i.length*(m[0]*i.xVec[1]+m[1]*i.yVec[1]+m[2]*i.zVec[1]),g.z=i.length*(m[0]*i.xVec[2]+m[1]*i.yVec[2]+m[2]*i.zVec[2])),g.bonds=[],g.bondOrder=[],r[0].push(g)}h+=o[c]}if(s)for(let e=0;e<r.length;e++)(0,b.assignBonds)(r[e],t);return r}});var v=r("./src/WebGL/index.ts"),b=r("./src/parsers/utils/assignBonds.ts")},"./src/parsers/XYZ.ts":(e,t,r)=>{r.r(t),r.d(t,{XYZ:()=>function(e,t){var i=[[]],r=void 0===(t=t||{}).assignBonds||t.assignBonds,s=e.trimStart().split(/\r?\n|\r/);for(;0<s.length&&!(s.length<3);){var n=parseInt(s[0]);if(isNaN(n)||n<=0)break;if(s.length<n+2)break;for(var a=/Lattice\s*=\s*["\{\}]([^"\{\}]+)["\{\}]\s*/gi.exec(s[1]),o=(null!=a&&1<a.length&&(a=new Float32Array(a[1].split(/\s+/)),a=new m.Matrix3(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]),i.modelData=[{cryst:{matrix:a}}]),2),a=i[i.length-1].length,l=a+n,h=a;h<l;h++){var c=s[o++].trim().split(/\s+/),d={},u=(d.serial=h,c[0]);d.atom=d.elem=u[0].toUpperCase()+u.substring(1,2).toLowerCase(),d.x=parseFloat(c[1]),d.y=parseFloat(c[2]),d.z=parseFloat(c[3]),d.hetflag=!0,d.bonds=[],d.bondOrder=[],d.properties={},i[i.length-1][h]=d,7<=c.length&&(d.dx=parseFloat(c[4]),d.dy=parseFloat(c[5]),d.dz=parseFloat(c[6]))}if(!t.multimodel)break;i.push([]),s.splice(0,o)}if(r)for(let e=0;e<i.length;e++)(0,g.assignBonds)(i[e],t);if(t.onemol){var p=i;(i=[]).push(p[0]);for(let r=1;r<p.length;r++){var f=i[0].length;for(let e=0;e<p[r].length;e++){let t=p[r][e];for(let e=0;e<t.bonds.length;e++)t.bonds[e]=t.bonds[e]+f;t.index=i[0].length,t.serial=i[0].length,i[0].push(t)}}}return i}});var m=r("./src/WebGL/index.ts"),g=r("./src/parsers/utils/assignBonds.ts")},"./src/parsers/cifutils/category.ts":(e,t,r)=>{r.r(t),r.d(t,{Category:()=>function(e){const r=Object.create(null),i=Object.create(null);for(const t of e.columns)r[t.name]=t;return{rowCount:e.rowCount,name:e.name.substring(1),fieldNames:e.columns.map(e=>e.name),getField(e){var t=r[e];if(t)return i[e]||(i[e]=(0,s.decode)(t.data),i[e])}}}});var s=r("./src/parsers/cifutils/decoder.ts")},"./src/parsers/cifutils/decoder.ts":(e,t,r)=>{r.r(t),r.d(t,{decode:()=>l});var i=r("./src/parsers/cifutils/encoding.ts");const s=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0];function l(t){let r=t.data;for(let e=t.encoding.length-1;0<=e;e--)r=function(e,t){switch(t.kind){case"ByteArray":switch(t.type){case i.Encoding.IntDataType.Uint8:return e;case i.Encoding.IntDataType.Int8:return function(e){return new Int8Array(e.buffer,e.byteOffset)}(e);case i.Encoding.IntDataType.Int16:return function(e){return n(e,2,Int16Array)}(e);case i.Encoding.IntDataType.Uint16:return function(e){return n(e,2,Uint16Array)}(e);case i.Encoding.IntDataType.Int32:return function(e){return n(e,4,Int32Array)}(e);case i.Encoding.IntDataType.Uint32:return function(e){return n(e,4,Uint32Array)}(e);case i.Encoding.FloatDataType.Float32:return function(e){return n(e,4,Float32Array)}(e);case i.Encoding.FloatDataType.Float64:return function(e){return n(e,8,Float64Array)}(e);default:throw new Error("unreachable")}case"FixedPoint":return function(t,e){const r=t.length,i=a(e.srcType,r),s=1/e.factor;for(let e=0;e<r;e++)i[e]=s*t[e];return i}(e,t);case"IntervalQuantization":return function(t,e){const r=t.length,i=a(e.srcType,r),s=(e.max-e.min)/(e.numSteps-1),n=e.min;for(let e=0;e<r;e++)i[e]=n+s*t[e];return i}(e,t);case"RunLength":return function(r,e){const i=o(e.srcType,e.srcSize);let s=0;for(let e=0,t=r.length;e<t;e+=2){var n=r[e],a=r[e+1];for(let e=0;e<a;++e)i[s++]=n}return i}(e,t);case"Delta":return function(t,e){const r=t.length,i=o(e.srcType,r);if(!r)return t;i[0]=t[0]+(0|e.origin);for(let e=1;e<r;++e)i[e]=t[e]+i[e-1];return i}(e,t);case"IntegerPacking":return function(e,t){return e.length===t.srcSize?e:(t.isUnsigned?function(r,e){const i=1===e.byteCount?255:65535,t=r.length,s=new Int32Array(e.srcSize);let n=0,a=0;for(;n<t;){let e=0,t=r[n];for(;t===i;)e+=t,n++,t=r[n];e+=t,s[a]=e,n++,a++}return s}:function(r,e){const i=1===e.byteCount?127:32767,s=-i-1,t=r.length,n=new Int32Array(e.srcSize);let a=0,o=0;for(;a<t;){let e=0,t=r[a];for(;t===i||t===s;)e+=t,a++,t=r[a];e+=t,n[o]=e,a++,o++}return n})(e,t)}(e,t);case"StringArray":return function(e,t){const r=l({encoding:t.offsetEncoding,data:t.offsets}),i=l({encoding:t.dataEncoding,data:e}),s=t.stringData,n=new Array(r.length);n[0]="";for(let e=1,t=r.length;e<t;e++)n[e]=s.substring(r[e-1],r[e]);let a=0;const o=new Array(i.length);for(let e=0,t=i.length;e<t;e++)o[a++]=n[i[e]+1];return o}(e,t)}}(r,t.encoding[e]);return r}function o(e,t){switch(e){case i.Encoding.IntDataType.Int8:return new Int8Array(t);case i.Encoding.IntDataType.Int16:return new Int16Array(t);case i.Encoding.IntDataType.Int32:return new Int32Array(t);case i.Encoding.IntDataType.Uint8:return new Uint8Array(t);case i.Encoding.IntDataType.Uint16:return new Uint16Array(t);case i.Encoding.IntDataType.Uint32:return new Uint32Array(t);default:return new Int32Array(t)}}function a(e,t){return e!==i.Encoding.FloatDataType.Float32?(i.Encoding.FloatDataType.Float64,new Float64Array(t)):new Float32Array(t)}function n(e,t,r){return 0==e.byteOffset&&e.byteLength==e.buffer.byteLength||(e=new Uint8Array(e)),s?new r(e.buffer):new r(function(r,i){var e=new ArrayBuffer(r.length);const s=new Uint8Array(e);for(let t=0,e=r.length;t<e;t+=i)for(let e=0;e<i;e++)s[t+i-e-1]=r[t+e];return e}(e,t))}},"./src/parsers/cifutils/encoding.ts":(e,t,r)=>{r.r(t),r.d(t,{Encoding:()=>s,VERSION:()=>i});const i="0.3.0";var s,n;n=s=s||{},(r=n.IntDataType||(n.IntDataType={}))[r.Int8=1]="Int8",r[r.Int16=2]="Int16",r[r.Int32=3]="Int32",r[r.Uint8=4]="Uint8",r[r.Uint16=5]="Uint16",r[r.Uint32=6]="Uint32",(r=n.FloatDataType||(n.FloatDataType={}))[r.Float32=32]="Float32",r[r.Float64=33]="Float64",n.getDataType=function(e){let t;return t=e instanceof Int8Array?n.IntDataType.Int8:e instanceof Int16Array?n.IntDataType.Int16:e instanceof Int32Array?n.IntDataType.Int32:e instanceof Uint8Array?n.IntDataType.Uint8:e instanceof Uint16Array?n.IntDataType.Uint16:e instanceof Uint32Array?n.IntDataType.Uint32:e instanceof Float32Array?n.FloatDataType.Float32:e instanceof Float64Array?n.FloatDataType.Float64:n.IntDataType.Int32},n.isSignedIntegerDataType=function(r){if(r instanceof Int8Array||r instanceof Int16Array||r instanceof Int32Array)return!0;for(let e=0,t=r.length;e<t;e++)if(e<0)return!1;return!0}},"./src/parsers/index.ts":(e,t,r)=>{r.r(t),r.d(t,{Parsers:()=>v,bondLength:()=>g.bondLength,setBondLength:()=>g.setBondLength});var t=r("./src/parsers/VASP.ts"),i=r("./src/parsers/CUBE.ts"),s=r("./src/parsers/XYZ.ts"),n=r("./src/parsers/SDF.ts"),a=r("./src/parsers/CDJSON.ts"),o=r("./src/parsers/CIF.ts"),l=r("./src/parsers/MOL2.ts"),h=r("./src/parsers/PDB.ts"),c=r("./src/parsers/PQR.ts"),d=r("./src/parsers/MMTF.ts"),u=r("./src/parsers/PRMTOP.ts"),p=r("./src/parsers/GRO.ts"),f=r("./src/parsers/LAMMPSTRJ.ts"),m=r("./src/parsers/BCIF.ts"),g=r("./src/parsers/utils/bondLength.ts");const v={vasp:t.VASP,VASP:t.VASP,cube:i.CUBE,CUBE:i.CUBE,xyz:s.XYZ,XYZ:s.XYZ,sdf:n.SDF,SDF:n.SDF,json:a.CDJSON,cdjson:a.CDJSON,CDJSON:a.CDJSON,mcif:o.CIF,cif:o.CIF,CIF:o.CIF,mol2:l.MOL2,MOL2:l.MOL2,pdb:h.PDB,PDB:h.PDB,pdbqt:h.PDB,PDBQT:h.PDB,pqr:c.PQR,PQR:c.PQR,mmtf:d.MMTFparser,MMTF:d.MMTFparser,prmtop:u.PRMTOP,PRMTOP:u.PRMTOP,gro:p.GRO,GRO:p.GRO,lammpstrj:f.LAMMPSTRJ,LAMMPSTRJ:f.LAMMPSTRJ,bcif:m.BCIF,BCIF:m.BCIF}},"./src/parsers/utils/anumToSymbol.ts":(e,t,r)=>{r.r(t),r.d(t,{anumToSymbol:()=>i});const i={1:"H",2:"He",3:"Li",4:"Be",5:"B",6:"C",7:"N",8:"O",9:"F",10:"Ne",11:"Na",12:"Mg",13:"Al",14:"Si",15:"P",16:"S",17:"Cl",18:"Ar",19:"K",20:"Ca",21:"Sc",22:"Ti",23:"V",24:"Cr",25:"Mn",26:"Fe",27:"Co",28:"Ni",29:"Cu",30:"Zn",31:"Ga",32:"Ge",33:"As",34:"Se",35:"Br",36:"Kr",37:"Rb",38:"Sr",39:"Y",40:"Zr",41:"Nb",42:"Mo",43:"Tc",44:"Ru",45:"Rh",46:"Pd",47:"Ag",48:"Cd",49:"In",50:"Sn",51:"Sb",52:"Te",53:"I",54:"Xe",55:"Cs",56:"Ba",71:"Lu",72:"Hf",73:"Ta",74:"W",75:"Re",76:"Os",77:"Ir",78:"Pt",79:"Au",80:"Hg",81:"Tl",82:"Pb",83:"Bi",84:"Po",85:"At",86:"Rn",87:"Fr",88:"Ra",104:"Rf",105:"Db",106:"Sg",107:"Bh",108:"Hs",109:"Mt",110:"Ds",111:"Rg",112:"Cn",113:"Nh",114:"Fl",115:"Mc",116:"Lv",117:"Ts",118:"Og",57:"La",58:"Ce",59:"Pr",60:"Nd",61:"Pm",62:"Sm",63:"Eu",64:"Gd",65:"Tb",66:"Dy",67:"Ho",68:"Er",69:"Tm",70:"Yb",89:"Ac",90:"Th",91:"Pa",92:"U",93:"Np",94:"Pu",95:"Am",96:"Cm",97:"Bk",98:"Cf",99:"Es",100:"Fm",101:"Md",102:"No"}},"./src/parsers/utils/areConnected.ts":(e,t,r)=>{r.r(t),r.d(t,{areConnected:()=>function(e,t,r){if(r&&r.unboundCations&&(o.has(e.elem)||o.has(t.elem)))return!1;var r=(0,a.bondLength)(e.elem)+(0,a.bondLength)(t.elem),i=(r=(r+=.25)*r,e.x-t.x);if((i*=i)>r)return!1;var s=e.y-t.y;if((s*=s)>r)return!1;var n=e.z-t.z;if((n*=n)>r)return!1;i=i+s+n;return!(isNaN(i)||i<.5||r<i||e.altLoc!==t.altLoc&&""!==e.altLoc.trim()&&""!==t.altLoc.trim())}});var a=r("./src/parsers/utils/bondLength.ts");const o=new Set(["Na","K","Ca","Mg","Mn","Sr"])},"./src/parsers/utils/assignBackboneHBonds.ts":(e,t,r)=>{r.r(t),r.d(t,{assignBackboneHBonds:()=>function(r,e){const i=e||3.2,s=i*i,n=[];for(let e=0,t=r.length;e<t;e++){r[e].index=e;const h=r[e];h.hetflag||"N"!==h.atom&&"O"!==h.atom||(n.push(h),h.hbondOther=null,h.hbondDistanceSq=Number.POSITIVE_INFINITY)}n.sort(function(e,t){return e.z-t.z});for(let t=0,r=n.length;t<r;t++){const c=n[t];for(let e=t+1;e<r;e++){const d=n[e];var a,o,l=d.z-c.z;if(i<l)break;d.atom!=c.atom&&(a=Math.abs(d.y-c.y),i<a||(o=Math.abs(d.x-c.x),i<o||(o=o*o+a*a+l*l,s<o||d.chain==c.chain&&Math.abs(d.resi-c.resi)<4||(o<c.hbondDistanceSq&&(c.hbondOther=d,c.hbondDistanceSq=o),o<d.hbondDistanceSq&&(d.hbondOther=c,d.hbondDistanceSq=o)))))}}}})},"./src/parsers/utils/assignBonds.ts":(e,t,r)=>{r.r(t),r.d(t,{assignBonds:()=>function(r,o){for(let e=0,t=r.length;e<t;e++)r[e].index||(r[e].index=e);const t={x:{y:{z:[]}}};for(let e=0;e<r.length;e++){var i=r[e],s=Math.floor(i.x/_),n=Math.floor(i.y/_),a=Math.floor(i.z/_);t[s]||(t[s]={}),t[s][n]||(t[s][n]={}),t[s][n][a]||(t[s][n][a]=[]),t[s][n][a].push(i)}for(var e in t){var l,h=parseInt(e);for(l in t[h]){var c,d=parseInt(l);for(c in t[h][d]){var u=parseInt(c),p=t[h][d][u];for(let t=0;t<p.length;t++){const m=p[t];for(let e=t+1;e<p.length;e++){const g=p[e];(0,v.areConnected)(m,g,o)&&-1==m.bonds.indexOf(g.index)&&(m.bonds.push(g.index),m.bondOrder.push(1),g.bonds.push(m.index),g.bondOrder.push(1))}}for(let e=0;e<b.length;e++){var f=b[e];t[h+f.x]&&t[h+f.x][d+f.y]&&t[h+f.x][d+f.y][u+f.z]&&(f=t[h+f.x][d+f.y][u+f.z],function(t,r){for(let e=0;e<t.length;e++){const n=t[e];for(let e=0;e<r.length;e++){const a=r[e];var i,s;(0,v.areConnected)(n,a,o)&&(i=n.bonds.indexOf(a.index),s=a.bonds.indexOf(n.index),-1===i&&-1===s?(n.bonds.push(a.index),n.bondOrder.push(1),a.bonds.push(n.index),a.bondOrder.push(1)):-1===i?(n.bonds.push(a.index),n.bondOrder.push(a.bondOrder[s])):-1===s&&(a.bonds.push(n.index),a.bondOrder.push(n.bondOrder[i])))}}}(p,f))}}}}}});var v=r("./src/parsers/utils/areConnected.ts");const b=[{x:0,y:0,z:1},{x:0,y:1,z:-1},{x:0,y:1,z:0},{x:0,y:1,z:1},{x:1,y:-1,z:-1},{x:1,y:-1,z:0},{x:1,y:-1,z:1},{x:1,y:0,z:-1},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:1,z:-1},{x:1,y:1,z:0},{x:1,y:1,z:1}],_=4.95},"./src/parsers/utils/assignPDBBonds.ts":(e,t,r)=>{r.r(t),r.d(t,{assignPDBBonds:()=>function(r,i){const s=[],n=[];for(let e=0,t=r.length;e<t;e++){const h=r[e];h.index=e,(h.hetflag||!f.standardResidues.has(h.resn)?n:s).push(h)}(0,p.assignBonds)(n,i),s.sort(function(e,t){return e.chain!==t.chain?e.chain<t.chain?-1:1:e.resi-t.resi});let a=-1,o=-1,l;for(let t=0,e=s.length;t<e;t++){const c=s[t];c.resi!==a&&(a=c.resi,l||o++,l=!1),c.reschain=o;for(let e=t+1;e<s.length;e++){const d=s[e];if(d.chain!==c.chain||1<d.resi-c.resi)break;(0,u.areConnected)(c,d,i)&&(-1===c.bonds.indexOf(d.index)&&(c.bonds.push(d.index),c.bondOrder.push(1),d.bonds.push(c.index),d.bondOrder.push(1)),c.resi!==d.resi&&(l=!0))}}}});var u=r("./src/parsers/utils/areConnected.ts"),p=r("./src/parsers/utils/assignBonds.ts"),f=r("./src/parsers/utils/standardResidues.ts")},"./src/parsers/utils/atomNameToElem.ts":(e,t,r)=>{r.r(t),r.d(t,{atomNameToElem:()=>function(e,t){let r=e.replace(/ /g,"");0<r.length&&"H"===r[0]&&"Hg"!==r&&"He"!==r&&"Hf"!==r&&"Hs"!==r&&"Ho"!==r&&(r="H");1<r.length&&(r=r[0].toUpperCase()+r.substring(1).toLowerCase(),void 0===i.bondTable[r]?r=r[0]:!t||"Ca"!==r&&"Cd"!==r||(r="C"));return r}});var i=r("./src/parsers/utils/bondLength.ts")},"./src/parsers/utils/bondLength.ts":(e,t,r)=>{r.r(t),r.d(t,{bondLength:()=>function(e){return i[e]||1.6},bondTable:()=>i,setBondLength:()=>function(e,t){t<0&&(t=0);i[e]=t}});let i={H:.37,He:.32,Li:1.34,Be:.9,B:.82,C:.77,N:.75,O:.73,F:.71,Ne:.69,Na:1.54,Mg:1.3,Al:1.18,Si:1.11,P:1.06,S:1.02,Cl:.99,Ar:.97,K:1.96,Ca:1.74,Sc:1.44,Ti:1.56,V:1.25,Mn:1.39,Fe:1.25,Co:1.26,Ni:1.21,Cu:1.38,Zn:1.31,Ga:1.26,Ge:1.22,Se:1.16,Br:1.14,Kr:1.1,Rb:2.11,Sr:1.92,Y:1.62,Zr:1.48,Nb:1.37,Mo:1.45,Tc:1.56,Ru:1.26,Rh:1.35,Pd:1.31,Ag:1.53,Cd:1.48,In:1.44,Sn:1.41,Sb:1.38,Te:1.35,I:1.33,Xe:1.3,Cs:2.25,Ba:1.98,Lu:1.6,Hf:1.5,Ta:1.38,W:1.46,Re:1.59,Os:1.44,Ir:1.37,Pt:1.28,Au:1.44,Hg:1.49,Tl:1.48,Pb:1.47,Bi:1.46,Rn:1.45}},"./src/parsers/utils/computeSecondaryStructure.ts":(e,t,r)=>{r.r(t),r.d(t,{computeSecondaryStructure:()=>function(r,e){(0,v.assignBackboneHBonds)(r,e);const i={};let t,s,n,a,o,l;for(t=0,s=r.length;t<s;t++){var h;o=r[t],void 0===i[o.chain]&&(i[o.chain]=[]),isFinite(o.hbondDistanceSq)&&(h=o.hbondOther,void 0===i[h.chain]&&(i[h.chain]=[]),4===Math.abs(h.resi-o.resi)&&(i[o.chain][o.resi]="h"))}for(n in i)for(a=1;a<i[n].length-1;a++){var c=i[n][a-1],d=i[n][a+1];l=i[n][a],"h"==c&&c==d&&l!=c&&(i[n][a]=c)}for(t=0,s=r.length;t<s;t++)o=r[t],isFinite(o.hbondDistanceSq)&&"h"!=i[o.chain][o.resi]&&"h"!==o.ss&&(i[o.chain][o.resi]="maybesheet");for(let e=0,t=r.length;e<t;e++){var u,p;o=r[e],isFinite(o.hbondDistanceSq)&&"maybesheet"==i[o.chain][o.resi]&&(u=o.hbondOther,"maybesheet"!=(p=i[u.chain][u.resi])&&"s"!=p||(i[o.chain][o.resi]="s",i[u.chain][u.resi]="s"))}for(var f in i){for(let e=1;e<i[f].length-1;e++){var m=i[f][e-1],g=i[f][e+1];l=i[f][e],"s"==m&&m==g&&l!=m&&(i[f][e]=m)}for(let e=0;e<i[f].length;e++){const l=i[f][e];"h"!=l&&"s"!=l||i[f][e-1]!=l&&i[f][e+1]!=l&&delete i[f][e]}}for(t=0,s=r.length;t<s;t++)o=r[t],l=i[o.chain][o.resi],delete o.hbondOther,delete o.hbondDistanceSq,void 0!==l&&"maybesheet"!==l&&(o.ss=l,i[o.chain][o.resi-1]!=l&&(o.ssbegin=!0),i[o.chain][o.resi+1]!=l&&(o.ssend=!0))}});var v=r("./src/parsers/utils/assignBackboneHBonds.ts")},"./src/parsers/utils/getSinglePDB.ts":(e,t,r)=>{r.r(t),r.d(t,{getSinglePDB:()=>function(n,e,a){const u=[],t=void 0===e.assignBonds||e.assignBonds,p=!e.keepH,r=!!e.noSecondaryStructure,i=!e.noComputeSecondaryStructure,o=!e.doAssembly,f=e.altLoc||"A",l={symmetries:[],cryst:void 0};let m,h=[];const g=[];let v;const c={};for(let s=0;s<n.length;s++){const T=(v=n[s].replace(/^\s*/,"")).substring(0,6);let t,r,i;if(0===T.indexOf("END")){if(h=n.slice(s+1),"END"===T)for(const E in a)a.hasOwnProperty(E)&&delete a[E];break}if("ATOM  "===T||"HETATM"===T){let e,t,r,i,s,n,a,o,l,h,c,d;" "!==(c=v.substring(16,17))&&c!==f&&"*"!==f||(h=parseInt(v.substring(6,11)),m=v.substring(12,16).replace(/ /g,""),e=v.substring(17,20).replace(/ /g,""),t=v.substring(21,22),r=parseInt(v.substring(22,26)),i=v.substring(26,27),s=parseFloat(v.substring(30,38)),n=parseFloat(v.substring(38,46)),a=parseFloat(v.substring(46,54)),d=parseFloat(v.substring(60,68)),"H"===(l=""===(l=v.substring(76,78).replace(/ /g,""))||void 0===O.bondTable[l]?(0,I.atomNameToElem)(v.substring(12,14),"A"==v[0]):l[0].toUpperCase()+l.substring(1).toLowerCase())&&p||(o="H"==T[0],g[h]=u.length,u.push({resn:e,x:s,y:n,z:a,elem:l,hetflag:o,altLoc:c,chain:t,resi:r,icode:i,rescode:r+(" "!==i?"^"+i:""),serial:h,atom:m,bonds:[],ss:"c",bondOrder:[],properties:{},b:d,pdbline:v})))}else if("SHEET "===T){t=v.substring(21,22),r=parseInt(v.substring(22,26)),i=parseInt(v.substring(33,37)),t in a||(a[t]={}),a[t][r]="s1";for(let e=r+1;e<i;e++)a[t][e]="s";a[t][i]="s2"}else if("CONECT"===T){var d=parseInt(v.substring(6,11)),b=g[d];const F=u[b];var _=[11,16,21,26];for(let e=0;e<4;e++){var y,x=parseInt(v.substring(_[e],_[e]+5)),w=g[x],A=b+":"+w,x=u[w];if(void 0!==F&&void 0!==x)if(c[A]){c[A]+=1;for(let e=0;e<F.bonds.length;e++)F.bonds[e]==w&&(y=c[A],F.bondOrder[e]=4<=y?1:y)}else c[A]=1,0!=F.bonds.length&&F.bonds[F.bonds.length-1]===w||(F.bonds.push(w),F.bondOrder.push(1))}}else if("HELIX "===T){t=v.substring(19,20),r=parseInt(v.substring(21,25)),i=parseInt(v.substring(33,37)),t in a||(a[t]={}),a[t][r]="h1";for(let e=r+1;e<i;e++)a[t][e]="h";a[t][i]="h2"}else if(o||"REMARK"!==T||"BIOMT"!==v.substring(13,18)){if("CRYST1"===T){var S;d=parseFloat(v.substring(7,15)),M=parseFloat(v.substring(16,24)),z=parseFloat(v.substring(25,33)),C=parseFloat(v.substring(34,40)),L=parseFloat(v.substring(41,47)),S=parseFloat(v.substring(48,54)),l.cryst={a:d,b:M,c:z,alpha:C,beta:L,gamma:S}}else if("ANISOU"===T){var C,L,M=parseInt(v.substring(6,11)),z=g[M];const D=u[z];D&&(C=v.substring(30).trim().split(/\s+/),L={u11:parseInt(C[0]),u22:parseInt(C[1]),u33:parseInt(C[2]),u12:parseInt(C[3]),u13:parseInt(C[4]),u23:parseInt(C[5])},D.uMat=L)}}else{let e,t=new k.Matrix4;for(e=1;e<=3;e++)if(v=n[s].replace(/^\s*/,""),parseInt(v.substring(18,19))==e)t.elements[e-1]=parseFloat(v.substring(23,33)),t.elements[e-1+4]=parseFloat(v.substring(33,43)),t.elements[e-1+8]=parseFloat(v.substring(43,53)),t.elements[e-1+12]=parseFloat(v.substring(53)),s++;else for(;"BIOMT"===v.substring(13,18);)s++,v=n[s].replace(/^\s*/,"");t.elements[3]=0,t.elements[7]=0,t.elements[11]=0,t.elements[15]=1,l.symmetries.push(t),s--}}(0,U.validateBonds)(u,g),t&&(0,B.assignPDBBonds)(u,e);o||(0,P.processSymmetries)(l.symmetries,u,e,l.cryst);i&&!r&&(0,R.computeSecondaryStructure)(u,e.hbondCutoff);if(!(0,G.isEmpty)(a))for(let e=0;e<u.length;e++){const m=u[e];var s;void 0!==m&&m.chain in a&&m.resi in a[m.chain]&&(s=a[m.chain][m.resi],m.ss=s[0],1<s.length&&("1"==s[1]?m.ssbegin=!0:"2"==s[1]&&(m.ssend=!0)))}return[u,l,h]}});var k=r("./src/WebGL/index.ts"),I=r("./src/parsers/utils/atomNameToElem.ts"),O=r("./src/parsers/utils/bondLength.ts"),R=r("./src/parsers/utils/computeSecondaryStructure.ts"),G=r("./src/parsers/utils/isEmpty.ts"),P=r("./src/parsers/utils/processSymmetries.ts"),B=r("./src/parsers/utils/assignPDBBonds.ts"),U=r("./src/parsers/utils/validateBonds.ts")},"./src/parsers/utils/isEmpty.ts":(e,t,r)=>{r.r(t),r.d(t,{isEmpty:()=>function(e){for(const t in e)return!1;return!0}})},"./src/parsers/utils/processSymmetries.ts":(e,t,r)=>{r.r(t),r.d(t,{processSymmetries:()=>function(i,s,n,a){var e=!n.duplicateAssemblyAtoms,o=s.length;let l=o,h=-1,c=null,d=null;(n.normalizeAssembly||n.wrapAtoms)&&a&&(c=(0,w.conversionMatrix3)(a.a,a.b,a.c,a.alpha,a.beta,a.gamma),(d=new w.Matrix3).getInverse3(c));function u(e){const t=[(e=e.clone().applyMatrix3(d)).x,e.y,e.z],r=[0,0,0];for(let e=0;e<3;e++){for(;t[e]<-.001;)t[e]+=1,r[e]+=1;for(;1.001<t[e];)--t[e],--r[e]}const i=new w.Vector3(r[0],r[1],r[2]);return i.applyMatrix3(c),i}if(n.normalizeAssembly&&a)for(let t=0;t<i.length;t++){const g=new w.Vector3(0,0,0);for(let e=0;e<o;e++){const b=new w.Vector3(s[e].x,s[e].y,s[e].z);b.applyMatrix4(i[t]),g.add(b)}g.divideScalar(o);const v=u(g);i[t].isNearlyIdentity()&&.001<v.lengthSq()&&(h=t),i[t].translate(v)}if(e){if(1<i.length)for(let t=0;t<s.length;t++){var r,p=[];for(let e=0;e<i.length;e++)i[e].isNearlyIdentity()||((r=new w.Vector3).set(s[t].x,s[t].y,s[t].z),r.applyMatrix4(i[e]),p.push(r));s[t].symmetries=p}}else{for(let e=0;e<o;e++)s[e].sym=-1;for(let r=0;r<i.length;r++)if(i[r].isNearlyIdentity()||h==r)for(let e=0;e<o;e++)s[e].sym=r;else{let e=new w.Vector3;for(let t=0;t<o;t++){const _=[];for(let e=0;e<s[t].bonds.length;e++)_.push(s[t].bonds[e]+l);var f;e.set(s[t].x,s[t].y,s[t].z),e.applyMatrix4(i[r]),n.wrapAtoms&&a&&(f=u(e),e.add(f));const y={};for(const x in s[t])y[x]=s[t][x];y.x=e.x,y.y=e.y,y.z=e.z,y.bonds=_,y.sym=r,y.index=s.length,s.push(y)}l=s.length}if(n.wrapAtoms&&a){let t=new w.Vector3;for(let e=0;e<o;e++){t.set(s[e].x,s[e].y,s[e].z);var m=u(t);t.add(m),s[e].x=t.x,s[e].y=t.y,s[e].z=t.z}}if(0<=h){const t=new w.Vector3;for(let e=0;e<o;e++)t.set(s[e].x,s[e].y,s[e].z),t.applyMatrix4(i[h]),s[e].x=t.x,s[e].y=t.y,s[e].z=t.z}i.length=0}}});var w=r("./src/WebGL/index.ts")},"./src/parsers/utils/standardResidues.ts":(e,t,r)=>{r.r(t),r.d(t,{standardResidues:()=>i});const i=new Set(["ABU","ACD","ALA","ALB","ALI","ARG","AR0","ASN","ASP","ASX","BAS","CYS","CYH","CYX","CSS","CSH","GLN","GLU","GLX","GLY","HIS","HIE","HID","HIP","HYP","ILE","ILU","LEU","LYS","MET","PCA","PGA","PHE","PR0","PRO","PRZ","SER","THR","TRP","TYR","VAL","A","1MA","C","5MC","OMC","G","1MG","2MG","M2G","7MG","OMG","YG","I","T","U","+U","H2U","5MU","PSU","ACE","F0R","H2O","HOH","WAT"])},"./src/parsers/utils/validateBonds.ts":(e,t,r)=>{r.r(t),r.d(t,{validateBonds:()=>function(r,i){for(let e=0,t=r.length;e<t;e++){var s=r[e];for(let e=0;e<s.bonds.length;e++){var n=s.bonds[e];const a=r[n];n=i[s.serial];a&&n&&a.bonds.indexOf(n)<0&&(a.bonds.push(n),a.bondOrder.push(s.bondOrder[e]))}}}})},"./src/partialCharges.ts":(e,t,r)=>{r.r(t),r.d(t,{applyPartialCharges:()=>function(e,t){t&&void 0!==e.partialCharge||e.resn&&e.atom&&(t=e.resn+":"+e.atom,e.properties.partialCharge=i[t])},partialCharges:()=>i});const i={"ALA:N":-.15,"ALA:CA":.1,"ALA:CB":0,"ALA:C":.6,"ALA:O":-.55,"ARG:N":-.15,"ARG:CA":.1,"ARG:CB":0,"ARG:CG":0,"ARG:CD":.1,"ARG:NE":-.1,"ARG:CZ":.5,"ARG:NH1":.25,"ARG:NH2":.25,"ARG:C":.6,"ARG:O":-.55,"ASN:N":-.15,"ASN:CA":.1,"ASN:CB":0,"ASN:CG":.55,"ASN:OD1":-.55,"ASN:ND2":0,"ASN:C":.6,"ASN:O":-.55,"ASP:N":-.15,"ASP:CA":.1,"ASP:CB":0,"ASP:CG":.14,"ASP:OD1":-.57,"ASP:OD2":-.57,"ASP:C":.6,"ASP:O":-.55,"CYS:N":-.15,"CYS:CA":.1,"CYS:CB":.19,"CYS:SG":-.19,"CYS:C":.6,"CYS:O":-.55,"GLN:N":-.15,"GLN:CA":.1,"GLN:CB":0,"GLN:CG":0,"GLN:CD":.55,"GLN:OE1":-.55,"GLN:NE2":0,"GLN:C":.6,"GLN:O":-.55,"GLU:N":-.15,"GLU:CA":.1,"GLU:CB":0,"GLU:CG":0,"GLU:CD":.14,"GLU:OE1":-.57,"GLU:OE2":-.57,"GLU:C":.6,"GLU:O":-.55,"GLY:N":-.15,"GLY:CA":.1,"GLY:C":.6,"GLY:O":-.55,"HIS:N":-.15,"HIS:CA":.1,"HIS:CB":0,"HIS:CG":.1,"HIS:ND1":-.1,"HIS:CD2":.1,"HIS:NE2":-.4,"HIS:CE1":.3,"HIS:C":.6,"HIS:O":-.55,"ILE:N":-.15,"ILE:CA":.1,"ILE:CB":0,"ILE:CG2":0,"ILE:CG1":0,"ILE:CD":0,"ILE:C":.6,"ILE:O":-.55,"LEU:N":-.15,"LEU:CA":.1,"LEU:CB":0,"LEU:CG":0,"LEU:CD1":0,"LEU:CD2":0,"LEU:C":.6,"LEU:O":-.55,"LYS:N":-.15,"LYS:CA":.1,"LYS:CB":0,"LYS:CG":0,"LYS:CD":0,"LYS:CE":.25,"LYS:NZ":.75,"LYS:C":.6,"LYS:O":-.55,"MET:N":-.15,"MET:CA":.1,"MET:CB":0,"MET:CG":.06,"MET:SD":-.12,"MET:CE":.06,"MET:C":.6,"MET:O":-.55,"PHE:N":-.15,"PHE:CA":.1,"PHE:CB":0,"PHE:CG":0,"PHE:CD1":0,"PHE:CD2":0,"PHE:CE1":0,"PHE:CE2":0,"PHE:CZ":0,"PHE:C":.6,"PHE:O":-.55,"PRO:N":-.25,"PRO:CD":.1,"PRO:CA":.1,"PRO:CB":0,"PRO:CG":0,"PRO:C":.6,"PRO:O":-.55,"SER:N":-.15,"SER:CA":.1,"SER:CB":.25,"SER:OG":-.25,"SER:C":.6,"SER:O":-.55,"THR:N":-.15,"THR:CA":.1,"THR:CB":.25,"THR:OG1":-.25,"THR:CG2":0,"THR:C":.6,"THR:O":-.55,"TRP:N":-.15,"TRP:CA":.1,"TRP:CB":0,"TRP:CG":-.03,"TRP:CD2":.1,"TRP:CE2":-.04,"TRP:CE3":-.03,"TRP:CD1":.06,"TRP:NE1":-.06,"TRP:CZ2":0,"TRP:CZ3":0,"TRP:CH2":0,"TRP:C":.6,"TRP:O":-.55,"TYR:N":-.15,"TYR:CA":.1,"TYR:CB":0,"TYR:CG":0,"TYR:CD1":0,"TYR:CE1":0,"TYR:CD2":0,"TYR:CE2":0,"TYR:CZ":.25,"TYR:OH":-.25,"TYR:C":.6,"TYR:O":-.55,"VAL:N":-.15,"VAL:CA":.1,"VAL:CB":0,"VAL:CG1":0,"VAL:CG2":0,"VAL:C":.6,"VAL:O":-.55}},"./src/specs.ts":(e,t,r)=>{r.r(t)},"./src/utilities.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PausableTimer:()=>PausableTimer,adjustVolumeStyle:()=>adjustVolumeStyle,base64ToArray:()=>base64ToArray,deepCopy:()=>deepCopy,download:()=>download,extend:()=>extend,get:()=>get,getAtomProperty:()=>getAtomProperty,getColorFromStyle:()=>getColorFromStyle,getElement:()=>getElement,getExtent:()=>getExtent,getPropertyRange:()=>getPropertyRange,getbin:()=>getbin,inflateString:()=>inflateString,isEmptyObject:()=>isEmptyObject,isNumeric:()=>isNumeric,makeFunction:()=>makeFunction,mergeGeos:()=>mergeGeos,specStringToObject:()=>specStringToObject});var _Gradient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/Gradient.ts"),_VolumeData__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/VolumeData.ts"),_colors__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/colors.ts"),pako__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/pako/dist/pako.esm.mjs");function extend(e,t){for(var r in t)t.hasOwnProperty(r)&&void 0!==t[r]&&(e[r]=t[r]);return e}function deepCopy(e){let t,r,i;if(null==e)return{};if("object"!=typeof e||null===e)return e;for(i in t=Array.isArray(e)?[]:{},e)r=e[i],t[i]=deepCopy(r);return t}function isNumeric(e){var t=typeof e;return("number"==t||"string"==t)&&!isNaN(e-parseFloat(e))}function isEmptyObject(e){return 0===Object.keys(e).length}function makeFunction(callback){return callback&&"string"==typeof callback&&(callback=eval("("+callback+")")),callback&&"function"!=typeof callback?(console.warn("Invalid callback provided."),()=>{}):callback}function adjustVolumeStyle(e){e&&(!e.volformat||e.voldata instanceof _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData||(e.voldata=new _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData(e.voldata,e.volformat)),e.volscheme&&(e.volscheme=_Gradient__WEBPACK_IMPORTED_MODULE_0__.Gradient.getGradient(e.volscheme)))}function getExtent(e,t){var r,i,s,n,a,o,l,h=!t,c=r=i=9999,d=s=n=-9999,u=a=o=l=0;if(0===e.length)return[[0,0,0],[0,0,0],[0,0,0]];for(var p=0;p<e.length;p++){var f=e[p];if(void 0!==f&&isFinite(f.x)&&isFinite(f.y)&&isFinite(f.z)&&(l++,u+=f.x,a+=f.y,o+=f.z,c=c<f.x?c:f.x,r=r<f.y?r:f.y,i=i<f.z?i:f.z,d=d>f.x?d:f.x,s=s>f.y?s:f.y,n=n>f.z?n:f.z,f.symmetries&&h))for(var m=0;m<f.symmetries.length;m++)l++,u+=f.symmetries[m].x,a+=f.symmetries[m].y,o+=f.symmetries[m].z,c=c<f.symmetries[m].x?c:f.symmetries[m].x,r=r<f.symmetries[m].y?r:f.symmetries[m].y,i=i<f.symmetries[m].z?i:f.symmetries[m].z,d=d>f.symmetries[m].x?d:f.symmetries[m].x,s=s>f.symmetries[m].y?s:f.symmetries[m].y,n=n>f.symmetries[m].z?n:f.symmetries[m].z}return[[c,r,i],[d,s,n],[u/l,a/l,o/l]]}function getPropertyRange(e,t){for(var r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,s=0,n=e.length;s<n;s++){var a=getAtomProperty(e[s],t);null!=a&&(a<r&&(r=a),i<a&&(i=a))}return isFinite(r)||isFinite(i)?isFinite(r)?isFinite(i)||(i=r):r=i:r=i=0,[r,i]}class PausableTimer{constructor(e,t,r){this.total_time_run=0,this.fn=e,this.arg=r,this.countdown=t,this.start_time=(new Date).getTime(),this.ident=setTimeout(e,t,r)}cancel(){clearTimeout(this.ident)}pause(){clearTimeout(this.ident),this.total_time_run=(new Date).getTime()-this.start_time}resume(){this.ident=setTimeout(this.fn,Math.max(0,this.countdown-this.total_time_run),this.arg)}}function base64ToArray(e){for(var t=window.atob(e),r=t.length,i=new Uint8Array(r),s=0;s<r;s++)i[s]=t.charCodeAt(s);return i}function getAtomProperty(e,t){var r=null;return e.properties&&void 0!==e.properties[t]?r=e.properties[t]:void 0!==e[t]&&(r=e[t]),r}function mergeGeos(e,t){t=t.geometry;void 0!==t&&e.geometryGroups.push(t.geometryGroups[0])}function specStringToObject(e){if("object"==typeof e)return e;if(void 0===e||null==e)return e;try{return JSON.parse(e)}catch(e){}function t(e){return isNumeric(e)?(Math.floor(parseFloat(e))==parseInt(e)||0<=e.indexOf(".")?parseFloat:parseInt)(e):"true"===e||"false"!==e&&e}var r={};if("all"===(e=e.replace(/%7E/g,"~")))return r;for(var i=e.split(";"),s=0;s<i.length;s++){var n=i[s].split(":"),a=n[0],o={},n=n[1];if(n)if(-1!==(n=n.replace(/~/g,"=")).indexOf("="))for(var l=n.split(","),h=0;h<l.length;h++){var c=l[h].split("=",2);o[c[0]]=t(c[1])}else o=-1!==n.indexOf(",")?n.split(","):t(n);r[a]=o}return r}function checkStatus(e){if(e.ok)return e;throw new Error(`HTTP ${e.status} - `+e.statusText)}function get(e,t){e=fetch(e).then(checkStatus).then(e=>e.text());return t?e.then(t):e}function getbin(e,t,r,i){r="POST"==r?fetch(e,{method:"POST",body:i}).then(e=>checkStatus(e)).then(e=>e.arrayBuffer()):fetch(e).then(e=>checkStatus(e)).then(e=>e.arrayBuffer());return t?r.then(t):r}function download(e,r,i,t){var s="",n="",a="",o=null,l=r.addModel();if("mmtf:"==(e=e.indexOf(":")<0?4==e.length?"pdb:"+e:isNaN(e)?"url:"+e:"cid:"+e:e).substring(0,5)&&(console.warn("WARNING: MMTF now deprecated.  Reverting to bcif."),e="bcif:"+e.slice(5)),"bcif:"===e.substring(0,5))e=e.substring(5).toUpperCase(),a="https://models.rcsb.org/"+e+".bcif.gz",i&&void 0===i.noComputeSecondaryStructure&&(i.noComputeSecondaryStructure=!0),o=new Promise(function(t){getbin(a).then(function(e){l.addMolData(e,"bcif.gz",i),r.zoomTo(),r.render(),t(l)},function(){console.error("fetch of "+a+" failed.")})});else{if("pdb:"===e.substring(0,4)){if(s="bcif",i&&i.format&&(s=i.format),i&&void 0===i.noComputeSecondaryStructure&&(i.noComputeSecondaryStructure=!0),!(e=e.substring(4).toUpperCase()).match(/^[1-9][A-Za-z0-9]{3}$/))return void alert("Wrong PDB ID");a="bcif"==s?"https://models.rcsb.org/"+e.toUpperCase()+".bcif.gz":(n=i&&i.pdbUri?i.pdbUri:"https://files.rcsb.org/view/")+e+"."+s}else if("cid:"==e.substring(0,4)){if(s="sdf",!(e=e.substring(4)).match(/^[0-9]+$/))return void alert("Wrong Compound ID");a="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e+"/SDF?record_type=3d"}else"url:"==e.substring(0,4)&&(a=e.substring(4),s=a);function h(e){l.addMolData(e,s,i),r.zoomTo(),r.render()}o=new Promise(function(t){"bcif"==s?getbin(a).then(function(e){h(e),t(l)}).catch(function(){n=i&&i.pdbUri?i.pdbUri:"https://files.rcsb.org/view/",a=n+e+".pdb",s="pdb",console.warn("falling back to pdb format"),get(a).then(function(e){h(e),t(l)}).catch(function(e){h(""),t(l),console.error("fetch of "+a+" failed: "+e.statusText)})}):get(a).then(function(e){h(e),t(l)}).catch(function(e){h(""),t(l),console.error("fetch of "+a+" failed: "+e.statusText)})})}return t?(o.then(function(e){t(e)}),l):o}function getColorFromStyle(r,i){let s=i.colorscheme;if(void 0!==_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[s])s=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[s];else if("string"==typeof s&&s.endsWith("Carbon")){var n=s.substring(0,s.lastIndexOf("Carbon")).toLowerCase();if(void 0!==_colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[n]){let e=Object.assign({},_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors.defaultColors);e.C=_colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[n],_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[s]={prop:"elem",map:e},s=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[s]}}let a=r.color;if(void 0!==i.color&&"spectrum"!=i.color&&(a=i.color),void 0!==s){let e,t;var o;void 0!==_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[s]?void 0!==(s=_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[s])[r[s.prop]]&&(a=s.map[r[s.prop]]):void 0!==s[r[s.prop]]?a=s.map[r[s.prop]]:void 0!==s.prop&&void 0!==s.gradient?(e=s.prop,o=(n=(n=s.gradient)instanceof _Gradient__WEBPACK_IMPORTED_MODULE_0__.GradientType?n:(0,_Gradient__WEBPACK_IMPORTED_MODULE_0__.getGradient)(s)).range()||[-1,1],null!=(t=getAtomProperty(r,e))&&(a=n.valueToHex(t,o))):void 0!==s.prop&&void 0!==s.map?(e=s.prop,t=getAtomProperty(r,e),void 0!==s.map[t]&&(a=s.map[t])):void 0!==i.colorscheme[r.elem]?a=i.colorscheme[r.elem]:console.warn("Could not interpret colorscheme "+s)}else void 0!==i.colorfunc&&(a=i.colorfunc(r));return _colors__WEBPACK_IMPORTED_MODULE_2__.CC.color(a)}function getElement(e){let t=e;return"string"==typeof e?t=document.querySelector("#"+e):"object"==typeof e&&e.get&&(t=e.get(0)),t}function inflateString(e,t=!0){let r;if("string"==typeof e){const i=new TextEncoder;r=i.encode(e)}else r=new Uint8Array(e);return(0,pako__WEBPACK_IMPORTED_MODULE_3__.inflate)(r,{to:t?"string":null})}},"./src/vendor/mmtf.js":function(e,t){!function(e){"use strict";function d(e,t,r){for(var i=(e.byteLength,0),s=r.length;s>i;i++){var n=r.charCodeAt(i);if(128>n)e.setUint8(t++,n>>>0&127|0);else if(2048>n)e.setUint8(t++,n>>>6&31|192),e.setUint8(t++,n>>>0&63|128);else if(65536>n)e.setUint8(t++,n>>>12&15|224),e.setUint8(t++,n>>>6&63|128),e.setUint8(t++,n>>>0&63|128);else{if(!(1114112>n))throw new Error("bad codepoint "+n);e.setUint8(t++,n>>>18&7|240),e.setUint8(t++,n>>>12&63|128),e.setUint8(t++,n>>>6&63|128),e.setUint8(t++,n>>>0&63|128)}}}function u(e){for(var t=0,r=0,i=e.length;i>r;r++){var s=e.charCodeAt(r);if(128>s)t+=1;else if(2048>s)t+=2;else if(65536>s)t+=3;else{if(!(1114112>s))throw new Error("bad codepoint "+s);t+=4}}return t}function p(e,t,r){var i=typeof e;if("string"===i){var s=u(e);if(32>s)return t.setUint8(r,160|s),d(t,r+1,e),1+s;if(256>s)return t.setUint8(r,217),t.setUint8(r+1,s),d(t,r+2,e),2+s;if(65536>s)return t.setUint8(r,218),t.setUint16(r+1,s),d(t,r+3,e),3+s;if(4294967296>s)return t.setUint8(r,219),t.setUint32(r+1,s),d(t,r+5,e),5+s}if(e instanceof Uint8Array){var s=e.byteLength,n=new Uint8Array(t.buffer);if(256>s)return t.setUint8(r,196),t.setUint8(r+1,s),n.set(e,r+2),2+s;if(65536>s)return t.setUint8(r,197),t.setUint16(r+1,s),n.set(e,r+3),3+s;if(4294967296>s)return t.setUint8(r,198),t.setUint32(r+1,s),n.set(e,r+5),5+s}if("number"===i){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(r,203),t.setFloat64(r+1,e),9;if(e>=0){if(128>e)return t.setUint8(r,e),1;if(256>e)return t.setUint8(r,204),t.setUint8(r+1,e),2;if(65536>e)return t.setUint8(r,205),t.setUint16(r+1,e),3;if(4294967296>e)return t.setUint8(r,206),t.setUint32(r+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(r,e),1;if(e>=-128)return t.setUint8(r,208),t.setInt8(r+1,e),2;if(e>=-32768)return t.setUint8(r,209),t.setInt16(r+1,e),3;if(e>=-2147483648)return t.setUint8(r,210),t.setInt32(r+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(null===e)return t.setUint8(r,192),1;if("boolean"===i)return t.setUint8(r,e?195:194),1;if("object"===i){var s,a=0,o=Array.isArray(e);if(o)s=e.length;else{var l=Object.keys(e);s=l.length}var a;if(16>s?(t.setUint8(r,s|(o?144:128)),a=1):65536>s?(t.setUint8(r,o?220:222),t.setUint16(r+1,s),a=3):4294967296>s&&(t.setUint8(r,o?221:223),t.setUint32(r+1,s),a=5),o)for(var h=0;s>h;h++)a+=p(e[h],t,r+a);else for(var h=0;s>h;h++){var c=l[h];a+=p(c,t,r+a),a+=p(e[c],t,r+a)}return a}throw new Error("Unknown type "+i)}function o(e){var t=typeof e;if("string"===t){var r=u(e);if(32>r)return 1+r;if(256>r)return 2+r;if(65536>r)return 3+r;if(4294967296>r)return 5+r}if(e instanceof Uint8Array){var r=e.byteLength;if(256>r)return 2+r;if(65536>r)return 3+r;if(4294967296>r)return 5+r}if("number"===t){if(Math.floor(e)!==e)return 9;if(e>=0){if(128>e)return 1;if(256>e)return 2;if(65536>e)return 3;if(4294967296>e)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if("boolean"===t||null===e)return 1;if("object"===t){var r,i=0;if(Array.isArray(e)){r=e.length;for(var s=0;r>s;s++)i+=o(e[s])}else{var n=Object.keys(e);r=n.length;for(var s=0;r>s;s++){var a=n[s];i+=o(a)+o(e[a])}}if(16>r)return 1+i;if(65536>r)return 3+i;if(4294967296>r)return 5+i;throw new Error("Array or object too long 0x"+r.toString(16))}throw new Error("Unknown type "+t)}function t(e){var t=new ArrayBuffer(o(e)),r=new DataView(t);return p(e,r,0),new Uint8Array(t)}function r(e,t,r){return t?new e(t.buffer,t.byteOffset,t.byteLength/(r||1)):void 0}function l(e){return r(DataView,e)}function n(e){return r(Uint8Array,e)}function s(e){return r(Int8Array,e)}function a(e){return r(Int32Array,e,4)}function O(e){return r(Float32Array,e,4)}function h(e,t){var r=e.length/2;t||(t=new Int16Array(r));for(var i=0,s=0;r>i;++i,s+=2)t[i]=e[s]<<8^e[s+1]<<0;return t}function R(e,t){var r=e.length;t||(t=new Uint8Array(2*r));for(var i=l(t),s=0;r>s;++s)i.setInt16(2*s,e[s]);return n(t)}function c(e,t){var r=e.length/4;t||(t=new Int32Array(r));for(var i=0,s=0;r>i;++i,s+=4)t[i]=e[s]<<24^e[s+1]<<16^e[s+2]<<8^e[s+3]<<0;return t}function f(e,t){var r=e.length;t||(t=new Uint8Array(4*r));for(var i=l(t),s=0;r>s;++s)i.setInt32(4*s,e[s]);return n(t)}function G(e,t){var r=e.length;t||(t=new Float32Array(r/4));for(var i=l(t),s=l(e),n=0,a=0,o=r/4;o>n;++n,a+=4)i.setFloat32(a,s.getFloat32(a),!0);return t}function m(e,t,r){var i=e.length,s=1/t;r||(r=new Float32Array(i));for(var n=0;i>n;++n)r[n]=e[n]*s;return r}function i(e,t,r){var i=e.length;r||(r=new Int32Array(i));for(var s=0;i>s;++s)r[s]=Math.round(e[s]*t);return r}function g(e,t){var r,i;if(!t){var s=0;for(r=0,i=e.length;i>r;r+=2)s+=e[r+1];t=new e.constructor(s)}var n=0;for(r=0,i=e.length;i>r;r+=2)for(var a=e[r],o=e[r+1],l=0;o>l;++l)t[n]=a,++n;return t}function v(e){if(0===e.length)return new Int32Array;var t,r,i=2;for(t=1,r=e.length;r>t;++t)e[t-1]!==e[t]&&(i+=2);var s=new Int32Array(i),n=0,a=1;for(t=1,r=e.length;r>t;++t)e[t-1]!==e[t]?(s[n]=e[t-1],s[n+1]=a,a=1,n+=2):++a;return s[n]=e[e.length-1],s[n+1]=a,s}function b(e,t){var r=e.length;t||(t=new e.constructor(r)),r&&(t[0]=e[0]);for(var i=1;r>i;++i)t[i]=e[i]+t[i-1];return t}function _(e,t){var r=e.length;t||(t=new e.constructor(r)),t[0]=e[0];for(var i=1;r>i;++i)t[i]=e[i]-e[i-1];return t}function y(e,t){var r,i,s=e instanceof Int8Array?127:32767,n=-s-1,a=e.length;if(!t){var o=0;for(r=0;a>r;++r)e[r]<s&&e[r]>n&&++o;t=new Int32Array(o)}for(r=0,i=0;a>r;){for(var l=0;e[r]===s||e[r]===n;)l+=e[r],++r;l+=e[r],++r,t[i]=l,++i}return t}function P(e,t){var r,i=t?127:32767,s=-i-1,n=e.length,a=0;for(r=0;n>r;++r){var o=e[r];0===o?++a:o>0?(a+=Math.ceil(o/i),o%i===0&&(a+=1)):(a+=Math.ceil(o/s),o%s===0&&(a+=1))}var l=t?new Int8Array(a):new Int16Array(a),h=0;for(r=0;n>r;++r){var o=e[r];if(o>=0)for(;o>=i;)l[h]=i,++h,o-=i;else for(;s>=o;)l[h]=s,++h,o-=s;l[h]=o,++h}return l}function B(e,t){return b(g(e),t)}function U(e){return v(_(e))}function N(e,t,r){return m(g(e,a(r)),t,r)}function j(e,t){return v(i(e,t))}function V(e,t,r){return m(b(e,a(r)),t,r)}function W(e,t,r){return _(i(e,t),r)}function x(e,t,r){return m(y(e,a(r)),t,r)}function H(e,t,r){var i=y(e,a(r));return V(i,t,O(i))}function q(e,t,r){return P(W(e,t),r)}function Z(e){var t=l(e),r=t.getInt32(0),i=t.getInt32(4),s=e.subarray(8,12),e=e.subarray(12);return[r,e,i,s]}function w(e,t,r,i){var s=new ArrayBuffer(12+i.byteLength),n=new Uint8Array(s),a=new DataView(s);return a.setInt32(0,e),a.setInt32(4,t),r&&n.set(r,8),n.set(i,12),n}function A(e){var t=e.length,r=n(e);return w(2,t,void 0,r)}function S(e){var t=e.length,r=f(e);return w(4,t,void 0,r)}function C(e,t){var r=e.length/t,i=f([t]),s=n(e);return w(5,r,i,s)}function L(e){var t=e.length,r=f(v(e));return w(6,t,void 0,r)}function M(e){var t=e.length,r=f(U(e));return w(8,t,void 0,r)}function X(e,t){var r=e.length,i=f([t]),s=f(j(e,t));return w(9,r,i,s)}function z(e,t){var r=e.length,i=f([t]),s=R(q(e,t));return w(10,r,i,s)}function T(t){var r={};return I.forEach(function(e){void 0!==t[e]&&(r[e]=t[e])}),t.bondAtomList&&(r.bondAtomList=S(t.bondAtomList)),t.bondOrderList&&(r.bondOrderList=A(t.bondOrderList)),r.xCoordList=z(t.xCoordList,1e3),r.yCoordList=z(t.yCoordList,1e3),r.zCoordList=z(t.zCoordList,1e3),t.bFactorList&&(r.bFactorList=z(t.bFactorList,100)),t.atomIdList&&(r.atomIdList=M(t.atomIdList)),t.altLocList&&(r.altLocList=L(t.altLocList)),t.occupancyList&&(r.occupancyList=X(t.occupancyList,100)),r.groupIdList=M(t.groupIdList),r.groupTypeList=S(t.groupTypeList),t.secStructList&&(r.secStructList=A(t.secStructList)),t.insCodeList&&(r.insCodeList=L(t.insCodeList)),t.sequenceIndexList&&(r.sequenceIndexList=M(t.sequenceIndexList)),r.chainIdList=C(t.chainIdList,4),t.chainNameList&&(r.chainNameList=C(t.chainNameList,4)),r}function E(n){function i(e){for(var t={},r=0;e>r;r++){var i=l();t[i]=l()}return t}function s(e){var t=n.subarray(h,h+e);return h+=e,t}function a(e){var t=n.subarray(h,h+e);h+=e;var r=65535;if(e>r){for(var i=[],s=0;s<t.length;s+=r)i.push(String.fromCharCode.apply(null,t.subarray(s,s+r)));return i.join("")}return String.fromCharCode.apply(null,t)}function o(e){for(var t=new Array(e),r=0;e>r;r++)t[r]=l();return t}function l(){var e,t,r=n[h];if(0===(128&r))return h++,r;if(128===(240&r))return t=15&r,h++,i(t);if(144===(240&r))return t=15&r,h++,o(t);if(160===(224&r))return t=31&r,h++,a(t);if(224===(224&r))return e=c.getInt8(h),h++,e;switch(r){case 192:return h++,null;case 194:return h++,!1;case 195:return h++,!0;case 196:return t=c.getUint8(h+1),h+=2,s(t);case 197:return t=c.getUint16(h+1),h+=3,s(t);case 198:return t=c.getUint32(h+1),h+=5,s(t);case 202:return e=c.getFloat32(h+1),h+=5,e;case 203:return e=c.getFloat64(h+1),h+=9,e;case 204:return e=n[h+1],h+=2,e;case 205:return e=c.getUint16(h+1),h+=3,e;case 206:return e=c.getUint32(h+1),h+=5,e;case 208:return e=c.getInt8(h+1),h+=2,e;case 209:return e=c.getInt16(h+1),h+=3,e;case 210:return e=c.getInt32(h+1),h+=5,e;case 217:return t=c.getUint8(h+1),h+=2,a(t);case 218:return t=c.getUint16(h+1),h+=3,a(t);case 219:return t=c.getUint32(h+1),h+=5,a(t);case 220:return t=c.getUint16(h+1),h+=3,o(t);case 221:return t=c.getUint32(h+1),h+=5,o(t);case 222:return t=c.getUint16(h+1),h+=3,i(t);case 223:return t=c.getUint32(h+1),h+=5,i(t)}throw new Error("Unknown type 0x"+r.toString(16))}var h=0,c=new DataView(n.buffer);return l()}function K(e,t,r,i){switch(e){case 1:return G(t);case 2:return s(t);case 3:return h(t);case 4:return c(t);case 5:return n(t);case 6:return g(c(t),new Uint8Array(r));case 7:return g(c(t));case 8:return B(c(t));case 9:return N(c(t),c(i)[0]);case 10:return H(h(t),c(i)[0]);case 11:return m(h(t),c(i)[0]);case 12:return x(h(t),c(i)[0]);case 13:return x(s(t),c(i)[0]);case 14:return y(h(t));case 15:return y(s(t))}}function F(i,e){e=e||{};var s=e.ignoreFields,n={};return re.forEach(function(e){var t=s?-1!==s.indexOf(e):!1,r=i[e];t||void 0===r||(r instanceof Uint8Array?n[e]=K.apply(null,Z(r)):n[e]=r)}),n}function Y(e){return String.fromCharCode.apply(null,e).replace(/\0/g,"")}function Q(e,t,r){r=r||{};var i,s,n,a,o,l,R=r.firstModelOnly,h=t.onModel,c=t.onChain,d=t.onGroup,u=t.onAtom,p=t.onBond,f=0,m=0,g=0,v=0,b=0,_=-1,y=e.chainNameList,x=e.secStructList,G=e.insCodeList,w=e.sequenceIndexList,A=e.atomIdList,S=e.bFactorList,C=e.altLocList,L=e.occupancyList,M=e.bondAtomList,z=e.bondOrderList;for(i=0,s=e.chainsPerModel.length;s>i&&!(R&&f>0);++i){var T=e.chainsPerModel[f];for(h&&h({chainCount:T,modelIndex:f}),n=0;T>n;++n){var E=e.groupsPerChain[m];if(c){var P=Y(e.chainIdList.subarray(4*m,4*m+4)),F=null;y&&(F=Y(y.subarray(4*m,4*m+4))),c({groupCount:E,chainIndex:m,modelIndex:f,chainId:P,chainName:F})}for(a=0;E>a;++a){var D=e.groupList[e.groupTypeList[g]],k=D.atomNameList.length;if(d){var B=null;x&&(B=x[g]);var U=null;e.insCodeList&&(U=String.fromCharCode(G[g]));var N=null;w&&(N=w[g]),d({atomCount:k,groupIndex:g,chainIndex:m,modelIndex:f,groupId:e.groupIdList[g],groupType:e.groupTypeList[g],groupName:D.groupName,singleLetterCode:D.singleLetterCode,chemCompType:D.chemCompType,secStruct:B,insCode:U,sequenceIndex:N})}for(o=0;k>o;++o){if(u){var j=null;A&&(j=A[v]);var V=null;S&&(V=S[v]);var W=null;C&&(W=String.fromCharCode(C[v]));var H=null;L&&(H=L[v]),u({atomIndex:v,groupIndex:g,chainIndex:m,modelIndex:f,atomId:j,element:D.elementList[o],atomName:D.atomNameList[o],formalCharge:D.formalChargeList[o],xCoord:e.xCoordList[v],yCoord:e.yCoordList[v],zCoord:e.zCoordList[v],bFactor:V,altLoc:W,occupancy:H})}v+=1}if(p){var q=D.bondAtomList;for(o=0,l=D.bondOrderList.length;l>o;++o)p({atomIndex1:v-k+q[2*o],atomIndex2:v-k+q[2*o+1],bondOrder:D.bondOrderList[o]})}g+=1}m+=1}if(b=_+1,_=v-1,p&&M)for(o=0,l=M.length;l>o;o+=2){var I=M[o],O=M[o+1];(I>=b&&_>=I||O>=b&&_>=O)&&p({atomIndex1:I,atomIndex2:O,bondOrder:z?z[o/2]:null})}f+=1}}function $(e){return t(T(e))}function D(e,t){e instanceof ArrayBuffer&&(e=new Uint8Array(e));var r;return r=e instanceof Uint8Array?E(e):e,F(r,t)}function k(e,t,r,i){function s(){try{var e=D(n.response);r(e)}catch(e){i(e)}}var n=new XMLHttpRequest;n.addEventListener("load",s,!0),n.addEventListener("error",i,!0),n.responseType="arraybuffer",n.open("GET",t+e.toUpperCase()),n.send()}function J(e,t,r){k(e,ne,t,r)}function ee(e,t,r){k(e,ae,t,r)}var I=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],te,re=I.concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]),ie="v1.0.1",se="//mmtf.rcsb.org/v1.0/",ne=se+"full/",ae=se+"reduced/";e.encode=$,e.decode=D,e.traverse=Q,e.fetch=J,e.fetchReduced=ee,e.version=ie,e.fetchUrl=ne,e.fetchReducedUrl=ae,e.encodeMsgpack=t,e.encodeMmtf=T,e.decodeMsgpack=E,e.decodeMmtf=F}(t)}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(t.exports,t,t.exports,__webpack_require__),t.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__("./src/index.ts"),__webpack_require__("./src/SurfaceWorker.js");var __webpack_exports__=__webpack_require__("./src/exporter.js");return __webpack_exports__})());

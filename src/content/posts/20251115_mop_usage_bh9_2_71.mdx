---
title:  【計算化学】自作pythonライブラリで遷移状態構造を求めてみる(BH9データセットの2. Pericyclic, No. 71の化学反応, NNP(UMA)使用)
published: 2025-11-15
description: ""
tags: [MultiOptPy, python]
category: Computational Chemistry
draft: false
---
最終更新：2025-11-15

import MoleculeViewer from '../../components/MoleculeViewer.astro';
import MultiDataGraph from '../../components/MultiDataGraph.astro';

## 概要

本記事では、自作ライブラリ(MultiOptPy)で、BH9データセットの2. Pericyclic, No. 71の素過程の遷移状態構造を算出してみる。計算レベルは、Meta社のFAIR Chemistryが開発したニューラルネットワークポテンシャル(NNP)であるUMA(Meta’s Universal Model for Atoms)とした。

MultiOptPyは電子状態計算ソフトウェアを用いた分子構造最適化手法の勉強を目的として作成したpythonライブラリである。

MultiOptPyのレポジトリ:https://github.com/ss0832/MultiOptPy

BH9のデータセットについて:

- _J. Chem. Theory Comput._ 2022, 18, 1, 151–166 

https://doi.org/10.1021/acs.jctc.1c00694


この文献のSupporting Informationから、データセットの詳細を確認できる。

有機金属錯体が関わる反応を除いたさまざまなカテゴリの反応がまとめられたデータセットである。DFTの汎関数の電子エネルギーの精度の比較などのベンチマークに主に使われる。

今回使用したニューラルネットワークポテンシャルについて：
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)



## 使用した自作ライブラリMultiOptPyのバージョン
```
v1.19.6
```
## 環境
```
Windows 11
```
※Windows 11環境下でAnaconda PowerShell Promptを使用した。

## Source codeのダウンロード(Unixコマンド)
```
wget https://github.com/ss0832/MultiOptPy/archive/refs/tags/v1.19.6.zip
unzip v1.19.6.zip
cd MultiOptPy-v1.19.6
```
https://github.com/ss0832/MultiOptPy/releases/tag/v1.19.6 にアクセスしてzipファイルをダウンロードする。Unixコマンドの場合とはディレクトリ名が異なるので都度読み替えていただけると良い。

移動先のディレクトリで`requirements.txt`を参照することで、本ソースコードで必要なモジュールを把握することが出来る。導入方法は各自の状況に合わせて適宜LLMとの対話などで調べると良い。

次に述べる環境構築手順を使用する場合は、環境構築が終わった後、`pip install -r requirements.txt`で本自作モジュールが動作させるために最低限必要なモジュールを導入することが可能である。

### 環境構築手順

今回は、Windows 11のPower Shellを使用した。初めに、NNPを使用できる環境が整ったAnaconda PowerShell Promptを用意する手順を説明する。

1, https://repo.anaconda.com/archive/ より、`Anaconda3-2025.06-1-Windows-x86_64.exe`でAnacondaをインストールする。

2, 検索機能を使い、スタートから`Anaconda PowerShell Prompt`を開く。

3, 以下のコマンドを実行し、仮想環境を作成する。
```
conda create -n (任意の仮想環境名) python=3.12.7
```

4, 先ほど作成した仮想環境を`conda activate (仮想環境名)`で起動させる。

5, 以下のコマンドを実行し、必要なライブラリを導入する。
```
pip install ase==3.26.0 fairchem-core==2.7.1 torch==2.6.0
```
- fairchem-coreは、FAIR Chemistryが管理しているNNPを動作させるために必要なライブラリである。
- aseはNNPに電子エネルギーを算出したい分子構造を渡すために必要なインターフェイスの役割を果たすために必要なライブラリである。
- torchはPyTorchライブラリを指す。これはニューラルネットワークなどの機械学習を行ったり、学習結果を扱ったりするために必須なライブラリである。

これで、`Anaconda PowerShell Prompt`から仮想環境を立ち上げることで、NNPを使用する準備が整えることが出来る。

次に、NNPを使用するために必要なModelの情報が保存されている`.pt`ファイルのダウンロードおよびNNPの自作ライブラリへの導入方法について説明する。


1, 以下のサイトにアクセスして、`uma-s-1p1.pt`をダウンロードする。（使用許諾が下りていれば可能である。）
```
https://huggingface.co/facebook/UMA
```

2, ダウンロード後、`MultiOptPy-v1.19.6`ディレクトリ内に存在する`software_path.conf`に対して、`uma-s-1p1.pt`の絶対パスを用いて以下を追記する。
```
uma-s-1p1::(uma-s-1p1.ptの絶対パス)
```

これで、`MultiOptPy-v1.19.6`がNNP`uma-s-1p1`を使用できるようになる。


### 使用するNNPに関する具体的な説明

今回使用するNNPについて具体的に説明する。

- UMAのModel Checkpointは`uma-s-1p1`を使用した。
- 小分子系のトレーニングセットである`Omol25`(`omol`)を使用して学習したニューラルネットワークポテンシャルを使用する。

※自作ライブラリでの具体的な使用の仕方に関しては、`ase_calculation_tools.py` を参照すると良い。`omol`以外のモデルを使用したい場合は、現バージョンでは、`multioptpy/Calculator/ase_tools/firechem.py`内の、`self.task_name`を編集することで対応可能である。


## 手順

### 1. 初期構造の準備

モデル反応系として、以下の構造を用意した。今回はファイルの名前を`bh9_2_71.xyz`とした。
初期構造は以下のものを使用した。

```
43
OptimizedStructure
C      1.772867807911     -0.286867424776      0.246782052329
C      2.499706872235      0.784852167750     -0.063108786593
C     -1.823289531191     -0.295590426510      0.639920939390
N     -1.737804855615      0.108555151311      1.890400726228
N     -1.693220478618      0.452740290158      2.952932480527
C     -3.170933372682     -0.523229407052      0.090435526205
C     -4.300710364719     -0.090795072006      0.788755586303
C     -3.342436882865     -1.181268523296     -1.128637203139
C     -5.570648857686     -0.316662538016      0.284904801724
H     -4.197948370957      0.432800022917      1.731647772076
C     -4.618272729898     -1.396548995209     -1.626264677619
H     -2.477541743348     -1.513245272587     -1.681724672964
C     -5.737300859386     -0.970632107114     -0.926590692077
H     -6.432811794421      0.026208315831      0.842113793859
H     -4.734314782608     -1.907659685133     -2.573269674344
H     -6.729320292402     -1.144803187297     -1.321507861071
C      2.096404470453      2.183628897745     -0.054207014182
C      0.743818499970      2.726970672941      0.357845523906
C      2.885140861749      3.166416245387     -0.497707612740
C      0.971234349220      4.248973947734      0.400138742871
H      0.409231601752      2.335237885554      1.317451178304
H     -0.011427437279      2.445965658469     -0.384474355676
C      2.208198318999      4.506259659764     -0.479539942657
H      3.884685741498      3.011492676776     -0.885640391520
H      1.194347510294      4.547407895515      1.425752841707
H      1.930132879459      4.800933124507     -1.497596759925
C     -0.548779563189     -0.436287054097     -0.052491699823
C      2.226070226996     -1.687044358051      0.165660717634
C      3.169184090069     -2.081367543000     -0.781952142787
C      1.711998949192     -2.640541370124      1.042447975406
C      3.605834104116     -3.394467721903     -0.834089102901
H      3.538766389720     -1.361869740411     -1.500789090954
C      2.146981941889     -3.955300184734      0.985476361020
H      0.975084810442     -2.346807659543      1.778777333861
C      3.097796312376     -4.336192010727      0.050371565469
H      4.333206660460     -3.687987230776     -1.579878611943
H      1.742254526595     -4.683961999623      1.675870105357
H      3.434108584454     -5.363653622375      0.003441499497
O      0.489084396948     -0.121083004537      0.778308328428
O     -0.401815100462     -0.765072141862     -1.198368778150
H      2.844655704259      5.301786828586     -0.087750266835
H      0.097160167971      4.813859973357      0.078842797345
H      3.520621238300      0.594848866460     -0.372689311548
```

<MoleculeViewer 
  xyzData={`43
OptimizedStructure
C      1.772867807911     -0.286867424776      0.246782052329
C      2.499706872235      0.784852167750     -0.063108786593
C     -1.823289531191     -0.295590426510      0.639920939390
N     -1.737804855615      0.108555151311      1.890400726228
N     -1.693220478618      0.452740290158      2.952932480527
C     -3.170933372682     -0.523229407052      0.090435526205
C     -4.300710364719     -0.090795072006      0.788755586303
C     -3.342436882865     -1.181268523296     -1.128637203139
C     -5.570648857686     -0.316662538016      0.284904801724
H     -4.197948370957      0.432800022917      1.731647772076
C     -4.618272729898     -1.396548995209     -1.626264677619
H     -2.477541743348     -1.513245272587     -1.681724672964
C     -5.737300859386     -0.970632107114     -0.926590692077
H     -6.432811794421      0.026208315831      0.842113793859
H     -4.734314782608     -1.907659685133     -2.573269674344
H     -6.729320292402     -1.144803187297     -1.321507861071
C      2.096404470453      2.183628897745     -0.054207014182
C      0.743818499970      2.726970672941      0.357845523906
C      2.885140861749      3.166416245387     -0.497707612740
C      0.971234349220      4.248973947734      0.400138742871
H      0.409231601752      2.335237885554      1.317451178304
H     -0.011427437279      2.445965658469     -0.384474355676
C      2.208198318999      4.506259659764     -0.479539942657
H      3.884685741498      3.011492676776     -0.885640391520
H      1.194347510294      4.547407895515      1.425752841707
H      1.930132879459      4.800933124507     -1.497596759925
C     -0.548779563189     -0.436287054097     -0.052491699823
C      2.226070226996     -1.687044358051      0.165660717634
C      3.169184090069     -2.081367543000     -0.781952142787
C      1.711998949192     -2.640541370124      1.042447975406
C      3.605834104116     -3.394467721903     -0.834089102901
H      3.538766389720     -1.361869740411     -1.500789090954
C      2.146981941889     -3.955300184734      0.985476361020
H      0.975084810442     -2.346807659543      1.778777333861
C      3.097796312376     -4.336192010727      0.050371565469
H      4.333206660460     -3.687987230776     -1.579878611943
H      1.742254526595     -4.683961999623      1.675870105357
H      3.434108584454     -5.363653622375      0.003441499497
O      0.489084396948     -0.121083004537      0.778308328428
O     -0.401815100462     -0.765072141862     -1.198368778150
H      2.844655704259      5.301786828586     -0.087750266835
H      0.097160167971      4.813859973357      0.078842797345
H      3.520621238300      0.594848866460     -0.372689311548`}
  caption="初期経路を求めるための初期構造"
  backgroundColor="#333333"
/>


### 2. 遷移状態構造最適化

　`run_autots.py`を適切に使用することで、自動的に遷移状態構造が得られる。以下にその手順を説明していく。

初期構造をカレントディレクトリに`bh9_2_71.xyz`として保存する。その後、同じディレクトリ内で、`config_bh9_2_71.json`を作成し、以下のように記述する。

`config_bh9_2_71.json`
```json
{
  "work_dir": "bh9_2_71",
  "top_n_candidates": 3,
  "multioptpy_version": "v1.19.6b",
  
  "step1_settings": {
    "othersoft": "uma-s-1p1",
    "opt_method": ["rsirfo_block_fsb"],
    "use_model_hessian": "fischerd3",
    "spin_multiplicity": 1,
    "electronic_charge": 0,
	"manual_AFIR": ["350", "1", "3", "350", "5", "17"]
  },
  
  "step2_settings": {
    "othersoft": "uma-s-1p1",
    "NSTEP": 15,
    "ANEB": [3, 5],
    "QSM": true,
    "use_model_hessian": "fischerd3",
    "save_pict": true,
    "node_distance_bernstein": 0.80,
    "align_distances": 9999,
    "spin_multiplicity": 1,
    "electronic_charge": 0
  },
  
  "step3_settings": {
    "othersoft": "uma-s-1p1",
    "opt_method": ["rsirfo_block_bofill"],
    "calc_exact_hess": 5,
    "tight_convergence_criteria": true,
    "max_trust_radius": 0.2,
    "frequency_analysis": true,
	"NSTEP": 500,
	"detect_negative_eigenvalues": true,
    "spin_multiplicity": 1,
    "electronic_charge": 0
  },

  "step4_settings": {
    "othersoft": "uma-s-1p1",
	"opt_method": ["rsirfo_block_bofill"],
    "spin_multiplicity": 1,
    "electronic_charge": 0,
	"calc_exact_hess": 10,
    "tight_convergence_criteria": true,
    "frequency_analysis": true,
    
    "intrinsic_reaction_coordinates": ["0.5", "200", "lqa"],

    "step4b_opt_method": ["rsirfo_block_fsb"]
  }
}
```
その後、以下のコマンドを実行する。
```
python run_autots.py bh9_2_71.xyz -cfg config_bh9_2_71.json
```

これにより、これまでの似た内容の記事で行ってきたコマンドの操作をまとめ、遷移状態構造を求める処理を自動的に行う。

具体的な処理の流れは、
```
Step1. バイアスポテンシャルによるNEB法のための初期経路の作成

Step2. NEB法による経路の緩和

Step3. NEB法により得られた経路のエネルギー極大値を示す構造のうち、エネルギー値が上位の最大で3個
(`run_autots.py`にて、`--top_n X`で最大値を変更可能)の構造を初期構造とした遷移状態構造の算出

(Step4.得られた遷移状態構造に対するIRC計算とIRC経路の末端に存在する構造に対する構造最適化。
こちらは`--run_step4`をコマンドで追記しなければ行わない。)
```
となっている。

`run_autots.py`のオプションの説明：

- `-cfg YYY.json`は、workflowを実行するためのオプションが記されたJSONファイルの読み込み先を指定する。


これらの一連の結果は、`(jsonファイルの"work_dir"にて指定した名前)`のディレクトリの中に存在するファイルを開いて確認できる。

以下にすべてのstepで共通のオプションに関する説明を載せる。

- `"opt_method": ["rsirfo_block_fsb"]`は準ニュートン法であるRS-I-RFO法を構造最適化に使用することを示す。初期のへシアンに関しては、特にオプションで指定しない限り、単位行列が使われる。(以前のHessian更新法とは細かな点で異なる方法を使用している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `"spin_multiplicity": Z`はスピン多重度の指定である。PySCFを使用するときは目的とするスピン多重度に1を引いた値を指定する。（デフォルトでは1が指定される。）
- ` "electronic_charge": 0`は形式電荷をMとすることを示す。（デフォルトでは0が指定される。）
- `"othersoft": "uma-s-1p1"`は今回使用するNNPを指定している。これを使用する際にASEライブラリが必要である。
- `"use_model_hessian": "fischerd3"`は、計算コストが非常に低い数式を使用して、近似したHessianを生成する機能を呼び出すオプションである。デフォルトではこの機能は使用されない。


※オプションの説明は`MultiOptPy-v1.19.6/OPTION_README.md`にて示されている。


#### Step 1


Step1では、`omol`のデータセットを使用した`uma-s-1p1`モデルのNNPで得たエネルギーに対して、指定した人工力ポテンシャルを加えた上で初期構造を構造最適化を行っている。


以下のJSON内で記述したバイアスポテンシャルで、次の経路緩和アルゴリズムの初期経路として用いるトラジェクトリーを生成する。
- `"manual_AFIR": ["yyy", "a", "b]`：yyykJ/molの活性化障壁を超えうるペア同士を近づける力を原子のラベル番号aとbのペアに構造最適化時に加えることを示す。


Step1が正常終了していれば作成された`work_dir`ディレクトリ中に、`bh9_2_71_step1_traj.xyz`が存在する。必要に応じて確認し、目的に沿った初期経路が得られているか確認する。もし想定とは異なる場合は、プロセスをkillして再度設定を見直してやり直す。


`bh9_2_71_step1_traj.xyz`は構造最適化の過程をAvogadro（公式ページ:https://avogadro.cc/ ）等で可視化して確認できるようにしている。この`bh9_2_71_step1_traj.xyz`はStep2のNEB計算に使用している。

※`bh9_2_71_step1_traj.xyz`をアニメーションとして表示したい場合は、[https://github.com/ss0832/molecule_movie] を使うと良い。


#### Step 2

Step2では、NEB法を用いることで、先ほど得られた`bh9_2_71_step1_traj.xyz`全体のエネルギーを下げることができる。これにより、パスのエネルギー極大値を持つ構造を遷移状態構造に近づける。（この時点ではまだ正確な遷移状態構造は求められていない。）

Step2固有のオプションについて以下に示す。


- `"NSTEP": n`はn回分NEB法による経路の緩和を行うことを示す。
- `"align_distances": X`は線形補間で、各ノード間の距離を全て等しくするための処理である。X回の反復計算ごとに本処理を行う。Xを`"NSTEP": n`よりも大きな数値を指定することで、初期経路に対してのみ処理を行うことが出来る。
- `"node_distance_bernstein": N`はノード間の距離をN Åとして初期経路を作成することを示す。経路作成時に元のノードをベルンシュタイン多項式を用いてがたついた経路を滑らかにする。

→プログラムの仕様上`"align_distances": X`の処理を行った後に、`"node_distance_bernstein": N`の処理を行うようになっている。

- `"save_pict": true`は緩和中のパスのエネルギープロファイルや各ノードの勾配のRMS値をmatplotlibで可視化するオプションである。
- `"ANEB": [A, B]`これを指定すると、(B+1)回の緩和ごとに、エネルギー極大値を示すノードと前後のノードの間に線形補間でA個の新規ノードを内挿するようにできる。デフォルトではこのような操作は行われない。このオプションを使用するとノードの数が徐々に増えるため、計算コストが使用しない場合と比べて増加する。一方で、エネルギー極大値を示すノード周辺にノードを増加させるため、緩和している経路中のノードが遷移状態構造付近に存在する可能性が高くすることが出来る。


`MultiOptPy-v1.19.6/"work_dir"`と同じディレクトリ内に、NEBという名前を含むディレクトリが生成されている。
そのディレクトリ内の`energy_plot.csv`を確認し、緩和後のパスのエネルギー極大値を示す構造を確認する。

経路の緩和後の各ノードのエネルギー一覧(単位:hartree) (energy_plot.csvに保存されている。)

export const dataset1 = [-1070.975524802316,-1070.975524802316,-1070.9570198589638,-1070.9255484009623,-1070.889268115658,-1070.8599377564926,-1070.8406437525318,-1070.829723725497,-1070.8249630810717,-1070.8237067383286,-1070.823717848187,-1070.8243329383135,-1070.8259406434718,-1070.8282756413173,-1070.8300336625093,-1070.8292903008314,-1070.8234522104208,-1070.8134033960532,-1070.814282722071,-1070.8176254927203,-1070.8161198791001,-1070.810689068389,-1070.80234363714,-1070.7932264562467,-1070.7967350511706,-1070.813742930149,-1070.8255468568182,-1070.831378603745,-1070.8354007580074,-1070.8390454224118,-1070.8441575168692,-1070.8608637912291,-1070.8854535089715,-1070.910405146999,-1070.9267670770798,-1070.9343209791061,-1070.9380547764677,-1070.9407531183774,-1070.9430962164313,-1070.945104976088,-1070.946749103708,-1070.9481145123168,-1070.949398252952,-1070.9506622008666,-1070.9518177444252,-1070.9528536379628,-1070.95379344612,-1070.9544726282136,-1070.9548189657835,-1070.955074023775,-1070.955186844037,-1070.9551976340927];

export const dataset1_itr5 = [-1070.9755248975996,-1070.9755248756953,-1070.9653148468117,-1070.9414969181414,-1070.906880772221,-1070.878631083353,-1070.8597316808853,-1070.8530278275964,-1070.8467835789866,-1070.8474733890441,-1070.848639240764,-1070.8523390864682,-1070.8574741278653,-1070.8614080165805,-1070.8640459683493,-1070.8611660967852,-1070.8546995984366,-1070.8403946218423,-1070.8356435276896,-1070.8364832156954,-1070.8339967627926,-1070.828720035654,-1070.8203017069113,-1070.8084381129424,-1070.80646609555,-1070.822569239528,-1070.8335154816232,-1070.841185436985,-1070.8471309986285,-1070.8516880470127,-1070.8585813111213,-1070.8791716901148,-1070.9052668374813,-1070.9274895683457,-1070.9401425230121,-1070.9462446258901,-1070.949900860143,-1070.952709275516,-1070.9550562068216,-1070.9570413952665,-1070.958790442269,-1070.9603980247632,-1070.961627550078,-1070.9625237774499,-1070.9632750181029,-1070.964069940301,-1070.9648450369216,-1070.9653993623435,-1070.965692174578,-1070.966070490228,-1070.9655381983364,-1070.9654930930121];

export const dataset1_itr10 = [-1070.9755249490747,-1070.9755247782211,-1070.9690766882422,-1070.9486298064755,-1070.916968006722,-1070.8900725552724,-1070.8729700497395,-1070.8690806793134,-1070.8674553806254,-1070.865750245163,-1070.8634823270306,-1070.8607890800597,-1070.8614649064154,-1070.8618252408298,-1070.861841949426,-1070.8618405037425,-1070.8627381067042,-1070.8695913998552,-1070.874113664219,-1070.8781385346142,-1070.881090620258,-1070.880566511811,-1070.8741490966067,-1070.8585511795732,-1070.8529419539984,-1070.843468653077,-1070.8415615775384,-1070.8425799344975,-1070.843497181231,-1070.8438778954012,-1070.8441168449745,-1070.8440780656106,-1070.842207368725,-1070.8367655708194,-1070.829363040614,-1070.8172273076843,-1070.81166056768,-1070.8068587081332,-1070.805476003893,-1070.8093951028286,-1070.8142544567688,-1070.818311044583,-1070.8218811292438,-1070.8248566962918,-1070.8348569532184,-1070.8422272403013,-1070.8479578682407,-1070.8524234442891,-1070.8640351651509,-1070.8865595444424,-1070.9123173306193,-1070.931142376767,-1070.9414166257577,-1070.947134207499,-1070.9508708305145,-1070.9537186166674,-1070.95606436076,-1070.9580066868805,-1070.9596484072185,-1070.961057801842,-1070.9622459806096,-1070.9633010163107,-1070.9642657143181,-1070.9651675754749,-1070.9658639480592,-1070.966299219257,-1070.9665455023883,-1070.9666886600985,-1070.9667332243866,-1070.966688009541,-1070.9666770530125,-1070.9663300495522,-1070.9663891079124,-1070.9665585157297,-1070.9664550464115,-1070.9663640581607];

export const dataset2 = [-1070.9755249435987,-1070.9755247858877,-1070.9713242375708,-1070.9535470184205,-1070.9245025760174,-1070.8983599751864,-1070.8846726033319,-1070.8793685221096,-1070.8775899108803,-1070.8758687589973,-1070.8727716055887,-1070.871559614662,-1070.8709515163864,-1070.8712967981692,-1070.869706108267,-1070.8698059568055,-1070.8697736698746,-1070.8698183546364,-1070.8703669783704,-1070.8719924873396,-1070.8711081233337,-1070.8695492998002,-1070.8701382975307,-1070.8701111537284,-1070.8709012066017,-1070.8709454182306,-1070.8722136068166,-1070.8722790480883,-1070.8720827242732,-1070.879398180525,-1070.884140661909,-1070.8883213419351,-1070.8902772552897,-1070.8919228899251,-1070.8863553000342,-1070.8743701197047,-1070.8686665567122,-1070.8549871580212,-1070.852020790777,-1070.8490134800247,-1070.846812764269,-1070.845770829527,-1070.845440530282,-1070.8453113387502,-1070.8456118393922,-1070.8461563889273,-1070.8478860747234,-1070.8483348323957,-1070.8487164052144,-1070.8485686300787,-1070.8463215035028,-1070.8420031681253,-1070.8349631802873,-1070.8245903926352,-1070.819106696194,-1070.8105409077375,-1070.8079952781916,-1070.8061213569938,-1070.8056754205948,-1070.8063152362895,-1070.807552022878,-1070.8087677813437,-1070.8102326354517,-1070.8115447903385,-1070.8168058865722,-1070.82060764858,-1070.8237878017435,-1070.8262381037978,-1070.8353244259201,-1070.8425794263178,-1070.8482734828463,-1070.8527344940396,-1070.8696633510833,-1070.8928411092093,-1070.9169165053436,-1070.9329641131724,-1070.941888277799,-1070.9473597779288,-1070.9510423849529,-1070.9539422157106,-1070.9562951027938,-1070.9582077201192,-1070.9598047162674,-1070.9611341908803,-1070.9623089642193,-1070.9633731865817,-1070.964346751448,-1070.965247935762,-1070.96592300861,-1070.9663504512125,-1070.9665994570476,-1070.966764917711,-1070.966775488724,-1070.9667712699566,-1070.9667660786388,-1070.9667621577698,-1070.9667479462632,-1070.9667387311265,-1070.9667504280199,-1070.966750362307,-1070.966750877058,-1070.9667348387331,-1070.966705329267,-1070.9666565900202,-1070.9665408849628,-1070.96654403261,-1070.9665462318012,-1070.9665488406026,-1070.9665426175925,-1070.9666984359853,-1070.9666440585731,-1070.9664906825092];

<MultiDataGraph datasets={[ { data: dataset1, label: "緩和前の経路のエネルギー", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_itr5, label: "ITR. 5の経路のエネルギー", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_itr10, label: "ITR. 10の経路のエネルギー", color: "rgba(81, 143, 18, 1)"}, { data: dataset2, label: "緩和後の経路のエネルギー", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="Electronic Energy [hartree]" height="500px" />

export const dataset1_grad = [1.7062041182435724e-05,1.706175392721142e-05,0.008752538110204806,0.011569421919430776,0.011459532401843962,0.010811384555451024,0.010932481366743317,0.011326397953234035,0.011581617729218776,0.011798769618405144,0.012141440975685678,0.012507194880492324,0.012825602501585974,0.013105496122601168,0.013227263278987713,0.013144192687521148,0.013217291212801614,0.012300413117380856,0.013466332618606035,0.011071470191147004,0.010128837110422919,0.01105576198556004,0.011735757280597437,0.010868437308906345,0.009442234412364359,0.008863037119186025,0.00866016948535593,0.0100060809553075,0.011232920843593279,0.011772051737153703,0.011769633738686365,0.012412282179831865,0.012803824920674837,0.012758214916586973,0.012129859696926207,0.011784666123896706,0.011771002726937192,0.011824743105266976,0.011844785133974795,0.011821537321952687,0.011790508283501009,0.011790259558396,0.011798745775576268,0.011779339098418894,0.011745795030577792,0.011701177043383857,0.011625632698228652,0.01157308328190993,0.011567479903420738,0.011540492469477517,0.011527099973034128,0.011529103398693674];

export const dataset1_grad_itr5 = [8.186842830748008e-06,9.645415620008622e-06,0.004192566959330838,0.005670510337521541,0.0064624603485708325,0.0064894872230853405,0.0069590665271011395,0.006936016765544274,0.007266261794564984,0.007163562344710762,0.007287177540748126,0.007791321346658717,0.006400214326544125,0.006292607932231113,0.006495927884062445,0.008019139012027832,0.008645295822673016,0.009110178630272173,0.004156096369772291,0.004553502385506899,0.005675634389706005,0.006910928320784389,0.007679441109673161,0.0068701359038421,0.0036732205639060274,0.0031090743604374887,0.0021986244594133595,0.002001822959747652,0.0015828407468350214,0.001511944112699966,0.0034434101593351393,0.005010044082457851,0.005448385925780657,0.004135448777142583,0.0024576137250347774,0.0020447416308334533,0.001979308718072954,0.0020258556017119,0.0021273570208204884,0.0021566987709140334,0.0019766694546090196,0.0014244113759494705,0.0014208618642329,0.001965814485782734,0.002519311581164611,0.0028025191191502373,0.0028164507104181807,0.0026897755088383106,0.0026284910954133584,0.002128145810747754,0.002838445259236559,0.0031551405380710502];

export const dataset1_grad_itr10 = [3.3429061505964597e-06,2.3596837749496658e-05,0.0026742584961110204,0.004325399481146365,0.004963414520259823,0.004978186225776877,0.005133454838586731,0.004903581874637227,0.004968598549532458,0.0050171655901929315,0.005104819033743383,0.005268795238976863,0.005259575273273557,0.005255303691626667,0.005295695068108597,0.005244730652930822,0.005437088601745868,0.004636289068460105,0.004317408137999497,0.004104333454685517,0.004265786650717135,0.005428110358569303,0.006980713321044952,0.008475453315027769,0.008817416352312195,0.0061943162307087195,0.0030535649374839333,0.0027141030507645673,0.0027889598028842757,0.0027886894590182783,0.0027655747888221233,0.002908462958024747,0.003782437913138578,0.0048273186409708785,0.00577853384430197,0.005993379932348561,0.005617928530051984,0.0038851465480526067,0.0018970458717178517,0.002905588155328013,0.00290908775479436,0.0026159350124766536,0.0023061592048807533,0.0017689183047384684,0.0011024761805264634,0.000896801544624367,0.0007377291246337954,0.0007458195446877971,0.004169110204960357,0.004837835730532555,0.0047237834885458735,0.002777293248427631,0.0013773401844808762,0.0010134592816228886,0.0008210537248512265,0.0008736139385725466,0.0009201569610000041,0.0008665658203092076,0.0006360525443227125,0.00029480090977989455,0.0003163072734631676,0.0004874567251662945,0.0006046910920080809,0.0006719891916403382,0.0006337778337134944,0.0005904113443520757,0.0005734433808715384,0.0005553510299285575,0.00036012582239510887,0.0006467738472947158,0.0004367341355480175,0.001086747351828792,0.0008112694023136338,0.0009955340205082858,0.0005722136603429139,0.001312724747622301];

export const dataset2_grad = [2.168082950148411e-06,2.109782574842722e-05,0.001829896908704679,0.003477336205318621,0.004041868151166422,0.004248633865410467,0.003997280424621474,0.004042186510830719,0.004052228058868334,0.004059995856084771,0.0046223245183504,0.004298216881500203,0.004303222065715923,0.004254884428267513,0.004376624771812039,0.004424631158500936,0.004495059515038161,0.004565471459264704,0.004680312198544398,0.0042132688149486225,0.0043510964148108814,0.004545838779709189,0.004553096042452221,0.004528731239168218,0.0044219538260353575,0.004354727189051759,0.0045036939639939415,0.0045597458459167035,0.00462919208734782,0.003617476576121472,0.0034186620867181845,0.0030905512682700563,0.003620113992497739,0.004087935185974644,0.005604970854960153,0.0073696286140924406,0.00806452292490777,0.008808928684043132,0.008554208799499217,0.0071457079104170285,0.004716233341569769,0.0029673155246463918,0.0022458962757161095,0.0020871390702428662,0.002146720292401735,0.002021376435683924,0.0021270706845314203,0.002154224636922984,0.0020571295033683062,0.002218715063099167,0.0027099604119786764,0.0035824788266152784,0.004629147277462708,0.00517359168679868,0.005314354012201342,0.004189813711718967,0.0034007921200606655,0.0020930607659313673,0.001074126215966917,0.0014056103765841285,0.001997517986482355,0.0023357381486563233,0.0025068969752892333,0.002360290030180056,0.001979368951589262,0.0013616322717400135,0.0011853809225632768,0.0011149562019938945,0.0008181748913554098,0.0006027343559031273,0.0005081001698257194,0.00044931281129353506,0.004469735154226907,0.0048640836081120875,0.004077011119945504,0.002005344944580392,0.001027884270782558,0.0006010036936601104,0.0003158686523333011,0.0003936740880582079,0.000451190811220342,0.0003851363164925053,0.00020692581923631797,0.00015054978756962384,0.00015021587602584674,0.0002116187368242772,0.00018151717821958307,0.0002176246806381732,0.0001678014544574293,0.00014882860802709294,0.0001421665880521051,0.0001859839433113066,0.00024691506625639154,0.00025683387836460857,0.0002102049489266066,0.00020994030394466993,0.00020713406464284317,0.00023376229331125732,0.0002119035550836443,0.00022985751479547925,0.00025732207889500575,0.0002447112386074433,0.0002601932921140255,0.00030954035153581323,0.0003981463350717916,0.00038710167721402313,0.00037746661618869514,0.0003734813932485643,0.0003769342913470376,0.0002893130126623065,0.00041856716020174467,0.0012474175511333692];

<MultiDataGraph datasets={[ { data: dataset1_grad, label: "緩和前の経路の勾配のRMS値", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_grad_itr5, label: "ITR. 5の経路の勾配のRMS値", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_grad_itr10, label: "ITR. 10の経路の勾配のRMS値", color: "rgba(81, 143, 18, 1)"},  { data: dataset2_grad, label: "緩和後の経路の勾配のRMS値", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="RMS of gradient [hartree/Bohr]" height="500px" />

※`bias_force_rms.csv`にて、各Iterationごとのすべてのノードの勾配のRMS値を確認できる。

経路緩和の結果、以下の構造がstep3の初期構造として用いられることとなった。"work_dir"内の`bh9_2_71_step3_TS_Opt_Inputs`内に保存された`bh9_2_71_ts_guess_X.xyz`にて確認が可能である。ts_guessの番号が小さい順にエネルギー値が高い構造を示すようになっている。

※こちら[https://ss0832.github.io/molecule_viewer/] を使うことでも可視化は可能である。


`bh9_2_71_ts_guess_1.xyz`
```
43
0 1
C       0.855574117304     -0.705121475789      0.650523398551
C       1.223251022626      0.537193100287      0.109603068286
C      -1.029996897623     -0.378049109676      0.984329819715
N      -1.035842441249      0.894763797083      1.722053155437
N      -0.315529473977      1.863920588198      1.571934148980
C      -2.305043069906     -0.440481193637      0.202444034508
C      -3.385905531915      0.344011766731      0.628471094823
C      -2.452435850042     -1.218073227572     -0.938762140594
C      -4.579487941780      0.345185356816     -0.069112140570
H      -3.290628866906      0.947819128983      1.518296138464
C      -3.652472047865     -1.206263739054     -1.640334928590
H      -1.626697927644     -1.824066816677     -1.288327036850
C      -4.717307456788     -0.428311569965     -1.210632688675
H      -5.402104230875      0.953991310436      0.284353646870
H      -3.758285296800     -1.807214493300     -2.533038607472
H      -5.650690323691     -0.424924550732     -1.758680042283
C       0.743864702170      1.869381048643      0.532441033209
C       0.192460713264      2.721393194446     -0.631241457003
C       1.884831776140      2.684780205735      1.042299289723
C       0.491834199381      4.160675616726     -0.209425712498
H      -0.858797105276      2.510941387029     -0.827672538321
H       0.763687679945      2.457333844019     -1.524148378225
C       1.867525804265      4.059948402253      0.473796190354
H       2.570711052573      2.311915031441      1.786811678055
H      -0.258038168666      4.495667819306      0.506853282971
H       2.679279607691      4.194460706253     -0.252127156992
C      -0.604227868779     -1.372184616247      2.010284831545
C       1.528426954394     -1.927442777890      0.038552692602
C       2.111285177431     -1.900315806252     -1.229887340945
C       1.785760350746     -3.040779903701      0.843766855848
C       2.970734955818     -2.905579796359     -1.646340132520
H       1.944040109987     -1.073102468488     -1.904043145466
C       2.633184080215     -4.054183016475      0.418193509565
H       1.369414563511     -3.105245894133      1.836223644522
C       3.249655404014     -3.982486817724     -0.818302158551
H       3.448026284406     -2.830556883639     -2.614596543144
H       2.836719187415     -4.885849432171      1.080762026017
H       3.943881553981     -4.751696973391     -1.131241596061
O       0.729233649352     -0.983736262642      2.078989228201
O      -1.112720291693     -2.282585346676      2.571774326714
H       2.026068780133      4.817205261457      1.245728302106
H       0.483330346603      4.845828800687     -1.054975771528
H       1.703428718109      0.511835805658     -0.855595880775
```

<MoleculeViewer 
  xyzData={`43
0 1
C       0.855574117304     -0.705121475789      0.650523398551
C       1.223251022626      0.537193100287      0.109603068286
C      -1.029996897623     -0.378049109676      0.984329819715
N      -1.035842441249      0.894763797083      1.722053155437
N      -0.315529473977      1.863920588198      1.571934148980
C      -2.305043069906     -0.440481193637      0.202444034508
C      -3.385905531915      0.344011766731      0.628471094823
C      -2.452435850042     -1.218073227572     -0.938762140594
C      -4.579487941780      0.345185356816     -0.069112140570
H      -3.290628866906      0.947819128983      1.518296138464
C      -3.652472047865     -1.206263739054     -1.640334928590
H      -1.626697927644     -1.824066816677     -1.288327036850
C      -4.717307456788     -0.428311569965     -1.210632688675
H      -5.402104230875      0.953991310436      0.284353646870
H      -3.758285296800     -1.807214493300     -2.533038607472
H      -5.650690323691     -0.424924550732     -1.758680042283
C       0.743864702170      1.869381048643      0.532441033209
C       0.192460713264      2.721393194446     -0.631241457003
C       1.884831776140      2.684780205735      1.042299289723
C       0.491834199381      4.160675616726     -0.209425712498
H      -0.858797105276      2.510941387029     -0.827672538321
H       0.763687679945      2.457333844019     -1.524148378225
C       1.867525804265      4.059948402253      0.473796190354
H       2.570711052573      2.311915031441      1.786811678055
H      -0.258038168666      4.495667819306      0.506853282971
H       2.679279607691      4.194460706253     -0.252127156992
C      -0.604227868779     -1.372184616247      2.010284831545
C       1.528426954394     -1.927442777890      0.038552692602
C       2.111285177431     -1.900315806252     -1.229887340945
C       1.785760350746     -3.040779903701      0.843766855848
C       2.970734955818     -2.905579796359     -1.646340132520
H       1.944040109987     -1.073102468488     -1.904043145466
C       2.633184080215     -4.054183016475      0.418193509565
H       1.369414563511     -3.105245894133      1.836223644522
C       3.249655404014     -3.982486817724     -0.818302158551
H       3.448026284406     -2.830556883639     -2.614596543144
H       2.836719187415     -4.885849432171      1.080762026017
H       3.943881553981     -4.751696973391     -1.131241596061
O       0.729233649352     -0.983736262642      2.078989228201
O      -1.112720291693     -2.282585346676      2.571774326714
H       2.026068780133      4.817205261457      1.245728302106
H       0.483330346603      4.845828800687     -1.054975771528
H       1.703428718109      0.511835805658     -0.855595880775`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.1)"
  backgroundColor="#333333"
/>

`bh9_2_71_ts_guess_2.xyz`
```
43
0 1
C       1.253080149419     -0.863057450746      0.586045844307
C       1.369876590493      0.347630586810      0.038556785660
C      -1.389112957952     -0.252895218735      0.647850294036
N      -1.044529689086      0.817871300551      1.416046079668
N      -0.263012208825      1.676104897647      1.616767878235
C      -2.721635605578     -0.183618183314      0.075461341694
C      -3.696893268456      0.506818985892      0.781225929136
C      -3.028742454461     -0.784767429612     -1.141658821454
C      -4.989936852904      0.557831597457      0.299437038195
H      -3.443648637674      0.961859236004      1.726742430376
C      -4.325602309606     -0.722142470312     -1.622098404948
H      -2.260205642210     -1.294361611860     -1.709078088156
C      -5.310268495746     -0.061992632814     -0.899589985606
H      -5.748013460768      1.063937639292      0.880810835937
H      -4.573438272246     -1.195783487887     -2.562196686939
H      -6.327223945237     -0.036514622405     -1.265349409649
C       0.937645112403      1.737742275054      0.375168423722
C       0.166380184371      2.574382586656     -0.662231220931
C       2.010298961185      2.595175437676      0.802221028757
C       0.358316168690      4.004239403075     -0.143994370949
H      -0.876700637513      2.273529979964     -0.761205894726
H       0.641712252830      2.447425519602     -1.638784109975
C       1.805361260924      4.005852357750      0.368404595598
H       2.871135160044      2.233708442708      1.344584678831
H      -0.316793033436      4.179215572684      0.694466402435
H       2.502065636021      4.249463434295     -0.446042290370
C      -0.827089184143     -1.491817376349      1.150998801911
C       2.030045946447     -2.020682876320      0.119696821277
C       2.777983953112     -2.006998315959     -1.053825993894
C       2.153576463661     -3.114886816756      0.978602162048
C       3.694395516449     -3.009214375708     -1.312469931468
H       2.666017485093     -1.205096732146     -1.770346990841
C       3.068051389893     -4.119160136689      0.713575811189
H       1.553346773831     -3.161910296350      1.874380277549
C       3.862921448761     -4.057335059686     -0.417990302782
H       4.293411010642     -2.958401168443     -2.210726265402
H       3.170286109701     -4.936326326754      1.414719237660
H       4.604837262636     -4.820832179761     -0.606094267065
O       0.446177598018     -1.209845667393      1.664772021945
O      -1.315252055074     -2.581882198112      1.181185684860
H       1.994719902513      4.736602172786      1.157233574826
H       0.161089057687      4.766429154780     -0.895005554759
H       2.065367316090      0.353702053426     -0.790265389937
```

<MoleculeViewer 
  xyzData={`43
0 1
C       1.253080149419     -0.863057450746      0.586045844307
C       1.369876590493      0.347630586810      0.038556785660
C      -1.389112957952     -0.252895218735      0.647850294036
N      -1.044529689086      0.817871300551      1.416046079668
N      -0.263012208825      1.676104897647      1.616767878235
C      -2.721635605578     -0.183618183314      0.075461341694
C      -3.696893268456      0.506818985892      0.781225929136
C      -3.028742454461     -0.784767429612     -1.141658821454
C      -4.989936852904      0.557831597457      0.299437038195
H      -3.443648637674      0.961859236004      1.726742430376
C      -4.325602309606     -0.722142470312     -1.622098404948
H      -2.260205642210     -1.294361611860     -1.709078088156
C      -5.310268495746     -0.061992632814     -0.899589985606
H      -5.748013460768      1.063937639292      0.880810835937
H      -4.573438272246     -1.195783487887     -2.562196686939
H      -6.327223945237     -0.036514622405     -1.265349409649
C       0.937645112403      1.737742275054      0.375168423722
C       0.166380184371      2.574382586656     -0.662231220931
C       2.010298961185      2.595175437676      0.802221028757
C       0.358316168690      4.004239403075     -0.143994370949
H      -0.876700637513      2.273529979964     -0.761205894726
H       0.641712252830      2.447425519602     -1.638784109975
C       1.805361260924      4.005852357750      0.368404595598
H       2.871135160044      2.233708442708      1.344584678831
H      -0.316793033436      4.179215572684      0.694466402435
H       2.502065636021      4.249463434295     -0.446042290370
C      -0.827089184143     -1.491817376349      1.150998801911
C       2.030045946447     -2.020682876320      0.119696821277
C       2.777983953112     -2.006998315959     -1.053825993894
C       2.153576463661     -3.114886816756      0.978602162048
C       3.694395516449     -3.009214375708     -1.312469931468
H       2.666017485093     -1.205096732146     -1.770346990841
C       3.068051389893     -4.119160136689      0.713575811189
H       1.553346773831     -3.161910296350      1.874380277549
C       3.862921448761     -4.057335059686     -0.417990302782
H       4.293411010642     -2.958401168443     -2.210726265402
H       3.170286109701     -4.936326326754      1.414719237660
H       4.604837262636     -4.820832179761     -0.606094267065
O       0.446177598018     -1.209845667393      1.664772021945
O      -1.315252055074     -2.581882198112      1.181185684860
H       1.994719902513      4.736602172786      1.157233574826
H       0.161089057687      4.766429154780     -0.895005554759
H       2.065367316090      0.353702053426     -0.790265389937`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.2)"
  backgroundColor="#333333"
/>

`bh9_2_71_ts_guess_3.xyz`
```
43
0 1
C       1.352638554025     -0.757143425573      0.507235394605
C       1.688861912506      0.543868664774      0.329299314005
C      -1.532175876777      0.003433185622      0.083847448245
N      -1.058467930362      0.591229542377      1.204974103195
N      -0.355939035239      1.029122845977      1.957964170167
C      -2.961895566253     -0.079255518823     -0.199307230822
C      -3.937907853622      0.328229097174      0.702771762479
C      -3.334784862033     -0.775819811442     -1.348488938022
C      -5.267432141187      0.025508692275      0.456038131360
H      -3.671150948085      0.832946609614      1.623657966992
C      -4.658678075204     -1.090708347840     -1.571677223153
H      -2.575660072445     -1.115325919427     -2.033947803165
C      -5.634803813696     -0.696730963091     -0.670642879995
H      -6.021684611282      0.328842832531      1.168239535910
H      -4.911270611963     -1.669314512586     -2.449533652087
H      -6.668684131524     -0.960736666249     -0.842632601371
C       1.298803890652      2.013610123668      0.274421612406
C       0.082730244304      2.995564269932      0.199748232788
C       2.384188716430      2.769279381606      0.081137732966
C       0.710707031775      4.401544258142      0.248305039864
H      -0.650412197438      2.957912551145      0.997288691240
H      -0.460556755383      2.827882137084     -0.733752024335
C       2.135196362639      4.206607337965     -0.247874645858
H       3.378865200136      2.357241436389      0.007316704601
H       0.742765948410      4.743941103386      1.285156323235
H       2.196014292459      4.321700130788     -1.336512404621
C      -0.697172835857     -1.123142486424     -0.265481239404
C       2.298754779796     -1.883834640843      0.331220833368
C       3.204484521274     -2.029214263689     -0.704268711100
C       2.054045321119     -2.963175845965      1.181130778630
C       3.827322170373     -3.261031744414     -0.899920979349
H       3.383498979509     -1.226937206629     -1.408076158250
C       2.665917245787     -4.177987259384      0.985066541134
H       1.331212862416     -2.852591589560      1.975799575051
C       3.544240848646     -4.339183397075     -0.077958694323
H       4.506446982428     -3.389786772067     -1.731415923037
H       2.416441287574     -5.002696695731      1.638046230724
H       3.981604546426     -5.309063650176     -0.271433093066
O       0.139142679767     -1.342616787542      0.809369371598
O      -0.667666017978     -1.791603454619     -1.254744697804
H       2.857798131133      4.897210397928      0.186158253387
H       0.136924721089      5.137457390088     -0.317026169278
H       2.747736105655      0.524768970684      0.130501321091
```

<MoleculeViewer 
  xyzData={`43
0 1
C       1.352638554025     -0.757143425573      0.507235394605
C       1.688861912506      0.543868664774      0.329299314005
C      -1.532175876777      0.003433185622      0.083847448245
N      -1.058467930362      0.591229542377      1.204974103195
N      -0.355939035239      1.029122845977      1.957964170167
C      -2.961895566253     -0.079255518823     -0.199307230822
C      -3.937907853622      0.328229097174      0.702771762479
C      -3.334784862033     -0.775819811442     -1.348488938022
C      -5.267432141187      0.025508692275      0.456038131360
H      -3.671150948085      0.832946609614      1.623657966992
C      -4.658678075204     -1.090708347840     -1.571677223153
H      -2.575660072445     -1.115325919427     -2.033947803165
C      -5.634803813696     -0.696730963091     -0.670642879995
H      -6.021684611282      0.328842832531      1.168239535910
H      -4.911270611963     -1.669314512586     -2.449533652087
H      -6.668684131524     -0.960736666249     -0.842632601371
C       1.298803890652      2.013610123668      0.274421612406
C       0.082730244304      2.995564269932      0.199748232788
C       2.384188716430      2.769279381606      0.081137732966
C       0.710707031775      4.401544258142      0.248305039864
H      -0.650412197438      2.957912551145      0.997288691240
H      -0.460556755383      2.827882137084     -0.733752024335
C       2.135196362639      4.206607337965     -0.247874645858
H       3.378865200136      2.357241436389      0.007316704601
H       0.742765948410      4.743941103386      1.285156323235
H       2.196014292459      4.321700130788     -1.336512404621
C      -0.697172835857     -1.123142486424     -0.265481239404
C       2.298754779796     -1.883834640843      0.331220833368
C       3.204484521274     -2.029214263689     -0.704268711100
C       2.054045321119     -2.963175845965      1.181130778630
C       3.827322170373     -3.261031744414     -0.899920979349
H       3.383498979509     -1.226937206629     -1.408076158250
C       2.665917245787     -4.177987259384      0.985066541134
H       1.331212862416     -2.852591589560      1.975799575051
C       3.544240848646     -4.339183397075     -0.077958694323
H       4.506446982428     -3.389786772067     -1.731415923037
H       2.416441287574     -5.002696695731      1.638046230724
H       3.981604546426     -5.309063650176     -0.271433093066
O       0.139142679767     -1.342616787542      0.809369371598
O      -0.667666017978     -1.791603454619     -1.254744697804
H       2.857798131133      4.897210397928      0.186158253387
H       0.136924721089      5.137457390088     -0.317026169278
H       2.747736105655      0.524768970684      0.130501321091`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.3)"
  backgroundColor="#333333"
/>


#### Step 3

step3のオプションで、追加での説明を要するものを以下に示す。

- `"opt_method": ["rsirfo_block_bofill"]`は遷移状態構造の最適化向けのoptimizerを指定することを意味する。準ニュートン法であるRS-I-RFO法を使用する。今回は`-fc`で正確なHessianを計算するようにしているので、初期Hessianは正確なHessianを使用するようになっている。(Bofill法によるHessianの更新法を細かい点で変更している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `"saddle_order": 1`は一次の鞍点を求めることを指定する。（step3のデフォルトでは一次の鞍点を指定する。それ以外の値の指定は、プログラムの使用目的上想定していないので、行わないことを勧める。）
- `"calc_exact_hess": 5`は5回の反復回数当たり1回正確なHessianを計算することを指定する。
- `"frequency_analysis": true`は収束条件を満たした後に基準振動解析を行うことを示す。（自前で実装しているため、あくまで目安として使用することを推奨する。各振動モードを`vibration_animation`内のxyzファイルで可視化できる。）UMAモデルから算出されるHessianは数値微分により求めているため、原子数Zが多いとZの二乗オーダーで計算コストが急増する。
- `"tight_convergence_criteria": true`は収束条件を厳しくすることを示す。（Gaussianのtightと同等）
- `"max_trust_radius": D`は一回の反復計算ごとの計算されるステップ幅の最大値をDÅ以下にすることを示す。デフォルトでは、`"saddle_order": 1`を指定すると0.1Åが指定される。
- `"detect_negative_eigenvalues": true`は、初めの計算時(ITR. 0)に、任意の次数の鞍点(遷移状態構造等)を求める際に、正確なへシアンから算出した固有値に１つも負の固有値がない場合、計算を打ち切るオプションである。

実行して得られた正確な遷移状態構造と思われる構造を以下に示す。

(実行して得られた正確な遷移状態構造は計算開始時に、`MultiOptPy-v1.19.6/"work_dir"`ディレクトリ内に生成された新規ディレクトリ内の`bh9_2_71_ts_final_X.xyz`として保存されている。)

`bh9_2_71_ts_final_1.xyz`
```
43
OptimizedStructure
C      0.691156752172      0.092269742865      0.257419263966
C      1.001526594822      1.322597145057     -0.303044052215
C     -1.305186826567      0.106081297349      0.730008760202
N     -1.555394950614      1.375595496131      0.317915883706
N     -0.997660364402      2.228578750697     -0.223069841731
C     -2.197481222613     -0.968526724360      0.284110376866
C     -3.053063377038     -0.774154145416     -0.801828866871
C     -2.093572388121     -2.234946104631      0.856579562530
C     -3.786104903054     -1.832854105558     -1.306723996670
H     -3.147022322419      0.208542109164     -1.247681706635
C     -2.820393486550     -3.293666660730      0.336730621480
H     -1.440719953976     -2.397703004770      1.704900531149
C     -3.666624440726     -3.097625669303     -0.744459948257
H     -4.450628159943     -1.672360984517     -2.145648751973
H     -2.725851865619     -4.275664424591      0.781332534532
H     -4.235127630851     -3.925946710080     -1.146079275075
C      1.542789478609      2.505514299252      0.379117606078
C      1.837243926451      3.741330860499     -0.445315630847
C      1.868176523250      2.699087263589      1.660073798674
C      2.048996530543      4.834524482403      0.612666436497
H      1.026899536032      3.975240419635     -1.138402853267
H      2.738001254125      3.574645580429     -1.046323916751
C      2.432059987675      4.074143491140      1.894749088223
H      1.799509976542      1.957867887446      2.441760319999
H      1.106637510577      5.359715116858      0.776979345388
H      3.518907363079      4.018537299312      2.025148057506
C     -0.548679407971      0.005479272705      2.053855835165
C      0.851215548339     -1.201917209964     -0.440111229140
C      0.411233042425     -1.343858924391     -1.755661789177
C      1.391428003445     -2.302322524864      0.218317329246
C      0.515217127582     -2.563492597285     -2.400922756304
H     -0.040163623261     -0.501188568425     -2.266120348012
C      1.499171845415     -3.522419040143     -0.435632736694
H      1.729085870291     -2.201508443204      1.240966201665
C      1.060775571316     -3.659077350285     -1.742812327277
H      0.157913965239     -2.664211114423     -3.417704544656
H      1.926915113254     -4.370112898542      0.084242670512
H      1.137615098901     -4.613351249422     -2.247072120346
O      0.748565177947      0.001759835057      1.696205895715
O     -0.960903051836     -0.089750958616      3.163193379589
H      2.034839023444      4.543298103107      2.796958970984
H      2.791411510002      5.574748261884      0.316699419797
H      1.157285644085      1.307102698941     -1.375315197568
```

<MoleculeViewer 
  xyzData={`43
OptimizedStructure
C      0.691156752172      0.092269742865      0.257419263966
C      1.001526594822      1.322597145057     -0.303044052215
C     -1.305186826567      0.106081297349      0.730008760202
N     -1.555394950614      1.375595496131      0.317915883706
N     -0.997660364402      2.228578750697     -0.223069841731
C     -2.197481222613     -0.968526724360      0.284110376866
C     -3.053063377038     -0.774154145416     -0.801828866871
C     -2.093572388121     -2.234946104631      0.856579562530
C     -3.786104903054     -1.832854105558     -1.306723996670
H     -3.147022322419      0.208542109164     -1.247681706635
C     -2.820393486550     -3.293666660730      0.336730621480
H     -1.440719953976     -2.397703004770      1.704900531149
C     -3.666624440726     -3.097625669303     -0.744459948257
H     -4.450628159943     -1.672360984517     -2.145648751973
H     -2.725851865619     -4.275664424591      0.781332534532
H     -4.235127630851     -3.925946710080     -1.146079275075
C      1.542789478609      2.505514299252      0.379117606078
C      1.837243926451      3.741330860499     -0.445315630847
C      1.868176523250      2.699087263589      1.660073798674
C      2.048996530543      4.834524482403      0.612666436497
H      1.026899536032      3.975240419635     -1.138402853267
H      2.738001254125      3.574645580429     -1.046323916751
C      2.432059987675      4.074143491140      1.894749088223
H      1.799509976542      1.957867887446      2.441760319999
H      1.106637510577      5.359715116858      0.776979345388
H      3.518907363079      4.018537299312      2.025148057506
C     -0.548679407971      0.005479272705      2.053855835165
C      0.851215548339     -1.201917209964     -0.440111229140
C      0.411233042425     -1.343858924391     -1.755661789177
C      1.391428003445     -2.302322524864      0.218317329246
C      0.515217127582     -2.563492597285     -2.400922756304
H     -0.040163623261     -0.501188568425     -2.266120348012
C      1.499171845415     -3.522419040143     -0.435632736694
H      1.729085870291     -2.201508443204      1.240966201665
C      1.060775571316     -3.659077350285     -1.742812327277
H      0.157913965239     -2.664211114423     -3.417704544656
H      1.926915113254     -4.370112898542      0.084242670512
H      1.137615098901     -4.613351249422     -2.247072120346
O      0.748565177947      0.001759835057      1.696205895715
O     -0.960903051836     -0.089750958616      3.163193379589
H      2.034839023444      4.543298103107      2.796958970984
H      2.791411510002      5.574748261884      0.316699419797
H      1.157285644085      1.307102698941     -1.375315197568`}
  caption="遷移状態構造 (No.1)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                     -546.9243             27.2124             35.2540
Reduced mass [au]                  12.0119              5.3790              5.1885
Force const [Dyne/A]               -2.1170              0.0023              0.0038
Char temp [K]                       0.0000             39.1526             50.7227
Normal mode                   x         y         z            x         y         z            x         y         z     
       C                -0.14811   -0.01342    0.01074   -0.00649    0.01305    0.01139   -0.00444    0.00719    0.00561
       C                -0.11340    0.05043   -0.00604   -0.02242    0.01139    0.00030   -0.00694    0.00647    0.00318
       C                 0.12690   -0.02615   -0.05800   -0.00919   -0.01484    0.01947    0.00215    0.00715    0.01946
       N                -0.05839    0.04147    0.02035   -0.01021   -0.00602    0.04738   -0.00498    0.00606    0.02133
       N                 0.10417   -0.05135   -0.01552   -0.01816    0.00352    0.05437   -0.01174    0.00760    0.01676
       C                 0.03220   -0.00362   -0.00995   -0.01074   -0.00290   -0.00551    0.02106   -0.00194    0.00521
       C                 0.01281    0.00337    0.00310   -0.02545    0.03139    0.01207    0.06878   -0.02137   -0.03603
       C                 0.00798   -0.00108   -0.00218    0.00593   -0.02381   -0.05441    0.00860    0.00477    0.02194
       C                 0.00188    0.00557    0.00582   -0.02184    0.04437   -0.02051    0.10699   -0.03489   -0.06263
       H                 0.01892    0.00235    0.00116   -0.03950    0.04763    0.05091    0.08014   -0.02691   -0.05083
       C                -0.00104    0.00099    0.00342    0.00931   -0.00998   -0.08714    0.04767   -0.00914   -0.00466
       H                 0.01037   -0.00677   -0.00499    0.01778   -0.05063   -0.06883   -0.02975    0.02060    0.05442
       C                 0.00129    0.00432    0.00251   -0.00403    0.02381   -0.07075    0.09824   -0.02921   -0.04773
       H                -0.00178    0.00919    0.00937   -0.03296    0.07101   -0.00663    0.14579   -0.05084   -0.09643
       H                -0.00622    0.00158    0.00550    0.02306   -0.02628   -0.12605    0.03951   -0.00442    0.00751
       H                 0.00023    0.00533    0.00106   -0.00075    0.03404   -0.09651    0.13020   -0.04046   -0.06983
       C                 0.00931   -0.00666   -0.00006   -0.00278    0.01414   -0.01949   -0.00107    0.00631   -0.00177
       C                 0.00320   -0.00254    0.00025   -0.03513    0.01474   -0.02987   -0.01564    0.00946   -0.00233
       C                 0.00499   -0.00389    0.00018    0.04740    0.01178   -0.03230    0.01753    0.00302   -0.00598
       C                 0.00040   -0.00165    0.00035    0.00870    0.01299   -0.03674   -0.00321    0.00665   -0.00191
       H                -0.00082   -0.00623    0.00395   -0.06315    0.01647    0.00348   -0.02593    0.00970    0.00985
       H                 0.00245    0.00305   -0.00231   -0.05975    0.01493   -0.06687   -0.02361    0.01348   -0.01541
       C                 0.00192   -0.00144   -0.00021    0.05804    0.01095   -0.05253    0.01815    0.00352   -0.01017
       H                -0.00360    0.00124    0.00387    0.07643    0.00947   -0.03180    0.03094    0.00005   -0.00757
       H                -0.00041   -0.00302   -0.00041    0.01625    0.01465    0.00108   -0.00240    0.00320    0.01387
       H                 0.00192    0.00353    0.00112    0.06309    0.00955   -0.09524    0.02031    0.00539   -0.02723
       C                 0.00517   -0.00536    0.01824   -0.00112   -0.03875    0.01287    0.00919    0.00727    0.01504
       C                 0.00095    0.00024   -0.00078    0.00041    0.00693    0.02362   -0.02504    0.00585    0.00337
       C                 0.00277   -0.00058   -0.00166   -0.01261   -0.01501    0.03033   -0.03477    0.01390    0.00558
       C                 0.00148    0.00373    0.00026    0.01954    0.02115    0.03193   -0.05089   -0.00689    0.00318
       C                 0.00174   -0.00001   -0.00102   -0.00841   -0.02280    0.04591   -0.07459    0.00843    0.00971
       H                -0.00261   -0.00259   -0.00108   -0.02753   -0.02667    0.02430   -0.01444    0.02429    0.00491
       C                 0.00241    0.00188   -0.00074    0.02365    0.01317    0.04734   -0.08948   -0.01229    0.00683
       H                -0.00733    0.00084    0.00340    0.03043    0.03800    0.02668   -0.04356   -0.01366    0.00141
       C                 0.00127    0.00020    0.00076    0.00936   -0.00890    0.05454   -0.10316   -0.00517    0.01076
       H                 0.00088   -0.00071   -0.00058   -0.01956   -0.04009    0.05154   -0.08421    0.01500    0.01241
       H                 0.00114    0.00207    0.00061    0.03819    0.02453    0.05392   -0.11062   -0.02261    0.00740
       H                -0.00063   -0.00078    0.00228    0.01219   -0.01508    0.06667   -0.13533   -0.00969    0.01439
       O                 0.00723   -0.00007    0.01249   -0.00094    0.02515    0.01127    0.00679    0.00517    0.00549
       O                -0.01223    0.00378    0.00794    0.00397   -0.10205    0.00934    0.01719    0.00987    0.01829
       H                -0.00189   -0.00373   -0.00071    0.09403    0.01064   -0.03651    0.03116   -0.00012   -0.00255
       H                -0.00038   -0.00099   -0.00037   -0.00157    0.01192   -0.06517   -0.00987    0.00992   -0.01049
       H                -0.04481    0.02223    0.00350   -0.04390    0.00518   -0.00301   -0.01721    0.00683    0.00170
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。

`bh9_2_71_ts_final_2.xyz`
```
43
OptimizedStructure
C      1.611625161828     -0.826986748164      0.435026697421
C      1.924879044991      0.422806606601      0.103475192144
C     -1.581711814742      0.017365027716      0.627263559129
N     -1.091385465144      1.144039635613      0.982390147174
N      0.109802955063      1.365511131283      1.439540304738
C     -3.011298742929     -0.038146661531      0.229969184183
C     -3.911558224888      0.794790713554      0.893523525698
C     -3.473829087614     -0.858349102720     -0.797136800215
C     -5.249006962890      0.811549205948      0.536139626385
H     -3.552151281042      1.425473327856      1.695763326709
C     -4.814042464779     -0.833357425285     -1.154717221516
H     -2.790983718454     -1.513788551806     -1.315220345906
C     -5.704137044037     -0.003018712319     -0.491250828747
H     -5.937793182592      1.457964766884      1.064106815845
H     -5.161618540474     -1.469703529737     -1.958062733384
H     -6.749640499353      0.007330994448     -0.770763075396
C      1.130776687848      1.664881261841      0.408804008322
C      0.567797750743      2.328539396420     -0.866175919495
C      1.896060086763      2.794539607408      1.034183082175
C      0.291166734788      3.769327075356     -0.437294166481
H     -0.301431870722      1.808254615602     -1.265200028102
H      1.352534455468      2.300092054190     -1.626675045438
C      1.471239056511      4.109599923577      0.488896189375
H      2.498251445761      2.649429837035      1.919441836278
H     -0.642920271271      3.804700497751      0.124827891781
H      2.292553611251      4.567478759517     -0.080668143565
C     -0.711660594294     -1.215182132549      0.565781001339
C      2.393156194883     -2.036479193253      0.105294470857
C      3.259153388847     -2.061046935707     -0.987210329253
C      2.271376069820     -3.175702469201      0.896756245638
C      4.005450403272     -3.193416253119     -1.266621890764
H      3.332698850159     -1.199934139793     -1.638708874668
C      3.020497915271     -4.307237133829      0.615552487927
H      1.584287414166     -3.170647870663      1.730906868315
C      3.891539399494     -4.319538620799     -0.463265600041
H      4.667670723750     -3.201139335891     -2.122519769458
H      2.918196370303     -5.184546653240      1.240715772793
H      4.470614233669     -5.206286568665     -0.685486540838
O      0.479956621792     -1.064768603202      1.226405806712
O     -1.016679117710     -2.230344425516      0.019030511876
H      1.213995033934      4.829591217659      1.269900947892
H      0.201197985591      4.449728683323     -1.282303192027
H      2.845371286970      0.586626727407     -0.444414995411
```

<MoleculeViewer 
  xyzData={`43
OptimizedStructure
C      1.611625161828     -0.826986748164      0.435026697421
C      1.924879044991      0.422806606601      0.103475192144
C     -1.581711814742      0.017365027716      0.627263559129
N     -1.091385465144      1.144039635613      0.982390147174
N      0.109802955063      1.365511131283      1.439540304738
C     -3.011298742929     -0.038146661531      0.229969184183
C     -3.911558224888      0.794790713554      0.893523525698
C     -3.473829087614     -0.858349102720     -0.797136800215
C     -5.249006962890      0.811549205948      0.536139626385
H     -3.552151281042      1.425473327856      1.695763326709
C     -4.814042464779     -0.833357425285     -1.154717221516
H     -2.790983718454     -1.513788551806     -1.315220345906
C     -5.704137044037     -0.003018712319     -0.491250828747
H     -5.937793182592      1.457964766884      1.064106815845
H     -5.161618540474     -1.469703529737     -1.958062733384
H     -6.749640499353      0.007330994448     -0.770763075396
C      1.130776687848      1.664881261841      0.408804008322
C      0.567797750743      2.328539396420     -0.866175919495
C      1.896060086763      2.794539607408      1.034183082175
C      0.291166734788      3.769327075356     -0.437294166481
H     -0.301431870722      1.808254615602     -1.265200028102
H      1.352534455468      2.300092054190     -1.626675045438
C      1.471239056511      4.109599923577      0.488896189375
H      2.498251445761      2.649429837035      1.919441836278
H     -0.642920271271      3.804700497751      0.124827891781
H      2.292553611251      4.567478759517     -0.080668143565
C     -0.711660594294     -1.215182132549      0.565781001339
C      2.393156194883     -2.036479193253      0.105294470857
C      3.259153388847     -2.061046935707     -0.987210329253
C      2.271376069820     -3.175702469201      0.896756245638
C      4.005450403272     -3.193416253119     -1.266621890764
H      3.332698850159     -1.199934139793     -1.638708874668
C      3.020497915271     -4.307237133829      0.615552487927
H      1.584287414166     -3.170647870663      1.730906868315
C      3.891539399494     -4.319538620799     -0.463265600041
H      4.667670723750     -3.201139335891     -2.122519769458
H      2.918196370303     -5.184546653240      1.240715772793
H      4.470614233669     -5.206286568665     -0.685486540838
O      0.479956621792     -1.064768603202      1.226405806712
O     -1.016679117710     -2.230344425516      0.019030511876
H      1.213995033934      4.829591217659      1.269900947892
H      0.201197985591      4.449728683323     -1.282303192027
H      2.845371286970      0.586626727407     -0.444414995411`}
  caption="遷移状態構造 (No.2)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                      -27.8495             33.3323             37.0076
Reduced mass [au]                   7.9180              3.8138              3.9056
Force const [Dyne/A]               -0.0036              0.0025              0.0032
Char temp [K]                       0.0000             47.9577             53.2457
Normal mode                   x         y         z            x         y         z            x         y         z     
       C                 0.01271   -0.01015    0.00160   -0.00671   -0.00931    0.00446   -0.00206   -0.00331   -0.00915
       C                 0.01777   -0.00770    0.01594   -0.00385   -0.00985    0.00626   -0.00303   -0.00184   -0.00471
       C                -0.00492    0.00588   -0.00787   -0.00402   -0.00435   -0.00064   -0.00866   -0.01498   -0.01394
       N                -0.00455   -0.00313    0.02221   -0.00280   -0.00776    0.00873   -0.00473   -0.01524   -0.01705
       N                 0.00490   -0.01616    0.00610   -0.00213   -0.01151    0.00855   -0.00947   -0.01296   -0.00865
       C                -0.00995    0.01215    0.00904   -0.00326    0.00294   -0.00451   -0.01227   -0.00696   -0.00613
       C                -0.00163   -0.00049    0.03682   -0.00130    0.00394   -0.00289    0.01877    0.08209   -0.07311
       C                -0.02417    0.03118   -0.00007   -0.00400    0.01173   -0.01122   -0.05114   -0.08407    0.07245
       C                -0.00626    0.00607    0.05504    0.00037    0.01423   -0.00839    0.01705    0.09656   -0.06342
       H                 0.00888   -0.01563    0.04397   -0.00089   -0.00296    0.00234    0.04487    0.14058   -0.13111
       C                -0.02931    0.03751    0.01902   -0.00244    0.02214   -0.01669   -0.05478   -0.07254    0.08461
       H                -0.03108    0.04208   -0.02238   -0.00562    0.01115   -0.01254   -0.07951   -0.15259    0.12312
       C                -0.02040    0.02510    0.04604   -0.00020    0.02362   -0.01565   -0.02094    0.01812    0.01527
       H                 0.00093   -0.00375    0.07644    0.00207    0.01512   -0.00725    0.04443    0.16824   -0.11543
       H                -0.03983    0.05231    0.01183   -0.00283    0.02923   -0.02214   -0.08306   -0.13533    0.14656
       H                -0.02417    0.03041    0.06033    0.00112    0.03198   -0.02031   -0.02317    0.02793    0.02397
       C                -0.00144   -0.01565    0.00024   -0.00282   -0.00958    0.00784   -0.00149   -0.00274    0.00283
       C                -0.00767   -0.03675   -0.00757   -0.00357   -0.00656    0.00988    0.00737    0.01524    0.00855
       C                -0.02435    0.00252   -0.00481   -0.00200   -0.01132    0.00969    0.00144   -0.01398    0.02009
       C                -0.02948   -0.03569   -0.02439   -0.00291   -0.00749    0.01345    0.01091    0.01077    0.02634
       H                 0.00090   -0.05308   -0.00517   -0.00400   -0.00525    0.00907    0.00675    0.02352   -0.00103
       H                -0.00536   -0.03429   -0.00522   -0.00401   -0.00494    0.00933    0.01026    0.02207    0.01130
       C                -0.03936   -0.00933   -0.02140   -0.00185   -0.00981    0.01296    0.00808   -0.00535    0.03590
       H                -0.03100    0.01989    0.00255   -0.00024   -0.01380    0.00808   -0.00258   -0.02786    0.02056
       H                -0.03307   -0.04173   -0.03004   -0.00234   -0.00858    0.01449    0.00869    0.00651    0.02297
       H                -0.04214   -0.00506   -0.02202   -0.00235   -0.00896    0.01294    0.01186   -0.00003    0.04566
       C                 0.00844    0.01848   -0.07197   -0.00285   -0.00307   -0.01423   -0.00159   -0.01061   -0.01917
       C                 0.01934   -0.00872    0.01578   -0.00241   -0.00549    0.00433    0.00498    0.00052   -0.00638
       C                 0.04140   -0.00553    0.03334   -0.09058   -0.03584   -0.06363    0.01265    0.00654   -0.00050
       C                 0.00071   -0.01153    0.00866    0.09340    0.03348    0.07530    0.00775   -0.00020   -0.00709
       C                 0.04395   -0.00627    0.04314   -0.07883   -0.02897   -0.06372    0.02337    0.01222    0.00529
       H                 0.05584   -0.00274    0.03866   -0.17335   -0.06630   -0.11371    0.01092    0.00690   -0.00018
       C                 0.00361   -0.01207    0.01885    0.10683    0.04254    0.07723    0.01850    0.00543   -0.00132
       H                -0.01606   -0.01328   -0.00499    0.15878    0.05875    0.12964    0.00216   -0.00491   -0.01162
       C                 0.02483   -0.00950    0.03585    0.02064    0.01197    0.00696    0.02658    0.01178    0.00515
       H                 0.06082   -0.00437    0.05618   -0.14889   -0.05604   -0.11769    0.02957    0.01700    0.01004
       H                -0.01076   -0.01458    0.01298    0.18568    0.07288    0.13276    0.02091    0.00494   -0.00161
       H                 0.02672   -0.01013    0.04331    0.02983    0.01761    0.00833    0.03536    0.01631    0.00997
       O                -0.01143   -0.00938   -0.03172   -0.00921   -0.01268    0.00037   -0.00496   -0.00675   -0.01400
       O                 0.03934    0.05568   -0.15876    0.00604    0.00837   -0.04019    0.01249   -0.00823   -0.03182
       H                -0.05353   -0.00397   -0.03109   -0.00095   -0.01138    0.01470    0.00700   -0.01510    0.04457
       H                -0.03378   -0.04629   -0.03250   -0.00366   -0.00555    0.01507    0.01654    0.02225    0.03501
       H                 0.03092    0.00013    0.04041   -0.00050   -0.01381    0.01007   -0.00114    0.00104   -0.00062
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。

`bh9_2_71_ts_final_3.xyz`
```
43
OptimizedStructure
C      1.589075279118     -0.963277019482     -0.204154000677
C      1.896389283184      0.327021070421     -0.012023133547
C     -1.691232246998     -0.817636762798      0.042769330415
N     -1.269076330091     -1.312167812665      1.192404571960
N     -0.937916504416     -1.718410987835      2.177704191388
C     -3.030816248456     -0.204290119156      0.019793439698
C     -3.710720647701      0.056622156691      1.211364069598
C     -3.634380168310      0.134360412071     -1.192070183106
C     -4.969098399070      0.634209853794      1.191816585618
H     -3.259751470927     -0.183085419152      2.166891222819
C     -4.891825163722      0.718229453342     -1.199261060271
H     -3.114824872040     -0.054379635236     -2.118779772156
C     -5.566618465249      0.969307663928     -0.014121815638
H     -5.480402445667      0.827873629916      2.125731409389
H     -5.347489059836      0.975844268386     -2.146572494386
H     -6.548313791532      1.423614829750     -0.029154605641
C      1.309682172478      1.649321621952     -0.239695353376
C     -0.060804951015      2.054508154055     -0.746859266561
C      2.060789330129      2.740122451782     -0.042266902230
C     -0.114676107606      3.565182439129     -0.463368713409
H     -0.878602347463      1.536786671201     -0.249509173520
H     -0.146812263240      1.834339600844     -1.812983700214
C      1.352082347851      4.015818275961     -0.388260979461
H      3.095266709188      2.707175168202      0.278093752107
H     -0.588739737520      3.730764003937      0.506002411832
H      1.710145004849      4.397797728993     -1.351105200433
C     -0.722183239680     -0.881406764302     -1.035833800066
C      2.557294711099     -2.041066577099      0.129070527730
C      3.926183592820     -1.860494656266     -0.057759952759
C      2.105825438369     -3.259857388992      0.633011275517
C      4.823717693274     -2.860108360167      0.283059556798
H      4.289551839465     -0.940937191757     -0.497401868849
C      3.004104729475     -4.257751943357      0.975685000734
H      1.044836549898     -3.427154368045      0.758595785138
C      4.366859082452     -4.060622825292      0.806624786645
H      5.883000472368     -2.704788833357      0.124309008747
H      2.636526670800     -5.194074995497      1.375201494868
H      5.067511537616     -4.842320507536      1.069389365393
O      0.427184827154     -1.550057678706     -0.666203124678
O     -0.888125292640     -0.500906816963     -2.158055837961
H      1.514968385883      4.809070835863      0.343541033364
H     -0.693854652959      4.108735010965     -1.208718775981
H      2.885268748668      0.418091362476      0.423100895164
```

<MoleculeViewer 
  xyzData={`43
OptimizedStructure
C      1.589075279118     -0.963277019482     -0.204154000677
C      1.896389283184      0.327021070421     -0.012023133547
C     -1.691232246998     -0.817636762798      0.042769330415
N     -1.269076330091     -1.312167812665      1.192404571960
N     -0.937916504416     -1.718410987835      2.177704191388
C     -3.030816248456     -0.204290119156      0.019793439698
C     -3.710720647701      0.056622156691      1.211364069598
C     -3.634380168310      0.134360412071     -1.192070183106
C     -4.969098399070      0.634209853794      1.191816585618
H     -3.259751470927     -0.183085419152      2.166891222819
C     -4.891825163722      0.718229453342     -1.199261060271
H     -3.114824872040     -0.054379635236     -2.118779772156
C     -5.566618465249      0.969307663928     -0.014121815638
H     -5.480402445667      0.827873629916      2.125731409389
H     -5.347489059836      0.975844268386     -2.146572494386
H     -6.548313791532      1.423614829750     -0.029154605641
C      1.309682172478      1.649321621952     -0.239695353376
C     -0.060804951015      2.054508154055     -0.746859266561
C      2.060789330129      2.740122451782     -0.042266902230
C     -0.114676107606      3.565182439129     -0.463368713409
H     -0.878602347463      1.536786671201     -0.249509173520
H     -0.146812263240      1.834339600844     -1.812983700214
C      1.352082347851      4.015818275961     -0.388260979461
H      3.095266709188      2.707175168202      0.278093752107
H     -0.588739737520      3.730764003937      0.506002411832
H      1.710145004849      4.397797728993     -1.351105200433
C     -0.722183239680     -0.881406764302     -1.035833800066
C      2.557294711099     -2.041066577099      0.129070527730
C      3.926183592820     -1.860494656266     -0.057759952759
C      2.105825438369     -3.259857388992      0.633011275517
C      4.823717693274     -2.860108360167      0.283059556798
H      4.289551839465     -0.940937191757     -0.497401868849
C      3.004104729475     -4.257751943357      0.975685000734
H      1.044836549898     -3.427154368045      0.758595785138
C      4.366859082452     -4.060622825292      0.806624786645
H      5.883000472368     -2.704788833357      0.124309008747
H      2.636526670800     -5.194074995497      1.375201494868
H      5.067511537616     -4.842320507536      1.069389365393
O      0.427184827154     -1.550057678706     -0.666203124678
O     -0.888125292640     -0.500906816963     -2.158055837961
H      1.514968385883      4.809070835863      0.343541033364
H     -0.693854652959      4.108735010965     -1.208718775981
H      2.885268748668      0.418091362476      0.423100895164`}
  caption="遷移状態構造 (No.3)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                      -51.4725             16.8700             24.7442
Reduced mass [au]                   5.3731              3.7687              5.7584
Force const [Dyne/A]               -0.0084              0.0006              0.0021
Char temp [K]                       0.0000             24.2722             35.6014
Normal mode                   x         y         z            x         y         z            x         y         z     
       C                -0.01979    0.00091    0.00792    0.00074    0.00308   -0.00312    0.00814    0.01690   -0.00284
       C                -0.03807   -0.00168    0.05552    0.00372    0.00353   -0.01106    0.02478    0.01232    0.00004
       C                 0.03176    0.01221   -0.01856    0.00118    0.00420   -0.00076    0.00630    0.03092    0.00524
       N                 0.05169    0.00920   -0.02815    0.00401   -0.00331   -0.00465    0.01904    0.04514    0.00659
       N                 0.06818    0.00623   -0.03460    0.00508   -0.00899   -0.00748    0.03124    0.05903    0.00831
       C                 0.02719    0.00609    0.00376   -0.00178   -0.00191    0.00657   -0.01098   -0.00716    0.00266
       C                 0.04468    0.00206    0.01467   -0.04791   -0.11633    0.00588   -0.01560   -0.01532    0.00173
       C                 0.00374    0.00145    0.01377    0.03954    0.10792    0.01621   -0.02800   -0.04591    0.00035
       C                 0.04023   -0.00650    0.03509   -0.04938   -0.11978    0.01369   -0.03777   -0.06367   -0.00135
       H                 0.06176    0.00543    0.00750   -0.08536   -0.20568    0.00094   -0.00274    0.01442    0.00315
       C                -0.00022   -0.00683    0.03426    0.03659    0.10207    0.02525   -0.05035   -0.09420   -0.00293
       H                -0.01168    0.00380    0.00500    0.07243    0.19412    0.01730   -0.02450   -0.03924    0.00092
       C                 0.01765   -0.01073    0.04508   -0.00784   -0.01044    0.02348   -0.05564   -0.10426   -0.00376
       H                 0.05445   -0.00986    0.04358   -0.08422   -0.21019    0.01337   -0.04155   -0.07011   -0.00209
       H                -0.01733   -0.01068    0.04144    0.06998    0.18721    0.03231   -0.06400   -0.12490   -0.00471
       H                 0.01432   -0.01737    0.06136   -0.00959   -0.01404    0.03010   -0.07349   -0.14292   -0.00632
       C                -0.02287   -0.00030    0.02415    0.00728    0.00345   -0.02062    0.03921    0.01821   -0.00096
       C                 0.00679    0.00103   -0.05486    0.00490    0.00349   -0.01412    0.03701    0.03055    0.01494
       C                -0.02975   -0.00210    0.05985    0.01208    0.00279   -0.03541    0.05369    0.01070   -0.01514
       C                -0.00294    0.00310   -0.06681    0.01137    0.00569   -0.02496    0.05687    0.03203    0.01107
       H                -0.02275    0.00890   -0.09612    0.00711    0.00893   -0.00449    0.03805    0.03892    0.02645
       H                 0.06391   -0.00643   -0.05828   -0.00275   -0.00344   -0.01205    0.02146    0.02903    0.01656
       C                -0.00560   -0.00169    0.01168    0.01337    0.00187   -0.04163    0.06288    0.01661   -0.01237
       H                -0.04760   -0.00422    0.11729    0.01408    0.00247   -0.04192    0.05714    0.00088   -0.02736
       H                -0.05560    0.00956   -0.09367    0.02071    0.01425   -0.02187    0.07346    0.04020    0.01779
       H                 0.04935   -0.00975    0.02891    0.00634   -0.00849   -0.04836    0.05310    0.00719   -0.01975
       C                -0.00033   -0.00128   -0.04703    0.00022    0.00391   -0.00202    0.00222    0.03865    0.00128
       C                -0.02358    0.00173    0.02115   -0.00273    0.00255    0.00542   -0.00859    0.00200   -0.00204
       C                -0.02080    0.01407    0.05439   -0.00153   -0.00118    0.01034   -0.00481   -0.01703    0.00754
       C                -0.02816   -0.01001   -0.01224   -0.00713    0.00575    0.00926   -0.02942    0.00593   -0.01101
       C                -0.02201    0.01270    0.05432   -0.00495   -0.00116    0.01928   -0.02164   -0.03203    0.00794
       H                -0.01860    0.02524    0.07945    0.00234   -0.00419    0.00725    0.01164   -0.02018    0.01455
       C                -0.02963   -0.01066   -0.01044   -0.01055    0.00574    0.01821   -0.04627   -0.00903   -0.01058
       H                -0.03043   -0.01919   -0.04147   -0.00793    0.00799    0.00520   -0.03258    0.02058   -0.01869
       C                -0.02694    0.00064    0.02203   -0.00946    0.00233    0.02339   -0.04239   -0.02813   -0.00118
       H                -0.01950    0.02129    0.07957   -0.00397   -0.00396    0.02308   -0.01837   -0.04673    0.01534
       H                -0.03230   -0.02044   -0.03587   -0.01417    0.00840    0.02112   -0.06257   -0.00571   -0.01780
       H                -0.02832   -0.00058    0.02213   -0.01207    0.00237    0.03045   -0.05541   -0.03975   -0.00102
       O                 0.02004    0.00474   -0.09651    0.00002    0.00344   -0.00204    0.00232    0.03373   -0.00840
       O                -0.04400   -0.01972   -0.04682    0.00094    0.00228   -0.00274   -0.00349    0.04441    0.00407
       H                -0.04333    0.00280    0.01521    0.02207    0.00829   -0.05055    0.08191    0.01900   -0.01922
       H                 0.03981    0.00130   -0.10131    0.00617    0.00172   -0.02385    0.05154    0.03583    0.01800
       H                -0.06680   -0.00661    0.12229    0.00354    0.00405   -0.01079    0.02525    0.00014    0.00147
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。


次に、`vibration_animation`内の虚振動を示す分子振動が示されたxyzファイル(`mode_1_XXXi_wave_number.xyz`)をAvogadroで確認すると、求められた遷移状態構造の中に、想定される反応系と生成系をつなぐ方向に振動している構造が存在することを確認できた。


## 終わりに
　
　自作ライブラリで、UMAモデルのニューラルネットワークポテンシャル(NNP, `uma-s-1p1`)を用いて、BH9データセットの2. Pericyclic, No. 71の反応のある1つの遷移状態構造を算出する手順を説明した。



## 参考
- https://github.com/ss0832/MultiOptPy (自作ライブラリMultiOptPyのレポジトリ)
- https://avogadro.cc/ (Avogadro、分子構造可視化ツール)
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)
- _The Journal of Chemical Physics_ 2010, 132, 241102.
- _The Journal of Chemical Physics_ 1991, 94, 751–760.
- In _Classical and Quantum Dynamics in Condensed Phase Simulations_; WORLD SCIENTIFIC: LERICI, Villa Marigola, 1998; pp 385–404.
- _The Journal of Chemical Physics_, 2020, 153, 024109.
- _The Journal of Chemical Physics_, 2022, 144, 214108.
- _J. Phys. Chem. A_ 2019, 123, 3761−3781 http://dx.doi.org/10.1021/acs.jpca.9b01546 (MOBH35のデータセットについて)


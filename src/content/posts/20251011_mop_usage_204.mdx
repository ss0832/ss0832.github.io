---
title:  【計算化学】自作pythonライブラリで遷移状態構造を求めてみる(MOBH35データセットのNo. 24の素過程, NNP使用)
published: 2025-10-11
description: ""
tags: [MultiOptPy, python]
category: Computational Chemistry
draft: false
---
最終更新：2025-10-11

import MoleculeViewer from '../../components/MoleculeViewer.astro';
import MultiDataGraph from '../../components/MultiDataGraph.astro';

## 概要

本記事では、自作ライブラリ(MultiOptPy)で、MOBH35データセットのNo. 24の素過程の遷移状態構造を算出してみる。計算レベルは、Meta社のFAIR Chemistryが開発したニューラルネットワークポテンシャル(NNP)であるUMA(Meta’s Universal Model for Atoms)とした。

MultiOptPyは電子状態計算ソフトウェアを用いた分子構造最適化手法の勉強を目的として作成したpythonライブラリである。

MultiOptPyのレポジトリ:https://github.com/ss0832/MultiOptPy

MOBH35のデータセットについて:
- _J. Phys. Chem. A_ 2019, 123, 3761−3781 http://dx.doi.org/10.1021/acs.jpca.9b01546

この文献のSupporting Informationから、データセットの詳細を確認できる。

有機金属錯体が関わる化学反応の活性化障壁及び反応熱の値のDFTの汎関数のエネルギーの精度の比較のベンチマークに使用される。

今回使用したニューラルネットワークポテンシャルについて：
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)



## 使用した自作ライブラリMultiOptPyのバージョン
```
v1.18c
```
## 環境
```
Windows 11
```
※Windows 11環境下でAnaconda PowerShell Promptを使用した。

## Source codeのダウンロード(Unixコマンド)
```
wget https://github.com/ss0832/MultiOptPy/archive/refs/tags/v1.18c.zip
unzip v1.18c.zip
cd MultiOptPy-v1.18c
```
https://github.com/ss0832/MultiOptPy/releases/tag/v1.18c にアクセスしてzipファイルをダウンロードする。Unixコマンドの場合とはディレクトリ名が異なるので都度読み替えていただけると良い。


### 環境構築手順

今回は、Windows 11のPower Shellを使用した。初めに、NNPを使用できる環境が整ったAnaconda PowerShell Promptを用意する手順を説明する。

1, https://repo.anaconda.com/archive/ より、`Anaconda3-2025.06-1-Windows-x86_64.exe`でAnacondaをインストールする。

2, 検索機能を使い、スタートから`Anaconda PowerShell Prompt`を開く。

3, 以下のコマンドを実行し、仮想環境を作成する。
```
conda create -n (任意の仮想環境名) python=3.12.7
```

4, 先ほど作成した仮想環境を`conda activate (仮想環境名)`で起動させる。

5, 以下のコマンドを実行し、必要なライブラリを導入する。
```
pip install ase==3.26.0 fairchem-core==2.7.1 torch==2.6.0
```
- fairchem-coreは、FAIR Chemistryが管理しているNNPを動作させるために必要なライブラリである。
- aseはNNPに電子エネルギーを算出したい分子構造を渡すために必要なインターフェイスの役割を果たすために必要なライブラリである。
- torchはPyTorchライブラリを指す。これはニューラルネットワークなどの機械学習を行ったり、学習結果を扱ったりするために必須なライブラリである。

これで、`Anaconda PowerShell Prompt`から仮想環境を立ち上げることで、NNPを使用する準備が整えることが出来る。

次に、NNPを使用するために必要なModelの情報が保存されている`.pt`ファイルのダウンロードおよびNNPの自作ライブラリへの導入方法について説明する。


1, 以下のサイトにアクセスして、`uma-s-1p1.pt`をダウンロードする。（使用許諾が下りていれば可能である。）
```
https://huggingface.co/facebook/UMA
```

2, ダウンロード後、`MultiOptPy-v1.18c`ディレクトリ内に存在する`software_path.conf`に対して、`uma-s-1p1.pt`の絶対パスを用いて以下を追記する。
```
uma-s-1p1::(uma-s-1p1.ptの絶対パス)
```

これで、`MultiOptPy-v1.18c`がNNP`uma-s-1p1`を使用できるようになる。


### 使用するNNPに関する具体的な説明

今回使用するNNPについて具体的に説明する。

- UMAのModel Checkpointは`uma-s-1p1`を使用した。
- 小分子系のトレーニングセットである`Omol25`(`omol`)を使用して学習したニューラルネットワークポテンシャルを使用する。

※自作ライブラリでの具体的な使用の仕方に関しては、`ase_calculation_tools.py` を参照


## 手順

### 1. 初期構造の準備

モデル反応系として、以下の構造を用意した。今回はファイルの名前を`mobh35_24_Re.xyz`とした。
初期構造は以下のものを使用した。

```
86
OptimizedStructure
C      1.170250334708     -0.219922999664      2.164461964766
C     -1.038843764027     -1.093688673994      2.282968050686
C      1.326986166920     -0.234336623684      3.523993673954
C     -0.861879156093     -1.208401960295      3.707891510629
C      0.276507994000     -0.777625331742      4.302946590286
H      2.243018514165      0.121886214793      3.973070713895
H     -1.677845597029     -1.617924191873      4.288634826175
H      0.385174563846     -0.849191628619      5.378608998355
N      0.049760121862     -0.662409010959      1.538867689956
P      2.294686739387     -0.820980113674     -0.222300255306
P     -2.467772700393     -0.810594776036      0.012835040184
C      2.286152337563      0.261447584056      1.266158678582
H      2.063794515548      1.272457768866      0.923900488337
H      3.231661423309      0.290882587301      1.804763147591
C     -0.258667392294     -0.546995315242     -2.573463392058
O     -0.357101967743     -0.399862283417     -3.718193618793
C     -2.244718243777     -1.367772936867      1.669786114846
H     -3.082019470200     -1.637326564665      2.301842286409
C     -3.338542513240      0.874541132531      0.158494613686
C     -3.673071280439     -1.994691727099     -0.812513426079
C      3.470131526936     -0.038599738019     -1.466273941108
C      3.063882010335     -2.406457466953      0.475582936162
C     -3.207107257089      1.653469595890     -1.157120625067
H     -3.869270765616      1.259380503995     -1.926549102265
H     -3.483297951930      2.700140059264     -0.992492120509
H     -2.194130620553      1.623444590334     -1.555428600265
C     -4.815132351510      0.833005395025      0.559320436176
H     -5.457769185172      0.421488858479     -0.216783834793
H     -4.963812496724      0.265640246304      1.479448414916
H     -5.150878782896      1.857714351098      0.749734907280
C     -2.624247791910      1.624856214337      1.298150119050
H     -2.881000658404      2.688093137201      1.239068579543
H     -2.954052021919      1.246887486674      2.265886351286
H     -1.542256787567      1.522545099071      1.273350230709
C     -4.226813823810     -1.400071850967     -2.110155930516
H     -3.423384861152     -1.025912100026     -2.749423165985
H     -4.751039334398     -2.185339005400     -2.661975949435
H     -4.937473138067     -0.593592181673     -1.938319411304
C     -2.915699883817     -3.269727297767     -1.182988513720
H     -2.221982642630     -3.097948641267     -2.003292099737
H     -2.366370842293     -3.677227701897     -0.333438312584
H     -3.639931769455     -4.021315547073     -1.510176222205
C     -4.813425937652     -2.417325647543      0.121396707301
H     -5.429381645216     -1.591945241401      0.465354879043
H     -5.463258570239     -3.111458397551     -0.419599748705
H     -4.422248946723     -2.944606192829      0.992091329973
C      3.503820552941     -3.323994047686     -0.671068627100
H      3.762432245762     -4.300575148482     -0.253915864405
H      2.711184446600     -3.478958871439     -1.403644605339
H      4.388574802880     -2.944611212967     -1.181728327156
C      2.049695400457     -3.173894103017      1.343363346368
H      1.736858801424     -2.604357917858      2.216359773135
H      1.167011427106     -3.493451212563      0.801356894392
H      2.555143503874     -4.074435700770      1.705040081146
C      4.263550700807     -2.129326801932      1.394971173365
H      4.717071786731     -3.089664670496      1.655252358231
H      5.036651168580     -1.513465178419      0.944866036117
H      3.945967848846     -1.664334856578      2.328915481061
C      2.985018600532      1.395800030018     -1.716567411299
H      3.038403611392      2.022154310864     -0.824257498526
H      3.631859664919      1.846690112179     -2.473730592649
H      1.964626179203      1.401502246226     -2.097604764307
C      3.339961349853     -0.781270839429     -2.804024799151
H      2.298156882464     -0.849505270112     -3.118040528888
H      3.886372202133     -0.221874309295     -3.568480929110
H      3.753177771007     -1.786186775770     -2.773141667614
C      4.939191970068      0.023274812399     -1.048015341489
H      5.071257503101      0.518006868480     -0.083515593000
H      5.398723451567     -0.962626142108     -1.000671054994
H      5.490862588191      0.602312248129     -1.794038445331
Re    -0.096353100648     -0.742469926817     -0.679836685763
C     -0.001544636819     -2.618663766432     -1.025549397741
O      0.142146707069     -3.721675605694     -1.341242851066
N      0.014411321529      1.405678704697     -0.510017793060
C      0.090845716305      2.548898279326     -0.446433202384
C      0.182054857614      3.972449312165     -0.336693219821
C      0.532382084603      4.734044185047     -1.451158291189
C     -0.081910608484      4.577689646007      0.892278532887
C      0.617954034715      6.109896271919     -1.328419057064
H      0.730613674279      4.245628578754     -2.395852567300
C      0.008433909964      5.954480731009      0.999208856596
H     -0.356477503250      3.968052653356      1.742943950471
C      0.357143710166      6.717877217483     -0.107318219524
H      0.887495096432      6.709245691361     -2.187328711183
H     -0.195404411104      6.433025462367      1.947396460910
H      0.425058590583      7.794005319056     -0.017777907573

```

<MoleculeViewer 
  xyzData={`86
OptimizedStructure
C      1.170250334708     -0.219922999664      2.164461964766
C     -1.038843764027     -1.093688673994      2.282968050686
C      1.326986166920     -0.234336623684      3.523993673954
C     -0.861879156093     -1.208401960295      3.707891510629
C      0.276507994000     -0.777625331742      4.302946590286
H      2.243018514165      0.121886214793      3.973070713895
H     -1.677845597029     -1.617924191873      4.288634826175
H      0.385174563846     -0.849191628619      5.378608998355
N      0.049760121862     -0.662409010959      1.538867689956
P      2.294686739387     -0.820980113674     -0.222300255306
P     -2.467772700393     -0.810594776036      0.012835040184
C      2.286152337563      0.261447584056      1.266158678582
H      2.063794515548      1.272457768866      0.923900488337
H      3.231661423309      0.290882587301      1.804763147591
C     -0.258667392294     -0.546995315242     -2.573463392058
O     -0.357101967743     -0.399862283417     -3.718193618793
C     -2.244718243777     -1.367772936867      1.669786114846
H     -3.082019470200     -1.637326564665      2.301842286409
C     -3.338542513240      0.874541132531      0.158494613686
C     -3.673071280439     -1.994691727099     -0.812513426079
C      3.470131526936     -0.038599738019     -1.466273941108
C      3.063882010335     -2.406457466953      0.475582936162
C     -3.207107257089      1.653469595890     -1.157120625067
H     -3.869270765616      1.259380503995     -1.926549102265
H     -3.483297951930      2.700140059264     -0.992492120509
H     -2.194130620553      1.623444590334     -1.555428600265
C     -4.815132351510      0.833005395025      0.559320436176
H     -5.457769185172      0.421488858479     -0.216783834793
H     -4.963812496724      0.265640246304      1.479448414916
H     -5.150878782896      1.857714351098      0.749734907280
C     -2.624247791910      1.624856214337      1.298150119050
H     -2.881000658404      2.688093137201      1.239068579543
H     -2.954052021919      1.246887486674      2.265886351286
H     -1.542256787567      1.522545099071      1.273350230709
C     -4.226813823810     -1.400071850967     -2.110155930516
H     -3.423384861152     -1.025912100026     -2.749423165985
H     -4.751039334398     -2.185339005400     -2.661975949435
H     -4.937473138067     -0.593592181673     -1.938319411304
C     -2.915699883817     -3.269727297767     -1.182988513720
H     -2.221982642630     -3.097948641267     -2.003292099737
H     -2.366370842293     -3.677227701897     -0.333438312584
H     -3.639931769455     -4.021315547073     -1.510176222205
C     -4.813425937652     -2.417325647543      0.121396707301
H     -5.429381645216     -1.591945241401      0.465354879043
H     -5.463258570239     -3.111458397551     -0.419599748705
H     -4.422248946723     -2.944606192829      0.992091329973
C      3.503820552941     -3.323994047686     -0.671068627100
H      3.762432245762     -4.300575148482     -0.253915864405
H      2.711184446600     -3.478958871439     -1.403644605339
H      4.388574802880     -2.944611212967     -1.181728327156
C      2.049695400457     -3.173894103017      1.343363346368
H      1.736858801424     -2.604357917858      2.216359773135
H      1.167011427106     -3.493451212563      0.801356894392
H      2.555143503874     -4.074435700770      1.705040081146
C      4.263550700807     -2.129326801932      1.394971173365
H      4.717071786731     -3.089664670496      1.655252358231
H      5.036651168580     -1.513465178419      0.944866036117
H      3.945967848846     -1.664334856578      2.328915481061
C      2.985018600532      1.395800030018     -1.716567411299
H      3.038403611392      2.022154310864     -0.824257498526
H      3.631859664919      1.846690112179     -2.473730592649
H      1.964626179203      1.401502246226     -2.097604764307
C      3.339961349853     -0.781270839429     -2.804024799151
H      2.298156882464     -0.849505270112     -3.118040528888
H      3.886372202133     -0.221874309295     -3.568480929110
H      3.753177771007     -1.786186775770     -2.773141667614
C      4.939191970068      0.023274812399     -1.048015341489
H      5.071257503101      0.518006868480     -0.083515593000
H      5.398723451567     -0.962626142108     -1.000671054994
H      5.490862588191      0.602312248129     -1.794038445331
Re    -0.096353100648     -0.742469926817     -0.679836685763
C     -0.001544636819     -2.618663766432     -1.025549397741
O      0.142146707069     -3.721675605694     -1.341242851066
N      0.014411321529      1.405678704697     -0.510017793060
C      0.090845716305      2.548898279326     -0.446433202384
C      0.182054857614      3.972449312165     -0.336693219821
C      0.532382084603      4.734044185047     -1.451158291189
C     -0.081910608484      4.577689646007      0.892278532887
C      0.617954034715      6.109896271919     -1.328419057064
H      0.730613674279      4.245628578754     -2.395852567300
C      0.008433909964      5.954480731009      0.999208856596
H     -0.356477503250      3.968052653356      1.742943950471
C      0.357143710166      6.717877217483     -0.107318219524
H      0.887495096432      6.709245691361     -2.187328711183
H     -0.195404411104      6.433025462367      1.947396460910
H      0.425058590583      7.794005319056     -0.017777907573
`}
  caption="初期経路を求めるための初期構造"
  backgroundColor="#333333"
/>


### 2. 遷移状態構造最適化のための初期構造の算出


#### a. 初期構造をカレントディレクトリに`mobh35_24_Re.xyz`として保存し、以下を実行する。
```
python optmain.py .\mobh35_24_Re.xyz -os uma-s-1p1 -modelhess -opt rsirfo_block_fsb -spin 1 -elec 0 -ma 100 17 75
```
- `-opt rsirfo_block_fsb`は準ニュートン法であるRS-I-RFO法を構造最適化に使用することを示す。初期のへシアンに関しては、特にオプションで指定しない限り、単位行列が使われる。(以前のHessian更新法とは細かな点で異なる方法を使用している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `-spin`はスピン多重度の指定である。PySCFを使用するときは目的とするスピン多重度に1を引いた値を指定する。（デフォルトでは1が指定される。）
- `-elec M`は形式電荷をMとすることを示す。（デフォルトでは0が指定される。）
- `-ma yyy a b `はyyykJ/molの活性化障壁を超えうるペア同士を近づける力を原子のラベル番号aとbのペアに構造最適化時に加えることを示す。
- `-os uma-s-1p1`は今回使用するNNPを指定している。これを使用する際にASEライブラリが必要である。
- `-modelhess`は、計算コストが非常に低い数式を使用して、近似したHessianを生成するオプションである。



これを実行すると、`omol`のデータセットを使用した`uma-s-1p1`モデルのNNPで得たエネルギーに対して、指定した人工力ポテンシャルを加えた上で初期構造を構造最適化することができる。

結果は`yyyy_mm_dd`（今日の年月日）ディレクトリの中に存在するディレクトリを開いて確認できる。

正常終了していれば、このディレクトリ中に、`mobh35_24_Re_traj.xyz`が存在するので、これをコピーして、`MultiOptPy-v1.18c`ディレクトリに置く。

`mobh35_24_Re_traj.xyz`は構造最適化の過程をAvogadro（公式ページ:https://avogadro.cc/ ）等で可視化して確認できるようにしている。この`mobh35_24_Re_traj.xyz`は次のNEB計算に使用する。

※`mobh35_24_Re_traj.xyz`をアニメーションとして表示したい場合は、[https://github.com/ss0832/molecule_movie] を使うと良い。

（この人工力ポテンシャルを加えて行った構造最適化の結果は`mobh35_24_Re_optimized.xyz`で確認できる。構造を可視化して、生成系になっているか確認する。反応系のままであれば、`-ma`の設定を見直してb.をやり直す。今回の場合以下の構造が得られた。生成系の安定構造に近いものが得られていると判断できるため、次のNEB計算を行うことが可能である。）



#### b. `mobh35_24_Re_traj.xyz`を初期経路として、NEB法で経路の緩和を行う。

NEB法を用いることで、先ほど得られた`mobh35_24_Re_traj.xyz`全体のエネルギーを下げることができる。これにより、パスのエネルギー極大値を持つ構造を遷移状態構造に近づける。（この時点ではまだ正確な遷移状態構造は求められていない。）


```
python nebmain.py mobh35_24_Re_traj.xyz -os uma-s-1p1 -ns 15 -aneb 3 5 -modelhess -spng -ndb 0.75 -ad 9999 -spin 1 -elec 0
```
- `-ad X`は線形補間で、各ノード間の距離を全て等しくするための処理である。X回の反復計算ごとに本処理を行う。Xを`-ns`よりも大きな数値を指定することで、初期経路に対してのみ処理を行うことが出来る。
- `-ndb N`はノード間の距離をN Åとして初期経路を作成することを示す。経路作成時に元のノードをベルンシュタイン多項式を用いてがたついた経路を滑らかにする。

→プログラムの仕様上`-ad`の処理を行った後に、`-ndb`の処理を行うようになっている。

- `-ns n`はn回分NEB法による経路の緩和を行うことを示す。
- `-fc M`はM回あたりの経路緩和回数に対して1回だけ正確なHessianを計算し、経路緩和に使用する。これを使用すると、Hessianを使用しない場合の経路緩和アルゴリズムとは別のものを使用して、経路緩和を行う。
- `-spng`は緩和中のパスのエネルギープロファイルや各ノードの勾配のRMS値をmatplotlibで可視化するオプションである。
- `-os uma-s-1p1`は今回使用するNNPを指定している。これを使用する際にASEライブラリが必要である。
- `-aneb A B`これを指定すると、(B+1)回の緩和ごとに、エネルギー極大値を示すノードと前後のノードの間に線形補間でA個の新規ノードを内挿するようにできる。デフォルトではこのような操作は行われない。このオプションを使用するとノードの数が徐々に増えるため、計算コストが使用しない場合と比べて増加する。一方で、エネルギー極大値を示すノード周辺にノードを増加させるため、緩和している経路中のノードが遷移状態構造付近に存在する可能性が高くすることが出来る。


#### c. 初期構造の決定及び遷移状態構造の計算

`MultiOptPy-v1.18c`と同じディレクトリ内に、NEBという名前を含むディレクトリが生成されている。
そのディレクトリ内の`energy_plot.csv`を確認し、緩和後のパスのエネルギー極大値を示す構造を確認する。

経路の緩和後の各ノードのエネルギー一覧(単位:hartree) (energy_plot.csvに保存されている。)

export const dataset1 = [-2268.6433175817037,-2268.6433175817037,-2268.638501931213,-2268.6332830314127,-2268.62932911341,-2268.626053212193,-2268.62327259337,-2268.6209933550977,-2268.619239609624,-2268.617939580955,-2268.616984273319,-2268.616304434096,-2268.61586753979,-2268.6156065106875,-2268.6154249678907,-2268.615267817717,-2268.6150869057637,-2268.614797979351,-2268.614186972185,-2268.612825261021,-2268.610134222003,-2268.6066757966764,-2268.6072854019676,-2268.61657765951,-2268.628577147725,-2268.634982454235,-2268.637082462804,-2268.638347654882,-2268.639700534234,-2268.641262433131,-2268.6430341926966,-2268.644741816487,-2268.6460096020337,-2268.6467096983483,-2268.647102713971,-2268.6476084403334,-2268.6482548448403,-2268.6488775576613,-2268.649582139976,-2268.650454596807,-2268.6515102085905,-2268.6527772231066,-2268.654262509541,-2268.655886581588,-2268.657357288524,-2268.65848895202,-2268.659238534518,-2268.6595775078636,-2268.6596257323595];

export const dataset1_itr5 = [-2268.64331751161,-2268.643317651797,-2268.640550911536,-2268.6360805428276,-2268.632271648781,-2268.629074532932,-2268.626405222975,-2268.6242482982857,-2268.622563525056,-2268.6212800385106,-2268.6203299178114,-2268.619660382369,-2268.6192279039687,-2268.6190064778316,-2268.6188282995345,-2268.618693509265,-2268.618670728798,-2268.618522971186,-2268.6179363566425,-2268.6165785707285,-2268.6139229290516,-2268.6097983327822,-2268.608827954991,-2268.6200040519957,-2268.6312025089046,-2268.6357857285407,-2268.6378944988273,-2268.639579972995,-2268.6410588108047,-2268.6427958739673,-2268.644655671276,-2268.646410818624,-2268.647768884913,-2268.6487323935175,-2268.649329942685,-2268.649693518935,-2268.6499857397534,-2268.6503490356286,-2268.6509006032993,-2268.6516789242323,-2268.652692970426,-2268.6539328586628,-2268.6553817664444,-2268.656931539123,-2268.6583346756897,-2268.6594345867197,-2268.6601857813735,-2268.6606769282375,-2268.660911952561];

export const dataset1_itr10 = [-2268.6433126751413,-2268.643317651797,-2268.6419283236983,-2268.638280084513,-2268.634771121597,-2268.6317437727957,-2268.629204486733,-2268.627161534472,-2268.62556339711,-2268.6243233686855,-2268.623404790171,-2268.622745628603,-2268.6223019352037,-2268.6220898315346,-2268.621941372985,-2268.621907868175,-2268.6218998774884,-2268.6217430777833,-2268.621165224958,-2268.6198696822885,-2268.6174081301883,-2268.61299635985,-2268.6110184545832,-2268.609542140148,-2268.608955735886,-2268.6100928666942,-2268.6123751189975,-2268.6156508099334,-2268.6196723683993,-2268.6240338114294,-2268.6327969312983,-2268.6364395629844,-2268.63847809934,-2268.6401164705107,-2268.6417515472763,-2268.6434805496583,-2268.645289599096,-2268.6469206805177,-2268.6481595173486,-2268.649020618993,-2268.6495662987895,-2268.6499101786976,-2268.650201768672,-2268.6506104852933,-2268.651221001803,-2268.652060865043,-2268.653134561013,-2268.654424215808,-2268.6558928199315,-2268.6574193214874,-2268.658777738245,-2268.6598302659045,-2268.6605208294695,-2268.6609033310306,-2268.660936625559];

export const dataset2 = [-2268.6433151284227,-2268.6433175817037,-2268.6426767846965,-2268.6397841560706,-2268.6366231384995,-2268.6337992718372,-2268.631394005013,-2268.6294516372745,-2268.6279304628433,-2268.6267266027908,-2268.62585526746,-2268.6252273677014,-2268.6247598424293,-2268.6245472481037,-2268.624434887832,-2268.62440152321,-2268.6243702614,-2268.6241889989783,-2268.6236143003716,-2268.6223879402273,-2268.620140314234,-2268.6159229138475,-2268.613661409293,-2268.611245768595,-2268.610567891997,-2268.6101472594396,-2268.6098604358394,-2268.6097276782884,-2268.6098661835263,-2268.6101279135664,-2268.610569013497,-2268.611176726257,-2268.6144638424735,-2268.6186944204837,-2268.623449089417,-2268.62753611544,-2268.63378097737,-2268.6369692614076,-2268.6389016057406,-2268.6405105375393,-2268.6421877406447,-2268.643904406528,-2268.6456967736544,-2268.647250822052,-2268.648394751953,-2268.6491751756985,-2268.6496719300617,-2268.6499782397227,-2268.6502846895714,-2268.6507366540322,-2268.651401913756,-2268.6523009361163,-2268.6534330902687,-2268.654771320028,-2268.656261022368,-2268.6577692995506,-2268.6590837675312,-2268.660078397758,-2268.660692769424,-2268.660929756372,-2268.6609356442464];

<MultiDataGraph datasets={[ { data: dataset1, label: "緩和前の経路のエネルギー", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_itr5, label: "ITR. 5の経路のエネルギー", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_itr10, label: "ITR. 10の経路のエネルギー", color: "rgba(81, 143, 18, 1)"}, { data: dataset2, label: "緩和後の経路のエネルギー", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="Electronic Energy [hartree]" height="500px" />

export const dataset1_grad = [1.1927425065787084e-05,1.1927496255901723e-05,0.0018021930836965203,0.0020115617559487496,0.0020306953882713893,0.0020642001151638303,0.0020992651999134806,0.0021013457452778153,0.002068405104333522,0.002033129849136279,0.0020330579895414384,0.0020670356707251855,0.0021044576101704846,0.0021462218307361034,0.0021939743433646484,0.0022301631785656153,0.0022534361730239517,0.002292380903230059,0.0023651403074923514,0.002466121028777427,0.0024790766544501575,0.002011630055803615,0.0017873147683563257,0.0027597156015272753,0.0024941172782909026,0.0011428870183664047,0.0015426821050313164,0.0020936902473192927,0.0022768085980372304,0.002331311038992059,0.002327164019770534,0.0023093180308106807,0.0023817164728145352,0.002585560123799203,0.0027630024415939303,0.002705511629198105,0.00249529064461956,0.002355044564032712,0.002281042928049539,0.0022391798948069364,0.002223694047237654,0.00220968999579667,0.0021851790404699115,0.002138894218508229,0.0021080071348118863,0.002115092420350161,0.0021125083534587145,0.0021009455529146324,0.0021090836429728138];

export const dataset1_grad_itr5 = [1.1844903801963443e-05,1.0063440297519937e-05,0.0009229031963010967,0.0012340254256001065,0.0013503284455114292,0.0014121358041315384,0.001444246969799152,0.0014691823954447784,0.0014761390862802614,0.0014831338911008192,0.0015505850286977136,0.0016280608576058877,0.0016021155769337827,0.0015696962436911063,0.0016014889002140514,0.0016894642350402777,0.0016814588168822086,0.0016581259497268097,0.0017183355968280144,0.0018452014622336458,0.001982480127797332,0.001740659907994813,0.0011332177573417923,0.0024502065187399055,0.0016594588008001226,0.0006131262557354897,0.0009819178864565537,0.001057109711263063,0.0012006414417371019,0.0010727153357490806,0.000941689933433247,0.0007216086142171048,0.0005960079938831762,0.0005394995707844432,0.0006138502828118325,0.0006682672505299777,0.0007149600175776728,0.0008203126315526175,0.0009299364288440107,0.0010317313076030968,0.001113552271730044,0.0011685889213547225,0.0011921245895445617,0.0011960458629870342,0.0012029155461669811,0.0012255929072817868,0.0011821745883393794,0.0008459810456976489,0.00027778847037928484];

export const dataset1_grad_itr10 = [3.842419440120868e-05,8.563974436924099e-06,0.0005755355523453187,0.0008880846093892517,0.001014192729025757,0.001096520462380589,0.0011726500535652873,0.0012289565205196443,0.0012600086074691273,0.0012899120997760438,0.0013613637459484313,0.0014372682808426961,0.0014011714591779982,0.0013630756756603968,0.0013590736739384837,0.0013552737653605663,0.0013513655592623343,0.001356667273427133,0.0014371322341203696,0.0015919347945579315,0.0018009307730722345,0.0018565835361378444,0.0016367904703425838,0.0012240453736143723,0.0007467295580086824,0.0009531706578512245,0.0014828069741914423,0.0019380838251867676,0.002312612415918884,0.0023667230594945944,0.001121092286004801,0.00043282437156098397,0.0006662446469304626,0.000768672917606828,0.0006953799562674652,0.0006148628462992505,0.0005108913560722928,0.00038233810892347026,0.00029678150467729277,0.0002374500098557894,0.00025657340448306386,0.00024599769127418684,0.0003388053986807087,0.0004670287969510837,0.000583039418991111,0.0006839378365668498,0.000765438303756475,0.0008245470040689691,0.0008584564437028098,0.0008726081707221821,0.0008753893990015555,0.0008666062438397429,0.0007658971021583024,0.00024584040234626177,4.6476455897356115e-05];


export const dataset2_grad = [3.070331144176525e-05,7.199474147243049e-06,0.0003637638608047864,0.0006829081347416927,0.0008355542782658141,0.0009485048816228002,0.0010472517942899104,0.001109893259501538,0.0011389373334209569,0.001175772446158107,0.0012343448554155746,0.001277080423541666,0.0012414052292100983,0.001213423379392796,0.0011981612336833315,0.0011835073346591286,0.0011529733654276765,0.0011750327790432786,0.0012729972772562042,0.0014492275046314148,0.0016863774625269143,0.0019073874955433917,0.0018180860419088052,0.0014157717216543668,0.0012217907890200639,0.0010319879060045893,0.0008336725014410041,0.0006582053494253759,0.0005622392583465247,0.0006127845108808387,0.0007774919113032874,0.0009918934681865975,0.0017250043781049376,0.0022356323860788308,0.0024286854790741843,0.002047802845179908,0.0008614458286756656,0.0003500455350629358,0.0004900071158939003,0.0005726953914990887,0.0004104267438667799,0.0004487886995957883,0.00036322646256265595,0.00026769703800450835,0.00019481587818087411,0.0001380745572223545,0.00010624251095248005,8.629180411477068e-05,0.00017498348433718673,0.000297484722158093,0.0004058805128077878,0.0004982285281656756,0.000573057075313559,0.0006284010184350859,0.000663164862488217,0.0006764218770817861,0.0006724132804025943,0.0006454432011207993,0.0005127305534381797,7.84975842898548e-05,3.9123052708343805e-05];

<MultiDataGraph datasets={[ { data: dataset1_grad, label: "緩和前の経路の勾配のRMS値", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_grad_itr5, label: "ITR. 5の経路の勾配のRMS値", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_grad_itr10, label: "ITR. 10の経路の勾配のRMS値", color: "rgba(81, 143, 18, 1)"},  { data: dataset2_grad, label: "緩和後の経路の勾配のRMS値", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="RMS of gradient [hartree/Bohr]" height="500px" />

※`bias_force_rms.csv`にて、各Iterationごとのすべてのノードの勾配のRMS値を確認できる。

経路緩和の結果、経路のエネルギー極大値を示す構造の中から目視で、緩和後に得られた経路の27番(グラフ上では28番)の構造を遷移状態構造を求める初期構造として採用した。


※こちら[https://ss0832.github.io/molecule_viewer/] を使うことでも可視化は可能である。


`mobh35_24_Re_traj_27.xyz`
```
86
0 1
C       1.505461213533     -0.449565000617      2.023899120887
C      -0.765368578219      0.040797793238      2.095759950492
C       1.632343046720     -0.373170193708      3.389790518027
C      -0.708053905682      0.078104115310      3.516651514056
C       0.471619562746     -0.177417922017      4.154656988333
H       2.611912641055     -0.404206376179      3.845494699377
H      -1.606528563505      0.322596007684      4.068268741151
H       0.522903645057     -0.162932173401      5.236247020202
N       0.299029688182     -0.448318256701      1.402132656685
P       2.446846873753     -1.088921526068     -0.504706317334
P      -2.241448174258     -0.142897841753     -0.207632907806
C       2.706890480268     -0.301291878592      1.131510200642
H       2.769935857974      0.773037134657      0.934465304377
H       3.626476926638     -0.592045810359      1.634348143179
C       0.026422237689     -0.334566031199     -2.734215634017
O      -0.007780864277     -0.093200719203     -3.865725024154
C      -1.824477092093      0.648287198708      1.358226803499
H      -2.648165722989      0.999670896935      1.977262680611
C      -3.319363741012      1.158975974432     -1.100746462338
C      -3.278722124845     -1.669456401457      0.200554127319
C       3.640182328133     -0.205250130076     -1.653539786380
C       3.033057924222     -2.841543284195     -0.119992029446
C      -2.483403211292      1.761737531149     -2.237136826285
H      -2.317606061838      1.025922777735     -3.025181737556
H      -3.035494996443      2.601308308433     -2.669891909307
H      -1.510192197617      2.119514940210     -1.912090004057
C      -4.601499783584      0.641499955740     -1.762235968066
H      -4.420630128928     -0.159939214426     -2.473078042374
H      -5.350730901106      0.322145655429     -1.043235526295
H      -5.033962757237      1.477100486733     -2.319444944075
C      -3.753474760356      2.265276327690     -0.129050384127
H      -4.355369066012      2.988771437008     -0.685713303226
H      -4.374483652029      1.871901491401      0.678398541821
H      -2.922818193060      2.806885580596      0.311372330193
C      -3.605781478042     -2.430019322536     -1.092926852037
H      -2.749107402650     -2.494039062189     -1.763462335496
H      -3.902099054526     -3.452270231289     -0.845312208732
H      -4.433263086837     -1.976628390901     -1.632441566866
C      -2.427895607335     -2.576540028801      1.104283811211
H      -1.451843309082     -2.803875303293      0.683933206022
H      -2.280833853205     -2.134564466821      2.089699516023
H      -2.964758705046     -3.518945100995      1.240488936808
C      -4.565667544723     -1.383001922484      0.978738561398
H      -5.317905505290     -0.866872939008      0.389846335769
H      -5.004554999001     -2.336558054821      1.286788855155
H      -4.369628789281     -0.808325778055      1.885101622305
C       3.220551556340     -3.645319156741     -1.408771526349
H       3.301610416658     -4.705502545088     -1.154707180066
H       2.378375553484     -3.529938990654     -2.092985719272
H       4.137010158010     -3.363400737300     -1.927662243483
C       1.960604299385     -3.532023443919      0.739917671533
H       1.693771864050     -2.948526385904      1.622127454107
H       1.056319704433     -3.754556085420      0.183547951371
H       2.374501918638     -4.482434344302      1.089786332599
C       4.331135976986     -2.893165369174      0.701104403265
H       4.670344933091     -3.931786628087      0.736541900392
H       5.140058357751     -2.296331118726      0.289749866861
H       4.163624639528     -2.582773764741      1.733114206327
C       3.202268415336      1.267218221809     -1.692896865334
H       3.353450065508      1.780259980258     -0.742110651828
H       3.809710346918      1.781281094727     -2.442109314332
H       2.153723633633      1.370202461332     -1.967961612709
C       3.479896147520     -0.761247768156     -3.074451712357
H       2.437657630494     -0.769682567916     -3.390096857624
H       4.030605317331     -0.117165658255     -3.764997211531
H       3.877564671239     -1.768122041534     -3.176496309560
C       5.112272074974     -0.263868615274     -1.246698346523
H       5.269321083242      0.045953121303     -0.211259391890
H       5.535115699112     -1.258442390253     -1.384265048129
H       5.679846302645      0.419995188578     -1.883860747675
Re      0.089598912278     -0.658158389565     -0.862749124834
C      -0.218258886648     -2.471098633018     -1.316374610518
O      -0.418485098197     -3.557852837168     -1.674655694132
N       0.212113601691      1.467155750761     -0.347930983944
C      -0.411817301375      2.115924781824      0.411768040567
C      -0.580568991858      3.488910177068      0.879143903488
C      -0.451352326458      4.490617938370     -0.083766296322
C      -0.787976992810      3.816330514014      2.211639355819
C      -0.529584790327      5.821058869690      0.289734574912
H      -0.281391270761      4.203979361337     -1.112835932463
C      -0.850308497097      5.153213466057      2.579772157127
H      -0.879230610171      3.029475113069      2.949389296461
C      -0.725237560186      6.151959890797      1.623631518142
H      -0.427797351698      6.597325275925     -0.457230562074
H      -0.993282629997      5.421029258651      3.618018176671
H      -0.775929587264      7.192336753688      1.917726717739

```


<MoleculeViewer 
  xyzData={`86
0 1
C       1.505461213533     -0.449565000617      2.023899120887
C      -0.765368578219      0.040797793238      2.095759950492
C       1.632343046720     -0.373170193708      3.389790518027
C      -0.708053905682      0.078104115310      3.516651514056
C       0.471619562746     -0.177417922017      4.154656988333
H       2.611912641055     -0.404206376179      3.845494699377
H      -1.606528563505      0.322596007684      4.068268741151
H       0.522903645057     -0.162932173401      5.236247020202
N       0.299029688182     -0.448318256701      1.402132656685
P       2.446846873753     -1.088921526068     -0.504706317334
P      -2.241448174258     -0.142897841753     -0.207632907806
C       2.706890480268     -0.301291878592      1.131510200642
H       2.769935857974      0.773037134657      0.934465304377
H       3.626476926638     -0.592045810359      1.634348143179
C       0.026422237689     -0.334566031199     -2.734215634017
O      -0.007780864277     -0.093200719203     -3.865725024154
C      -1.824477092093      0.648287198708      1.358226803499
H      -2.648165722989      0.999670896935      1.977262680611
C      -3.319363741012      1.158975974432     -1.100746462338
C      -3.278722124845     -1.669456401457      0.200554127319
C       3.640182328133     -0.205250130076     -1.653539786380
C       3.033057924222     -2.841543284195     -0.119992029446
C      -2.483403211292      1.761737531149     -2.237136826285
H      -2.317606061838      1.025922777735     -3.025181737556
H      -3.035494996443      2.601308308433     -2.669891909307
H      -1.510192197617      2.119514940210     -1.912090004057
C      -4.601499783584      0.641499955740     -1.762235968066
H      -4.420630128928     -0.159939214426     -2.473078042374
H      -5.350730901106      0.322145655429     -1.043235526295
H      -5.033962757237      1.477100486733     -2.319444944075
C      -3.753474760356      2.265276327690     -0.129050384127
H      -4.355369066012      2.988771437008     -0.685713303226
H      -4.374483652029      1.871901491401      0.678398541821
H      -2.922818193060      2.806885580596      0.311372330193
C      -3.605781478042     -2.430019322536     -1.092926852037
H      -2.749107402650     -2.494039062189     -1.763462335496
H      -3.902099054526     -3.452270231289     -0.845312208732
H      -4.433263086837     -1.976628390901     -1.632441566866
C      -2.427895607335     -2.576540028801      1.104283811211
H      -1.451843309082     -2.803875303293      0.683933206022
H      -2.280833853205     -2.134564466821      2.089699516023
H      -2.964758705046     -3.518945100995      1.240488936808
C      -4.565667544723     -1.383001922484      0.978738561398
H      -5.317905505290     -0.866872939008      0.389846335769
H      -5.004554999001     -2.336558054821      1.286788855155
H      -4.369628789281     -0.808325778055      1.885101622305
C       3.220551556340     -3.645319156741     -1.408771526349
H       3.301610416658     -4.705502545088     -1.154707180066
H       2.378375553484     -3.529938990654     -2.092985719272
H       4.137010158010     -3.363400737300     -1.927662243483
C       1.960604299385     -3.532023443919      0.739917671533
H       1.693771864050     -2.948526385904      1.622127454107
H       1.056319704433     -3.754556085420      0.183547951371
H       2.374501918638     -4.482434344302      1.089786332599
C       4.331135976986     -2.893165369174      0.701104403265
H       4.670344933091     -3.931786628087      0.736541900392
H       5.140058357751     -2.296331118726      0.289749866861
H       4.163624639528     -2.582773764741      1.733114206327
C       3.202268415336      1.267218221809     -1.692896865334
H       3.353450065508      1.780259980258     -0.742110651828
H       3.809710346918      1.781281094727     -2.442109314332
H       2.153723633633      1.370202461332     -1.967961612709
C       3.479896147520     -0.761247768156     -3.074451712357
H       2.437657630494     -0.769682567916     -3.390096857624
H       4.030605317331     -0.117165658255     -3.764997211531
H       3.877564671239     -1.768122041534     -3.176496309560
C       5.112272074974     -0.263868615274     -1.246698346523
H       5.269321083242      0.045953121303     -0.211259391890
H       5.535115699112     -1.258442390253     -1.384265048129
H       5.679846302645      0.419995188578     -1.883860747675
Re      0.089598912278     -0.658158389565     -0.862749124834
C      -0.218258886648     -2.471098633018     -1.316374610518
O      -0.418485098197     -3.557852837168     -1.674655694132
N       0.212113601691      1.467155750761     -0.347930983944
C      -0.411817301375      2.115924781824      0.411768040567
C      -0.580568991858      3.488910177068      0.879143903488
C      -0.451352326458      4.490617938370     -0.083766296322
C      -0.787976992810      3.816330514014      2.211639355819
C      -0.529584790327      5.821058869690      0.289734574912
H      -0.281391270761      4.203979361337     -1.112835932463
C      -0.850308497097      5.153213466057      2.579772157127
H      -0.879230610171      3.029475113069      2.949389296461
C      -0.725237560186      6.151959890797      1.623631518142
H      -0.427797351698      6.597325275925     -0.457230562074
H      -0.993282629997      5.421029258651      3.618018176671
H      -0.775929587264      7.192336753688      1.917726717739
`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造"
  backgroundColor="#333333"
/>


構造が壊れていないので、これを遷移状態を求めるための初期構造とする。

遷移状態構造を求めるための初期構造を含むxyzファイルを`MultiOptPy-v1.18c`と同じディレクトリ内にコピーする。

そして、以下を実行する。

```
python optmain.py .\mobh35_24_Re_traj_27.xyz -spin 1 -elec 0 -os uma-s-1p1  -tcc -freq -opt rsirfo_block_bofill -order 1 -fc 5 -tr 0.2
```
- `-opt rsirfo_block_bofill`は遷移状態構造の最適化向けのoptimizerを指定することを意味する。準ニュートン法であるRS-I-RFO法を使用する。今回は`-fc`で正確なHessianを計算するようにしているので、初期Hessianは正確なHessianを使用するようになっている。(Bofill法によるHessianの更新法を細かい点で変更している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `-order 1`は一次の鞍点を求めることを指定する。（デフォルトだと極小値を求めるようになっている。）
- `-fc 5`は5回の反復回数当たり1回正確なHessianを計算することを指定する。
- `-freq`は収束条件を満たした後に基準振動解析を行うことを示す。（自前で実装しているため、あくまで目安として使用することを推奨する。各振動モードを`vibration_animation`内のxyzファイルで可視化できる。）UMAモデルから算出されるHessianは数値微分により求めているため、原子数Zが多いとZの二乗オーダーで計算コストが急増する。
- `-tcc`は収束条件を厳しくすることを示す。（Gaussianのtightと同等）
- `-tr D`は一回の反復計算ごとの計算されるステップ幅の最大値をDÅ以下にすることを示す。

実行して得られた正確な遷移状態構造と思われる構造を以下に示す。

(実行して得られた正確な遷移状態構造は計算開始時に、`yyyy_mm_dd`ディレクトリ内に生成された新規ディレクトリ内の`YYY_optimized.xyz`として保存されている。)

```
86
OptimizedStructure
C      1.528353134425     -0.567753902965      2.065616450608
C     -0.683587386314      0.199499571198      2.086873816396
C      1.633004705890     -0.485293863463      3.434210719877
C     -0.621631844115      0.303225827307      3.501226351175
C      0.508451007638     -0.080534892984      4.165866368795
H      2.582453650756     -0.670964712655      3.916382629736
H     -1.488432727678      0.676199018365      4.031998759864
H      0.552420034499     -0.025426565203      5.246515110393
N      0.354424348525     -0.379743422535      1.417615744395
P      2.479777552016     -1.155131326369     -0.520885367415
P     -2.185133557111     -0.086962477248     -0.174500656440
C      2.775428383679     -0.644001725227      1.222191851544
H      3.136098742689      0.388098455408      1.166792888716
H      3.560599177540     -1.220426952940      1.712176920309
C      0.074272599744     -0.629745881615     -2.702949242256
O      0.090211525051     -0.577856156096     -3.859004829297
C     -1.744373085796      0.782959544489      1.331016646485
H     -2.546655231466      1.207881911383      1.930055347600
C     -3.219417236150      1.111885953184     -1.216264805072
C     -3.321569325661     -1.481039722271      0.417690457152
C      3.739974208369     -0.139116657600     -1.475215722268
C      3.003012581614     -2.960861564184     -0.496168040071
C     -2.316081290001      1.924891958854     -2.154280047848
H     -1.683323846052      1.283493720107     -2.766484899891
H     -2.959210951654      2.505509825108     -2.821866352962
H     -1.680032469232      2.626925778018     -1.625432340646
C     -4.182147049680      0.345825955299     -2.130317641009
H     -3.658768999349     -0.402969912475     -2.728121382130
H     -4.988032899802     -0.141211082317     -1.588076495133
H     -4.639642872650      1.058588408926     -2.821134065898
C     -3.999620314068      2.095586498017     -0.338035016699
H     -4.597637921406      2.748269268060     -0.981037436380
H     -4.678615987545      1.598437767381      0.353566293966
H     -3.325920421065      2.729339097578      0.240672614174
C     -3.669555306549     -2.461263488308     -0.713969101263
H     -2.821997313121     -2.668134029417     -1.364140079477
H     -3.981551826298     -3.412272439609     -0.274849286363
H     -4.490640835794     -2.105203059875     -1.330316221933
C     -2.553836352901     -2.246877260835      1.509540425752
H     -1.564562211988     -2.568775702078      1.189638629634
H     -2.443065420562     -1.649333982971      2.413770039480
H     -3.128854680895     -3.139180620102      1.769215743356
C     -4.610727468605     -0.976497045055      1.073704823805
H     -5.288165610391     -0.494583994584      0.371412491043
H     -5.141601111382     -1.831670702177      1.502131848196
H     -4.400487394584     -0.280049521196      1.887705982709
C      2.601281835556     -3.652799778029     -1.805582706520
H      2.722464909286     -4.732676437170     -1.684995427077
H      1.568498726418     -3.465053203191     -2.084909803616
H      3.235501268375     -3.341951511779     -2.633943839473
C      2.269421258258     -3.609410575984      0.691367608217
H      2.705578862936     -3.300001230885      1.642781524033
H      1.206309361440     -3.382000666090      0.718756058658
H      2.376395307229     -4.694298287458      0.618005812470
C      4.500631042912     -3.192805663701     -0.275177349643
H      4.663440026377     -4.263851223792     -0.125742705230
H      5.097129700810     -2.891957522388     -1.135123688353
H      4.879505921987     -2.680002833367      0.610770364744
C      3.145746439480      1.265475221086     -1.633835709791
H      2.931046791094      1.740273046016     -0.674992371165
H      3.869999369892      1.888605375902     -2.166101705529
H      2.216086894817      1.246769221868     -2.200453184940
C      3.911834171816     -0.733430311937     -2.876695333096
H      2.948698170816     -0.930244747094     -3.352718960202
H      4.450678680007     -0.015941517047     -3.501078872570
H      4.490379386340     -1.656593941041     -2.865371415645
C      5.107276023767      0.008421573617     -0.799275125684
H      5.033245099992      0.500580206866      0.171531940493
H      5.627980066863     -0.935246696964     -0.664497401439
H      5.735207933133      0.642890530068     -1.431132881295
Re     0.119887463272     -0.687557384351     -0.793911787899
C     -0.311673479540     -2.518638337618     -0.925162140358
O     -0.621345742010     -3.633376025756     -1.031612997760
N      0.296243491841      1.513387921877     -0.426844313928
C     -0.330095196570      2.176037511100      0.318378592887
C     -0.614840952251      3.516032625336      0.817753032517
C     -0.430531969437      4.584479489013     -0.059355030853
C     -1.035362280774      3.747645755945      2.122263059043
C     -0.683955858203      5.878289012785      0.368331023957
H     -0.089468874304      4.388687105588     -1.067468910690
C     -1.274526324804      5.044352709135      2.545962123677
H     -1.165424247992      2.912542047486      2.795393241908
C     -1.106917592701      6.108849226975      1.669466054544
H     -0.548092434797      6.706172442026     -0.314930400155
H     -1.597170460643      5.225304581894      3.562817660052
H     -1.304663493259      7.119306396722      2.002796041006

```

<MoleculeViewer 
  xyzData={`86
OptimizedStructure
C      1.528353134425     -0.567753902965      2.065616450608
C     -0.683587386314      0.199499571198      2.086873816396
C      1.633004705890     -0.485293863463      3.434210719877
C     -0.621631844115      0.303225827307      3.501226351175
C      0.508451007638     -0.080534892984      4.165866368795
H      2.582453650756     -0.670964712655      3.916382629736
H     -1.488432727678      0.676199018365      4.031998759864
H      0.552420034499     -0.025426565203      5.246515110393
N      0.354424348525     -0.379743422535      1.417615744395
P      2.479777552016     -1.155131326369     -0.520885367415
P     -2.185133557111     -0.086962477248     -0.174500656440
C      2.775428383679     -0.644001725227      1.222191851544
H      3.136098742689      0.388098455408      1.166792888716
H      3.560599177540     -1.220426952940      1.712176920309
C      0.074272599744     -0.629745881615     -2.702949242256
O      0.090211525051     -0.577856156096     -3.859004829297
C     -1.744373085796      0.782959544489      1.331016646485
H     -2.546655231466      1.207881911383      1.930055347600
C     -3.219417236150      1.111885953184     -1.216264805072
C     -3.321569325661     -1.481039722271      0.417690457152
C      3.739974208369     -0.139116657600     -1.475215722268
C      3.003012581614     -2.960861564184     -0.496168040071
C     -2.316081290001      1.924891958854     -2.154280047848
H     -1.683323846052      1.283493720107     -2.766484899891
H     -2.959210951654      2.505509825108     -2.821866352962
H     -1.680032469232      2.626925778018     -1.625432340646
C     -4.182147049680      0.345825955299     -2.130317641009
H     -3.658768999349     -0.402969912475     -2.728121382130
H     -4.988032899802     -0.141211082317     -1.588076495133
H     -4.639642872650      1.058588408926     -2.821134065898
C     -3.999620314068      2.095586498017     -0.338035016699
H     -4.597637921406      2.748269268060     -0.981037436380
H     -4.678615987545      1.598437767381      0.353566293966
H     -3.325920421065      2.729339097578      0.240672614174
C     -3.669555306549     -2.461263488308     -0.713969101263
H     -2.821997313121     -2.668134029417     -1.364140079477
H     -3.981551826298     -3.412272439609     -0.274849286363
H     -4.490640835794     -2.105203059875     -1.330316221933
C     -2.553836352901     -2.246877260835      1.509540425752
H     -1.564562211988     -2.568775702078      1.189638629634
H     -2.443065420562     -1.649333982971      2.413770039480
H     -3.128854680895     -3.139180620102      1.769215743356
C     -4.610727468605     -0.976497045055      1.073704823805
H     -5.288165610391     -0.494583994584      0.371412491043
H     -5.141601111382     -1.831670702177      1.502131848196
H     -4.400487394584     -0.280049521196      1.887705982709
C      2.601281835556     -3.652799778029     -1.805582706520
H      2.722464909286     -4.732676437170     -1.684995427077
H      1.568498726418     -3.465053203191     -2.084909803616
H      3.235501268375     -3.341951511779     -2.633943839473
C      2.269421258258     -3.609410575984      0.691367608217
H      2.705578862936     -3.300001230885      1.642781524033
H      1.206309361440     -3.382000666090      0.718756058658
H      2.376395307229     -4.694298287458      0.618005812470
C      4.500631042912     -3.192805663701     -0.275177349643
H      4.663440026377     -4.263851223792     -0.125742705230
H      5.097129700810     -2.891957522388     -1.135123688353
H      4.879505921987     -2.680002833367      0.610770364744
C      3.145746439480      1.265475221086     -1.633835709791
H      2.931046791094      1.740273046016     -0.674992371165
H      3.869999369892      1.888605375902     -2.166101705529
H      2.216086894817      1.246769221868     -2.200453184940
C      3.911834171816     -0.733430311937     -2.876695333096
H      2.948698170816     -0.930244747094     -3.352718960202
H      4.450678680007     -0.015941517047     -3.501078872570
H      4.490379386340     -1.656593941041     -2.865371415645
C      5.107276023767      0.008421573617     -0.799275125684
H      5.033245099992      0.500580206866      0.171531940493
H      5.627980066863     -0.935246696964     -0.664497401439
H      5.735207933133      0.642890530068     -1.431132881295
Re     0.119887463272     -0.687557384351     -0.793911787899
C     -0.311673479540     -2.518638337618     -0.925162140358
O     -0.621345742010     -3.633376025756     -1.031612997760
N      0.296243491841      1.513387921877     -0.426844313928
C     -0.330095196570      2.176037511100      0.318378592887
C     -0.614840952251      3.516032625336      0.817753032517
C     -0.430531969437      4.584479489013     -0.059355030853
C     -1.035362280774      3.747645755945      2.122263059043
C     -0.683955858203      5.878289012785      0.368331023957
H     -0.089468874304      4.388687105588     -1.067468910690
C     -1.274526324804      5.044352709135      2.545962123677
H     -1.165424247992      2.912542047486      2.795393241908
C     -1.106917592701      6.108849226975      1.669466054544
H     -0.548092434797      6.706172442026     -0.314930400155
H     -1.597170460643      5.225304581894      3.562817660052
H     -1.304663493259      7.119306396722      2.002796041006
`}
  caption="遷移状態構造"
  backgroundColor="#333333"
/>


停留点に収束した分子構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                     -361.0619             24.3165             32.2232
Reduced mass [au]                   7.9337              4.3601              3.8033
Force const [Dyne/A]               -0.6094              0.0015              0.0023
Char temp [K]                       0.0000             34.9860             46.3620
Normal mode                   x         y         z            x         y         z            x         y         z     
       C                -0.00591    0.00745   -0.00067    0.00395   -0.01665    0.00380    0.00972    0.02481   -0.01128
       C                -0.02853    0.00210   -0.00396    0.01131    0.00558    0.00142    0.00177   -0.00180   -0.00658
       C                 0.00553    0.00168   -0.00650    0.00285   -0.01877    0.00400    0.01300    0.02818   -0.01177
       C                 0.00167    0.00151    0.01331    0.01175    0.00642    0.00154    0.00117   -0.00579   -0.00613
       C                -0.00085    0.00681    0.00018    0.00693   -0.00521    0.00276    0.00794    0.00903   -0.00877
       H                 0.00893    0.00966   -0.01077   -0.00004   -0.03063    0.00513    0.01736    0.04368   -0.01442
       H                -0.00343   -0.02209    0.02272    0.01466    0.01465    0.00049   -0.00302   -0.01820   -0.00422
       H                 0.00197    0.00210    0.00078    0.00649   -0.00527    0.00278    0.00902    0.00748   -0.00874
       N                -0.00959    0.00355   -0.00630    0.00749   -0.00201    0.00156    0.00465    0.00553   -0.00757
       P                 0.00087   -0.00221    0.00259    0.00320   -0.01648    0.00292    0.00109    0.00061   -0.00443
       P                -0.00574   -0.00173    0.01789    0.00818    0.00532    0.00560    0.00291    0.00468   -0.01026
       C                -0.00349    0.00473   -0.00123    0.00530   -0.03307    0.00740    0.00543    0.04324   -0.01843
       H                 0.00272    0.00217   -0.00443    0.02431   -0.03937    0.01601   -0.02490    0.05275   -0.04430
       H                -0.00553    0.00330    0.00036   -0.00675   -0.05044    0.00626    0.02524    0.07500   -0.01284
       C                -0.00092   -0.00439   -0.00021    0.01906    0.02594    0.00006   -0.00079   -0.00148   -0.00599
       O                 0.00032    0.00006   -0.00063    0.02753    0.03801    0.00073   -0.00245   -0.00344   -0.00610
       C                -0.08908   -0.10584    0.07110    0.01361    0.00901    0.00203    0.00317    0.00013   -0.00719
       H                -0.09750   -0.14498    0.08224    0.01738    0.01582    0.00198    0.00459    0.00402   -0.00797
       C                -0.00033   -0.00343    0.00355    0.00100    0.00176    0.00789    0.00891    0.00989   -0.01088
       C                -0.00644   -0.01176   -0.00948    0.01162    0.00737    0.01752   -0.00308    0.00877   -0.01320
       C                -0.00071   -0.00060   -0.00045    0.01728   -0.02278    0.01514   -0.00370   -0.02505   -0.03622
       C                -0.00002   -0.00105   -0.00032   -0.01731   -0.02274   -0.01074    0.00032    0.00107    0.04537
       C                 0.00080   -0.00241    0.00529   -0.00401   -0.02584   -0.02017    0.01279    0.00257   -0.01336
       H                 0.00509    0.00051    0.00653   -0.05875   -0.04890   -0.05276   -0.00005   -0.00342   -0.02038
       H                 0.00374   -0.00207    0.00276   -0.00702    0.00745    0.01146    0.01548    0.01325   -0.00671
       H                -0.00739    0.00514    0.00741    0.05096   -0.06013   -0.04165    0.02637   -0.00861   -0.01538
       C                 0.00075   -0.00038    0.00013   -0.02799    0.00803    0.03330    0.00328    0.01601   -0.01016
       H                 0.00131   -0.00056    0.00071   -0.05113   -0.00534    0.03015   -0.00148    0.01386   -0.01159
       H                 0.00106   -0.00143   -0.00069   -0.02652    0.02612    0.05179    0.00085    0.02002   -0.01023
       H                 0.00066   -0.00047   -0.00037   -0.02842    0.00975    0.03523    0.00691    0.01947   -0.00902
       C                -0.00109   -0.00215    0.00087    0.02998    0.02155    0.01148    0.01587    0.01515   -0.01059
       H                 0.00427    0.00375    0.00139    0.01864    0.01565    0.01608    0.01839    0.01786   -0.01017
       H                -0.00559   -0.00327   -0.00448    0.04325    0.03560    0.03513    0.01420    0.01920   -0.00922
       H                -0.00002   -0.01252    0.01111    0.04726    0.02552   -0.01335    0.01992    0.01197   -0.01185
       C                -0.00675   -0.00905   -0.00695   -0.01163    0.01227    0.02039   -0.00323    0.01009   -0.01405
       H                -0.00620   -0.00776   -0.00689   -0.02367    0.01163    0.00469    0.00079    0.00012   -0.00569
       H                -0.00903   -0.01038   -0.01119   -0.00631    0.01169    0.02289   -0.01676    0.01431   -0.01443
       H                -0.00520   -0.00746   -0.00864   -0.02185    0.01649    0.03658    0.00591    0.01683   -0.02225
       C                -0.00694   -0.00995   -0.00575    0.02254   -0.00165    0.00344   -0.00840    0.00610   -0.01138
       H                -0.00140   -0.00045    0.00152    0.01296   -0.01289   -0.01476   -0.00748    0.00538   -0.00784
       H                -0.01624   -0.01272   -0.00418    0.04539   -0.00431    0.00228   -0.01130    0.00471   -0.01011
       H                -0.00198   -0.01616   -0.01554    0.01678    0.00475    0.01282   -0.01041    0.00637   -0.01494
       C                -0.00368   -0.00805   -0.00580    0.02533    0.01526    0.03869   -0.00275    0.01347   -0.01608
       H                -0.00522   -0.00688   -0.00403    0.02104    0.02868    0.05210    0.00066    0.01685   -0.01698
       H                -0.00466   -0.00695   -0.00458    0.02196    0.01740    0.03880   -0.00709    0.01529   -0.01784
       H                 0.00100   -0.01058   -0.00595    0.04378    0.00631    0.04151   -0.00176    0.01200   -0.01508
       C                -0.00010   -0.00036   -0.00041   -0.01785   -0.00630   -0.01943    0.00946   -0.03677    0.06266
       H                -0.00064   -0.00039   -0.00049   -0.03813   -0.00932   -0.02633   -0.00208   -0.03407    0.09841
       H                -0.00009   -0.00025   -0.00052   -0.01174    0.01398   -0.02825    0.01443   -0.03654    0.04441
       H                -0.00002   -0.00079   -0.00060   -0.00437   -0.01140   -0.01102    0.02229   -0.06926    0.06038
       C                -0.00019    0.00029    0.00041   -0.03009   -0.02504   -0.01984   -0.00852    0.03367    0.05765
       H                -0.00114    0.00205   -0.00006   -0.03122   -0.03774   -0.01517   -0.02676    0.07173    0.05365
       H                -0.00002    0.00066    0.00179   -0.02770   -0.01370   -0.02272   -0.01180    0.02194    0.03315
       H                -0.00016    0.00027    0.00059   -0.04139   -0.02557   -0.02846    0.00603    0.03245    0.09639
       C                -0.00000   -0.00014   -0.00007   -0.02098   -0.04172   -0.00565   -0.00089    0.00872    0.06203
       H                 0.00001   -0.00001    0.00059   -0.03386   -0.04489   -0.01431   -0.00026    0.01280    0.09056
       H                 0.00027   -0.00086   -0.00026   -0.01371   -0.04103   -0.00037    0.00447   -0.01244    0.05830
       H                -0.00100    0.00037   -0.00009   -0.01909   -0.05378    0.00053   -0.00714    0.03184    0.05125
       C                 0.00038    0.00002   -0.00063    0.03259   -0.01489    0.02750   -0.00998   -0.03266   -0.08105
       H                 0.00605   -0.00192    0.00214    0.03357   -0.02260    0.03160   -0.00861   -0.00201   -0.09608
       H                -0.00015    0.00130    0.00050    0.04094   -0.01659    0.03690   -0.01454   -0.04747   -0.10460
       H                 0.00321   -0.00229   -0.00601    0.03458    0.00065    0.02374   -0.01206   -0.05493   -0.07715
       C                -0.00034    0.00054   -0.00068    0.01391   -0.01181    0.01011   -0.00015   -0.07004   -0.01670
       H                -0.00027   -0.00013   -0.00064    0.01298    0.00178    0.00641    0.00106   -0.09080   -0.01061
       H                 0.00049   -0.00038   -0.00116    0.02219   -0.01157    0.01753   -0.00395   -0.08757   -0.04008
       H                -0.00080    0.00045    0.00049    0.00490   -0.01757    0.00317    0.00490   -0.06648    0.01398
       C                -0.00057    0.00026   -0.00045    0.01772   -0.04451    0.01906   -0.00558    0.00148   -0.03861
       H                -0.00081   -0.00125    0.00014    0.02208   -0.05157    0.02294   -0.00974    0.03588   -0.05634
       H                -0.00158   -0.00020   -0.00081    0.00629   -0.05180    0.01223   -0.00477    0.00679   -0.00328
       H                 0.00005   -0.00022   -0.00045    0.02637   -0.04680    0.02536   -0.00470   -0.02012   -0.05942
      Re                 0.00033   -0.00240   -0.00099    0.00885    0.00786   -0.00058    0.00168    0.00157   -0.00594
       C                -0.00399    0.00165    0.00055   -0.00609    0.01331   -0.02358    0.00130    0.00181   -0.00152
       O                 0.00159    0.00172   -0.00028   -0.01677    0.01802   -0.04214    0.00118    0.00131    0.00351
       N                 0.00665   -0.02776    0.00081    0.01789    0.00855    0.00619    0.00589    0.00734   -0.00078
       C                 0.15311    0.12981   -0.07756    0.01193    0.00896    0.00068    0.00100   -0.00204    0.00464
       C                 0.02449    0.03540   -0.00744   -0.01427    0.00693   -0.00921   -0.00481   -0.00890    0.02158
       C                 0.00169    0.03719   -0.00620   -0.08129    0.00228   -0.02839   -0.05581    0.00246    0.02540
       C                 0.01269   -0.00301   -0.00407    0.01553    0.00757    0.00052    0.03635   -0.02856    0.03869
       C                -0.01020    0.02680    0.00366   -0.12128   -0.00204   -0.03827   -0.06706   -0.00628    0.04623
       H                 0.00806    0.04699   -0.00523   -0.10270    0.00343   -0.03579   -0.08601    0.01952    0.01189
       C                -0.00407   -0.00704   -0.00192   -0.02321    0.00349   -0.00953    0.02691   -0.03737    0.05958
       H                 0.02841   -0.01684   -0.01935    0.06709    0.01080    0.01486    0.07584   -0.03690    0.03604
       C                -0.00731    0.00330    0.00704   -0.09271   -0.00154   -0.02924   -0.02550   -0.02609    0.06312
       H                -0.01664    0.03436    0.01268   -0.17467   -0.00579   -0.05343   -0.10749    0.00258    0.04892
       H                -0.00869   -0.01577   -0.00231   -0.00021    0.00425   -0.00237    0.05990   -0.05311    0.07287
       H                -0.01048   -0.00185    0.02021   -0.12429   -0.00507   -0.03730   -0.03363   -0.03295    0.07907
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。

次に、`vibration_animation`内の虚振動を示す分子振動が示されたxyzファイル(`mode_1_XXXi_wave_number.xyz`)をAvogadroで確認すると、想定される反応系と生成系をつなぐ方向に振動していることを確認できた。


## 終わりに
　
　自作ライブラリで、UMAモデルのニューラルネットワークポテンシャル(NNP, `uma-s-1p1`)を用いて、MOBH35データセットのNo. 24の反応のある1つの遷移状態構造を算出する手順を説明した。



## 参考
- https://github.com/ss0832/MultiOptPy (自作ライブラリMultiOptPyのレポジトリ)
- https://avogadro.cc/ (Avogadro、分子構造可視化ツール)
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)
- _The Journal of Chemical Physics_ 2010, 132, 241102.
- _The Journal of Chemical Physics_ 1991, 94, 751–760.
- In _Classical and Quantum Dynamics in Condensed Phase Simulations_; WORLD SCIENTIFIC: LERICI, Villa Marigola, 1998; pp 385–404.
- _The Journal of Chemical Physics_, 2020, 153, 024109.
- _The Journal of Chemical Physics_, 2022, 144, 214108.
- _J. Phys. Chem. A_ 2019, 123, 3761−3781 http://dx.doi.org/10.1021/acs.jpca.9b01546 (MOBH35のデータセットについて)


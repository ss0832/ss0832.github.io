---
title:  【計算化学】自作pythonライブラリで遷移状態構造を求めてみる(BH9データセットの3. Halogen atom transfer, No. 41の化学反応, NNP(UMA)使用)
published: 2025-11-19
description: ""
tags: [MultiOptPy, python]
category: Computational Chemistry
draft: false
---
最終更新：2025-11-19

import MoleculeViewer from '../../components/MoleculeViewer.astro';
import MultiDataGraph from '../../components/MultiDataGraph.astro';

## 概要

本記事では、自作ライブラリ(MultiOptPy)で、BH9データセットの3. Halogen atom transfer, No. 41の素過程の遷移状態構造を算出してみる。計算レベルは、Meta社のFAIR Chemistryが開発したニューラルネットワークポテンシャル(NNP)であるUMA(Meta’s Universal Model for Atoms)とした。

MultiOptPyは電子状態計算ソフトウェアを用いた分子構造最適化手法の勉強を目的として作成したpythonライブラリである。

MultiOptPyのレポジトリ:https://github.com/ss0832/MultiOptPy

BH9のデータセットについて:

- _J. Chem. Theory Comput._ 2022, 18, 1, 151–166 

https://doi.org/10.1021/acs.jctc.1c00694


この文献のSupporting Informationから、データセットの詳細を確認できる。

有機金属錯体が関わる反応を除いたさまざまなカテゴリの反応がまとめられたデータセットである。DFTの汎関数の電子エネルギーの精度の比較などのベンチマークに主に使われる。

今回使用したニューラルネットワークポテンシャルについて：
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)



## 使用した自作ライブラリMultiOptPyのバージョン
```
v1.20.0-rc.1
```
## 環境
```
Windows 11
```
※Windows 11環境下でAnaconda PowerShell Promptを使用した。

## Source codeのダウンロード(Unixコマンド)
```
wget https://github.com/ss0832/MultiOptPy/archive/refs/tags/v1.20.0-rc.1.zip
unzip v1.20.0-rc.1.zip
cd MultiOptPy-v1.20.0-rc.1
```
https://github.com/ss0832/MultiOptPy/releases/tag/v1.20.0-rc.1 にアクセスしてzipファイルをダウンロードする。Unixコマンドの場合とはディレクトリ名が異なるので都度読み替えていただけると良い。

移動先のディレクトリで`requirements.txt`を参照することで、本ソースコードで必要なモジュールを把握することが出来る。導入方法は各自の状況に合わせて適宜LLMとの対話などで調べると良い。

次に述べる環境構築手順を使用する場合は、環境構築が終わった後、`pip install -r requirements.txt`で本自作モジュールが動作させるために最低限必要なモジュールを導入することが可能である。

### 環境構築手順

今回は、Windows 11のPower Shellを使用した。初めに、NNPを使用できる環境が整ったAnaconda PowerShell Promptを用意する手順を説明する。

1, https://repo.anaconda.com/archive/ より、`Anaconda3-2025.06-1-Windows-x86_64.exe`でAnacondaをインストールする。

2, 検索機能を使い、スタートから`Anaconda PowerShell Prompt`を開く。

3, 以下のコマンドを実行し、仮想環境を作成する。
```
conda create -n (任意の仮想環境名) python=3.12.7
```

4, 先ほど作成した仮想環境を`conda activate (仮想環境名)`で起動させる。

5, 以下のコマンドを実行し、必要なライブラリを導入する。
```
pip install ase==3.26.0 fairchem-core==2.7.1 torch==2.6.0
```
- fairchem-coreは、FAIR Chemistryが管理しているNNPを動作させるために必要なライブラリである。
- aseはNNPに電子エネルギーを算出したい分子構造を渡すために必要なインターフェイスの役割を果たすために必要なライブラリである。
- torchはPyTorchライブラリを指す。これはニューラルネットワークなどの機械学習を行ったり、学習結果を扱ったりするために必須なライブラリである。

これで、`Anaconda PowerShell Prompt`から仮想環境を立ち上げることで、NNPを使用する準備が整えることが出来る。

次に、NNPを使用するために必要なModelの情報が保存されている`.pt`ファイルのダウンロードおよびNNPの自作ライブラリへの導入方法について説明する。


1, 以下のサイトにアクセスして、`uma-s-1p1.pt`をダウンロードする。（使用許諾が下りていれば可能である。）
```
https://huggingface.co/facebook/UMA
```

2, ダウンロード後、`MultiOptPy-v1.20.0-rc.1`ディレクトリ内に存在する`software_path.conf`に対して、`uma-s-1p1.pt`の絶対パスを用いて以下を追記する。
```
uma-s-1p1::(uma-s-1p1.ptの絶対パス)
```

これで、`MultiOptPy-v1.20.0-rc.1`がNNP`uma-s-1p1`を使用できるようになる。


### 使用するNNPに関する具体的な説明

今回使用するNNPについて具体的に説明する。

- UMAのModel Checkpointは`uma-s-1p1`を使用した。
- 小分子系のトレーニングセットである`Omol25`(`omol`)を使用して学習したニューラルネットワークポテンシャルを使用する。

※自作ライブラリでの具体的な使用の仕方に関しては、`ase_calculation_tools.py` を参照すると良い。`omol`以外のモデルを使用したい場合は、現バージョンでは、`multioptpy/Calculator/ase_tools/firechem.py`内の、`self.task_name`を編集することで対応可能である。


## 手順

### 1. 初期構造の準備

モデル反応系として、以下の構造を用意した。今回はファイルの名前を`bh9_3_41.xyz`とした。
初期構造は以下のものを使用した。

```
44
OptimizedStructure
C     -2.088061845253      0.796979351931     -1.324685410958
C     -2.885141167249     -0.365073878801     -0.689379850441
C     -3.368584074905      0.243784147123      0.640704512295
C     -2.297654959523      1.264181142721      1.023335369796
C     -1.965605503332      1.926781496305     -0.314172762849
C     -1.599448869382      0.791427726691     -2.531416937809
C     -1.948592882812     -1.546952395164     -0.421459322098
C     -4.042995800750     -0.812653953359     -1.574504338760
H     -3.532204066275     -0.523691337014      1.399959719449
H     -4.320560335023      0.758552730056      0.477925264375
H     -1.415103705258      0.759841806356      1.424848646887
H     -2.636156691559      1.977851076569      1.774564305709
H     -2.717684832056      2.686304188301     -0.548193687065
H     -0.992495232286      2.415591776993     -0.339703307062
H     -1.568179114880      0.151957637602     -3.398167350963
Cl     0.966751816935     -0.932859448061      2.336882966393
H     -1.148208855632     -1.276567885939      0.269051180163
H     -1.494565871236     -1.894569771196     -1.351892796630
H     -2.507507286844     -2.376203216227      0.019366137038
H     -3.678022880334     -1.231044566408     -2.514268656897
H     -4.700733171995      0.025239676740     -1.810119224901
H     -4.632628497884     -1.581904569563     -1.070064196708
C      2.361937754963     -1.262591593597      1.190116707842
C      2.585962935041     -0.013091484641      0.346125382797
C      3.526244426921     -1.603348520670      2.080024093904
C      4.686688169562     -0.969291354009      2.128746822510
H      2.796838835594      0.824684634805      1.014015847823
H      3.487347416124     -0.186039263593     -0.252401139677
C      1.438455621097      0.358121179694     -0.581512610639
H      0.506448766065      0.418828102829     -0.017550982764
C      1.677305760288      1.698311044666     -1.284529860952
H      1.295846368777     -0.404407655079     -1.349836789289
H      2.604897247703      1.660977368209     -1.862914265229
H      0.866111149129      1.879491158101     -1.994474339790
C      1.746655025308      2.818073081118     -0.345024386855
C      1.789755984862      3.715470637678      0.448934063369
H      1.825567575617      4.509271341939      1.154988147966
C      1.976688330770     -2.479052763504      0.358083983285
H      2.765593603828     -2.675989594254     -0.371551178813
H      1.038432059941     -2.316610056080     -0.168780332271
H      1.866011976907     -3.356457105376      0.994297881597
H      3.358770547436     -2.467112887213      2.716013621472
H      4.902703074900     -0.098909007801      1.523703568575
H      5.469121196700     -1.307298998879      2.794915506177
```

<MoleculeViewer 
  xyzData={`44
OptimizedStructure
C     -2.088061845253      0.796979351931     -1.324685410958
C     -2.885141167249     -0.365073878801     -0.689379850441
C     -3.368584074905      0.243784147123      0.640704512295
C     -2.297654959523      1.264181142721      1.023335369796
C     -1.965605503332      1.926781496305     -0.314172762849
C     -1.599448869382      0.791427726691     -2.531416937809
C     -1.948592882812     -1.546952395164     -0.421459322098
C     -4.042995800750     -0.812653953359     -1.574504338760
H     -3.532204066275     -0.523691337014      1.399959719449
H     -4.320560335023      0.758552730056      0.477925264375
H     -1.415103705258      0.759841806356      1.424848646887
H     -2.636156691559      1.977851076569      1.774564305709
H     -2.717684832056      2.686304188301     -0.548193687065
H     -0.992495232286      2.415591776993     -0.339703307062
H     -1.568179114880      0.151957637602     -3.398167350963
Cl     0.966751816935     -0.932859448061      2.336882966393
H     -1.148208855632     -1.276567885939      0.269051180163
H     -1.494565871236     -1.894569771196     -1.351892796630
H     -2.507507286844     -2.376203216227      0.019366137038
H     -3.678022880334     -1.231044566408     -2.514268656897
H     -4.700733171995      0.025239676740     -1.810119224901
H     -4.632628497884     -1.581904569563     -1.070064196708
C      2.361937754963     -1.262591593597      1.190116707842
C      2.585962935041     -0.013091484641      0.346125382797
C      3.526244426921     -1.603348520670      2.080024093904
C      4.686688169562     -0.969291354009      2.128746822510
H      2.796838835594      0.824684634805      1.014015847823
H      3.487347416124     -0.186039263593     -0.252401139677
C      1.438455621097      0.358121179694     -0.581512610639
H      0.506448766065      0.418828102829     -0.017550982764
C      1.677305760288      1.698311044666     -1.284529860952
H      1.295846368777     -0.404407655079     -1.349836789289
H      2.604897247703      1.660977368209     -1.862914265229
H      0.866111149129      1.879491158101     -1.994474339790
C      1.746655025308      2.818073081118     -0.345024386855
C      1.789755984862      3.715470637678      0.448934063369
H      1.825567575617      4.509271341939      1.154988147966
C      1.976688330770     -2.479052763504      0.358083983285
H      2.765593603828     -2.675989594254     -0.371551178813
H      1.038432059941     -2.316610056080     -0.168780332271
H      1.866011976907     -3.356457105376      0.994297881597
H      3.358770547436     -2.467112887213      2.716013621472
H      4.902703074900     -0.098909007801      1.523703568575
H      5.469121196700     -1.307298998879      2.794915506177`}
  caption="初期経路を求めるための初期構造"
  backgroundColor="#333333"
/>


### 2. 遷移状態構造最適化

　`run_autots.py`を適切に使用することで、自動的に遷移状態構造が得られる。以下にその手順を説明していく。

初期構造をカレントディレクトリに`bh9_3_41.xyz`として保存する。その後、同じディレクトリ内で、`config_bh9_3_41.json`を作成し、以下のように記述する。

`config_bh9_3_41.json`
```json
{
  "work_dir": "bh9_3_41",
  "top_n_candidates": 3,
  "multioptpy_version": "1.20.0-rc.1",
  
  "step1_settings": {
    "othersoft": "uma-s-1p1",
    "opt_method": ["rsirfo_block_fsb"],
    "use_model_hessian": "fischerd3",
    "spin_multiplicity": 2,
    "electronic_charge": 0,
	"manual_AFIR": ["600", "6", "16"]
  },
  
  "step2_settings": {
    "othersoft": "uma-s-1p1",
    "NSTEP": 15,
    "ANEB": [3, 5],
    "QSM": true,
    "use_model_hessian": "fischerd3",
    "save_pict": true,
    "node_distance_bernstein": 0.50,
    "align_distances": 9999,
    "spin_multiplicity": 2,
    "electronic_charge": 0
  },
  
  "step3_settings": {
    "othersoft": "uma-s-1p1",
    "opt_method": ["rsirfo_block_bofill"],
    "calc_exact_hess": 5,
    "tight_convergence_criteria": true,
    "max_trust_radius": 0.2,
    "frequency_analysis": true,
	"NSTEP": 500,
	"detect_negative_eigenvalues": true,
    "spin_multiplicity": 2,
    "electronic_charge": 0
  },

  "step4_settings": {
    "othersoft": "uma-s-1p1",
	"opt_method": ["rsirfo_block_bofill"],
    "spin_multiplicity": 2,
    "electronic_charge": 0,
	"calc_exact_hess": 10,
    "tight_convergence_criteria": true,
    "frequency_analysis": true,
    
    "intrinsic_reaction_coordinates": ["0.5", "200", "lqa"],

    "step4b_opt_method": ["rsirfo_block_fsb"]
  }
}
```
その後、以下のコマンドを実行する。
```
python run_autots.py bh9_3_41.xyz -cfg config_bh9_3_41.json
```

これにより、これまでの似た内容の記事で行ってきたコマンドの操作をまとめ、遷移状態構造を求める処理を自動的に行う。

具体的な処理の流れは、
```
Step1. バイアスポテンシャルによるNEB法のための初期経路の作成

Step2. NEB法による経路の緩和

Step3. NEB法により得られた経路のエネルギー極大値を示す構造のうち、エネルギー値が上位の最大で3個
(`run_autots.py`にて、`--top_n X`で最大値を変更可能)の構造を初期構造とした遷移状態構造の算出

(Step4.得られた遷移状態構造に対するIRC計算とIRC経路の末端に存在する構造に対する構造最適化。
こちらは`--run_step4`をコマンドで追記しなければ行わない。)
```
となっている。

`run_autots.py`のオプションの説明：

- `-cfg YYY.json`は、workflowを実行するためのオプションが記されたJSONファイルの読み込み先を指定する。


これらの一連の結果は、`(jsonファイルの"work_dir"にて指定した名前)`のディレクトリの中に存在するファイルを開いて確認できる。

以下にすべてのstepで共通のオプションに関する説明を載せる。

- `"opt_method": ["rsirfo_block_fsb"]`は準ニュートン法であるRS-I-RFO法を構造最適化に使用することを示す。初期のへシアンに関しては、特にオプションで指定しない限り、単位行列が使われる。(以前のHessian更新法とは細かな点で異なる方法を使用している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `"spin_multiplicity": Z`はスピン多重度の指定である。PySCFを使用するときは目的とするスピン多重度に1を引いた値を指定する。（デフォルトでは1が指定される。）
- ` "electronic_charge": 0`は形式電荷をMとすることを示す。（デフォルトでは0が指定される。）
- `"othersoft": "uma-s-1p1"`は今回使用するNNPを指定している。これを使用する際にASEライブラリが必要である。
- `"use_model_hessian": "fischerd3"`は、計算コストが非常に低い数式を使用して、近似したHessianを生成する機能を呼び出すオプションである。デフォルトではこの機能は使用されない。


※オプションの説明は`MultiOptPy-v1.20.0-rc.1/OPTION_README.md`にて示されている。


#### Step 1


Step1では、`omol`のデータセットを使用した`uma-s-1p1`モデルのNNPで得たエネルギーに対して、指定した人工力ポテンシャルを加えた上で初期構造を構造最適化を行っている。


以下のJSON内で記述したバイアスポテンシャルで、次の経路緩和アルゴリズムの初期経路として用いるトラジェクトリーを生成する。
- `"manual_AFIR": ["yyy", "a", "b]`：yyykJ/molの活性化障壁を超えうるペア同士を近づける力を原子のラベル番号aとbのペアに構造最適化時に加えることを示す。


Step1が正常終了していれば作成された`work_dir`ディレクトリ中に、`bh9_3_41_step1_traj.xyz`が存在する。必要に応じて確認し、目的に沿った初期経路が得られているか確認する。もし想定とは異なる場合は、プロセスをkillして再度設定を見直してやり直す。


`bh9_3_41_step1_traj.xyz`は構造最適化の過程をAvogadro（公式ページ:https://avogadro.cc/ ）等で可視化して確認できるようにしている。この`bh9_3_41_step1_traj.xyz`はStep2のNEB計算に使用している。

※`bh9_3_41_step1_traj.xyz`をアニメーションとして表示したい場合は、[https://github.com/ss0832/molecule_movie] を使うと良い。


#### Step 2

Step2では、NEB法を用いることで、先ほど得られた`bh9_3_41_step1_traj.xyz`全体のエネルギーを下げることができる。これにより、パスのエネルギー極大値を持つ構造を遷移状態構造に近づける。（この時点ではまだ正確な遷移状態構造は求められていない。）

Step2固有のオプションについて以下に示す。


- `"NSTEP": n`はn回分NEB法による経路の緩和を行うことを示す。
- `"align_distances": X`は線形補間で、各ノード間の距離を全て等しくするための処理である。X回の反復計算ごとに本処理を行う。Xを`"NSTEP": n`よりも大きな数値を指定することで、初期経路に対してのみ処理を行うことが出来る。
- `"node_distance_bernstein": N`はノード間の距離をN Åとして初期経路を作成することを示す。経路作成時に元のノードをベルンシュタイン多項式を用いてがたついた経路を滑らかにする。

→プログラムの仕様上`"align_distances": X`の処理を行った後に、`"node_distance_bernstein": N`の処理を行うようになっている。

- `"save_pict": true`は緩和中のパスのエネルギープロファイルや各ノードの勾配のRMS値をmatplotlibで可視化するオプションである。
- `"ANEB": [A, B]`これを指定すると、(B+1)回の緩和ごとに、エネルギー極大値を示すノードと前後のノードの間に線形補間でA個の新規ノードを内挿するようにできる。デフォルトではこのような操作は行われない。このオプションを使用するとノードの数が徐々に増えるため、計算コストが使用しない場合と比べて増加する。一方で、エネルギー極大値を示すノード周辺にノードを増加させるため、緩和している経路中のノードが遷移状態構造付近に存在する可能性が高くすることが出来る。


`MultiOptPy-v1.20.0-rc.1/"work_dir"`と同じディレクトリ内に、NEBという名前を含むディレクトリが生成されている。
そのディレクトリ内の`energy_plot.csv`を確認し、緩和後のパスのエネルギー極大値を示す構造を確認する。

経路の緩和後の各ノードのエネルギー一覧(単位:hartree) (energy_plot.csvに保存されている。)

export const dataset1 = [-1123.3890751611978,-1123.3890751611978,-1123.376522846944,-1123.3476446855204,-1123.3151362409571,-1123.285771693568,-1123.26285448265,-1123.2482982375072,-1123.2418763713501,-1123.2419083078123,-1123.2445959823303,-1123.2456556420282,-1123.2445286923362,-1123.244357751218,-1123.2565806895273,-1123.280060069795,-1123.3008918078342,-1123.3192000046183,-1123.3362156902874,-1123.3514628275602,-1123.3643220900194,-1123.3746433116755,-1123.382643098078,-1123.3887447996797,-1123.3934178958036,-1123.3970415693223,-1123.399882506002,-1123.40213321393,-1123.4039395833772,-1123.405392079082,-1123.4065237381972,-1123.4073400707484,-1123.407875330672,-1123.4082119054974,-1123.4084474818092,-1123.4086626717935,-1123.4089008240503,-1123.4091702249743,-1123.4094786790658,-1123.40982789486,-1123.4102120085768,-1123.4106322994273,-1123.4110771603255,-1123.411514067774,-1123.4119031296711,-1123.4122016567362,-1123.4123706286582,-1123.4124074103504,-1123.4123845006482,-1123.4124433049185,-1123.4127007417167,-1123.413152095048,-1123.4136939503546,-1123.4142244526654,-1123.4147001460492,-1123.4151206690851,-1123.4154962313653,-1123.4158321183959,-1123.4161299401426,-1123.416398583178,-1123.4166564909185,-1123.416913058116,-1123.417175854895,-1123.4174378828334,-1123.4176850662311,-1123.41790828633,-1123.4181132732938,-1123.418307170113,-1123.4184906382973,-1123.418658309104,-1123.4188037426707,-1123.4189278370732,-1123.4190393146016,-1123.4191474889624,-1123.4192675836405,-1123.4194381918132,-1123.4196913309888,-1123.4199882349455,-1123.4202702001733,-1123.4205342126406,-1123.4207496632862,-1123.4208677515307,-1123.4209333724177,-1123.420948698853];

export const dataset1_itr5 = [-1123.3890760933625,-1123.3890759030346,-1123.3800359136299,-1123.35446920738,-1123.3253826671123,-1123.298462227243,-1123.275966595148,-1123.264136216852,-1123.2622975790928,-1123.2664306128963,-1123.276825383699,-1123.2826922651147,-1123.2802262708237,-1123.2684565148545,-1123.2686625116062,-1123.2931649889224,-1123.3163713321533,-1123.3362794361667,-1123.3533331586439,-1123.3679239819069,-1123.380100212045,-1123.38991177319,-1123.3975538100221,-1123.4033988090473,-1123.40788353164,-1123.4113794395962,-1123.414183671249,-1123.4164610367038,-1123.4182603277782,-1123.4195920081536,-1123.4204926558123,-1123.4210314072805,-1123.4213307908033,-1123.4214720056027,-1123.421541529835,-1123.4216034708004,-1123.421703739901,-1123.4217023073602,-1123.421746538703,-1123.4221904423835,-1123.4224542599027,-1123.4232099602702,-1123.423860062222,-1123.424381702055,-1123.4248714098067,-1123.4252878060734,-1123.4254543707134,-1123.4259410228158,-1123.42625525307,-1123.426303442519,-1123.4266635140816,-1123.4271542666684,-1123.4275910602146,-1123.427847804837,-1123.4280301887588,-1123.4280173002717,-1123.428355441254,-1123.428611454273,-1123.428977479423,-1123.429334094488,-1123.429700465726,-1123.4301159201082,-1123.4305212152783,-1123.4308698703223,-1123.4311663975254,-1123.4314177142635,-1123.431631548372,-1123.4318551298918,-1123.4321073359442,-1123.4323376114164,-1123.4325539075678,-1123.4327334965014,-1123.4328719535501,-1123.4329683893993,-1123.4330540921437,-1123.433155303129,-1123.4332941106466,-1123.4334902592273,-1123.4337296074586,-1123.4339839513702,-1123.4342132586728,-1123.434316646945,-1123.4340037922807,-1123.4337476346934];

export const dataset1_itr10 = [-1123.3890766762563,-1123.3890763583358,-1123.3841742490943,-1123.3641080259158,-1123.3404659909247,-1123.3174060516208,-1123.2967320858374,-1123.2881911456132,-1123.2881432978713,-1123.2878370057335,-1123.287089429669,-1123.285993277416,-1123.287607545101,-1123.288289171714,-1123.2890594844368,-1123.2893206975352,-1123.303543699496,-1123.310096115251,-1123.3058734928811,-1123.2901677103373,-1123.2844665305322,-1123.270746398614,-1123.269595091346,-1123.2766447258357,-1123.2842423094069,-1123.2902075673924,-1123.2955247298596,-1123.2987978886592,-1123.3208528545285,-1123.339887126121,-1123.3564756561336,-1123.3707812110013,-1123.3825873516473,-1123.392062989209,-1123.3993610370226,-1123.404919634105,-1123.4091331541456,-1123.4124014830481,-1123.41501155503,-1123.417110385148,-1123.4187833103445,-1123.4200189601002,-1123.4208682202827,-1123.4214114073707,-1123.4217556530803,-1123.422006433163,-1123.4222060360512,-1123.422448334791,-1123.4226192737185,-1123.4229476870037,-1123.4229502585679,-1123.4230759037944,-1123.4230137459765,-1123.4230630569255,-1123.423243292036,-1123.423465232924,-1123.4235224272286,-1123.42360168792,-1123.4238617291387,-1123.4243218244742,-1123.424900899559,-1123.4253385933719,-1123.4257132926227,-1123.4260444373733,-1123.42617457079,-1123.4264736213677,-1123.4267026351527,-1123.426917998181,-1123.4271928576552,-1123.4276515774009,-1123.4281214420516,-1123.428499672275,-1123.428868334702,-1123.4290633354979,-1123.429562359146,-1123.4298566608727,-1123.4301554617414,-1123.4304274473723,-1123.4306604083113,-1123.4309374932618,-1123.4312159450405,-1123.4314542243424,-1123.4316716200892,-1123.4318436432795,-1123.43202755174,-1123.432207850373,-1123.432389235459,-1123.4325436037875,-1123.4326976172663,-1123.4328306289071,-1123.43294676986,-1123.4330438453146,-1123.4331321415277,-1123.4332385657353,-1123.4333899068902,-1123.433598724915,-1123.4338263236825,-1123.4341028040749,-1123.4342954961578,-1123.4343935792099,-1123.434396089442,-1123.4343947927077,-1123.434371267495,-1123.434348119036,-1123.4342974193548,-1123.4343302495122,-1123.434346379835,-1123.4342549556886];

export const dataset2 = [-1123.3890769541329,-1123.3890765111526,-1123.3865119770364,-1123.371560030257,-1123.3533738502526,-1123.334033238333,-1123.316032279952,-1123.3082170947337,-1123.3076984798838,-1123.3071707791323,-1123.3034432463992,-1123.3004667068005,-1123.301254210014,-1123.3012493384986,-1123.3012934274636,-1123.3028162315743,-1123.3023581163873,-1123.302616683447,-1123.305299985868,-1123.308350465605,-1123.3083916456794,-1123.3130578825933,-1123.3211835480506,-1123.3236034995139,-1123.3215130236943,-1123.3097782050754,-1123.2980391151193,-1123.2797351239597,-1123.2734243651487,-1123.270948005745,-1123.270756991531,-1123.2724602607473,-1123.274710620397,-1123.2770885681841,-1123.2794608909483,-1123.2813267864124,-1123.2909725529905,-1123.2967371150635,-1123.3004039991847,-1123.3026647414704,-1123.323531013821,-1123.3421112926148,-1123.3584539688204,-1123.3723934602056,-1123.3838787352388,-1123.3930881362257,-1123.4001270948359,-1123.4054735663449,-1123.4095318385994,-1123.4127005270545,-1123.4152318487152,-1123.4173173413078,-1123.4189322047896,-1123.4201424236587,-1123.420965733823,-1123.421484164677,-1123.4218091827963,-1123.4220495539582,-1123.422259666527,-1123.4225226801586,-1123.4227879258378,-1123.4231036981544,-1123.4232138154262,-1123.4232635556991,-1123.4232539112381,-1123.423260357672,-1123.4232614463156,-1123.423264534821,-1123.4233072438155,-1123.4233317306268,-1123.4233561977244,-1123.4233788160993,-1123.4234950906684,-1123.4236362945157,-1123.4237465454037,-1123.4238299043886,-1123.4241710243552,-1123.4245946906576,-1123.4250624722101,-1123.4254887648374,-1123.4258251709998,-1123.4261507739639,-1123.426355986542,-1123.426571787656,-1123.426780951769,-1123.427019743631,-1123.4272944804413,-1123.427756617257,-1123.4282230166484,-1123.42869074344,-1123.429037632998,-1123.4294291459858,-1123.4297287835986,-1123.4300142097047,-1123.430265552728,-1123.4305153974974,-1123.4307577466172,-1123.4310077578593,-1123.4312723573619,-1123.431503605385,-1123.4317134353882,-1123.4319137414043,-1123.4320717589883,-1123.4322447678717,-1123.432409115797,-1123.432553246058,-1123.4327131693158,-1123.4328447615583,-1123.4329577482927,-1123.4330527296966,-1123.4331392735662,-1123.4332469726037,-1123.4333992162155,-1123.4336111052228,-1123.4338545451762,-1123.434128309436,-1123.4343147325096,-1123.434406901402,-1123.4344192203775,-1123.4344268781192,-1123.4344210471959,-1123.4344197504615,-1123.434409823435,-1123.434398726719,-1123.4344105331343,-1123.434419518276,-1123.4344264268907,-1123.4344260545176,-1123.4344169204267,-1123.434408487273,-1123.4343998920276,-1123.4343863814586,-1123.4343919013409,-1123.4343964223874,-1123.434402152551,-1123.4344163772,-1123.4344120051028,-1123.4343227451006];

<MultiDataGraph datasets={[ { data: dataset1, label: "緩和前の経路のエネルギー", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_itr5, label: "ITR. 5の経路のエネルギー", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_itr10, label: "ITR. 10の経路のエネルギー", color: "rgba(81, 143, 18, 1)"}, { data: dataset2, label: "緩和後の経路のエネルギー", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="Electronic Energy [hartree]" height="500px" />

export const dataset1_grad = [4.963657682705335e-05,4.963674376425554e-05,0.004336651786021215,0.006989192555332563,0.00882821079323897,0.009979669152414512,0.010567486902284163,0.010904877857535975,0.011336730896514075,0.011918851556578684,0.012708376586335437,0.012653381249213929,0.011490436172022469,0.008255371203604884,0.007640676418293663,0.009833218830758873,0.012500986881562481,0.01446657497592628,0.01507734294061596,0.01495475105068683,0.014599372175989734,0.01422387016640245,0.013899799506706664,0.013644736518924705,0.013448592927457374,0.013297287677383012,0.01318200124194948,0.01309339389083717,0.013016312412561517,0.012936929247493992,0.012853936756104122,0.012778326257995284,0.012721314040715127,0.01268740445621079,0.01267655802150831,0.012687024539517096,0.01271341806150466,0.012741523954634196,0.012761617705034586,0.012766195947163207,0.012756033710697908,0.012738973491771098,0.012723512420091801,0.01271556645259302,0.012716583966633822,0.012726128674343376,0.012744206059970105,0.012770162156179737,0.012796348195530828,0.012805570070478077,0.012785335838438359,0.0127464592387985,0.012715891470125128,0.012710974140264193,0.012728227092348762,0.012752505858242552,0.012769397323135099,0.012772922691493039,0.012764408314376492,0.01274732242209408,0.012725262286967598,0.012701873542910648,0.012682383817554066,0.012673708180308635,0.012678729350746334,0.01269167806431238,0.012701869054213472,0.012701740036116507,0.012691436419593825,0.012678287083107297,0.012673736240551074,0.012684644848054365,0.012705668490334871,0.012722027632106413,0.012722132612665835,0.012704468818321825,0.012677034930144085,0.012657910751018743,0.01265442698989189,0.012658662403519653,0.012669562734105671,0.012678182678973658,0.012679560550721105,0.012670635337812272];

export const dataset1_grad_itr5 = [3.4093181770838074e-05,3.992743438417456e-05,0.0026929278229869532,0.005464378391232237,0.007409383421061241,0.008762265722645119,0.009536569279248843,0.009917896018151278,0.009990424167847168,0.009917353957733846,0.009527644181571619,0.009843298618798235,0.010788837480646962,0.009926764812290144,0.0054818141917442696,0.004729408932120567,0.003880181303394054,0.003582635099324339,0.003648280929627838,0.003692370907364854,0.003571196092521701,0.003293361754283623,0.0029411526361174047,0.0025909863379032535,0.0022742550339050417,0.0020036472880163164,0.0017601725302431972,0.0015265935247287504,0.0013325633818082306,0.0012044498931261505,0.001152703090814907,0.0012068512202613453,0.001349451280342942,0.001614681557225553,0.0019554795490928445,0.0023102065951711,0.00262263108872464,0.0030001705105334076,0.003319267118075544,0.003290809397709169,0.0034442669843411226,0.0030921207811392495,0.0028494556429743364,0.002682273608879686,0.0025007903570589394,0.002350769933983964,0.0025822917799522495,0.0017747293969646875,0.0014145816599953546,0.0015675115914476551,0.0014671373525601326,0.0013232834393036106,0.0014050719453179445,0.0019316461961210298,0.002613806357515908,0.0032224611098720744,0.0032284866151171387,0.0032282805464600006,0.0030119600628315687,0.002753733882691769,0.0024525211433625575,0.0020991867971243577,0.0017937264367166013,0.0015771662977064676,0.0014253363523269716,0.001326505589295789,0.001274929208402646,0.0011929340254453777,0.0010148210203796768,0.0008232895695673519,0.000627393791380452,0.00046774349504355504,0.0003329872121958417,0.00038206610148564424,0.00043657466946676486,0.000443635579966898,0.0004331371641148787,0.0004454713092466991,0.0004651518283697708,0.0004557409956012567,0.00035370610340217036,0.00036269398812955646,0.0012819449145941857,0.0026510362456657706];

export const dataset1_grad_itr10 = [2.3108493304034306e-05,2.7672945046868627e-05,0.001854537392547818,0.0042836370126665725,0.0061115325082787796,0.007435185160843992,0.008259940086495242,0.008439455637041902,0.008368713232768025,0.008288315148598006,0.008353371949114612,0.008343356961639077,0.00818443805369279,0.008162712160227395,0.008084804449710435,0.008058040234737777,0.007100990228418307,0.007112703676726947,0.008357212618754656,0.009702345908758767,0.009387310834463829,0.008099278324474104,0.004577115128341838,0.00491426198942552,0.0044703487326684145,0.004056061431171109,0.0038993840873680482,0.0037169434956510236,0.002952638576121816,0.002563432447844283,0.0024011268650238156,0.0022287785604200566,0.0020291679926176154,0.0017622482502700377,0.0015047419176254123,0.0012452680976863446,0.001015448640710862,0.000826838896262499,0.0006635571158112431,0.0005538505557793177,0.0004802212175220391,0.00044457494901333866,0.00042384008365056725,0.0003707456629662089,0.00034115959537338157,0.0003390541525713783,0.0004952135533335321,0.0005388733203220333,0.0008728638092786003,0.0010592118774009043,0.0011372789215702082,0.001056623565039629,0.0013527728359399522,0.001456811693513424,0.0011406427562563565,0.0009706385155388433,0.0010677548468789617,0.0012797731932525356,0.001288351353560311,0.0013960481979346318,0.0009370517606249802,0.0008678181050445499,0.000786084160840012,0.0006464970453354314,0.0009853250018677974,0.0005956229250203141,0.0002625387913435819,0.00029217957452034823,0.0005625700106851153,0.00036742266138308925,0.0004271670341422811,0.0007521244095824027,0.001150753981398627,0.0014721696619032234,0.0010202315343717306,0.0009265771377746611,0.0007728027726190373,0.0006418763574426906,0.0006429401766997741,0.0004853154734448314,0.0003665952433051607,0.0003567390603034802,0.0003469127047160122,0.00037414138838054575,0.0004152003691459462,0.00029792936927939965,0.00015318472763548916,0.00014126829583454821,9.70583695427638e-05,9.021862144951648e-05,7.744308053295541e-05,6.9272141571006e-05,6.289484674823952e-05,6.55771511157339e-05,7.232469608540733e-05,0.00010182869255102297,0.0003638750346835676,0.00011332965495120011,7.347546097605388e-05,7.44535322148603e-05,0.0002417341499893965,0.000297849481389792,0.0004223650541001435,0.0003842474836040545,0.0004983133395427171,0.000705303749048552,0.0005360134139051708,0.0010925147827070994];

export const dataset2_grad = [1.6976983145186493e-05,2.6967987729375617e-05,0.0012906187724915734,0.003480553887915118,0.005075106258135805,0.006341978453673214,0.007109854956811943,0.007317416742412916,0.0073433146779219105,0.007329558682387025,0.007335831416870154,0.007507560514198115,0.007421090145398886,0.007353851108698579,0.007260474779768777,0.007036057589959289,0.007096632830817473,0.007056524782945547,0.006895204381452892,0.006787903271778598,0.00672591958661994,0.006479093341820017,0.005748956687360617,0.005939362079715524,0.006795708479169352,0.008427661794870084,0.009071617031344629,0.008917946644321193,0.007420793821348256,0.004380557720300509,0.00267871284401626,0.0035565703481237926,0.004500041102826575,0.004787485814019093,0.004759303019010501,0.004619661874325455,0.0038102755378439566,0.0033445080975854414,0.0034230614249439214,0.0032498534943348847,0.0025231785376214357,0.0021849347690832627,0.0019084461210713926,0.00168975351240861,0.0015212993767589767,0.0012547798251662998,0.0010244047664117227,0.0008072439736801553,0.0006407594622211042,0.0005154887882889015,0.00040653104877223925,0.0003008557365396045,0.0002648276865368855,0.00023856159489632717,0.00024779778679358066,0.00019899907480422818,0.00017739519640181978,0.00013989093822373573,0.00023858550569183566,0.00017908685448541882,0.0002130744302959377,0.00039670614656674207,0.00036275998660105876,0.0004543741705937433,0.0004973869883480696,0.000562603364360012,0.0006319512645859186,0.0006699967785277834,0.0005614032715669587,0.0005345242938683051,0.000511209042636502,0.000494622219074638,0.0007065907768640869,0.000427168223184418,0.00039880386023161384,0.00041524726251531427,0.0006197736980408362,0.0005559355926274681,0.0004418465246172971,0.0003142682028776907,0.00030224201216847536,0.0002462160342860092,0.00030085363357197745,0.0001906995214233017,0.0001083336102323958,0.00013794930444630682,0.0001953138462040204,0.00013395941245720577,0.0001950926055782129,0.0002716126903782279,0.0006189588631453391,0.00042721135727496383,0.00042866843791959446,0.0003071296268688491,0.0002572385766063282,0.000207388274673855,0.00021201284426084236,0.00015400538691894288,0.00013531704120217755,0.0001658215659268745,0.00014677667538262794,0.00012198952919224549,0.00012864656298481353,9.289883974941938e-05,5.986069902087537e-05,0.00010994349218025524,5.196607195447083e-05,4.971905366596801e-05,4.6466108206057353e-05,3.8902173302775337e-05,3.0678726269388996e-05,3.5145271162030346e-05,5.277613602875381e-05,0.00018880407755839294,0.00017475049465693365,5.6866046234388355e-05,3.732236760826167e-05,3.885338874551635e-05,7.588728654574271e-05,9.537294621193e-05,0.00012283063013604628,0.00013902338898967207,0.0001908801400134046,0.0002712629096500852,0.0002451592663881041,0.00019042767861588838,0.00014377874159536956,0.00011912913293333642,0.000127153748209697,0.00013804722173537984,0.0001515164399253892,0.00017017452029335223,0.00016526412199152908,0.00016174098695675098,0.00015663112820054362,0.0001581283527879103,0.00027281523077136234,0.0008084205127136577];

<MultiDataGraph datasets={[ { data: dataset1_grad, label: "緩和前の経路の勾配のRMS値", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_grad_itr5, label: "ITR. 5の経路の勾配のRMS値", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_grad_itr10, label: "ITR. 10の経路の勾配のRMS値", color: "rgba(81, 143, 18, 1)"},  { data: dataset2_grad, label: "緩和後の経路の勾配のRMS値", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="RMS of gradient [hartree/Bohr]" height="500px" />

※`bias_force_rms.csv`にて、各Iterationごとのすべてのノードの勾配のRMS値を確認できる。

経路緩和の結果、以下の構造がstep3の初期構造として用いられることとなった。"work_dir"内の`bh9_3_41_step3_TS_Opt_Inputs`内に保存された`bh9_3_41_ts_guess_X.xyz`にて確認が可能である。ts_guessの番号が小さい順にエネルギー値が高い構造を示すようになっている。

※こちら[https://ss0832.github.io/molecule_viewer/] を使うことでも可視化は可能である。


`bh9_3_41_ts_guess_1.xyz`
```
44
0 2
C      -1.843680048033      0.409444433601     -0.673875507822
C      -3.065641771709     -0.511998422778     -0.470883205706
C      -3.628314786581      0.138068886143      0.845474189711
C      -2.639348847680      1.215523368094      1.334589510234
C      -2.028155015299      1.713937737170      0.033436718340
C      -0.677985582571     -0.209156449091     -0.772224026754
C      -2.551198245755     -1.935921651945     -0.218623415915
C      -4.106491729823     -0.585757674917     -1.569408587187
H      -3.810856707923     -0.620214756061      1.606747027895
H      -4.580250118580      0.619273497090      0.614760543260
H      -1.837304902133      0.770951539674      1.923473025172
H      -3.107813673584      1.991031436219      1.939133826659
H      -2.751423394104      2.322635267792     -0.522652204300
H      -1.105846262591      2.291112357054      0.120948963324
H      -0.473630264757     -1.110918322105     -1.328927145788
Cl      0.276188850391     -0.350548413698      0.943734036109
H      -1.812964361253     -1.960057193610      0.583027299190
H      -2.068058310201     -2.319405724621     -1.120336688750
H      -3.362373483593     -2.614541003932      0.037386530703
H      -3.662002928570     -0.971492906084     -2.488608872578
H      -4.567435620941      0.378903288691     -1.779273831612
H      -4.887785671729     -1.282857501178     -1.258499773324
C       2.414875805058     -1.090569816974      0.677376680441
C       2.933637533977      0.123732040797     -0.071390995198
C       3.010051492037     -1.346088798771      1.978096704747
C       4.215526804352     -0.878055957599      2.311262033799
H       3.028641835317      0.923701525521      0.668978185418
H       3.941425774715     -0.131720565833     -0.413024395131
C       2.088196603978      0.643874490180     -1.234176890589
H       1.056646831778      0.688470129880     -0.925455454490
C       2.305006607808      2.087259977606     -1.705949389743
H       2.096189717948     -0.040781722480     -2.082534182002
H       3.253673916515      2.260009744049     -2.211150200779
H       1.511455513112      2.282256835239     -2.435839513059
C       2.125388840054      3.039078120570     -0.605114273454
C       1.944257990873      3.773056270615      0.325847903957
H       1.794034102027      4.428598076612      1.149320584108
C       2.167967998650     -2.390411249655     -0.041464757310
H       3.113964221703     -2.714488153304     -0.491459098175
H       1.402805137928     -2.363944879913     -0.815451868289
H       1.882503261446     -3.161557288193      0.683658970096
H       2.527049041984     -2.084358215575      2.615977714374
H       4.738837327879     -0.191925084232      1.660568305347
H       4.740236517883     -1.234147270050      3.182525525068
```

<MoleculeViewer 
  xyzData={`44
0 2
C      -1.843680048033      0.409444433601     -0.673875507822
C      -3.065641771709     -0.511998422778     -0.470883205706
C      -3.628314786581      0.138068886143      0.845474189711
C      -2.639348847680      1.215523368094      1.334589510234
C      -2.028155015299      1.713937737170      0.033436718340
C      -0.677985582571     -0.209156449091     -0.772224026754
C      -2.551198245755     -1.935921651945     -0.218623415915
C      -4.106491729823     -0.585757674917     -1.569408587187
H      -3.810856707923     -0.620214756061      1.606747027895
H      -4.580250118580      0.619273497090      0.614760543260
H      -1.837304902133      0.770951539674      1.923473025172
H      -3.107813673584      1.991031436219      1.939133826659
H      -2.751423394104      2.322635267792     -0.522652204300
H      -1.105846262591      2.291112357054      0.120948963324
H      -0.473630264757     -1.110918322105     -1.328927145788
Cl      0.276188850391     -0.350548413698      0.943734036109
H      -1.812964361253     -1.960057193610      0.583027299190
H      -2.068058310201     -2.319405724621     -1.120336688750
H      -3.362373483593     -2.614541003932      0.037386530703
H      -3.662002928570     -0.971492906084     -2.488608872578
H      -4.567435620941      0.378903288691     -1.779273831612
H      -4.887785671729     -1.282857501178     -1.258499773324
C       2.414875805058     -1.090569816974      0.677376680441
C       2.933637533977      0.123732040797     -0.071390995198
C       3.010051492037     -1.346088798771      1.978096704747
C       4.215526804352     -0.878055957599      2.311262033799
H       3.028641835317      0.923701525521      0.668978185418
H       3.941425774715     -0.131720565833     -0.413024395131
C       2.088196603978      0.643874490180     -1.234176890589
H       1.056646831778      0.688470129880     -0.925455454490
C       2.305006607808      2.087259977606     -1.705949389743
H       2.096189717948     -0.040781722480     -2.082534182002
H       3.253673916515      2.260009744049     -2.211150200779
H       1.511455513112      2.282256835239     -2.435839513059
C       2.125388840054      3.039078120570     -0.605114273454
C       1.944257990873      3.773056270615      0.325847903957
H       1.794034102027      4.428598076612      1.149320584108
C       2.167967998650     -2.390411249655     -0.041464757310
H       3.113964221703     -2.714488153304     -0.491459098175
H       1.402805137928     -2.363944879913     -0.815451868289
H       1.882503261446     -3.161557288193      0.683658970096
H       2.527049041984     -2.084358215575      2.615977714374
H       4.738837327879     -0.191925084232      1.660568305347
H       4.740236517883     -1.234147270050      3.182525525068`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.1)"
  backgroundColor="#333333"
/>

`bh9_3_41_ts_guess_2.xyz`
```
44
0 2
C      -1.882865860500      0.619261770706     -0.936914357442
C      -2.955870515893     -0.413259982117     -0.553346698008
C      -3.471448835201      0.225099698385      0.766535858781
C      -2.436787379198      1.282241241544      1.191908274409
C      -2.004759562997      1.884012254543     -0.141870103460
C      -0.751000743396      0.197031738549     -1.407341804480
C      -2.207563287105     -1.736351676387     -0.354562676486
C      -4.065575047620     -0.717258465124     -1.557478034665
H      -3.644240537545     -0.528069888213      1.533813261543
H      -4.416203766855      0.734302987721      0.560588200923
H      -1.557350664308      0.805731581013      1.628814004555
H      -2.808067492951      2.010184546545      1.910566655133
H      -2.778172852329      2.535828897446     -0.563345956138
H      -1.066642472494      2.441885620209     -0.130889006070
H      -0.600408535266     -0.410145740657     -2.299394068284
Cl      0.451992073853     -0.744758681802      1.217780740787
H      -1.398760999578     -1.602742854575      0.343035985320
H      -1.740807157430     -2.017924593891     -1.305811755562
H      -2.827790954552     -2.554758489689     -0.000812075859
H      -3.644988170803     -1.130315921439     -2.477866454837
H      -4.698948589258      0.131279420689     -1.808497170385
H      -4.693739218300     -1.499886213221     -1.120823508407
C       2.209138398641     -1.153279767687      0.911593299254
C       2.725421013582      0.065328826954      0.141633566887
C       3.151281425374     -1.441912834727      2.065967655713
C       4.377258885717     -0.929991130668      2.144964636658
H       2.876857113610      0.856525694379      0.882404391416
H       3.684424695803     -0.184573140210     -0.309966835786
C       1.758504347585      0.537116229772     -0.895688319718
H       0.816561257192      0.683314557144     -0.395832054202
C       1.918057895421      1.898267492232     -1.526860303953
H       1.558517766079     -0.255156301730     -1.615609792129
H       2.811760203344      1.981784649730     -2.137426205173
H       1.029353072152      2.021017864717     -2.156079783868
C       1.875429398015      2.927860756080     -0.483875992090
C       1.818349211902      3.738037827727      0.398255774090
H       1.791466776434      4.475635072292      1.163528120937
C       2.039241917692     -2.489270694375      0.187592930425
H       2.922398627081     -2.736598052875     -0.396738115545
H       1.158687063486     -2.479852246000     -0.451223477870
H       1.886800013784     -3.276108194013      0.929895113717
H       2.938083544946     -2.291312420009      2.708684832647
H       4.729457713220     -0.115444905758      1.525870593028
H       5.122950228668     -1.342776533211      2.814820654195
```

<MoleculeViewer 
  xyzData={`44
0 2
C      -1.882865860500      0.619261770706     -0.936914357442
C      -2.955870515893     -0.413259982117     -0.553346698008
C      -3.471448835201      0.225099698385      0.766535858781
C      -2.436787379198      1.282241241544      1.191908274409
C      -2.004759562997      1.884012254543     -0.141870103460
C      -0.751000743396      0.197031738549     -1.407341804480
C      -2.207563287105     -1.736351676387     -0.354562676486
C      -4.065575047620     -0.717258465124     -1.557478034665
H      -3.644240537545     -0.528069888213      1.533813261543
H      -4.416203766855      0.734302987721      0.560588200923
H      -1.557350664308      0.805731581013      1.628814004555
H      -2.808067492951      2.010184546545      1.910566655133
H      -2.778172852329      2.535828897446     -0.563345956138
H      -1.066642472494      2.441885620209     -0.130889006070
H      -0.600408535266     -0.410145740657     -2.299394068284
Cl      0.451992073853     -0.744758681802      1.217780740787
H      -1.398760999578     -1.602742854575      0.343035985320
H      -1.740807157430     -2.017924593891     -1.305811755562
H      -2.827790954552     -2.554758489689     -0.000812075859
H      -3.644988170803     -1.130315921439     -2.477866454837
H      -4.698948589258      0.131279420689     -1.808497170385
H      -4.693739218300     -1.499886213221     -1.120823508407
C       2.209138398641     -1.153279767687      0.911593299254
C       2.725421013582      0.065328826954      0.141633566887
C       3.151281425374     -1.441912834727      2.065967655713
C       4.377258885717     -0.929991130668      2.144964636658
H       2.876857113610      0.856525694379      0.882404391416
H       3.684424695803     -0.184573140210     -0.309966835786
C       1.758504347585      0.537116229772     -0.895688319718
H       0.816561257192      0.683314557144     -0.395832054202
C       1.918057895421      1.898267492232     -1.526860303953
H       1.558517766079     -0.255156301730     -1.615609792129
H       2.811760203344      1.981784649730     -2.137426205173
H       1.029353072152      2.021017864717     -2.156079783868
C       1.875429398015      2.927860756080     -0.483875992090
C       1.818349211902      3.738037827727      0.398255774090
H       1.791466776434      4.475635072292      1.163528120937
C       2.039241917692     -2.489270694375      0.187592930425
H       2.922398627081     -2.736598052875     -0.396738115545
H       1.158687063486     -2.479852246000     -0.451223477870
H       1.886800013784     -3.276108194013      0.929895113717
H       2.938083544946     -2.291312420009      2.708684832647
H       4.729457713220     -0.115444905758      1.525870593028
H       5.122950228668     -1.342776533211      2.814820654195`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.2)"
  backgroundColor="#333333"
/>

`bh9_3_41_ts_guess_3.xyz`
```
44
0 2
C      -1.883126572803      0.617441083555     -0.932727469548
C      -2.958232885158     -0.413888731306     -0.551474921313
C      -3.475014302140      0.226062445151      0.767547549691
C      -2.441612068779      1.284660680076      1.192183759208
C      -2.011235705442      1.885101990394     -0.142795588949
C      -0.746609202399      0.193294888516     -1.392966707950
C      -2.214642627832     -1.739285714775     -0.349147186314
C      -4.066398715233     -0.715229897193     -1.557227569677
H      -3.647742059029     -0.526003845884      1.535942989945
H      -4.420109870132      0.734389871415      0.560842862214
H      -1.561658112196      0.809709966409      1.629810822781
H      -2.814070526543      2.012434204747      1.910409528830
H      -2.787703619592      2.531917759956     -0.566168461176
H      -1.076345555800      2.448556767622     -0.131376354607
H      -0.576968716600     -0.427384598014     -2.269287749223
Cl      0.452152716431     -0.750112694628      1.212380292383
H      -1.412267143722     -1.611028637974      0.356929533305
H      -1.740586280998     -2.020132136195     -1.295889520191
H      -2.841257472473     -2.556855684885     -0.004309153947
H      -3.645108290631     -1.127772650519     -2.477432073781
H      -4.698831541670      0.134210871150     -1.808324742786
H      -4.696440475944     -1.497407548164     -1.122226192865
C       2.212567334631     -1.153640643179      0.907071347641
C       2.731729483980      0.066784003301      0.139871273640
C       3.150824377982     -1.445405129508      2.062690922773
C       4.376427547710     -0.933567314509      2.146430196990
H       2.880704467931      0.856954689346      0.882237610172
H       3.692278816979     -0.183214266114     -0.307987967254
C       1.768392029939      0.540211402677     -0.900859977453
H       0.825008410882      0.684760976164     -0.402934242957
C       1.923120206571      1.903232285595     -1.531529690532
H       1.570744389345     -0.251572402051     -1.621679187378
H       2.814198897699      1.992441353240     -2.145374544422
H       1.032884125052      2.023215716957     -2.159027557582
C       1.877376578421      2.931779243343     -0.487896795314
C       1.817210725052      3.739646597035      0.396153152467
H       1.787422787463      4.475195295397      1.163275069290
C       2.042518778663     -2.489131498087      0.180678603479
H       2.926662061490     -2.736404468335     -0.401815499383
H       1.163246916423     -2.479703063002     -0.460315666649
H       1.888248548610     -3.276869804749      0.921759109742
H       2.933252958184     -2.293761552330      2.705322953326
H       4.729975178681     -0.118559663566      1.528756750240
H       5.119014406997     -1.345070147077      2.820480493135
```

<MoleculeViewer 
  xyzData={`44
0 2
C      -1.883126572803      0.617441083555     -0.932727469548
C      -2.958232885158     -0.413888731306     -0.551474921313
C      -3.475014302140      0.226062445151      0.767547549691
C      -2.441612068779      1.284660680076      1.192183759208
C      -2.011235705442      1.885101990394     -0.142795588949
C      -0.746609202399      0.193294888516     -1.392966707950
C      -2.214642627832     -1.739285714775     -0.349147186314
C      -4.066398715233     -0.715229897193     -1.557227569677
H      -3.647742059029     -0.526003845884      1.535942989945
H      -4.420109870132      0.734389871415      0.560842862214
H      -1.561658112196      0.809709966409      1.629810822781
H      -2.814070526543      2.012434204747      1.910409528830
H      -2.787703619592      2.531917759956     -0.566168461176
H      -1.076345555800      2.448556767622     -0.131376354607
H      -0.576968716600     -0.427384598014     -2.269287749223
Cl      0.452152716431     -0.750112694628      1.212380292383
H      -1.412267143722     -1.611028637974      0.356929533305
H      -1.740586280998     -2.020132136195     -1.295889520191
H      -2.841257472473     -2.556855684885     -0.004309153947
H      -3.645108290631     -1.127772650519     -2.477432073781
H      -4.698831541670      0.134210871150     -1.808324742786
H      -4.696440475944     -1.497407548164     -1.122226192865
C       2.212567334631     -1.153640643179      0.907071347641
C       2.731729483980      0.066784003301      0.139871273640
C       3.150824377982     -1.445405129508      2.062690922773
C       4.376427547710     -0.933567314509      2.146430196990
H       2.880704467931      0.856954689346      0.882237610172
H       3.692278816979     -0.183214266114     -0.307987967254
C       1.768392029939      0.540211402677     -0.900859977453
H       0.825008410882      0.684760976164     -0.402934242957
C       1.923120206571      1.903232285595     -1.531529690532
H       1.570744389345     -0.251572402051     -1.621679187378
H       2.814198897699      1.992441353240     -2.145374544422
H       1.032884125052      2.023215716957     -2.159027557582
C       1.877376578421      2.931779243343     -0.487896795314
C       1.817210725052      3.739646597035      0.396153152467
H       1.787422787463      4.475195295397      1.163275069290
C       2.042518778663     -2.489131498087      0.180678603479
H       2.926662061490     -2.736404468335     -0.401815499383
H       1.163246916423     -2.479703063002     -0.460315666649
H       1.888248548610     -3.276869804749      0.921759109742
H       2.933252958184     -2.293761552330      2.705322953326
H       4.729975178681     -0.118559663566      1.528756750240
H       5.119014406997     -1.345070147077      2.820480493135`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.3)"
  backgroundColor="#333333"
/>


#### Step 3

step3のオプションで、追加での説明を要するものを以下に示す。

- `"opt_method": ["rsirfo_block_bofill"]`は遷移状態構造の最適化向けのoptimizerを指定することを意味する。準ニュートン法であるRS-I-RFO法を使用する。今回は`-fc`で正確なHessianを計算するようにしているので、初期Hessianは正確なHessianを使用するようになっている。(Bofill法によるHessianの更新法を細かい点で変更している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `"saddle_order": 1`は一次の鞍点を求めることを指定する。（step3のデフォルトでは一次の鞍点を指定する。それ以外の値の指定は、プログラムの使用目的上想定していないので、行わないことを勧める。）
- `"calc_exact_hess": 5`は5回の反復回数当たり1回正確なHessianを計算することを指定する。
- `"frequency_analysis": true`は収束条件を満たした後に基準振動解析を行うことを示す。（自前で実装しているため、あくまで目安として使用することを推奨する。各振動モードを`vibration_animation`内のxyzファイルで可視化できる。）UMAモデルから算出されるHessianは数値微分により求めているため、原子数Zが多いとZの二乗オーダーで計算コストが急増する。
- `"tight_convergence_criteria": true`は収束条件を厳しくすることを示す。（Gaussianのtightと同等）
- `"max_trust_radius": D`は一回の反復計算ごとの計算されるステップ幅の最大値をDÅ以下にすることを示す。デフォルトでは、`"saddle_order": 1`を指定すると0.1Åが指定される。
- `"detect_negative_eigenvalues": true`は、初めの計算時(ITR. 0)に、任意の次数の鞍点(遷移状態構造等)を求める際に、正確なへシアンから算出した固有値に１つも負の固有値がない場合、計算を打ち切るオプションである。

実行して得られた正確な遷移状態構造と思われる構造を以下に示す。

(実行して得られた正確な遷移状態構造は計算開始時に、`MultiOptPy-v1.20.0-rc.1/"work_dir"`ディレクトリ内に生成された新規ディレクトリ内の`bh9_3_41_ts_final_X.xyz`として保存されている。)

`bh9_3_41_ts_final_1.xyz`
```
44
OptimizedStructure
C     -1.926503920579     -0.649561410864     -0.124925271957
C     -3.464091111409     -0.571695507582     -0.178459975905
C     -3.713427504583      0.932162377443     -0.399617328005
C     -2.562602899745      1.632774503607      0.321632379815
C     -1.356780539467      0.749348550431     -0.005119043866
C     -1.237726068288     -1.760072988143     -0.167954502719
C     -4.035646551256     -1.014002058105      1.173121596254
C     -4.059133883253     -1.422657016217     -1.294287805447
H     -4.701936669540      1.236038371879     -0.049606551215
H     -3.659417066398      1.151487814607     -1.470545935399
H     -2.741196263035      1.644682097029      1.399437200467
H     -2.423587682123      2.665861198916      0.003117541580
H     -0.932301329298      1.041831552982     -0.970747495272
H     -0.549554794847      0.804523926790      0.722890824048
H     -1.508028958291     -2.800704549097     -0.260900204196
Cl     0.935733981946     -1.605212849261      0.012919279177
H     -3.642603774450     -0.413241906547      1.994379758428
H     -3.779031564242     -2.055375075506      1.372627939520
H     -5.124297109347     -0.919436933874      1.170128271129
H     -3.865638761766     -2.483423237089     -1.126412429329
H     -3.635178534376     -1.149599264409     -2.261610878922
H     -5.141776101260     -1.283088926998     -1.341006605598
C      2.921101430613     -1.162655189095      0.081800852424
C      2.977890415775      0.348089137533      0.136946209662
C      3.370504032679     -1.857693811524      1.305082203273
C      3.751271791371     -1.279180190996      2.439690146964
H      2.394605847394      0.693074595510      0.993924216701
H      4.021177741566      0.634029927829      0.330155973566
C      2.494971547688      1.066885260366     -1.115226180611
H      1.479893254952      0.745486768429     -1.355328474615
C      2.524700174116      2.590900859554     -0.949339143428
H      3.126565760891      0.813350676598     -1.968894116284
H      3.542035992837      2.916995577712     -0.714485487358
H      2.254030305891      3.070552377895     -1.892370305152
C      1.624146101143      3.076076288072      0.097943904740
C      0.881258519073      3.459441819854      0.957207013973
H      0.224350776586      3.802864106577      1.719174417687
C      3.469910690783     -1.786070587072     -1.180998181251
H      4.525803592151     -1.517374872197     -1.295561408719
H      2.930522646583     -1.448587812342     -2.064252290575
H      3.398964474556     -2.872231235149     -1.135303117297
H      3.379530644060     -2.941609100717      1.237507247287
H      3.763490236507     -0.205112159346      2.570236847623
H      4.068001128395     -1.877871107485      3.283028908802
```

<MoleculeViewer 
  xyzData={`44
OptimizedStructure
C     -1.926503920579     -0.649561410864     -0.124925271957
C     -3.464091111409     -0.571695507582     -0.178459975905
C     -3.713427504583      0.932162377443     -0.399617328005
C     -2.562602899745      1.632774503607      0.321632379815
C     -1.356780539467      0.749348550431     -0.005119043866
C     -1.237726068288     -1.760072988143     -0.167954502719
C     -4.035646551256     -1.014002058105      1.173121596254
C     -4.059133883253     -1.422657016217     -1.294287805447
H     -4.701936669540      1.236038371879     -0.049606551215
H     -3.659417066398      1.151487814607     -1.470545935399
H     -2.741196263035      1.644682097029      1.399437200467
H     -2.423587682123      2.665861198916      0.003117541580
H     -0.932301329298      1.041831552982     -0.970747495272
H     -0.549554794847      0.804523926790      0.722890824048
H     -1.508028958291     -2.800704549097     -0.260900204196
Cl     0.935733981946     -1.605212849261      0.012919279177
H     -3.642603774450     -0.413241906547      1.994379758428
H     -3.779031564242     -2.055375075506      1.372627939520
H     -5.124297109347     -0.919436933874      1.170128271129
H     -3.865638761766     -2.483423237089     -1.126412429329
H     -3.635178534376     -1.149599264409     -2.261610878922
H     -5.141776101260     -1.283088926998     -1.341006605598
C      2.921101430613     -1.162655189095      0.081800852424
C      2.977890415775      0.348089137533      0.136946209662
C      3.370504032679     -1.857693811524      1.305082203273
C      3.751271791371     -1.279180190996      2.439690146964
H      2.394605847394      0.693074595510      0.993924216701
H      4.021177741566      0.634029927829      0.330155973566
C      2.494971547688      1.066885260366     -1.115226180611
H      1.479893254952      0.745486768429     -1.355328474615
C      2.524700174116      2.590900859554     -0.949339143428
H      3.126565760891      0.813350676598     -1.968894116284
H      3.542035992837      2.916995577712     -0.714485487358
H      2.254030305891      3.070552377895     -1.892370305152
C      1.624146101143      3.076076288072      0.097943904740
C      0.881258519073      3.459441819854      0.957207013973
H      0.224350776586      3.802864106577      1.719174417687
C      3.469910690783     -1.786070587072     -1.180998181251
H      4.525803592151     -1.517374872197     -1.295561408719
H      2.930522646583     -1.448587812342     -2.064252290575
H      3.398964474556     -2.872231235149     -1.135303117297
H      3.379530644060     -2.941609100717      1.237507247287
H      3.763490236507     -0.205112159346      2.570236847623
H      4.068001128395     -1.877871107485      3.283028908802`}
  caption="遷移状態構造 (No.1)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                     -628.2825              7.4047             24.7367
Reduced mass [au]                  13.0866              3.4313              4.2710
Force const [Dyne/A]               -3.0436              0.0001              0.0015
Char temp [K]                       0.0000             10.6537             35.5906
Normal mode                   x         y         z            x         y         z            x         y         z     
       C                -0.03219    0.00388   -0.00259   -0.00451    0.00008   -0.01468    0.00552   -0.00698   -0.02078
       C                -0.01899    0.01098    0.00099   -0.00606   -0.00668    0.01137    0.00443   -0.00206    0.03446
       C                -0.00673    0.00736    0.00030   -0.01535   -0.01822   -0.05781    0.00299   -0.00273    0.03424
       C                -0.00036    0.00130   -0.00042    0.00042    0.02085   -0.12100    0.02469   -0.00305    0.00013
       C                -0.00327   -0.00405   -0.00153   -0.00575    0.00841   -0.10903    0.01401   -0.00992   -0.02256
       C                -0.12696   -0.02983   -0.01532   -0.00352   -0.00140    0.04033    0.00218   -0.00747   -0.05972
       C                -0.00617    0.00273    0.00115    0.02125    0.05824    0.04409    0.05591    0.00965    0.06040
       C                -0.00605    0.00355   -0.00019   -0.02472   -0.06366    0.06467   -0.04317   -0.00751    0.06442
       H                -0.00393    0.01856   -0.00090   -0.00766   -0.00341   -0.04899    0.01346    0.00218    0.05964
       H                -0.00329    0.00467   -0.00023   -0.04196   -0.07138   -0.07005   -0.02543   -0.00843    0.03164
       H                 0.00076    0.00008   -0.00025    0.02833    0.07146   -0.11684    0.05109    0.00680    0.00434
       H                 0.00319    0.00124    0.00050   -0.01104    0.00618   -0.17331    0.02126   -0.00618   -0.01152
       H                -0.00245   -0.00688   -0.00142   -0.03862   -0.04385   -0.13968    0.00382   -0.00881   -0.02645
       H                -0.00496   -0.01272    0.00040    0.01630    0.05237   -0.13702    0.02411   -0.01800   -0.03302
       H                -0.08942   -0.03753   -0.01349   -0.00424   -0.00756    0.11123   -0.00095   -0.00674   -0.05808
      Cl                 0.12246    0.01371    0.00712   -0.00099    0.00599    0.00690    0.00399   -0.00830   -0.07904
       H                -0.00135    0.00068    0.00044    0.03403    0.10129    0.00650    0.09379    0.01055    0.04158
       H                 0.00204    0.00322   -0.00604    0.02959    0.06939    0.09156    0.05626    0.00872    0.05502
       H                -0.00689   -0.00321    0.01150    0.02077    0.05322    0.05973    0.05650    0.01802    0.10416
       H                 0.00180    0.00590    0.00505   -0.01792   -0.05471    0.11341   -0.04010   -0.00709    0.06367
       H                 0.00008    0.00309    0.00220   -0.04409   -0.11013    0.04306   -0.08147   -0.01533    0.04546
       H                -0.00689   -0.00508   -0.00815   -0.02606   -0.06944    0.07839   -0.04461   -0.00445    0.10745
       C                -0.12920   -0.02427   -0.00750    0.00148    0.00040   -0.00933   -0.00129    0.00346    0.00780
       C                -0.01137   -0.00655   -0.00258    0.00621   -0.00058    0.01143   -0.01262    0.00342    0.02206
       C                -0.00803   -0.00515    0.00904    0.01319   -0.01820   -0.02422   -0.05078   -0.00283    0.02250
       C                 0.00495   -0.00003   -0.01002    0.02768   -0.03530   -0.02040   -0.10750   -0.00926    0.04472
       H                 0.00833    0.01915    0.00017    0.01405   -0.01105    0.02101   -0.05088   -0.00662    0.00011
       H                 0.00379   -0.06982   -0.01641    0.00855   -0.00616    0.00708   -0.02245    0.00773    0.06886
       C                -0.00128    0.00176   -0.00058   -0.00156    0.01801    0.02511    0.03688    0.01123    0.00745
       H                -0.00246    0.00618   -0.00351   -0.00320    0.02206    0.02687    0.04529    0.01505   -0.03344
       C                 0.00054    0.00064    0.00052   -0.00016    0.01555    0.04736    0.03483    0.01030    0.01636
       H                -0.00040    0.00011    0.00068   -0.00695    0.03032    0.01747    0.06910    0.01433    0.03038
       H                 0.00056    0.00051    0.00061    0.00094    0.01176    0.04785    0.02648    0.00585    0.05872
       H                 0.00092    0.00032    0.00028   -0.00405    0.02951    0.05557    0.07420    0.01576    0.00785
       C                 0.00009    0.00033    0.00011    0.00420    0.00033    0.05814   -0.00561    0.00862   -0.01766
       C                -0.00008    0.00007    0.00016    0.00704   -0.01233    0.06624   -0.03910    0.00812   -0.04638
       H                -0.00139   -0.00102   -0.00039    0.00921   -0.02344    0.07313   -0.06891    0.00737   -0.07173
       C                -0.00517    0.00152    0.00660   -0.01489    0.01655   -0.02437    0.05739    0.01598    0.02708
       H                -0.00964    0.02749    0.06819   -0.01529    0.01474   -0.03249    0.06058    0.02402    0.07464
       H                 0.02123   -0.00260   -0.01083   -0.02376    0.03086   -0.01348    0.09355    0.01823    0.00591
       H                 0.00724    0.00008   -0.00606   -0.01791    0.01614   -0.03895    0.06306    0.01518    0.01655
       H                -0.01291   -0.00529    0.01313    0.00908   -0.01728   -0.03956   -0.04008   -0.00224    0.01431
       H                -0.01294   -0.00036   -0.00612    0.03224   -0.03717   -0.00542   -0.12108   -0.01023    0.05404
       H                 0.03027    0.00355   -0.01623    0.03524   -0.04807   -0.03232   -0.14200   -0.01379    0.05447
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。

`bh9_3_41_ts_final_2.xyz`
```
44
OptimizedStructure
C     -2.043961270152      0.442889595959     -1.017828118453
C     -3.045318137587     -0.616429120870     -0.508087937049
C     -3.741544546978      0.116861254153      0.651730477335
C     -2.671238254442      1.035974339413      1.237238026267
C     -1.953681156108      1.574575273830     -0.002441189468
C     -1.397300436361      0.371965516992     -2.145749067723
C     -2.271452789391     -1.831441231536      0.013923188452
C     -4.028311974390     -1.054030723054     -1.586936786615
H     -4.162976903965     -0.581370718155      1.377945502153
H     -4.564273753823      0.719031113030      0.253697970553
H     -1.974980585842      0.464028411811      1.853255960851
H     -3.085062861186      1.829525037237      1.859513632057
H     -2.487198098982      2.442628356614     -0.399037790001
H     -0.926832714393      1.885150556226      0.188877552502
H     -1.310679336175     -0.276787231247     -3.001742235321
Cl     0.885611685737     -0.278668215065      1.982181474336
H     -1.553124903309     -1.552407287359      0.785985220503
H     -1.719678170955     -2.306705597714     -0.799628937990
H     -2.963378864324     -2.566063533970      0.433674411871
H     -3.511603205215     -1.550943505016     -2.409971468626
H     -4.568094779958     -0.197660557535     -1.993601846553
H     -4.756665320840     -1.757003506800     -1.175656548649
C      2.258300353892     -0.956478291704      0.966476387607
C      2.833391545886      0.189698444793      0.141853415446
C      3.227354975265     -1.536962381227      1.959410503869
C      4.489599774537     -1.176165787661      2.125197291292
H      3.112592677878      0.997773184048      0.821153641265
H      3.753131299332     -0.173588613261     -0.328778551587
C      1.897604723194      0.722135197158     -0.934898887874
H      0.891842951127      0.843339475598     -0.531561172427
C      2.366724572313      2.064670611265     -1.504430485440
H      1.820261615988      0.010494541561     -1.759371901728
H      3.377398910103      1.971038099193     -1.912052560070
H      1.717330998143      2.354375881924     -2.333151427708
C      2.354652267009      3.129797760250     -0.500900471818
C      2.329149243472      3.979072986122      0.344649036919
H      2.305474572822      4.735637728392      1.090846720498
C      1.666007556558     -2.062890489865      0.103999662192
H      2.443607500471     -2.456823642462     -0.554770546014
H      0.842525191377     -1.687262193911     -0.501273958953
H      1.293407094728     -2.875773608006      0.726704340223
H      2.811320250234     -2.331920718525      2.570686661295
H      4.950616167707     -0.383552494579      1.551152000757
H      5.109452136604     -1.669733916045      2.861718811822
```

<MoleculeViewer 
  xyzData={`44
OptimizedStructure
C     -2.043961270152      0.442889595959     -1.017828118453
C     -3.045318137587     -0.616429120870     -0.508087937049
C     -3.741544546978      0.116861254153      0.651730477335
C     -2.671238254442      1.035974339413      1.237238026267
C     -1.953681156108      1.574575273830     -0.002441189468
C     -1.397300436361      0.371965516992     -2.145749067723
C     -2.271452789391     -1.831441231536      0.013923188452
C     -4.028311974390     -1.054030723054     -1.586936786615
H     -4.162976903965     -0.581370718155      1.377945502153
H     -4.564273753823      0.719031113030      0.253697970553
H     -1.974980585842      0.464028411811      1.853255960851
H     -3.085062861186      1.829525037237      1.859513632057
H     -2.487198098982      2.442628356614     -0.399037790001
H     -0.926832714393      1.885150556226      0.188877552502
H     -1.310679336175     -0.276787231247     -3.001742235321
Cl     0.885611685737     -0.278668215065      1.982181474336
H     -1.553124903309     -1.552407287359      0.785985220503
H     -1.719678170955     -2.306705597714     -0.799628937990
H     -2.963378864324     -2.566063533970      0.433674411871
H     -3.511603205215     -1.550943505016     -2.409971468626
H     -4.568094779958     -0.197660557535     -1.993601846553
H     -4.756665320840     -1.757003506800     -1.175656548649
C      2.258300353892     -0.956478291704      0.966476387607
C      2.833391545886      0.189698444793      0.141853415446
C      3.227354975265     -1.536962381227      1.959410503869
C      4.489599774537     -1.176165787661      2.125197291292
H      3.112592677878      0.997773184048      0.821153641265
H      3.753131299332     -0.173588613261     -0.328778551587
C      1.897604723194      0.722135197158     -0.934898887874
H      0.891842951127      0.843339475598     -0.531561172427
C      2.366724572313      2.064670611265     -1.504430485440
H      1.820261615988      0.010494541561     -1.759371901728
H      3.377398910103      1.971038099193     -1.912052560070
H      1.717330998143      2.354375881924     -2.333151427708
C      2.354652267009      3.129797760250     -0.500900471818
C      2.329149243472      3.979072986122      0.344649036919
H      2.305474572822      4.735637728392      1.090846720498
C      1.666007556558     -2.062890489865      0.103999662192
H      2.443607500471     -2.456823642462     -0.554770546014
H      0.842525191377     -1.687262193911     -0.501273958953
H      1.293407094728     -2.875773608006      0.726704340223
H      2.811320250234     -2.331920718525      2.570686661295
H      4.950616167707     -0.383552494579      1.551152000757
H      5.109452136604     -1.669733916045      2.861718811822`}
  caption="遷移状態構造 (No.2)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                      -22.3433             15.2378             21.1177
Reduced mass [au]                   5.1488              4.1477              4.2039
Force const [Dyne/A]               -0.0015              0.0006              0.0011
Char temp [K]                       0.0000             21.9239             30.3837
Normal mode                   x         y         z            x         y         z            x         y         z     
       C                -0.00104   -0.04910    0.01663    0.02305   -0.02924   -0.01997    0.03116   -0.00149    0.04775
       C                -0.01258   -0.03659    0.02017    0.00390    0.00839    0.02152    0.00381    0.00785    0.01200
       C                -0.02233   -0.01691    0.00199    0.01879    0.06428   -0.00461   -0.00203    0.00149    0.01203
       C                -0.02573   -0.01127   -0.00076    0.03358    0.07293   -0.04538    0.00912   -0.03778    0.05351
       C                -0.01217   -0.03199   -0.00170    0.03381    0.01472   -0.07019    0.05522   -0.03333    0.08155
       C                 0.01557   -0.07167    0.02751    0.02937   -0.09080   -0.01254    0.03110    0.01762    0.04646
       C                -0.02516   -0.03352    0.04585   -0.01882    0.01267    0.06494   -0.02516   -0.01417    0.00432
       C                -0.00256   -0.04591    0.01474   -0.00603   -0.01240    0.03880    0.01402    0.04266   -0.01118
       H                -0.03201   -0.00471    0.00809    0.01204    0.09885    0.02468   -0.03519   -0.00250   -0.01096
       H                -0.01638   -0.02030   -0.01544    0.02550    0.06001   -0.02494    0.02166    0.03013    0.00637
       H                -0.03323   -0.00419    0.01435    0.02964    0.08770   -0.02710   -0.02250   -0.06798    0.06103
       H                -0.02964   -0.00094   -0.01655    0.04722    0.10253   -0.07403    0.01537   -0.03797    0.05794
       H                -0.00806   -0.03867   -0.02198    0.03698    0.00026   -0.10647    0.09996   -0.00029    0.09422
       H                -0.01435   -0.02950    0.00482    0.03584    0.01816   -0.08669    0.06441   -0.08198    0.11162
       H                 0.02489   -0.08772    0.04055    0.02440   -0.13169    0.01789    0.01758    0.04179    0.02683
      Cl                -0.01589    0.03835   -0.02345    0.00855   -0.00735   -0.01236   -0.02905    0.01854   -0.05796
       H                -0.03179   -0.02621    0.04938   -0.01326    0.02688    0.05451   -0.02934   -0.03873    0.01695
       H                -0.01869   -0.04825    0.05890   -0.02776   -0.02703    0.08206   -0.02333   -0.01184    0.00421
       H                -0.03391   -0.02359    0.04878   -0.03264    0.04081    0.09139   -0.04398   -0.00776   -0.01545
       H                 0.00420   -0.06005    0.02754   -0.01669   -0.05340    0.05686    0.01877    0.04784   -0.01133
       H                 0.00695   -0.04845   -0.00324    0.01046   -0.01694    0.00732    0.03501    0.05870   -0.00523
       H                -0.01131   -0.03615    0.01594   -0.01956    0.01747    0.06593   -0.00432    0.04779   -0.03491
       C                -0.02488    0.02070   -0.02373    0.00622   -0.00643   -0.01628   -0.00393    0.00459   -0.01416
       C                 0.00705    0.01833   -0.00471    0.01175   -0.00146   -0.00561    0.02204   -0.00369   -0.00764
       C                -0.04430   -0.01426   -0.02512    0.00176   -0.01979   -0.01986   -0.03383    0.00950    0.01784
       C                -0.03771   -0.04381   -0.01086    0.00290   -0.02663   -0.01370   -0.03852    0.00935    0.05377
       H                 0.01995    0.00357    0.00756    0.00446   -0.00488    0.00149   -0.00433    0.00487   -0.00692
       H                 0.00266    0.00347   -0.00187    0.01605    0.00324   -0.00048    0.03956   -0.00609    0.02867
       C                 0.02905    0.05335   -0.00653    0.01755    0.00109   -0.00992    0.05763   -0.01931   -0.04688
       H                 0.02933    0.07691   -0.01280    0.00794   -0.03186   -0.02418    0.03782   -0.03650   -0.09086
       C                 0.07126    0.04562    0.00991   -0.00581    0.02572    0.02903    0.05765   -0.00982   -0.02455
       H                 0.01601    0.06294   -0.01350    0.04792    0.01708   -0.02660    0.10599   -0.02093   -0.05024
       H                 0.07381    0.02172    0.02166    0.00801    0.06381    0.05456    0.08294    0.01425    0.03261
       H                 0.09007    0.07009    0.00381    0.00831    0.02402    0.01737    0.09727   -0.02621   -0.06124
       C                 0.08774    0.03800    0.01821   -0.06542    0.00380    0.05160   -0.02672   -0.00967   -0.02584
       C                 0.10071    0.03234    0.02426   -0.11657   -0.01654    0.07048   -0.10092   -0.01142   -0.02639
       H                 0.11250    0.02726    0.02978   -0.16163   -0.03467    0.08744   -0.16619   -0.01287   -0.02700
       C                -0.04519    0.04607   -0.04229    0.00113    0.00440   -0.02674    0.01472    0.00002   -0.02116
       H                -0.05067    0.03786   -0.04390   -0.00022    0.00581   -0.02922    0.02993   -0.00722    0.00113
       H                -0.03396    0.07345   -0.04086    0.00395    0.01456   -0.02454    0.03077   -0.00160   -0.04426
       H                -0.06658    0.04568   -0.05553   -0.00416    0.00108   -0.03424   -0.00333    0.00571   -0.02452
       H                -0.06590   -0.01375   -0.03913   -0.00291   -0.02361   -0.02802   -0.05309    0.01411    0.01074
       H                -0.01633   -0.04576    0.00362    0.00749   -0.02320   -0.00527   -0.02035    0.00521    0.06265
       H                -0.05376   -0.06746   -0.01319   -0.00080   -0.03598   -0.01684   -0.06135    0.01363    0.07585
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。

`bh9_3_41_ts_final_3.xyz`
```
44
OptimizedStructure
C     -2.043966982317      0.442787567836     -1.017854399861
C     -3.045315041005     -0.616498569540     -0.508028971922
C     -3.741545993369      0.116878650618      0.651731542774
C     -2.671245925693      1.036045598382      1.237165904746
C     -1.953692235538      1.574553022079     -0.002555920112
C     -1.397309410162      0.371780305671     -2.145772157534
C     -2.271439142441     -1.831462784460      0.014078054892
C     -4.028306060475     -1.054194311168     -1.586841839866
H     -4.162973346715     -0.581298718236      1.378002031581
H     -4.564279722965      0.719011025751      0.253651621511
H     -1.974984497063      0.464153158848      1.853229344370
H     -3.085076048615      1.829642753000      1.859378499691
H     -2.487213448017      2.442572448066     -0.399220079714
H     -0.926845151972      1.885148166947      0.188738261730
H     -1.310686725845     -0.277038398476     -3.001715174753
Cl     0.885616162124     -0.278499431921      1.982193863210
H     -1.553112181088     -1.552361541737      0.786116651611
H     -1.719661785357     -2.306787587111     -0.799436920772
H     -2.963358641886     -2.566056998278      0.433889076696
H     -3.511594168663     -1.551168573927     -2.409837578427
H     -4.568096543993     -0.197860899972     -1.993574677244
H     -4.756653596593     -1.757140100140     -1.175504863455
C      2.258310626336     -0.956378867383      0.966542899134
C      2.833391753251      0.189736900299      0.141828342472
C      3.227370152822     -1.536774895033      1.959523307377
C      4.489611262873     -1.175952412488      2.125282900640
H      3.112585232508      0.997868520281      0.821064190092
H      3.753134838909     -0.173579543341     -0.328773913705
C      1.897600784072      0.722079212098     -0.934967053836
H      0.891837325429      0.843305692018     -0.531640270806
C      2.366708490937      2.064574280774     -1.504603887417
H      1.820265662082      0.010372616214     -1.759383926075
H      3.377384474030      1.970919556984     -1.912216514846
H      1.717313532482      2.354208135719     -2.333348738052
C      2.354623898027      3.129780172197     -0.501157418200
C      2.329110894649      3.979120908088      0.344326092146
H      2.305426948055      4.735743371969      1.090464618729
C      1.666027227101     -2.062865081308      0.104154706519
H      2.443630623444     -2.456844043516     -0.554584178578
H      0.842541480363     -1.687292599475     -0.501148847728
H      1.293433905631     -2.875701583481      0.726924456781
H      2.811343023192     -2.331689185008      2.570861906692
H      4.950620337541     -0.383379723458      1.551175292741
H      5.109468013915     -1.669456214380      2.861843766773
```

<MoleculeViewer 
  xyzData={`44
OptimizedStructure
C     -2.043966982317      0.442787567836     -1.017854399861
C     -3.045315041005     -0.616498569540     -0.508028971922
C     -3.741545993369      0.116878650618      0.651731542774
C     -2.671245925693      1.036045598382      1.237165904746
C     -1.953692235538      1.574553022079     -0.002555920112
C     -1.397309410162      0.371780305671     -2.145772157534
C     -2.271439142441     -1.831462784460      0.014078054892
C     -4.028306060475     -1.054194311168     -1.586841839866
H     -4.162973346715     -0.581298718236      1.378002031581
H     -4.564279722965      0.719011025751      0.253651621511
H     -1.974984497063      0.464153158848      1.853229344370
H     -3.085076048615      1.829642753000      1.859378499691
H     -2.487213448017      2.442572448066     -0.399220079714
H     -0.926845151972      1.885148166947      0.188738261730
H     -1.310686725845     -0.277038398476     -3.001715174753
Cl     0.885616162124     -0.278499431921      1.982193863210
H     -1.553112181088     -1.552361541737      0.786116651611
H     -1.719661785357     -2.306787587111     -0.799436920772
H     -2.963358641886     -2.566056998278      0.433889076696
H     -3.511594168663     -1.551168573927     -2.409837578427
H     -4.568096543993     -0.197860899972     -1.993574677244
H     -4.756653596593     -1.757140100140     -1.175504863455
C      2.258310626336     -0.956378867383      0.966542899134
C      2.833391753251      0.189736900299      0.141828342472
C      3.227370152822     -1.536774895033      1.959523307377
C      4.489611262873     -1.175952412488      2.125282900640
H      3.112585232508      0.997868520281      0.821064190092
H      3.753134838909     -0.173579543341     -0.328773913705
C      1.897600784072      0.722079212098     -0.934967053836
H      0.891837325429      0.843305692018     -0.531640270806
C      2.366708490937      2.064574280774     -1.504603887417
H      1.820265662082      0.010372616214     -1.759383926075
H      3.377384474030      1.970919556984     -1.912216514846
H      1.717313532482      2.354208135719     -2.333348738052
C      2.354623898027      3.129780172197     -0.501157418200
C      2.329110894649      3.979120908088      0.344326092146
H      2.305426948055      4.735743371969      1.090464618729
C      1.666027227101     -2.062865081308      0.104154706519
H      2.443630623444     -2.456844043516     -0.554584178578
H      0.842541480363     -1.687292599475     -0.501148847728
H      1.293433905631     -2.875701583481      0.726924456781
H      2.811343023192     -2.331689185008      2.570861906692
H      4.950620337541     -0.383379723458      1.551175292741
H      5.109468013915     -1.669456214380      2.861843766773`}
  caption="遷移状態構造 (No.3)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                      -22.2036             15.5602             21.4480
Reduced mass [au]                   5.1399              4.1511              4.2079
Force const [Dyne/A]               -0.0015              0.0006              0.0011
Char temp [K]                       0.0000             22.3877             30.8589
Normal mode                   x         y         z            x         y         z            x         y         z     
       C                -0.00070   -0.04926    0.01667    0.02246   -0.02894   -0.02103    0.03139   -0.00197    0.04710
       C                -0.01241   -0.03654    0.02031    0.00387    0.00848    0.02114    0.00380    0.00813    0.01251
       C                -0.02215   -0.01659    0.00197    0.01880    0.06450   -0.00503   -0.00149    0.00300    0.01210
       C                -0.02549   -0.01097   -0.00088    0.03334    0.07391   -0.04655    0.01008   -0.03604    0.05247
       C                -0.01178   -0.03197   -0.00186    0.03275    0.01560   -0.07188    0.05597   -0.03288    0.07982
       C                 0.01599   -0.07209    0.02761    0.02876   -0.09082   -0.01358    0.03112    0.01586    0.04577
       C                -0.02518   -0.03349    0.04624   -0.01824    0.01324    0.06478   -0.02546   -0.01372    0.00565
       C                -0.00238   -0.04590    0.01489   -0.00621   -0.01307    0.03887    0.01359    0.04238   -0.01005
       H                -0.03196   -0.00422    0.00816    0.01266    0.09915    0.02469   -0.03463   -0.00023   -0.01015
       H                -0.01610   -0.01995   -0.01561    0.02507    0.05966   -0.02531    0.02225    0.03152    0.00615
       H                -0.03308   -0.00385    0.01438    0.02997    0.08928   -0.02837   -0.02152   -0.06588    0.06030
       H                -0.02936   -0.00049   -0.01683    0.04682    0.10352   -0.07533    0.01673   -0.03557    0.05632
       H                -0.00756   -0.03868   -0.02232    0.03509    0.00053   -0.10841    0.10075   -0.00011    0.09183
       H                -0.01394   -0.02956    0.00468    0.03460    0.01995   -0.08891    0.06525   -0.08153    0.10934
       H                 0.02530   -0.08829    0.04077    0.02407   -0.13213    0.01720    0.01725    0.03917    0.02674
      Cl                -0.01589    0.03852   -0.02358    0.00921   -0.00824   -0.01096   -0.02897    0.01812   -0.05853
       H                -0.03186   -0.02614    0.04979   -0.01263    0.02798    0.05411   -0.02940   -0.03791    0.01791
       H                -0.01869   -0.04839    0.05941   -0.02717   -0.02649    0.08192   -0.02394   -0.01222    0.00581
       H                -0.03407   -0.02341    0.04920   -0.03167    0.04123    0.09160   -0.04445   -0.00675   -0.01340
       H                 0.00436   -0.06025    0.02780   -0.01692   -0.05418    0.05697    0.01795    0.04666   -0.00989
       H                 0.00727   -0.04843   -0.00327    0.00985   -0.01797    0.00722    0.03479    0.05828   -0.00472
       H                -0.01126   -0.03597    0.01616   -0.01936    0.01669    0.06647   -0.00491    0.04815   -0.03299
       C                -0.02495    0.02070   -0.02384    0.00648   -0.00669   -0.01586   -0.00361    0.00436   -0.01453
       C                 0.00712    0.01829   -0.00477    0.01114   -0.00142   -0.00538    0.02238   -0.00378   -0.00781
       C                -0.04447   -0.01444   -0.02522    0.00286   -0.01987   -0.02015   -0.03364    0.00933    0.01763
       C                -0.03779   -0.04426   -0.01100    0.00402   -0.02637   -0.01482   -0.03847    0.00948    0.05398
       H                 0.01997    0.00354    0.00751    0.00426   -0.00494    0.00168   -0.00430    0.00477   -0.00696
       H                 0.00278    0.00340   -0.00183    0.01513    0.00355   -0.00108    0.04007   -0.00598    0.02869
       C                 0.02924    0.05329   -0.00672    0.01599    0.00123   -0.00879    0.05808   -0.01949   -0.04721
       H                 0.02942    0.07661   -0.01317    0.00683   -0.03148   -0.02201    0.03800   -0.03762   -0.09158
       C                 0.07130    0.04573    0.00999   -0.00766    0.02568    0.02949    0.05738   -0.00933   -0.02389
       H                 0.01649    0.06297   -0.01379    0.04533    0.01718   -0.02533    0.10731   -0.02071   -0.05099
       H                 0.07399    0.02213    0.02204    0.00553    0.06334    0.05355    0.08291    0.01574    0.03364
       H                 0.09027    0.07011    0.00372    0.00537    0.02420    0.01876    0.09714   -0.02568   -0.06069
       C                 0.08716    0.03799    0.01840   -0.06531    0.00384    0.05201   -0.02819   -0.00983   -0.02450
       C                 0.09956    0.03223    0.02454   -0.11470   -0.01636    0.07081   -0.10332   -0.01220   -0.02445
       H                 0.11087    0.02705    0.03015   -0.15822   -0.03437    0.08769   -0.16945   -0.01420   -0.02452
       C                -0.04539    0.04617   -0.04244    0.00126    0.00404   -0.02610    0.01530   -0.00019   -0.02172
       H                -0.05091    0.03788   -0.04405   -0.00035    0.00580   -0.02908    0.03069   -0.00732    0.00070
       H                -0.03410    0.07369   -0.04102    0.00359    0.01398   -0.02338    0.03146   -0.00183   -0.04498
       H                -0.06690    0.04581   -0.05572   -0.00339    0.00052   -0.03348   -0.00282    0.00544   -0.02522
       H                -0.06623   -0.01382   -0.03921   -0.00115   -0.02389   -0.02811   -0.05287    0.01373    0.01028
       H                -0.01624   -0.04633    0.00346    0.00797   -0.02274   -0.00663   -0.02035    0.00556    0.06311
       H                -0.05395   -0.06805   -0.01333    0.00097   -0.03563   -0.01846   -0.06138    0.01380    0.07615
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。


次に、`vibration_animation`内の虚振動を示す分子振動が示されたxyzファイル(`mode_1_XXXi_wave_number.xyz`)をAvogadroで確認すると、求められた遷移状態構造の中に、想定される反応系と生成系をつなぐ方向に振動している構造が存在することを確認できた。


## 終わりに
　
　自作ライブラリで、UMAモデルのニューラルネットワークポテンシャル(NNP, `uma-s-1p1`)を用いて、BH9データセットの3. Halogen atom transfer, No. 41の反応のある1つの遷移状態構造を算出する手順を説明した。



## 参考
- https://github.com/ss0832/MultiOptPy (自作ライブラリMultiOptPyのレポジトリ)
- https://avogadro.cc/ (Avogadro、分子構造可視化ツール)
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)
- _The Journal of Chemical Physics_ 2010, 132, 241102.
- _The Journal of Chemical Physics_ 1991, 94, 751–760.
- In _Classical and Quantum Dynamics in Condensed Phase Simulations_; WORLD SCIENTIFIC: LERICI, Villa Marigola, 1998; pp 385–404.
- _The Journal of Chemical Physics_, 2020, 153, 024109.
- _The Journal of Chemical Physics_, 2022, 144, 214108.
- _J. Phys. Chem. A_ 2019, 123, 3761−3781 http://dx.doi.org/10.1021/acs.jpca.9b01546 (MOBH35のデータセットについて)


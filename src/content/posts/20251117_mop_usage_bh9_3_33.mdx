---
title:  【計算化学】自作pythonライブラリで遷移状態構造を求めてみる(BH9データセットの3. Halogen atom transfer, No. 33の化学反応, NNP(UMA)使用)
published: 2025-11-17
description: ""
tags: [MultiOptPy, python]
category: Computational Chemistry
draft: false
---
最終更新：2025-11-17

import MoleculeViewer from '../../components/MoleculeViewer.astro';
import MultiDataGraph from '../../components/MultiDataGraph.astro';

## 概要

本記事では、自作ライブラリ(MultiOptPy)で、BH9データセットの3. Halogen atom transfer, No. 33の素過程の遷移状態構造を算出してみる。計算レベルは、Meta社のFAIR Chemistryが開発したニューラルネットワークポテンシャル(NNP)であるUMA(Meta’s Universal Model for Atoms)とした。

MultiOptPyは電子状態計算ソフトウェアを用いた分子構造最適化手法の勉強を目的として作成したpythonライブラリである。

MultiOptPyのレポジトリ:https://github.com/ss0832/MultiOptPy

BH9のデータセットについて:

- _J. Chem. Theory Comput._ 2022, 18, 1, 151–166 

https://doi.org/10.1021/acs.jctc.1c00694


この文献のSupporting Informationから、データセットの詳細を確認できる。

有機金属錯体が関わる反応を除いたさまざまなカテゴリの反応がまとめられたデータセットである。DFTの汎関数の電子エネルギーの精度の比較などのベンチマークに主に使われる。

今回使用したニューラルネットワークポテンシャルについて：
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)



## 使用した自作ライブラリMultiOptPyのバージョン
```
v1.19.6
```
## 環境
```
Windows 11
```
※Windows 11環境下でAnaconda PowerShell Promptを使用した。

## Source codeのダウンロード(Unixコマンド)
```
wget https://github.com/ss0832/MultiOptPy/archive/refs/tags/v1.19.6.zip
unzip v1.19.6.zip
cd MultiOptPy-v1.19.6
```
https://github.com/ss0832/MultiOptPy/releases/tag/v1.19.6 にアクセスしてzipファイルをダウンロードする。Unixコマンドの場合とはディレクトリ名が異なるので都度読み替えていただけると良い。

移動先のディレクトリで`requirements.txt`を参照することで、本ソースコードで必要なモジュールを把握することが出来る。導入方法は各自の状況に合わせて適宜LLMとの対話などで調べると良い。

次に述べる環境構築手順を使用する場合は、環境構築が終わった後、`pip install -r requirements.txt`で本自作モジュールが動作させるために最低限必要なモジュールを導入することが可能である。

### 環境構築手順

今回は、Windows 11のPower Shellを使用した。初めに、NNPを使用できる環境が整ったAnaconda PowerShell Promptを用意する手順を説明する。

1, https://repo.anaconda.com/archive/ より、`Anaconda3-2025.06-1-Windows-x86_64.exe`でAnacondaをインストールする。

2, 検索機能を使い、スタートから`Anaconda PowerShell Prompt`を開く。

3, 以下のコマンドを実行し、仮想環境を作成する。
```
conda create -n (任意の仮想環境名) python=3.12.7
```

4, 先ほど作成した仮想環境を`conda activate (仮想環境名)`で起動させる。

5, 以下のコマンドを実行し、必要なライブラリを導入する。
```
pip install ase==3.26.0 fairchem-core==2.7.1 torch==2.6.0
```
- fairchem-coreは、FAIR Chemistryが管理しているNNPを動作させるために必要なライブラリである。
- aseはNNPに電子エネルギーを算出したい分子構造を渡すために必要なインターフェイスの役割を果たすために必要なライブラリである。
- torchはPyTorchライブラリを指す。これはニューラルネットワークなどの機械学習を行ったり、学習結果を扱ったりするために必須なライブラリである。

これで、`Anaconda PowerShell Prompt`から仮想環境を立ち上げることで、NNPを使用する準備が整えることが出来る。

次に、NNPを使用するために必要なModelの情報が保存されている`.pt`ファイルのダウンロードおよびNNPの自作ライブラリへの導入方法について説明する。


1, 以下のサイトにアクセスして、`uma-s-1p1.pt`をダウンロードする。（使用許諾が下りていれば可能である。）
```
https://huggingface.co/facebook/UMA
```

2, ダウンロード後、`MultiOptPy-v1.19.6`ディレクトリ内に存在する`software_path.conf`に対して、`uma-s-1p1.pt`の絶対パスを用いて以下を追記する。
```
uma-s-1p1::(uma-s-1p1.ptの絶対パス)
```

これで、`MultiOptPy-v1.19.6`がNNP`uma-s-1p1`を使用できるようになる。


### 使用するNNPに関する具体的な説明

今回使用するNNPについて具体的に説明する。

- UMAのModel Checkpointは`uma-s-1p1`を使用した。
- 小分子系のトレーニングセットである`Omol25`(`omol`)を使用して学習したニューラルネットワークポテンシャルを使用する。

※自作ライブラリでの具体的な使用の仕方に関しては、`ase_calculation_tools.py` を参照すると良い。`omol`以外のモデルを使用したい場合は、現バージョンでは、`multioptpy/Calculator/ase_tools/firechem.py`内の、`self.task_name`を編集することで対応可能である。


## 手順

### 1. 初期構造の準備

モデル反応系として、以下の構造を用意した。今回はファイルの名前を`bh9_3_33.xyz`とした。
初期構造は以下のものを使用した。

```
37
OptimizedStructure
N     -1.408472593859      0.161217754203      0.290718462609
S     -2.122021867080     -1.218582097210     -0.352101021527
O     -1.498941202830     -2.304959291140      0.592119472434
C     -1.883235096643     -2.270822104550      1.982577031856
C     -1.963802336780      1.522413560178     -0.089735266624
Cl     0.303685063416      0.021712089840      0.026269810642
O     -3.520572344438     -1.103152899491     -0.101166023123
O     -1.641774343432     -1.529396222607     -1.652885665031
C      2.747836559623     -1.436841301223     -1.435482876749
C      3.271881608607     -0.898273681029     -0.276982237593
C      3.936661200564      0.308249138600     -0.186119571081
C      4.483438941750      0.862146377274      1.083991883877
H     -1.443991873638     -3.161938527684      2.418698194633
H     -1.480130955571     -1.375473618835      2.452377133410
H     -2.967045341718     -2.295415625125      2.068732115064
C     -1.038527177481      2.572556341030      0.524678281507
C     -3.341116461215      1.686869164677      0.556362417693
C     -2.032352999681      1.692720603137     -1.603447259632
H      2.869545678352     -0.883327712270     -2.361702971513
C      1.974396060307     -2.707806469321     -1.487193741923
H      3.141294482247     -1.467973686442      0.642746275665
H      4.074492409071      0.892418318277     -1.090963364677
H      4.274742628927      0.200679091799      1.925452278808
H      4.055036607977      1.843261845455      1.311151542387
H      5.567027414128      1.004938319712      1.028121817507
H      1.959335802212     -3.199589921773     -0.513673776747
H      2.394327451983     -3.405310711176     -2.217405850486
H      0.936729136018     -2.524607657774     -1.784832028403
H     -1.515625261321      3.546855994355      0.422582379681
H     -0.879681351134      2.375228292110      1.585469056802
H     -0.073192983648      2.614776202360      0.026421186481
H     -3.646170095305      2.726826322802      0.434905108127
H     -3.289685818699      1.466316849133      1.623067780918
H     -4.093970644797      1.051396909145      0.103919316728
H     -2.332004282355      2.714641846711     -1.839388422207
H     -2.759173924579      1.013319102549     -2.049107760649
H     -1.058942088978      1.504927404305     -2.058173708864
```

<MoleculeViewer 
  xyzData={`37
OptimizedStructure
N     -1.408472593859      0.161217754203      0.290718462609
S     -2.122021867080     -1.218582097210     -0.352101021527
O     -1.498941202830     -2.304959291140      0.592119472434
C     -1.883235096643     -2.270822104550      1.982577031856
C     -1.963802336780      1.522413560178     -0.089735266624
Cl     0.303685063416      0.021712089840      0.026269810642
O     -3.520572344438     -1.103152899491     -0.101166023123
O     -1.641774343432     -1.529396222607     -1.652885665031
C      2.747836559623     -1.436841301223     -1.435482876749
C      3.271881608607     -0.898273681029     -0.276982237593
C      3.936661200564      0.308249138600     -0.186119571081
C      4.483438941750      0.862146377274      1.083991883877
H     -1.443991873638     -3.161938527684      2.418698194633
H     -1.480130955571     -1.375473618835      2.452377133410
H     -2.967045341718     -2.295415625125      2.068732115064
C     -1.038527177481      2.572556341030      0.524678281507
C     -3.341116461215      1.686869164677      0.556362417693
C     -2.032352999681      1.692720603137     -1.603447259632
H      2.869545678352     -0.883327712270     -2.361702971513
C      1.974396060307     -2.707806469321     -1.487193741923
H      3.141294482247     -1.467973686442      0.642746275665
H      4.074492409071      0.892418318277     -1.090963364677
H      4.274742628927      0.200679091799      1.925452278808
H      4.055036607977      1.843261845455      1.311151542387
H      5.567027414128      1.004938319712      1.028121817507
H      1.959335802212     -3.199589921773     -0.513673776747
H      2.394327451983     -3.405310711176     -2.217405850486
H      0.936729136018     -2.524607657774     -1.784832028403
H     -1.515625261321      3.546855994355      0.422582379681
H     -0.879681351134      2.375228292110      1.585469056802
H     -0.073192983648      2.614776202360      0.026421186481
H     -3.646170095305      2.726826322802      0.434905108127
H     -3.289685818699      1.466316849133      1.623067780918
H     -4.093970644797      1.051396909145      0.103919316728
H     -2.332004282355      2.714641846711     -1.839388422207
H     -2.759173924579      1.013319102549     -2.049107760649
H     -1.058942088978      1.504927404305     -2.058173708864`}
  caption="初期経路を求めるための初期構造"
  backgroundColor="#333333"
/>


### 2. 遷移状態構造最適化

　`run_autots.py`を適切に使用することで、自動的に遷移状態構造が得られる。以下にその手順を説明していく。

初期構造をカレントディレクトリに`bh9_3_33.xyz`として保存する。その後、同じディレクトリ内で、`config_bh9_3_33.json`を作成し、以下のように記述する。

`config_bh9_3_33.json`
```json
{
  "work_dir": "bh9_3_33",
  "top_n_candidates": 3,
  "multioptpy_version": "v1.19.6b",
  
  "step1_settings": {
    "othersoft": "uma-s-1p1",
    "opt_method": ["rsirfo_block_fsb"],
    "use_model_hessian": "fischerd3",
    "spin_multiplicity": 2,
    "electronic_charge": 0,
	"manual_AFIR": ["600", "6", "11"]
  },
  
  "step2_settings": {
    "othersoft": "uma-s-1p1",
    "NSTEP": 15,
    "ANEB": [3, 5],
    "QSM": true,
    "use_model_hessian": "fischerd3",
    "save_pict": true,
    "node_distance_bernstein": 0.50,
    "align_distances": 9999,
    "spin_multiplicity": 2,
    "electronic_charge": 0
  },
  
  "step3_settings": {
    "othersoft": "uma-s-1p1",
    "opt_method": ["rsirfo_block_bofill"],
    "calc_exact_hess": 5,
    "tight_convergence_criteria": true,
    "max_trust_radius": 0.2,
    "frequency_analysis": true,
	"NSTEP": 500,
	"detect_negative_eigenvalues": true,
    "spin_multiplicity": 2,
    "electronic_charge": 0
  },

  "step4_settings": {
    "othersoft": "uma-s-1p1",
	"opt_method": ["rsirfo_block_bofill"],
    "spin_multiplicity": 2,
    "electronic_charge": 0,
	"calc_exact_hess": 10,
    "tight_convergence_criteria": true,
    "frequency_analysis": true,
    
    "intrinsic_reaction_coordinates": ["0.5", "200", "lqa"],

    "step4b_opt_method": ["rsirfo_block_fsb"]
  }
}
```
その後、以下のコマンドを実行する。
```
python run_autots.py bh9_3_33.xyz -cfg config_bh9_3_33.json
```

これにより、これまでの似た内容の記事で行ってきたコマンドの操作をまとめ、遷移状態構造を求める処理を自動的に行う。

具体的な処理の流れは、
```
Step1. バイアスポテンシャルによるNEB法のための初期経路の作成

Step2. NEB法による経路の緩和

Step3. NEB法により得られた経路のエネルギー極大値を示す構造のうち、エネルギー値が上位の最大で3個
(`run_autots.py`にて、`--top_n X`で最大値を変更可能)の構造を初期構造とした遷移状態構造の算出

(Step4.得られた遷移状態構造に対するIRC計算とIRC経路の末端に存在する構造に対する構造最適化。
こちらは`--run_step4`をコマンドで追記しなければ行わない。)
```
となっている。

`run_autots.py`のオプションの説明：

- `-cfg YYY.json`は、workflowを実行するためのオプションが記されたJSONファイルの読み込み先を指定する。


これらの一連の結果は、`(jsonファイルの"work_dir"にて指定した名前)`のディレクトリの中に存在するファイルを開いて確認できる。

以下にすべてのstepで共通のオプションに関する説明を載せる。

- `"opt_method": ["rsirfo_block_fsb"]`は準ニュートン法であるRS-I-RFO法を構造最適化に使用することを示す。初期のへシアンに関しては、特にオプションで指定しない限り、単位行列が使われる。(以前のHessian更新法とは細かな点で異なる方法を使用している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `"spin_multiplicity": Z`はスピン多重度の指定である。PySCFを使用するときは目的とするスピン多重度に1を引いた値を指定する。（デフォルトでは1が指定される。）
- ` "electronic_charge": 0`は形式電荷をMとすることを示す。（デフォルトでは0が指定される。）
- `"othersoft": "uma-s-1p1"`は今回使用するNNPを指定している。これを使用する際にASEライブラリが必要である。
- `"use_model_hessian": "fischerd3"`は、計算コストが非常に低い数式を使用して、近似したHessianを生成する機能を呼び出すオプションである。デフォルトではこの機能は使用されない。


※オプションの説明は`MultiOptPy-v1.19.6/OPTION_README.md`にて示されている。


#### Step 1


Step1では、`omol`のデータセットを使用した`uma-s-1p1`モデルのNNPで得たエネルギーに対して、指定した人工力ポテンシャルを加えた上で初期構造を構造最適化を行っている。


以下のJSON内で記述したバイアスポテンシャルで、次の経路緩和アルゴリズムの初期経路として用いるトラジェクトリーを生成する。
- `"manual_AFIR": ["yyy", "a", "b]`：yyykJ/molの活性化障壁を超えうるペア同士を近づける力を原子のラベル番号aとbのペアに構造最適化時に加えることを示す。


Step1が正常終了していれば作成された`work_dir`ディレクトリ中に、`bh9_3_33_step1_traj.xyz`が存在する。必要に応じて確認し、目的に沿った初期経路が得られているか確認する。もし想定とは異なる場合は、プロセスをkillして再度設定を見直してやり直す。


`bh9_3_33_step1_traj.xyz`は構造最適化の過程をAvogadro（公式ページ:https://avogadro.cc/ ）等で可視化して確認できるようにしている。この`bh9_3_33_step1_traj.xyz`はStep2のNEB計算に使用している。

※`bh9_3_33_step1_traj.xyz`をアニメーションとして表示したい場合は、[https://github.com/ss0832/molecule_movie] を使うと良い。


#### Step 2

Step2では、NEB法を用いることで、先ほど得られた`bh9_3_33_step1_traj.xyz`全体のエネルギーを下げることができる。これにより、パスのエネルギー極大値を持つ構造を遷移状態構造に近づける。（この時点ではまだ正確な遷移状態構造は求められていない。）

Step2固有のオプションについて以下に示す。


- `"NSTEP": n`はn回分NEB法による経路の緩和を行うことを示す。
- `"align_distances": X`は線形補間で、各ノード間の距離を全て等しくするための処理である。X回の反復計算ごとに本処理を行う。Xを`"NSTEP": n`よりも大きな数値を指定することで、初期経路に対してのみ処理を行うことが出来る。
- `"node_distance_bernstein": N`はノード間の距離をN Åとして初期経路を作成することを示す。経路作成時に元のノードをベルンシュタイン多項式を用いてがたついた経路を滑らかにする。

→プログラムの仕様上`"align_distances": X`の処理を行った後に、`"node_distance_bernstein": N`の処理を行うようになっている。

- `"save_pict": true`は緩和中のパスのエネルギープロファイルや各ノードの勾配のRMS値をmatplotlibで可視化するオプションである。
- `"ANEB": [A, B]`これを指定すると、(B+1)回の緩和ごとに、エネルギー極大値を示すノードと前後のノードの間に線形補間でA個の新規ノードを内挿するようにできる。デフォルトではこのような操作は行われない。このオプションを使用するとノードの数が徐々に増えるため、計算コストが使用しない場合と比べて増加する。一方で、エネルギー極大値を示すノード周辺にノードを増加させるため、緩和している経路中のノードが遷移状態構造付近に存在する可能性が高くすることが出来る。


`MultiOptPy-v1.19.6/"work_dir"`と同じディレクトリ内に、NEBという名前を含むディレクトリが生成されている。
そのディレクトリ内の`energy_plot.csv`を確認し、緩和後のパスのエネルギー極大値を示す構造を確認する。

経路の緩和後の各ノードのエネルギー一覧(単位:hartree) (energy_plot.csvに保存されている。)

export const dataset1 = [-1532.3709559646243,-1532.3709559646243,-1532.3526372181839,-1532.318332603361,-1532.2996740955678,-1532.338535580803,-1532.356482474866,-1532.3692164372283,-1532.3757616388039,-1532.3796413319126,-1532.3821417707077,-1532.383553132337,-1532.3843750011986,-1532.3849521728002,-1532.3853986064269,-1532.3857215940182,-1532.3859354697447,-1532.3861041744342,-1532.3862680777024,-1532.3864140742094,-1532.386514796729,-1532.386566495246,-1532.3865952161575,-1532.3866466080144,-1532.3867546268548,-1532.386924492472,-1532.387152853509,-1532.3874038373017,-1532.3876299378153,-1532.3878356804773,-1532.3880515954938,-1532.3882863744893,-1532.3885054568668,-1532.3887000217671,-1532.3888810257183,-1532.3890380970367,-1532.3891540780883,-1532.3892305021734,-1532.3892634922322,-1532.3892418661217,-1532.3891879925081,-1532.3891681866446,-1532.3892425166791,-1532.3893730618965,-1532.3894719028372,-1532.3895396462503,-1532.3896335740576,-1532.3897623275036,-1532.389926636001,-1532.3900540160478,-1532.3900725120343,-1532.3901043805931,-1532.3901065754035];

export const dataset1_itr5 = [-1532.3709559350534,-1532.3709559153394,-1532.3604911334817,-1532.3297665423931,-1532.3110332336232,-1532.3483510881438,-1532.3736833012492,-1532.3846716663986,-1532.3915194790952,-1532.395543298084,-1532.3980289273852,-1532.3995128864194,-1532.400338441774,-1532.4005633725983,-1532.4007406572002,-1532.4010052216559,-1532.401456288041,-1532.4020893090233,-1532.402297417349,-1532.4023248283838,-1532.402145708202,-1532.4019071616679,-1532.402053902921,-1532.4020829962055,-1532.402119081341,-1532.4021054700122,-1532.4019938939143,-1532.4018566196976,-1532.4017426823168,-1532.4016657763373,-1532.4016108754122,-1532.4015922567614,-1532.4016193479936,-1532.4017155166102,-1532.4020473009664,-1532.402584372375,-1532.4034175810905,-1532.4051628320785,-1532.404445304326,-1532.4036799945443,-1532.4040967850885,-1532.4033569762871,-1532.4030143668283,-1532.4034955340953,-1532.4034414786763,-1532.4038446929383,-1532.4039268384254,-1532.4040334860567,-1532.4038873493623,-1532.4033514914515,-1532.403725919089,-1532.4056952641577,-1532.4060094987926];

export const dataset1_itr10 = [-1532.3709559558624,-1532.3709559449103,-1532.3666548739504,-1532.3382915231482,-1532.3283420447583,-1532.3168019925592,-1532.3166621993487,-1532.325020372326,-1532.3353618368365,-1532.3453935034267,-1532.3528705772335,-1532.3565192784624,-1532.3773470366282,-1532.3868643980386,-1532.3925531340137,-1532.3963285582975,-1532.3987179445076,-1532.400119249875,-1532.4009228133173,-1532.401334491399,-1532.4016642737026,-1532.4019463396899,-1532.4022502705445,-1532.40271806743,-1532.4028763434846,-1532.4028708148408,-1532.4028727205143,-1532.402850049569,-1532.4027308814425,-1532.4026994619219,-1532.4027031155583,-1532.4027488122986,-1532.4027281215015,-1532.402773774433,-1532.4028036431296,-1532.4030695525091,-1532.4029829604501,-1532.402863218431,-1532.4029250279707,-1532.4029125819504,-1532.4029385911101,-1532.402874902182,-1532.402987963391,-1532.4030319209303,-1532.4031355194838,-1532.4034509982828,-1532.4034538677454,-1532.4035588769357,-1532.4038351558083,-1532.4034851908873,-1532.4038317869276,-1532.4037399904082,-1532.403848828469,-1532.4036614810343,-1532.4038324177714,-1532.4039979441477,-1532.4041762801558,-1532.4043967162188,-1532.4046601372704,-1532.4046882842895,-1532.405540374507,-1532.4057460251709,-1532.4056115021335,-1532.405597137297,-1532.405499176909,-1532.4055225444108,-1532.405577497906,-1532.4056072001301,-1532.4055722671603,-1532.4055274904006,-1532.4055550284802,-1532.4053526327946,-1532.4054952341357,-1532.4052879187454,-1532.4053451678108,-1532.4053322223724,-1532.40526774489,-1532.4054629296816,-1532.4054316153015,-1532.405521663858,-1532.4054331967916,-1532.4055287608496,-1532.4053938698203,-1532.4053321698023,-1532.4053322398959,-1532.405204853278,-1532.4053152772099,-1532.405336029339,-1532.405672505595,-1532.4057979865393,-1532.4055578453726,-1532.4056356976178,-1532.405589269274,-1532.4057143471794,-1532.4056821610084,-1532.4059220086576,-1532.405828823406,-1532.4059049057842,-1532.405795791729,-1532.4057656777043,-1532.405740238056,-1532.406106271968,-1532.405902325458,-1532.4059449117883,-1532.4059731902332,-1532.4063684839023,-1532.4063677216327];

export const dataset2 = [-1532.3709559668146,-1532.3709559208155,-1532.3684720197632,-1532.3473791047677,-1532.3340726486028,-1532.3311086097851,-1532.3277990679514,-1532.324979409104,-1532.3213376097813,-1532.3192034918443,-1532.3181776304739,-1532.3198366661568,-1532.3222354514999,-1532.3336985736244,-1532.3429233878423,-1532.3531973405775,-1532.3598853971735,-1532.3624289730549,-1532.3796569233898,-1532.387935485207,-1532.3930810143804,-1532.3967651809903,-1532.3990649611103,-1532.4004158997418,-1532.4011939534423,-1532.4016639451381,-1532.4020171606564,-1532.4023097450863,-1532.4025537457899,-1532.4028575014102,-1532.4029812650576,-1532.4030247012747,-1532.4030333928988,-1532.4030418873845,-1532.4030440997183,-1532.4030179284666,-1532.4030150809083,-1532.4030214200113,-1532.4030213104897,-1532.4030116945044,-1532.4029481370019,-1532.402959728755,-1532.4029734934138,-1532.4029687620862,-1532.4029559261692,-1532.4029624536493,-1532.4029755611793,-1532.40298091897,-1532.4030186863552,-1532.403031960358,-1532.40307067839,-1532.4030901162612,-1532.4030873694626,-1532.403068277679,-1532.4030858887322,-1532.4030705907726,-1532.403143374364,-1532.4031905167876,-1532.4032369977017,-1532.403259756264,-1532.403178175908,-1532.4031542126093,-1532.4031501997424,-1532.4031422660066,-1532.4031372981126,-1532.4031754378711,-1532.4031786621833,-1532.4031736855275,-1532.4031782153356,-1532.4032202277733,-1532.4032612895649,-1532.4032132709694,-1532.4031914280063,-1532.403190472979,-1532.4032206658594,-1532.403198148244,-1532.4032281790326,-1532.4032487164995,-1532.4032681894178,-1532.4034503893433,-1532.4036092392907,-1532.403875271334,-1532.4039206176055,-1532.4038611781107,-1532.4039261374878,-1532.4039432929317,-1532.4040221571554,-1532.4040122739375,-1532.4041859443307,-1532.404262955451,-1532.4042569142466,-1532.404240805828,-1532.404276194407,-1532.404276501067,-1532.4043014281547,-1532.404420442951,-1532.4043917132778,-1532.404427903554,-1532.4044702708413,-1532.404524435782,-1532.4045775449356,-1532.4044495756634,-1532.4044253188472,-1532.404304932842,-1532.4042355487973,-1532.404411689995,-1532.4044260241656,-1532.4045526528948,-1532.404624761834,-1532.404694045119,-1532.4048807529487,-1532.4050480229068,-1532.4054801639809,-1532.4055783653162,-1532.4057619627358,-1532.405827920949,-1532.4058352063173,-1532.4057614370327,-1532.4057612486558,-1532.4057662647394,-1532.4057677148037,-1532.4057690465847,-1532.405786166982,-1532.4057918620986,-1532.405815956823,-1532.405816386147,-1532.4058079968022,-1532.4058116416768,-1532.4058166008092,-1532.4058126711786,-1532.4058226858224,-1532.405812009669,-1532.4058138759149,-1532.4058142351455,-1532.4058222871643,-1532.405837953116,-1532.4057948848913,-1532.4057869730598,-1532.4057945300417,-1532.405786438595,-1532.4057759201526,-1532.405769449624,-1532.4057704221746,-1532.4057727002212,-1532.4057758281544,-1532.4057607886657,-1532.405749875946,-1532.405722031206,-1532.4056930912516,-1532.4057165726558,-1532.4057530652112,-1532.4057754514006,-1532.4058417206547,-1532.405723678409,-1532.4057176021577,-1532.405724861241,-1532.4057516940024,-1532.40571868423,-1532.4057233629871,-1532.4057256235105,-1532.4057522897992,-1532.4056978181984,-1532.4056966572707,-1532.4057152496364,-1532.4057071669515,-1532.4057260221687,-1532.405751085063,-1532.4057700804676,-1532.4057769146075,-1532.405800978666,-1532.4057973381723,-1532.405804242406,-1532.4057976623558,-1532.4057984509104,-1532.4058222521173,-1532.4058382772996,-1532.405844419264,-1532.4058766010542,-1532.4057684069794,-1532.405739396931,-1532.4057382754313,-1532.4057442027336,-1532.4057109782989,-1532.4056930036343,-1532.4057149123103,-1532.4057310689182,-1532.4057709566393,-1532.4057665494952,-1532.4057648935304,-1532.4057487763503,-1532.4057121698925,-1532.405715543154,-1532.405754808793,-1532.405780130158,-1532.4058105858899,-1532.405866323559,-1532.4060390214013,-1532.4060315695601,-1532.4060262161506,-1532.4060051266954,-1532.4059931231416,-1532.4059202125054,-1532.4059345028675,-1532.4059225694075,-1532.4059213821947,-1532.4059398781815,-1532.4059741233561,-1532.4059730631884,-1532.4059662553334,-1532.4059734662274,-1532.405990591005,-1532.4059573840939,-1532.4059824995586,-1532.406022010526,-1532.4061534362959,-1532.4062199640205,-1532.406232471373,-1532.4062066637327,-1532.4061721776106,-1532.4061608793752,-1532.4061435486972,-1532.4060994422086,-1532.406105733122,-1532.4060967523612,-1532.4061032316517,-1532.4061416693085,-1532.406285847759,-1532.4063561167372,-1532.406324438746,-1532.406325152826,-1532.4063046854526,-1532.406278737625,-1532.4062889450263,-1532.4063015838046,-1532.4062774627948,-1532.4062948986136,-1532.4063815038153,-1532.4065038173985,-1532.4064082445784];

<MultiDataGraph datasets={[ { data: dataset1, label: "緩和前の経路のエネルギー", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_itr5, label: "ITR. 5の経路のエネルギー", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_itr10, label: "ITR. 10の経路のエネルギー", color: "rgba(81, 143, 18, 1)"}, { data: dataset2, label: "緩和後の経路のエネルギー", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="Electronic Energy [hartree]" height="500px" />

export const dataset1_grad = [2.6847781430217765e-06,2.6844127263714365e-06,0.00691500948745325,0.009635288576386708,0.010072723098004267,0.010045368031960796,0.013413679597078489,0.013614499067355113,0.013729322124716526,0.013826302270607809,0.013802888082123219,0.01378494363381474,0.013790520241670094,0.013804258962125119,0.01382083914515726,0.013847964783571042,0.013887016517677613,0.013909113761022086,0.013893137173157516,0.013856823717412292,0.013830052453933005,0.013823975006018428,0.013829538910017182,0.013833293388654052,0.01383133748492727,0.01382454750444443,0.013812560650828348,0.013802899968690307,0.013807403018355681,0.013824962309261588,0.013840307626701869,0.013843023397995693,0.013842571073841042,0.013842803289918755,0.013835358065186338,0.013821207545417966,0.013809242596510304,0.013803701678576934,0.013809111778628572,0.013829174622773183,0.013855671446847403,0.013867946530468878,0.01385172661080522,0.013825978923138861,0.013818730698555009,0.013822803716390705,0.013819352576022705,0.01380781678356491,0.013790898963317932,0.013788277898837622,0.013811413242990487,0.013816217964916794,0.013817793292092448];

export const dataset1_grad_itr5 = [1.5101958987713166e-06,9.623314648089945e-07,0.004827061060316911,0.008246933734566196,0.008597330145369076,0.008117653180860463,0.0039784544771370774,0.0030558488247726364,0.0018530982246908762,0.0016142886562508642,0.0016855281834087562,0.0015199811274771787,0.0016031749574335536,0.0025668918369813345,0.0030407422064069912,0.0031633040401379295,0.0028882425446612806,0.0021750780561294292,0.0020578471047579504,0.0021494938596101094,0.0025449957385225938,0.0028561997178186086,0.00273667994361763,0.0028241977492636096,0.0029143860981252186,0.003140840163910096,0.0035339226095485498,0.003951237620967906,0.004326545164971649,0.0046643868733146415,0.004978549444957318,0.005238607921590827,0.005424494253823802,0.005509790925747928,0.005355937149009329,0.004976305889301529,0.004235916842386912,0.0017590430013033652,0.00309346871406479,0.004002859950799517,0.003545823294041323,0.004377420566094215,0.004728561865374113,0.0043001154731350435,0.004371475385455174,0.003985893346124255,0.003984803466599899,0.003990602108024699,0.004278213622394754,0.004926618462422931,0.004617785750923936,0.0022390925169865922,0.0014194330652649062];

export const dataset1_grad_itr10 = [7.065678086982028e-07,4.610681570088425e-07,0.002975680354523835,0.007226180126436394,0.007314153084822303,0.006492501364542238,0.006358029825619184,0.007040000890987104,0.006840431122095131,0.006421977978962745,0.006130106212453741,0.006365381843257503,0.002883861469583808,0.0015298378833077707,0.000980970295970652,0.0007482688349043084,0.000702373112829568,0.0006204382433203785,0.0007621434713320353,0.0014725945632813122,0.0017208006620697026,0.0017401828468508196,0.0015386269983655885,0.000807498528670266,0.000716569617051171,0.001015887990281537,0.0010643656028915401,0.001130413787827362,0.0014896182832266041,0.0015008454838718285,0.0015197958113927004,0.0014926201532075595,0.0016055700808515194,0.0014943719046237379,0.001467098383154805,0.0009216659281644667,0.0012956587723575,0.0015756616153159517,0.0015901598634028415,0.001676936593692864,0.0016912718639424662,0.00190245537514199,0.001779082877368296,0.0018075629642643747,0.0019933783759131483,0.001780552815807628,0.0023094887568341034,0.002516476877462693,0.0021783771208413426,0.002773883332436245,0.002433907445183574,0.0026450499923807613,0.002619773227797687,0.002904894342658307,0.0027980390710663472,0.002663537092931696,0.002763162441385938,0.00271969251201621,0.0025512598314256086,0.0025984971847422818,0.000903830211995103,0.0003858536859969574,0.0010261807545796759,0.0010748785078079452,0.0011877676471380332,0.0012893305218898345,0.001166493968750294,0.001144949574359898,0.001290943809046062,0.0013295577136394785,0.0012303330983266035,0.001723086559447622,0.001492647421475877,0.0019031384622236367,0.0017844081342546874,0.0018392470581109386,0.0019332934799712721,0.0016636047723073025,0.0017392233332187055,0.0015343709209619083,0.0017353967112123834,0.0015199222139741625,0.0018283249384026424,0.0019485561490163873,0.0019484315152266801,0.002213355363898143,0.0020140218254227466,0.0020260403551828135,0.0014887495044543168,0.001283855561603888,0.0018718773830969275,0.0017844069525146122,0.0019260626082123664,0.0017570166555595506,0.0018128332417593489,0.0014384519886156575,0.0016401739471335148,0.0015615695792867243,0.0018233370853222373,0.0019580664199301476,0.00200983716415647,0.0012233990151283092,0.0017518117456488858,0.0016863936838704039,0.0016632137070114134,0.0007844947841632057,0.00033089907976996034];

export const dataset2_grad = [1.5013172155078272e-06,2.8904918197592405e-07,0.002016680242096444,0.0061758893558581576,0.00694075706713135,0.006832795633147283,0.006491844597874725,0.006209614229135357,0.0057508353630778015,0.0050859252374030935,0.004247764017604922,0.005022336823541956,0.0056871157224040285,0.00609902583008892,0.005898076218500283,0.0051856329687320945,0.004885471206916708,0.005155994013796172,0.0023446025981647585,0.0011912321635657924,0.0008649584158507803,0.0005650150573552342,0.0004031528572934722,0.0003215177332439884,0.0005244470254496746,0.0009643385519783564,0.0011044943413638924,0.001069911854735458,0.000912620440095726,0.0004872903237642634,0.00033864535481756557,0.0004570094557566699,0.00045049957649303905,0.00044505736512117825,0.00046139169202147063,0.0005865450770134799,0.000617568824115694,0.0006339234988746433,0.0006838625549185321,0.000739131413634687,0.0008816798767103494,0.0008263922874654038,0.0007697897763696487,0.0007815670773552539,0.0009025395099342753,0.0009125816681023687,0.0008492336621697462,0.0008060097927205392,0.0006981569577125287,0.0008011532201213787,0.000702572201583348,0.0005607323989837393,0.0004521863260494639,0.0005398415069915502,0.0005709594964896908,0.0006793809101460893,0.0005432521575394781,0.0004078753901726738,0.00028489743374294547,0.00017661517054146658,0.0005250233269534251,0.0006366541232766622,0.0006844403209201981,0.0007436213287549613,0.0007961427502010678,0.0007920428810336119,0.0008657106726965637,0.0009556592162840294,0.0009124832126141145,0.0009596802897021979,0.0009740620714893079,0.0010762071547808104,0.0011118056228121337,0.0010738573126376702,0.0009671915917238957,0.0011333893199582355,0.0011479720194907575,0.001175666078268834,0.0011974959428808828,0.0008772522296741764,0.0007936201061842406,0.0008866800718076228,0.000933081826839652,0.0013301731450580559,0.00130576166831697,0.0013729296577643696,0.0013543932689083298,0.0015443935830845687,0.0011965439088773263,0.0011033436588318009,0.0012760119110608102,0.001343013698045382,0.0012840316188657839,0.0013247067220999846,0.001281767034246598,0.0010779429002778815,0.001211045714717056,0.0012832720405732748,0.0012497978778020192,0.00132052597314218,0.0013253629948237547,0.0016393243394548327,0.0017043851739238234,0.001976163362890395,0.002114503368233563,0.001847424740358204,0.0018656617280425304,0.0016600157434498088,0.0015035035655706157,0.0015114435778187142,0.0016780086826486734,0.0016739143267893305,0.0009773810223061054,0.0006333106712175128,0.00032369862010804513,8.882341512419247e-05,0.000245842125916751,0.000571931028749649,0.0005429659180621411,0.0004915509030532668,0.0004501417227009018,0.00040330938762025585,0.0003479464262408141,0.00035461985137900904,0.00031439022447435106,0.00036371754969470414,0.00045584328637535555,0.00042778229970716347,0.00038919789958451705,0.0003787354061588847,0.00035049963311916397,0.00037535483325403597,0.0003737279863619258,0.00037418004924498125,0.0004059243312919777,0.00030808221941163084,0.0005863528963178267,0.0006303313440439074,0.0006035719851901638,0.0006464987663288468,0.0006475097150491483,0.0006755077369351917,0.0007008288401244337,0.0007102322436023693,0.0007002928301160585,0.0007572798454184317,0.0007953107133751366,0.0008797523146774959,0.00097205399726166,0.0009126226732839381,0.000783182514318497,0.0006744200491529469,0.00045606712290966774,0.0008784108767614068,0.0009185893118952646,0.000919156104275889,0.0008866384866150672,0.0009480507326583388,0.0009314971994365853,0.0009398878222135598,0.0008964705283564829,0.001037510036660487,0.0010596437984073056,0.001024196648273304,0.0010595375498816898,0.0010128838885585048,0.0009392620694510388,0.0008945626707872431,0.00088208055056034,0.0008148422701475203,0.0008255069910523693,0.0007888114601061529,0.0007970879529963881,0.0007697959233584856,0.0007111574900305774,0.0006356770420375746,0.0005712825031985231,0.0004383657865712569,0.0009359434088101225,0.0010089707846738826,0.001002437559868943,0.0009714051836417785,0.0010763305727775209,0.0011663392233213837,0.0011132476840381715,0.00108776047418791,0.0010198556550930602,0.0010476790043710727,0.00102917038537674,0.0010479293770807843,0.0011157830392142735,0.0011484509310805198,0.0010724668026207732,0.0010286987158793963,0.0009651655030590222,0.0008955976192641739,0.00029663928716083327,0.00046002869792618843,0.0004718686402370679,0.000619530591059301,0.0007260449211507374,0.001017403220871335,0.0009999580216506112,0.0010655412846967594,0.0010920051976618986,0.0010538980892602374,0.0009572968646821789,0.0009883878095877888,0.0010364372671838368,0.001040586485867689,0.0010084508134297723,0.0011327375570378364,0.001090638581591731,0.0010011552093460692,0.0006263000776547093,0.0003905088330763769,0.00044310640260784563,0.0005994229834099162,0.000714026759520497,0.0007960695401694254,0.0009001606874241119,0.0010629887778495545,0.001058280202577247,0.0010580982127605055,0.001047989645642094,0.0009771698010097752,0.000646415074365274,0.00034954427457558685,0.00045576087399777784,0.0004805925095189139,0.0005841487628207233,0.0007100456629572718,0.0007193570357698469,0.0007124062978524087,0.0008271982989018411,0.000822949403318848,0.0005697293608382244,0.00022114656107179615,0.00021541186360919464];

<MultiDataGraph datasets={[ { data: dataset1_grad, label: "緩和前の経路の勾配のRMS値", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_grad_itr5, label: "ITR. 5の経路の勾配のRMS値", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_grad_itr10, label: "ITR. 10の経路の勾配のRMS値", color: "rgba(81, 143, 18, 1)"},  { data: dataset2_grad, label: "緩和後の経路の勾配のRMS値", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="RMS of gradient [hartree/Bohr]" height="500px" />

※`bias_force_rms.csv`にて、各Iterationごとのすべてのノードの勾配のRMS値を確認できる。

経路緩和の結果、以下の構造がstep3の初期構造として用いられることとなった。"work_dir"内の`bh9_3_33_step3_TS_Opt_Inputs`内に保存された`bh9_3_33_ts_guess_X.xyz`にて確認が可能である。ts_guessの番号が小さい順にエネルギー値が高い構造を示すようになっている。

※こちら[https://ss0832.github.io/molecule_viewer/] を使うことでも可視化は可能である。


`bh9_3_33_ts_guess_1.xyz`
```
37
0 2
N      -1.236428306551      0.209729462618      0.289508190072
S      -1.944848358156     -1.153319980563     -0.342406650485
O      -1.391770707331     -2.284178272172      0.613613776544
C      -1.856661639322     -2.265103656402      1.977398085518
C      -1.877874068993      1.510379219393     -0.085164508373
Cl      0.962402410598      0.386764451208      0.053512720611
O      -3.357180751041     -1.059937791293     -0.119326113694
O      -1.473367716709     -1.514599487986     -1.640886158469
C       2.773257415856     -1.540174395475     -1.448966067463
C       3.172431801589     -1.021400163292     -0.270862298247
C       3.351939669223      0.375865795188     -0.086677904766
C       4.212484637760      0.866644329952      1.075395641388
H      -1.442846701205     -3.159976002372      2.433218111021
H      -1.482600070118     -1.372044150078      2.473882456799
H      -2.945122681887     -2.291866021628      2.014317282323
C      -1.006290934447      2.606180156226      0.525303719563
C      -3.273778799587      1.657262699138      0.561423990121
C      -1.994692393894      1.688174459171     -1.600200554819
H       2.843635104025     -0.915647617467     -2.337354026808
C       1.984920519848     -2.787696603023     -1.519555917438
H       3.086820585434     -1.601895999085      0.639889581154
H       3.555298892853      0.945564516718     -1.001776661337
H       4.159142115412      0.208253877565      1.942037019666
H       3.966920514154      1.883000297436      1.377951273357
H       5.282155204430      0.899638337665      0.800481219698
H       1.947757457029     -3.265010719874     -0.541115617256
H       2.356115980709     -3.489494490439     -2.265211130411
H       0.952469115648     -2.527462503824     -1.793813499256
H      -1.506617358981      3.567015630799      0.421341245582
H      -0.853698547866      2.399127303535      1.585459716053
H      -0.038594558135      2.658323251563      0.037193160997
H      -3.574372192998      2.698450367898      0.439301703285
H      -3.245634395267      1.437818995761      1.629063346410
H      -4.028555729098      1.032537277015      0.097559557387
H      -2.319600286899      2.705418305317     -1.826235978980
H      -2.725712599338      1.000419820259     -2.028386055490
H      -1.031502626747      1.513239300547     -2.079912654258
```

<MoleculeViewer 
  xyzData={`37
0 2
N      -1.236428306551      0.209729462618      0.289508190072
S      -1.944848358156     -1.153319980563     -0.342406650485
O      -1.391770707331     -2.284178272172      0.613613776544
C      -1.856661639322     -2.265103656402      1.977398085518
C      -1.877874068993      1.510379219393     -0.085164508373
Cl      0.962402410598      0.386764451208      0.053512720611
O      -3.357180751041     -1.059937791293     -0.119326113694
O      -1.473367716709     -1.514599487986     -1.640886158469
C       2.773257415856     -1.540174395475     -1.448966067463
C       3.172431801589     -1.021400163292     -0.270862298247
C       3.351939669223      0.375865795188     -0.086677904766
C       4.212484637760      0.866644329952      1.075395641388
H      -1.442846701205     -3.159976002372      2.433218111021
H      -1.482600070118     -1.372044150078      2.473882456799
H      -2.945122681887     -2.291866021628      2.014317282323
C      -1.006290934447      2.606180156226      0.525303719563
C      -3.273778799587      1.657262699138      0.561423990121
C      -1.994692393894      1.688174459171     -1.600200554819
H       2.843635104025     -0.915647617467     -2.337354026808
C       1.984920519848     -2.787696603023     -1.519555917438
H       3.086820585434     -1.601895999085      0.639889581154
H       3.555298892853      0.945564516718     -1.001776661337
H       4.159142115412      0.208253877565      1.942037019666
H       3.966920514154      1.883000297436      1.377951273357
H       5.282155204430      0.899638337665      0.800481219698
H       1.947757457029     -3.265010719874     -0.541115617256
H       2.356115980709     -3.489494490439     -2.265211130411
H       0.952469115648     -2.527462503824     -1.793813499256
H      -1.506617358981      3.567015630799      0.421341245582
H      -0.853698547866      2.399127303535      1.585459716053
H      -0.038594558135      2.658323251563      0.037193160997
H      -3.574372192998      2.698450367898      0.439301703285
H      -3.245634395267      1.437818995761      1.629063346410
H      -4.028555729098      1.032537277015      0.097559557387
H      -2.319600286899      2.705418305317     -1.826235978980
H      -2.725712599338      1.000419820259     -2.028386055490
H      -1.031502626747      1.513239300547     -2.079912654258`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.1)"
  backgroundColor="#333333"
/>

`bh9_3_33_ts_guess_2.xyz`
```
37
0 2
N      -1.447712650082      0.470436678152      0.297029433673
S      -1.588154966731     -0.955237695059     -0.486976167534
O      -0.693250013092     -1.872085944998      0.417095457603
C      -1.110923891217     -2.070980877359      1.781650316139
C      -2.155641460611      1.646902766627     -0.194793703903
Cl      1.741721769466      1.013499599169      1.415352597618
O      -2.955066394404     -1.376645312235     -0.384098034715
O      -0.934138650387     -0.935286370225     -1.753967443005
C       2.379183408993     -1.465087648072     -1.207737335226
C       2.646847126917     -1.121188084985      0.043796262068
C       3.066202521877      0.250733616295      0.452076545964
C       4.354345023238      0.266230827492      1.255275467713
H      -0.426783153515     -2.810646637737      2.185999376873
H      -1.022059514408     -1.133320067674      2.326812776347
H      -2.133250026812     -2.442897103195      1.810602867208
C      -1.249551451138      2.837278134612      0.133006638747
C      -3.435208569678      1.719083884837      0.662544507738
C      -2.516268912295      1.642699886746     -1.679205418501
H       2.453864498002     -0.708152986401     -1.985587256797
C       1.943564202543     -2.825808971223     -1.643196528699
H       2.554220290017     -1.850282464657      0.844640679752
H       3.168892631769      0.871698940805     -0.436818187077
H       4.248038669011     -0.343600273272      2.152653489763
H       4.621547136099      1.279268041735      1.553038374657
H       5.155910887220     -0.150708033076      0.643856055442
H       1.902326199000     -3.516232790666     -0.800629140159
H       2.624186272395     -3.235479952483     -2.393177338253
H       0.951343044935     -2.772318244670     -2.094719074006
H      -1.762208917556      3.767917303373     -0.113715372595
H      -0.993457500544      2.841267758279      1.191963088129
H      -0.325198310506      2.781983859181     -0.441679926800
H      -3.969603901809      2.635427043792      0.408951173170
H      -3.184557261426      1.737581566745      1.722758537427
H      -4.076392601208      0.862402380504      0.459881672084
H      -3.013905641751      2.583661234809     -1.918011428678
H      -3.193964913860      0.825654642836     -1.926416154414
H      -1.624894978449      1.552231291998     -2.298256807750
```

<MoleculeViewer 
  xyzData={`37
0 2
N      -1.447712650082      0.470436678152      0.297029433673
S      -1.588154966731     -0.955237695059     -0.486976167534
O      -0.693250013092     -1.872085944998      0.417095457603
C      -1.110923891217     -2.070980877359      1.781650316139
C      -2.155641460611      1.646902766627     -0.194793703903
Cl      1.741721769466      1.013499599169      1.415352597618
O      -2.955066394404     -1.376645312235     -0.384098034715
O      -0.934138650387     -0.935286370225     -1.753967443005
C       2.379183408993     -1.465087648072     -1.207737335226
C       2.646847126917     -1.121188084985      0.043796262068
C       3.066202521877      0.250733616295      0.452076545964
C       4.354345023238      0.266230827492      1.255275467713
H      -0.426783153515     -2.810646637737      2.185999376873
H      -1.022059514408     -1.133320067674      2.326812776347
H      -2.133250026812     -2.442897103195      1.810602867208
C      -1.249551451138      2.837278134612      0.133006638747
C      -3.435208569678      1.719083884837      0.662544507738
C      -2.516268912295      1.642699886746     -1.679205418501
H       2.453864498002     -0.708152986401     -1.985587256797
C       1.943564202543     -2.825808971223     -1.643196528699
H       2.554220290017     -1.850282464657      0.844640679752
H       3.168892631769      0.871698940805     -0.436818187077
H       4.248038669011     -0.343600273272      2.152653489763
H       4.621547136099      1.279268041735      1.553038374657
H       5.155910887220     -0.150708033076      0.643856055442
H       1.902326199000     -3.516232790666     -0.800629140159
H       2.624186272395     -3.235479952483     -2.393177338253
H       0.951343044935     -2.772318244670     -2.094719074006
H      -1.762208917556      3.767917303373     -0.113715372595
H      -0.993457500544      2.841267758279      1.191963088129
H      -0.325198310506      2.781983859181     -0.441679926800
H      -3.969603901809      2.635427043792      0.408951173170
H      -3.184557261426      1.737581566745      1.722758537427
H      -4.076392601208      0.862402380504      0.459881672084
H      -3.013905641751      2.583661234809     -1.918011428678
H      -3.193964913860      0.825654642836     -1.926416154414
H      -1.624894978449      1.552231291998     -2.298256807750`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.2)"
  backgroundColor="#333333"
/>

`bh9_3_33_ts_guess_3.xyz`
```
37
0 2
N      -1.440012961029      0.460769455990      0.294793020173
S      -1.592627481483     -0.966790562824     -0.483172104633
O      -0.694216288364     -1.884691038663      0.416512551106
C      -1.099648245547     -2.075094920533      1.786010919872
C      -2.142257778233      1.639726204560     -0.198504397504
Cl      1.719828759239      1.009157943241      1.430413349542
O      -2.960412684294     -1.381997219272     -0.367825709488
O      -0.948880028941     -0.953788898403     -1.755400057022
C       2.363563067271     -1.450921683978     -1.207833172093
C       2.631468814271     -1.112581469379      0.045417372204
C       3.055919659359      0.256359812305      0.460803005314
C       4.337563650840      0.273270692189      1.259970130054
H      -0.416156144252     -2.817264700957      2.186699778619
H      -0.999727046351     -1.135542565867      2.325852144959
H      -2.123977076246     -2.440416532549      1.826408343450
C      -1.230609523516      2.826294874445      0.126409013102
C      -3.420879804244      1.719802439622      0.659410294038
C      -2.503855887772      1.634775265162     -1.682532394090
H       2.436675058677     -0.689901369369     -1.982004542974
C       1.929211677774     -2.809924074060     -1.649783810651
H       2.539154418690     -1.846093722449      0.842628149094
H       3.144314005297      0.883046511683     -0.424873254524
H       4.237469626386     -0.343349868641      2.153467538310
H       4.604571811888      1.283760363975      1.562701360465
H       5.138840116546     -0.138945001640      0.642780023542
H       1.889528730109     -3.504371118363     -0.810565785983
H       2.610105665458     -3.214887692689     -2.402178602705
H       0.936611221706     -2.755613908820     -2.100200474468
H      -1.738774810963      3.758811082738     -0.122194557573
H      -0.974072737306      2.831022838343      1.185203088204
H      -0.306685920741      2.765120202189     -0.448321662292
H      -3.950504705342      2.638549304916      0.404564239274
H      -3.169397424523      1.738549511534      1.719363567779
H      -4.066380155570      0.866062532199      0.458413204461
H      -2.996782385231      2.577841801692     -1.922675048827
H      -3.185659272770      0.820666794823     -1.927948052502
H      -1.613307920795      1.538588716848     -2.301807466232
```

<MoleculeViewer 
  xyzData={`37
0 2
N      -1.440012961029      0.460769455990      0.294793020173
S      -1.592627481483     -0.966790562824     -0.483172104633
O      -0.694216288364     -1.884691038663      0.416512551106
C      -1.099648245547     -2.075094920533      1.786010919872
C      -2.142257778233      1.639726204560     -0.198504397504
Cl      1.719828759239      1.009157943241      1.430413349542
O      -2.960412684294     -1.381997219272     -0.367825709488
O      -0.948880028941     -0.953788898403     -1.755400057022
C       2.363563067271     -1.450921683978     -1.207833172093
C       2.631468814271     -1.112581469379      0.045417372204
C       3.055919659359      0.256359812305      0.460803005314
C       4.337563650840      0.273270692189      1.259970130054
H      -0.416156144252     -2.817264700957      2.186699778619
H      -0.999727046351     -1.135542565867      2.325852144959
H      -2.123977076246     -2.440416532549      1.826408343450
C      -1.230609523516      2.826294874445      0.126409013102
C      -3.420879804244      1.719802439622      0.659410294038
C      -2.503855887772      1.634775265162     -1.682532394090
H       2.436675058677     -0.689901369369     -1.982004542974
C       1.929211677774     -2.809924074060     -1.649783810651
H       2.539154418690     -1.846093722449      0.842628149094
H       3.144314005297      0.883046511683     -0.424873254524
H       4.237469626386     -0.343349868641      2.153467538310
H       4.604571811888      1.283760363975      1.562701360465
H       5.138840116546     -0.138945001640      0.642780023542
H       1.889528730109     -3.504371118363     -0.810565785983
H       2.610105665458     -3.214887692689     -2.402178602705
H       0.936611221706     -2.755613908820     -2.100200474468
H      -1.738774810963      3.758811082738     -0.122194557573
H      -0.974072737306      2.831022838343      1.185203088204
H      -0.306685920741      2.765120202189     -0.448321662292
H      -3.950504705342      2.638549304916      0.404564239274
H      -3.169397424523      1.738549511534      1.719363567779
H      -4.066380155570      0.866062532199      0.458413204461
H      -2.996782385231      2.577841801692     -1.922675048827
H      -3.185659272770      0.820666794823     -1.927948052502
H      -1.613307920795      1.538588716848     -2.301807466232`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.3)"
  backgroundColor="#333333"
/>


#### Step 3

step3のオプションで、追加での説明を要するものを以下に示す。

- `"opt_method": ["rsirfo_block_bofill"]`は遷移状態構造の最適化向けのoptimizerを指定することを意味する。準ニュートン法であるRS-I-RFO法を使用する。今回は`-fc`で正確なHessianを計算するようにしているので、初期Hessianは正確なHessianを使用するようになっている。(Bofill法によるHessianの更新法を細かい点で変更している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `"saddle_order": 1`は一次の鞍点を求めることを指定する。（step3のデフォルトでは一次の鞍点を指定する。それ以外の値の指定は、プログラムの使用目的上想定していないので、行わないことを勧める。）
- `"calc_exact_hess": 5`は5回の反復回数当たり1回正確なHessianを計算することを指定する。
- `"frequency_analysis": true`は収束条件を満たした後に基準振動解析を行うことを示す。（自前で実装しているため、あくまで目安として使用することを推奨する。各振動モードを`vibration_animation`内のxyzファイルで可視化できる。）UMAモデルから算出されるHessianは数値微分により求めているため、原子数Zが多いとZの二乗オーダーで計算コストが急増する。
- `"tight_convergence_criteria": true`は収束条件を厳しくすることを示す。（Gaussianのtightと同等）
- `"max_trust_radius": D`は一回の反復計算ごとの計算されるステップ幅の最大値をDÅ以下にすることを示す。デフォルトでは、`"saddle_order": 1`を指定すると0.1Åが指定される。
- `"detect_negative_eigenvalues": true`は、初めの計算時(ITR. 0)に、任意の次数の鞍点(遷移状態構造等)を求める際に、正確なへシアンから算出した固有値に１つも負の固有値がない場合、計算を打ち切るオプションである。

実行して得られた正確な遷移状態構造と思われる構造を以下に示す。

(実行して得られた正確な遷移状態構造は計算開始時に、`MultiOptPy-v1.19.6/"work_dir"`ディレクトリ内に生成された新規ディレクトリ内の`bh9_3_33_ts_final_X.xyz`として保存されている。)

`bh9_3_33_ts_final_1.xyz`
```
37
OptimizedStructure
N     -1.323161177859      0.412464197650      0.567709924320
S     -1.859337432142     -1.048408163059      0.026693468723
O     -1.241855479468     -1.987774637957      1.132303425604
C     -1.739200777985     -1.829527620147      2.472297369989
C     -1.867643024235      1.655940839189     -0.047357509349
Cl     0.697878491830      0.292848289652      0.338141417607
O     -3.287280600326     -1.063859747988      0.145306510418
O     -1.259583185674     -1.480234039675     -1.192347402878
C      2.766297005405     -1.634504334503     -1.779053596543
C      2.962556523909     -1.270491158427     -0.502929773345
C      2.875670424557      0.088204157833     -0.056390806656
C      3.462210224325      0.489578813375      1.258349959519
H     -1.274530292401     -2.624896414806      3.047245857714
H     -1.446805671278     -0.855162313305      2.860122372260
H     -2.822326253193     -1.934675025320      2.484092953545
C     -1.025072924882      2.821694175224      0.474566479144
C     -3.304245916134      1.864499858241      0.455733593187
C     -1.831393699032      1.623118935655     -1.574148105228
H      2.559997153375     -0.856583833519     -2.509927395976
C      2.754275779897     -3.039286397687     -2.267714419309
H      3.133413674447     -2.032971416707      0.251697195799
H      2.873633566708      0.844096769766     -0.834243568457
H      3.222005413118     -0.238763602324      2.032725069162
H      3.105087244265      1.467895663684      1.573586855842
H      4.553343733067      0.539745452289      1.171115011660
H      3.008281853965     -3.741424879181     -1.474631759366
H      3.451178699403     -3.176215741238     -3.097449823032
H      1.758951704965     -3.290100718415     -2.643866085122
H     -1.511996834698      3.759097395607      0.204133180909
H     -0.941082628885      2.772368348522      1.560869405222
H     -0.024799186018      2.818143827125      0.048009414552
H     -3.648435728849      2.842169562063      0.113594215132
H     -3.328888539902      1.850396747775      1.545993934858
H     -3.980474543552      1.102379627348      0.081935925634
H     -2.138380392979      2.593315903312     -1.968835284676
H     -2.505283525741      0.863275992584     -1.970810228630
H     -0.823003678002      1.403645487365     -1.926517782235
```

<MoleculeViewer 
  xyzData={`37
OptimizedStructure
N     -1.323161177859      0.412464197650      0.567709924320
S     -1.859337432142     -1.048408163059      0.026693468723
O     -1.241855479468     -1.987774637957      1.132303425604
C     -1.739200777985     -1.829527620147      2.472297369989
C     -1.867643024235      1.655940839189     -0.047357509349
Cl     0.697878491830      0.292848289652      0.338141417607
O     -3.287280600326     -1.063859747988      0.145306510418
O     -1.259583185674     -1.480234039675     -1.192347402878
C      2.766297005405     -1.634504334503     -1.779053596543
C      2.962556523909     -1.270491158427     -0.502929773345
C      2.875670424557      0.088204157833     -0.056390806656
C      3.462210224325      0.489578813375      1.258349959519
H     -1.274530292401     -2.624896414806      3.047245857714
H     -1.446805671278     -0.855162313305      2.860122372260
H     -2.822326253193     -1.934675025320      2.484092953545
C     -1.025072924882      2.821694175224      0.474566479144
C     -3.304245916134      1.864499858241      0.455733593187
C     -1.831393699032      1.623118935655     -1.574148105228
H      2.559997153375     -0.856583833519     -2.509927395976
C      2.754275779897     -3.039286397687     -2.267714419309
H      3.133413674447     -2.032971416707      0.251697195799
H      2.873633566708      0.844096769766     -0.834243568457
H      3.222005413118     -0.238763602324      2.032725069162
H      3.105087244265      1.467895663684      1.573586855842
H      4.553343733067      0.539745452289      1.171115011660
H      3.008281853965     -3.741424879181     -1.474631759366
H      3.451178699403     -3.176215741238     -3.097449823032
H      1.758951704965     -3.290100718415     -2.643866085122
H     -1.511996834698      3.759097395607      0.204133180909
H     -0.941082628885      2.772368348522      1.560869405222
H     -0.024799186018      2.818143827125      0.048009414552
H     -3.648435728849      2.842169562063      0.113594215132
H     -3.328888539902      1.850396747775      1.545993934858
H     -3.980474543552      1.102379627348      0.081935925634
H     -2.138380392979      2.593315903312     -1.968835284676
H     -2.505283525741      0.863275992584     -1.970810228630
H     -0.823003678002      1.403645487365     -1.926517782235`}
  caption="遷移状態構造 (No.1)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                     -565.0161              7.4395             17.6041
Reduced mass [au]                  14.9741              3.6499              4.8052
Force const [Dyne/A]               -2.8165              0.0001              0.0009
Char temp [K]                       0.0000             10.7038             25.3284
Normal mode                   x         y         z            x         y         z            x         y         z     
       N                -0.10700    0.00862    0.01492    0.00092   -0.00381    0.00287    0.00451    0.00388    0.00312
       S                -0.01196   -0.00244   -0.00137   -0.00217    0.00764   -0.02482    0.04272   -0.00488   -0.01192
       O                -0.00068    0.00774   -0.00123    0.00595   -0.01595   -0.04932    0.03515    0.00352   -0.00067
       C                 0.00001    0.00086   -0.00032    0.01520   -0.04492   -0.04249    0.00288   -0.00838   -0.01108
       C                -0.01737    0.00183   -0.00226   -0.00540    0.00939    0.03519   -0.00628   -0.00509   -0.00587
      Cl                 0.12537   -0.00218   -0.00542   -0.00092    0.00244   -0.01524    0.00875    0.03559    0.03332
       O                -0.01341   -0.01843   -0.00455   -0.00135    0.00433   -0.01530    0.04042   -0.03061   -0.04401
       O                 0.00074    0.00907    0.00197   -0.01032    0.03402   -0.03817    0.07713    0.00755    0.00023
       C                 0.00249    0.00254    0.00891   -0.00579   -0.06514    0.04405   -0.09878   -0.00198    0.01481
       C                -0.01355   -0.01358   -0.00415    0.01086   -0.00217    0.02358   -0.03537   -0.00249    0.00507
       C                -0.13570    0.01411    0.02499   -0.00419    0.01739   -0.03863    0.00190    0.00001    0.00490
       C                -0.01490   -0.00297   -0.01001    0.01048    0.08862   -0.06693    0.03319   -0.00959   -0.00618
       H                 0.00130   -0.00057   -0.00340    0.01975   -0.05682   -0.06266    0.00425   -0.00154   -0.00275
       H                 0.00250   -0.00083    0.00179    0.01719   -0.05298   -0.02374   -0.02278   -0.00417   -0.00238
       H                 0.00013    0.00075    0.00036    0.01535   -0.04594   -0.03718    0.00448   -0.02753   -0.03526
       C                -0.00168   -0.00564    0.00188   -0.00160   -0.00155    0.05351   -0.03661    0.00871    0.01204
       C                -0.01571    0.01248   -0.00341   -0.00107   -0.00281    0.05256   -0.01957   -0.03153   -0.03302
       C                -0.00388   -0.00384   -0.00069   -0.01871    0.04307    0.03416    0.02335   -0.00219   -0.00524
       H                -0.02389    0.00064    0.01264   -0.03345   -0.10296    0.01168   -0.11507    0.00051    0.02206
       C                 0.00922    0.00251   -0.00138    0.01107   -0.08799    0.10939   -0.15742   -0.00295    0.01984
       H                 0.00326   -0.00140    0.00237    0.03799    0.03610    0.05616   -0.02207   -0.00383    0.00069
       H                 0.01600   -0.00628    0.00391   -0.02837   -0.01929   -0.07413   -0.00057   -0.00019    0.00481
       H                 0.01335    0.00175    0.00244    0.03412    0.12164   -0.02853    0.03481   -0.00481   -0.00120
       H                 0.03139    0.00604    0.01022    0.00030    0.09801   -0.10753    0.05717   -0.00283   -0.00000
       H                -0.02281   -0.04113   -0.10542    0.00832    0.10149   -0.08659    0.03254   -0.02918   -0.02643
       H                 0.00802   -0.00170   -0.00448    0.03511   -0.04700    0.13803   -0.13280   -0.00685    0.00853
       H                 0.00582    0.00413   -0.00365    0.00136   -0.11420    0.10554   -0.20546   -0.02258   -0.01718
       H                 0.00668    0.00869    0.00281    0.01009   -0.12241    0.13500   -0.18444    0.02183    0.07453
       H                 0.00327   -0.00268    0.00294   -0.00467    0.00409    0.07858   -0.04681    0.00081    0.00296
       H                -0.00141   -0.00889    0.00122    0.00812   -0.02554    0.05167   -0.05778    0.00926    0.01370
       H                -0.00258   -0.01730    0.00110   -0.00542    0.00859    0.04444   -0.02783    0.02561    0.03245
       H                -0.01613    0.01122   -0.00527   -0.00489    0.00447    0.07718   -0.03061   -0.03723   -0.03821
       H                -0.01073    0.01515   -0.00347    0.00868   -0.02683    0.05247   -0.04008   -0.03338   -0.03350
       H                -0.00917    0.00447   -0.00037   -0.00379    0.00490    0.04178    0.00124   -0.04315   -0.04699
       H                 0.00367   -0.00144    0.00018   -0.02362    0.05127    0.05814    0.01351   -0.00708   -0.00957
       H                -0.00421   -0.00196   -0.00252   -0.02107    0.05079    0.02337    0.04438   -0.01357   -0.01923
       H                -0.00168   -0.00829    0.01018   -0.02148    0.05235    0.02049    0.03399    0.01658    0.01356
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。

`bh9_3_33_ts_final_2.xyz`
```
37
OptimizedStructure
N     -1.526648717514      0.568269921964      0.415463325698
S     -1.457317304136     -0.597798183307     -0.724122263733
O     -0.860027273346     -1.782070612028      0.108031762958
C     -1.624064732922     -2.270400570511      1.228288705610
C     -2.009321585235      1.900575904661      0.073505426604
Cl     1.615264235534      0.339153630005      1.751353579041
O     -2.801402462507     -0.907943519652     -1.112296185699
O     -0.468798390582     -0.322360754411     -1.717588512302
C      2.373073230643     -2.342547269796     -0.680756530182
C      2.872394552752     -1.443493161870      0.155517555141
C      2.438629441089     -0.017800371321      0.162948396982
C      3.582813849686      0.961647949166     -0.011754912869
H     -1.077887141676     -3.135756651652      1.589828081539
H     -1.668228883829     -1.501313333208      1.996380337380
H     -2.622727835649     -2.555685503598      0.903359355275
C     -1.192660598345      2.862890421615      0.941530400164
C     -3.481961469665      1.909451446739      0.530799196305
C     -1.915901699123      2.296419609956     -1.398867022284
H      1.592671245271     -2.030085931767     -1.369851825627
C      2.793799195317     -3.776073558527     -0.740213852566
H      3.642528402821     -1.717922399510      0.872785811865
H      1.667016018333      0.138816782632     -0.587921507104
H      4.332029574188      0.820213109346      0.767788506982
H      3.226906510255      1.990090996118      0.031733077266
H      4.054071994558      0.792084171999     -0.981456484857
H      3.568028481958     -3.996858305499     -0.005364232195
H      3.176785479060     -4.030055146108     -1.730953207342
H      1.942806346110     -4.435216900197     -0.553758768210
H     -1.570728024875      3.878642912223      0.819938582737
H     -1.259985353516      2.578907218337      1.991098007161
H     -0.142624216035      2.840558667372      0.649890452979
H     -3.882197042702      2.913940122620      0.388712258049
H     -3.557034110786      1.643907317300      1.584692565028
H     -4.066221632121      1.204939127877     -0.059664111192
H     -2.294593366807      3.313471809437     -1.508870472087
H     -2.513415941108      1.639941410231     -2.031456541733
H     -0.885070775097      2.269459643361     -1.748748954782
```

<MoleculeViewer 
  xyzData={`37
OptimizedStructure
N     -1.526648717514      0.568269921964      0.415463325698
S     -1.457317304136     -0.597798183307     -0.724122263733
O     -0.860027273346     -1.782070612028      0.108031762958
C     -1.624064732922     -2.270400570511      1.228288705610
C     -2.009321585235      1.900575904661      0.073505426604
Cl     1.615264235534      0.339153630005      1.751353579041
O     -2.801402462507     -0.907943519652     -1.112296185699
O     -0.468798390582     -0.322360754411     -1.717588512302
C      2.373073230643     -2.342547269796     -0.680756530182
C      2.872394552752     -1.443493161870      0.155517555141
C      2.438629441089     -0.017800371321      0.162948396982
C      3.582813849686      0.961647949166     -0.011754912869
H     -1.077887141676     -3.135756651652      1.589828081539
H     -1.668228883829     -1.501313333208      1.996380337380
H     -2.622727835649     -2.555685503598      0.903359355275
C     -1.192660598345      2.862890421615      0.941530400164
C     -3.481961469665      1.909451446739      0.530799196305
C     -1.915901699123      2.296419609956     -1.398867022284
H      1.592671245271     -2.030085931767     -1.369851825627
C      2.793799195317     -3.776073558527     -0.740213852566
H      3.642528402821     -1.717922399510      0.872785811865
H      1.667016018333      0.138816782632     -0.587921507104
H      4.332029574188      0.820213109346      0.767788506982
H      3.226906510255      1.990090996118      0.031733077266
H      4.054071994558      0.792084171999     -0.981456484857
H      3.568028481958     -3.996858305499     -0.005364232195
H      3.176785479060     -4.030055146108     -1.730953207342
H      1.942806346110     -4.435216900197     -0.553758768210
H     -1.570728024875      3.878642912223      0.819938582737
H     -1.259985353516      2.578907218337      1.991098007161
H     -0.142624216035      2.840558667372      0.649890452979
H     -3.882197042702      2.913940122620      0.388712258049
H     -3.557034110786      1.643907317300      1.584692565028
H     -4.066221632121      1.204939127877     -0.059664111192
H     -2.294593366807      3.313471809437     -1.508870472087
H     -2.513415941108      1.639941410231     -2.031456541733
H     -0.885070775097      2.269459643361     -1.748748954782`}
  caption="遷移状態構造 (No.2)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                      -16.6172             17.7611             26.4713
Reduced mass [au]                   4.7825              4.5760              3.7950
Force const [Dyne/A]               -0.0008              0.0009              0.0016
Char temp [K]                       0.0000             25.5543             38.0863
Normal mode                   x         y         z            x         y         z            x         y         z     
       N                 0.02391    0.01623   -0.02786   -0.00182    0.01810   -0.00702   -0.01054    0.01519    0.00589
       S                -0.00924   -0.00024   -0.01233    0.01640    0.03090   -0.01856    0.02157   -0.00212    0.02558
       O                 0.02180    0.01485   -0.01347    0.06241    0.04082   -0.03763    0.03400    0.02132    0.04880
       C                 0.06855    0.03793    0.02861    0.10379    0.01896   -0.01933    0.04126    0.03474    0.05934
       C                 0.01369    0.01134   -0.03067   -0.04275    0.00827    0.01335   -0.02335    0.00330   -0.02266
      Cl                -0.00132   -0.05449    0.07066   -0.00705    0.00022   -0.01765   -0.02559   -0.01655   -0.01527
       O                -0.02037   -0.01001    0.03465    0.01977   -0.00394   -0.00232    0.02984   -0.03012    0.01884
       O                -0.04038   -0.01122   -0.04649   -0.00470    0.06715   -0.02956    0.02474   -0.00121    0.02888
       C                 0.00107    0.00660   -0.00901   -0.00101   -0.05321    0.03536   -0.02108    0.02963   -0.06378
       C                -0.00833    0.00105    0.00259   -0.00872   -0.04283    0.02873   -0.02024   -0.01276   -0.01869
       C                -0.04279   -0.00949    0.03957    0.00260   -0.03916   -0.00361    0.02841    0.00191    0.00809
       C                -0.07132    0.02055    0.01949    0.01253   -0.05254   -0.01412    0.06988   -0.03250    0.08665
       H                 0.07750    0.03843    0.01625    0.12860    0.02461   -0.04307    0.04634    0.04206    0.06925
       H                 0.11138    0.04992    0.01895    0.11485    0.01182   -0.01166    0.04207    0.04594    0.04805
       H                 0.05120    0.04191    0.07821    0.09861    0.00548    0.00807    0.04070    0.02599    0.06846
       C                 0.04918    0.02175   -0.07532   -0.04837    0.02124    0.00454   -0.04594    0.02731   -0.02795
       C                 0.03102    0.02118    0.02480   -0.03322   -0.03322    0.04447   -0.02930   -0.00755   -0.04202
       C                -0.04106   -0.01122   -0.04013   -0.08372    0.02262    0.01469   -0.00966   -0.01938   -0.02791
       H                -0.01729    0.00174    0.00958    0.01299   -0.05882    0.01685    0.01314    0.07682   -0.08098
       C                 0.03694    0.01868   -0.04723   -0.01054   -0.05735    0.06564   -0.06871    0.01696   -0.09247
       H                 0.01072    0.00533   -0.01626   -0.02231   -0.03639    0.04576   -0.05526   -0.06047    0.00067
       H                -0.06811   -0.01547    0.06409    0.01031   -0.04708   -0.01321    0.06370    0.05112   -0.01804
       H                -0.04323    0.02522   -0.00666    0.00508   -0.04313   -0.00525    0.03170   -0.08319    0.11413
       H                -0.09422    0.01148    0.04807    0.02069   -0.04875   -0.03795    0.10427   -0.02137    0.10364
       H                -0.09827    0.04772    0.00168    0.01871   -0.07624   -0.00694    0.10541   -0.01907    0.10155
       H                 0.05351    0.02214   -0.06366   -0.02537   -0.05113    0.08312   -0.10110   -0.03221   -0.07308
       H                 0.02875    0.05077   -0.05861    0.00560   -0.07591    0.07665   -0.04425    0.03339   -0.08724
       H                 0.05668   -0.00739   -0.04942   -0.01846   -0.04858    0.06066   -0.09816    0.04120   -0.14111
       H                 0.04870    0.02139   -0.07670   -0.07496    0.01317    0.01987   -0.05448    0.02133   -0.05129
       H                 0.08819    0.03742   -0.06868   -0.02077    0.01155    0.00368   -0.05850    0.04529   -0.02386
       H                 0.03833    0.01429   -0.11461   -0.05374    0.04865   -0.01708   -0.04154    0.03283   -0.01276
       H                 0.02740    0.01971    0.02469   -0.06246   -0.04250    0.06117   -0.04023   -0.01491   -0.06336
       H                 0.07003    0.03692    0.03152   -0.00421   -0.04410    0.04379   -0.03981    0.00822   -0.03880
       H                 0.00762    0.01341    0.05712   -0.02735   -0.04349    0.05082   -0.01264   -0.02445   -0.03834
       H                -0.04488   -0.01281   -0.04163   -0.11316    0.01338    0.03055   -0.02241   -0.02642   -0.04928
       H                -0.06504   -0.02086   -0.00748   -0.07955    0.01163    0.02213    0.00757   -0.03796   -0.02489
       H                -0.05429   -0.01706   -0.07860   -0.09032    0.05274   -0.00697   -0.00486   -0.01085   -0.01431
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。

`bh9_3_33_ts_final_3.xyz`
```
37
OptimizedStructure
N     -1.526082987652      0.568644414784      0.417004619272
S     -1.458257648274     -0.598016499481     -0.722064569709
O     -0.860099796239     -1.781929507049      0.109977226270
C     -1.622840932543     -2.269595459043      1.231406103162
C     -2.009011190842      1.900831464400      0.074944208742
Cl     1.617394078221      0.339835710054      1.749274953253
O     -2.802844877198     -0.908206964955     -1.108459269198
O     -0.470905247086     -0.323202040936     -1.716862416425
C      2.371991780454     -2.343144936031     -0.682426774312
C      2.872410686114     -1.443732243322      0.152804968054
C      2.438804005263     -0.017990107960      0.160053956658
C      3.582879835299      0.961251318285     -0.016514835609
H     -1.076326723387     -3.134828758528      1.592730908831
H     -1.665989655492     -1.500108517980      1.999155096508
H     -2.621928022709     -2.554931991596      0.907828704163
C     -1.191193013141      2.863494950825      0.941491687839
C     -3.481098534353      1.910114876310      0.534005676939
C     -1.917317538448      2.295909286370     -1.397742552905
H      1.590796420022     -2.030940217685     -1.370739664894
C      2.792495093290     -3.776744679457     -0.741682650422
H      3.643375999495     -1.717889648292      0.869284256677
H      1.666301904192      0.138336937866     -0.589962205345
H      4.333021601338      0.820122691510      0.762193368862
H      3.227132901197      1.989753264623      0.026894388615
H      4.052949085076      0.791158795104     -0.986700709361
H      3.567579210271     -3.997251542546     -0.007649793345
H      3.174270378328     -4.031253185416     -1.732754552866
H      1.941655101513     -4.435705424948     -0.553887180877
H     -1.569287240877      3.879229505037      0.819833412028
H     -1.257287499010      2.580057934016      1.991285177609
H     -0.141510936726      2.840889445951      0.648599734032
H     -3.881387325223      2.914577772939      0.391885344594
H     -3.554933571475      1.645119801408      1.588124649401
H     -4.066151714986      1.205368746400     -0.055392684139
H     -2.296023231469      3.312949019102     -1.507812071872
H     -2.515668820540      1.639176263128     -2.029275491464
H     -0.886911572401      2.268649527115     -1.748851018766
```

<MoleculeViewer 
  xyzData={`37
OptimizedStructure
N     -1.526082987652      0.568644414784      0.417004619272
S     -1.458257648274     -0.598016499481     -0.722064569709
O     -0.860099796239     -1.781929507049      0.109977226270
C     -1.622840932543     -2.269595459043      1.231406103162
C     -2.009011190842      1.900831464400      0.074944208742
Cl     1.617394078221      0.339835710054      1.749274953253
O     -2.802844877198     -0.908206964955     -1.108459269198
O     -0.470905247086     -0.323202040936     -1.716862416425
C      2.371991780454     -2.343144936031     -0.682426774312
C      2.872410686114     -1.443732243322      0.152804968054
C      2.438804005263     -0.017990107960      0.160053956658
C      3.582879835299      0.961251318285     -0.016514835609
H     -1.076326723387     -3.134828758528      1.592730908831
H     -1.665989655492     -1.500108517980      1.999155096508
H     -2.621928022709     -2.554931991596      0.907828704163
C     -1.191193013141      2.863494950825      0.941491687839
C     -3.481098534353      1.910114876310      0.534005676939
C     -1.917317538448      2.295909286370     -1.397742552905
H      1.590796420022     -2.030940217685     -1.370739664894
C      2.792495093290     -3.776744679457     -0.741682650422
H      3.643375999495     -1.717889648292      0.869284256677
H      1.666301904192      0.138336937866     -0.589962205345
H      4.333021601338      0.820122691510      0.762193368862
H      3.227132901197      1.989753264623      0.026894388615
H      4.052949085076      0.791158795104     -0.986700709361
H      3.567579210271     -3.997251542546     -0.007649793345
H      3.174270378328     -4.031253185416     -1.732754552866
H      1.941655101513     -4.435705424948     -0.553887180877
H     -1.569287240877      3.879229505037      0.819833412028
H     -1.257287499010      2.580057934016      1.991285177609
H     -0.141510936726      2.840889445951      0.648599734032
H     -3.881387325223      2.914577772939      0.391885344594
H     -3.554933571475      1.645119801408      1.588124649401
H     -4.066151714986      1.205368746400     -0.055392684139
H     -2.296023231469      3.312949019102     -1.507812071872
H     -2.515668820540      1.639176263128     -2.029275491464
H     -0.886911572401      2.268649527115     -1.748851018766`}
  caption="遷移状態構造 (No.3)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                      -16.6344             17.7454             26.4614
Reduced mass [au]                   4.7851              4.5721              3.7968
Force const [Dyne/A]               -0.0008              0.0008              0.0016
Char temp [K]                       0.0000             25.5317             38.0720
Normal mode                   x         y         z            x         y         z            x         y         z     
       N                 0.02394    0.01612   -0.02792   -0.00166    0.01794   -0.00715   -0.01061    0.01539    0.00580
       S                -0.00930   -0.00031   -0.01236    0.01617    0.03086   -0.01887    0.02166   -0.00183    0.02540
       O                 0.02167    0.01472   -0.01358    0.06209    0.04056   -0.03825    0.03454    0.02173    0.04845
       C                 0.06841    0.03781    0.02839    0.10353    0.01863   -0.01998    0.04225    0.03507    0.05922
       C                 0.01380    0.01127   -0.03068   -0.04249    0.00822    0.01354   -0.02376    0.00342   -0.02259
      Cl                -0.00109   -0.05436    0.07084   -0.00685    0.00039   -0.01740   -0.02571   -0.01676   -0.01532
       O                -0.02040   -0.00995    0.03464    0.01946   -0.00371   -0.00246    0.02994   -0.03015    0.01886
       O                -0.04047   -0.01134   -0.04649   -0.00502    0.06709   -0.02995    0.02463   -0.00064    0.02857
       C                 0.00096    0.00668   -0.00893   -0.00086   -0.05332    0.03590   -0.02098    0.02912   -0.06350
       C                -0.00835    0.00117    0.00260   -0.00860   -0.04266    0.02898   -0.02020   -0.01314   -0.01845
       C                -0.04284   -0.00937    0.03965    0.00237   -0.03911   -0.00354    0.02844    0.00152    0.00808
       C                -0.07149    0.02074    0.01934    0.01200   -0.05227   -0.01464    0.07000   -0.03285    0.08657
       H                 0.07730    0.03826    0.01601    0.12819    0.02410   -0.04398    0.04744    0.04233    0.06882
       H                 0.11125    0.04977    0.01871    0.11483    0.01135   -0.01217    0.04340    0.04620    0.04802
       H                 0.05113    0.04187    0.07798    0.09830    0.00541    0.00750    0.04155    0.02640    0.06873
       C                 0.04924    0.02159   -0.07530   -0.04773    0.02099    0.00458   -0.04627    0.02753   -0.02805
       C                 0.03117    0.02119    0.02471   -0.03279   -0.03310    0.04511   -0.02962   -0.00769   -0.04157
       C                -0.04090   -0.01124   -0.04004   -0.08384    0.02270    0.01493   -0.01051   -0.01921   -0.02786
       H                -0.01746    0.00179    0.00975    0.01291   -0.05924    0.01747    0.01326    0.07618   -0.08086
       C                 0.03680    0.01874   -0.04719   -0.01006   -0.05736    0.06640   -0.06856    0.01645   -0.09195
       H                 0.01076    0.00549   -0.01635   -0.02196   -0.03591    0.04591   -0.05524   -0.06073    0.00107
       H                -0.06827   -0.01541    0.06433    0.00980   -0.04736   -0.01294    0.06376    0.05063   -0.01820
       H                -0.04326    0.02545   -0.00700    0.00485   -0.04249   -0.00598    0.03177   -0.08339    0.11422
       H                -0.09442    0.01166    0.04803    0.01990   -0.04856   -0.03861    0.10439   -0.02172    0.10333
       H                -0.09865    0.04793    0.00146    0.01792   -0.07607   -0.00758    0.10566   -0.01955    0.10150
       H                 0.05340    0.02221   -0.06369   -0.02466   -0.05082    0.08378   -0.10092   -0.03257   -0.07247
       H                 0.02853    0.05079   -0.05860    0.00594   -0.07605    0.07738   -0.04408    0.03279   -0.08672
       H                 0.05655   -0.00734   -0.04932   -0.01780   -0.04874    0.06175   -0.09803    0.04065   -0.14048
       H                 0.04882    0.02125   -0.07667   -0.07421    0.01300    0.02016   -0.05503    0.02149   -0.05125
       H                 0.08818    0.03723   -0.06873   -0.01985    0.01120    0.00369   -0.05852    0.04548   -0.02395
       H                 0.03835    0.01406   -0.11453   -0.05322    0.04828   -0.01736   -0.04193    0.03322   -0.01313
       H                 0.02762    0.01976    0.02465   -0.06193   -0.04231    0.06206   -0.04078   -0.01512   -0.06277
       H                 0.07014    0.03687    0.03136   -0.00350   -0.04408    0.04440   -0.03982    0.00805   -0.03832
       H                 0.00781    0.01351    0.05700   -0.02718   -0.04324    0.05157   -0.01300   -0.02467   -0.03777
       H                -0.04467   -0.01281   -0.04151   -0.11317    0.01353    0.03104   -0.02351   -0.02633   -0.04909
       H                -0.06486   -0.02081   -0.00740   -0.07994    0.01186    0.02249    0.00669   -0.03790   -0.02472
       H                -0.05416   -0.01714   -0.07846   -0.09058    0.05271   -0.00704   -0.00578   -0.01048   -0.01451
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。


次に、`vibration_animation`内の虚振動を示す分子振動が示されたxyzファイル(`mode_1_XXXi_wave_number.xyz`)をAvogadroで確認すると、求められた遷移状態構造の中に、想定される反応系と生成系をつなぐ方向に振動している構造が存在することを確認できた。


## 終わりに
　
　自作ライブラリで、UMAモデルのニューラルネットワークポテンシャル(NNP, `uma-s-1p1`)を用いて、BH9データセットの3. Halogen atom transfer, No. 33の反応のある1つの遷移状態構造を算出する手順を説明した。



## 参考
- https://github.com/ss0832/MultiOptPy (自作ライブラリMultiOptPyのレポジトリ)
- https://avogadro.cc/ (Avogadro、分子構造可視化ツール)
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)
- _The Journal of Chemical Physics_ 2010, 132, 241102.
- _The Journal of Chemical Physics_ 1991, 94, 751–760.
- In _Classical and Quantum Dynamics in Condensed Phase Simulations_; WORLD SCIENTIFIC: LERICI, Villa Marigola, 1998; pp 385–404.
- _The Journal of Chemical Physics_, 2020, 153, 024109.
- _The Journal of Chemical Physics_, 2022, 144, 214108.
- _J. Phys. Chem. A_ 2019, 123, 3761−3781 http://dx.doi.org/10.1021/acs.jpca.9b01546 (MOBH35のデータセットについて)


---
title:  【計算化学】自作pythonライブラリで遷移状態構造を求めてみる(MOBH35データセットのNo. 25の素過程, NNP使用)
published: 2025-10-11
description: ""
tags: [MultiOptPy, python]
category: Computational Chemistry
draft: false
---
最終更新：2025-10-11

import MoleculeViewer from '../../components/MoleculeViewer.astro';
import MultiDataGraph from '../../components/MultiDataGraph.astro';

## 概要

本記事では、自作ライブラリ(MultiOptPy)で、MOBH35データセットのNo. 25の素過程の遷移状態構造を算出してみる。計算レベルは、Meta社のFAIR Chemistryが開発したニューラルネットワークポテンシャル(NNP)であるUMA(Meta’s Universal Model for Atoms)とした。

MultiOptPyは電子状態計算ソフトウェアを用いた分子構造最適化手法の勉強を目的として作成したpythonライブラリである。

MultiOptPyのレポジトリ:https://github.com/ss0832/MultiOptPy

MOBH35のデータセットについて:
- _J. Phys. Chem. A_ 2019, 123, 3761−3781 http://dx.doi.org/10.1021/acs.jpca.9b01546

この文献のSupporting Informationから、データセットの詳細を確認できる。

有機金属錯体が関わる化学反応の活性化障壁及び反応熱の値のDFTの汎関数のエネルギーの精度の比較のベンチマークに使用される。

今回使用したニューラルネットワークポテンシャルについて：
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)



## 使用した自作ライブラリMultiOptPyのバージョン
```
v1.18c
```
## 環境
```
Windows 11
```
※Windows 11環境下でAnaconda PowerShell Promptを使用した。

## Source codeのダウンロード(Unixコマンド)
```
wget https://github.com/ss0832/MultiOptPy/archive/refs/tags/v1.18c.zip
unzip v1.18c.zip
cd MultiOptPy-v1.18c
```
https://github.com/ss0832/MultiOptPy/releases/tag/v1.18c にアクセスしてzipファイルをダウンロードする。Unixコマンドの場合とはディレクトリ名が異なるので都度読み替えていただけると良い。


### 環境構築手順

今回は、Windows 11のPower Shellを使用した。初めに、NNPを使用できる環境が整ったAnaconda PowerShell Promptを用意する手順を説明する。

1, https://repo.anaconda.com/archive/ より、`Anaconda3-2025.06-1-Windows-x86_64.exe`でAnacondaをインストールする。

2, 検索機能を使い、スタートから`Anaconda PowerShell Prompt`を開く。

3, 以下のコマンドを実行し、仮想環境を作成する。
```
conda create -n (任意の仮想環境名) python=3.12.7
```

4, 先ほど作成した仮想環境を`conda activate (仮想環境名)`で起動させる。

5, 以下のコマンドを実行し、必要なライブラリを導入する。
```
pip install ase==3.26.0 fairchem-core==2.7.1 torch==2.6.0
```
- fairchem-coreは、FAIR Chemistryが管理しているNNPを動作させるために必要なライブラリである。
- aseはNNPに電子エネルギーを算出したい分子構造を渡すために必要なインターフェイスの役割を果たすために必要なライブラリである。
- torchはPyTorchライブラリを指す。これはニューラルネットワークなどの機械学習を行ったり、学習結果を扱ったりするために必須なライブラリである。

これで、`Anaconda PowerShell Prompt`から仮想環境を立ち上げることで、NNPを使用する準備が整えることが出来る。

次に、NNPを使用するために必要なModelの情報が保存されている`.pt`ファイルのダウンロードおよびNNPの自作ライブラリへの導入方法について説明する。


1, 以下のサイトにアクセスして、`uma-s-1p1.pt`をダウンロードする。（使用許諾が下りていれば可能である。）
```
https://huggingface.co/facebook/UMA
```

2, ダウンロード後、`MultiOptPy-v1.18c`ディレクトリ内に存在する`software_path.conf`に対して、`uma-s-1p1.pt`の絶対パスを用いて以下を追記する。
```
uma-s-1p1::(uma-s-1p1.ptの絶対パス)
```

これで、`MultiOptPy-v1.18c`がNNP`uma-s-1p1`を使用できるようになる。


### 使用するNNPに関する具体的な説明

今回使用するNNPについて具体的に説明する。

- UMAのModel Checkpointは`uma-s-1p1`を使用した。
- 小分子系のトレーニングセットである`Omol25`(`omol`)を使用して学習したニューラルネットワークポテンシャルを使用する。

※自作ライブラリでの具体的な使用の仕方に関しては、`ase_calculation_tools.py` を参照


## 手順

### 1. 初期構造の準備

モデル反応系として、以下の構造を用意した。今回はファイルの名前を`mobh35_25_Re.xyz`とした。
初期構造は以下のものを使用した。

```
88
OptimizedStructure
C      1.132567159956     -0.738200292453      2.086183177904
C     -1.086623091737     -1.585116272306      1.974591098780
C      1.280904598214     -1.094549374153      3.399192366536
C     -0.921322639626     -2.052249890954      3.327196194813
C      0.217939980836     -1.798988933787      4.015165359069
H      2.199567894358     -0.877131084493      3.925098792385
H     -1.746133167482     -2.582860067661      3.784284671923
H      0.318321474040     -2.137597608018      5.039471246037
N      0.009969222610     -0.992264119325      1.366624923438
P      2.257175797352     -0.755753778972     -0.369873461837
P     -2.501015441787     -0.736862019891     -0.161291814918
C      2.263269033115     -0.069903956462      1.338251208562
H      2.058792854881      0.997565172150      1.254213480636
H      3.205488685992     -0.192340239229      1.869531133044
C     -0.265988535769      0.189723145592     -2.575853873042
O     -0.347364902513      0.644574147366     -3.638133320084
C     -2.289355059669     -1.690164309037      1.305779269028
H     -3.132387122728     -2.101889863197      1.847102030888
C     -3.382105910209      0.854327171413      0.396710062175
C     -3.702090101252     -1.680135188884     -1.260837119014
C      3.470856156684      0.266073215944     -1.381397304424
C      2.976712793117     -2.485517802146     -0.076331664109
C     -3.239674079333      1.941246474509     -0.675410519571
H     -3.837897352607      1.724025385709     -1.558896744693
H     -3.589025359229      2.897596367342     -0.271247259466
H     -2.206995998873      2.058796231629     -1.001859350567
C     -4.861384104293      0.707377823975      0.760098929717
H     -5.495629900469      0.498395962059     -0.099238667577
H     -5.012942616182     -0.071601036986      1.508942198466
H     -5.205969074582      1.650676979722      1.196589740546
C     -2.681933977259      1.301295603047      1.690873031422
H     -3.008247054690      2.318212473751      1.932916685934
H     -2.958230718907      0.649930464695      2.519766956573
H     -1.596798718858      1.287534885640      1.620855424207
C     -4.252020153213     -0.784333647566     -2.374060461499
H     -3.445769807773     -0.267753529412     -2.900685609561
H     -4.776081784988     -1.409349174280     -3.102553999715
H     -4.961735831822     -0.042389666202     -2.012242516106
C     -2.941912037829     -2.823402678550     -1.933010198351
H     -2.250371614920     -2.454232854229     -2.687050435815
H     -2.390006023099     -3.424971643477     -1.209759827267
H     -3.664824280283     -3.474080513404     -2.433536810506
C     -4.844970845966     -2.324291276000     -0.466598371112
H     -5.465818493414     -1.613207950368      0.069537854670
H     -5.489951267928     -2.863437281570     -1.166671755071
H     -4.455019104362     -3.051134146918      0.246682147647
C      3.423262252543     -3.102585490201     -1.407060437884
H      3.657943168091     -4.156562158963     -1.237750781796
H      2.642122546608     -3.058060929065     -2.166128374074
H      4.323820191403     -2.628724470014     -1.796674513278
C      1.929724386493     -3.419843612847      0.557536968943
H      1.615408574632     -3.081783225681      1.542979876944
H      1.049017690752     -3.566982987365     -0.057423286059
H      2.407462582990     -4.396047244163      0.684367848242
C      4.162537460769     -2.472575399549      0.901039027101
H      4.594561373237     -3.476894462180      0.919909687058
H      4.954807365187     -1.780474923904      0.630088214152
H      3.834358763017     -2.248242629923      1.916553886708
C      3.028441622253      1.730697848816     -1.274105574283
H      3.098620881068      2.113174243649     -0.253600010535
H      3.689588183493      2.336199298257     -1.900169874492
H      2.008706374650      1.858863231835     -1.634953140852
C      3.330507993506     -0.122235214102     -2.860476016998
H      2.289210909662     -0.082186490780     -3.181372856287
H      3.897307263375      0.591496716522     -3.464850579044
H      3.715576935056     -1.115503877816     -3.076116210927
C      4.936669148280      0.180917841275     -0.956252556273
H      5.072655854052      0.427761194069      0.098868600930
H      5.367092861309     -0.801534729640     -1.142169331937
H      5.513260879715      0.903285010873     -1.541182854356
Re    -0.124210274178     -0.508108867442     -0.802333737281
C     -0.038384211031     -2.219379150556     -1.631977540138
O      0.106975474604     -3.199842335240     -2.229875294921
N      0.032742294933      1.556248118039     -0.084077706533
C      0.173012157165      2.650472514622      0.225943044567
C      0.378061785357      4.052242718115      0.629674582426
C     -0.973345077441      4.648460081706      1.042250461031
C      1.355376552464      4.066067608701      1.812771711452
C      0.961835405654      4.815343468883     -0.566792497845
H     -1.686898918684      4.609120253973      0.219339534458
H     -1.394981516676      4.112481552499      1.891820799581
H     -0.824238329868      5.691158283684      1.325602066794
H      2.324393418640      3.654103232270      1.528637559590
H      1.502793372977      5.097175301011      2.136162336018
H      0.963803361679      3.491332173017      2.652573070488
H      1.112996940286      5.856340656878     -0.278699900640
H      1.920583581654      4.396546057143     -0.872110322535
H      0.282849242824      4.786439488979     -1.419082777611

```

<MoleculeViewer 
  xyzData={`88
OptimizedStructure
C      1.132567159956     -0.738200292453      2.086183177904
C     -1.086623091737     -1.585116272306      1.974591098780
C      1.280904598214     -1.094549374153      3.399192366536
C     -0.921322639626     -2.052249890954      3.327196194813
C      0.217939980836     -1.798988933787      4.015165359069
H      2.199567894358     -0.877131084493      3.925098792385
H     -1.746133167482     -2.582860067661      3.784284671923
H      0.318321474040     -2.137597608018      5.039471246037
N      0.009969222610     -0.992264119325      1.366624923438
P      2.257175797352     -0.755753778972     -0.369873461837
P     -2.501015441787     -0.736862019891     -0.161291814918
C      2.263269033115     -0.069903956462      1.338251208562
H      2.058792854881      0.997565172150      1.254213480636
H      3.205488685992     -0.192340239229      1.869531133044
C     -0.265988535769      0.189723145592     -2.575853873042
O     -0.347364902513      0.644574147366     -3.638133320084
C     -2.289355059669     -1.690164309037      1.305779269028
H     -3.132387122728     -2.101889863197      1.847102030888
C     -3.382105910209      0.854327171413      0.396710062175
C     -3.702090101252     -1.680135188884     -1.260837119014
C      3.470856156684      0.266073215944     -1.381397304424
C      2.976712793117     -2.485517802146     -0.076331664109
C     -3.239674079333      1.941246474509     -0.675410519571
H     -3.837897352607      1.724025385709     -1.558896744693
H     -3.589025359229      2.897596367342     -0.271247259466
H     -2.206995998873      2.058796231629     -1.001859350567
C     -4.861384104293      0.707377823975      0.760098929717
H     -5.495629900469      0.498395962059     -0.099238667577
H     -5.012942616182     -0.071601036986      1.508942198466
H     -5.205969074582      1.650676979722      1.196589740546
C     -2.681933977259      1.301295603047      1.690873031422
H     -3.008247054690      2.318212473751      1.932916685934
H     -2.958230718907      0.649930464695      2.519766956573
H     -1.596798718858      1.287534885640      1.620855424207
C     -4.252020153213     -0.784333647566     -2.374060461499
H     -3.445769807773     -0.267753529412     -2.900685609561
H     -4.776081784988     -1.409349174280     -3.102553999715
H     -4.961735831822     -0.042389666202     -2.012242516106
C     -2.941912037829     -2.823402678550     -1.933010198351
H     -2.250371614920     -2.454232854229     -2.687050435815
H     -2.390006023099     -3.424971643477     -1.209759827267
H     -3.664824280283     -3.474080513404     -2.433536810506
C     -4.844970845966     -2.324291276000     -0.466598371112
H     -5.465818493414     -1.613207950368      0.069537854670
H     -5.489951267928     -2.863437281570     -1.166671755071
H     -4.455019104362     -3.051134146918      0.246682147647
C      3.423262252543     -3.102585490201     -1.407060437884
H      3.657943168091     -4.156562158963     -1.237750781796
H      2.642122546608     -3.058060929065     -2.166128374074
H      4.323820191403     -2.628724470014     -1.796674513278
C      1.929724386493     -3.419843612847      0.557536968943
H      1.615408574632     -3.081783225681      1.542979876944
H      1.049017690752     -3.566982987365     -0.057423286059
H      2.407462582990     -4.396047244163      0.684367848242
C      4.162537460769     -2.472575399549      0.901039027101
H      4.594561373237     -3.476894462180      0.919909687058
H      4.954807365187     -1.780474923904      0.630088214152
H      3.834358763017     -2.248242629923      1.916553886708
C      3.028441622253      1.730697848816     -1.274105574283
H      3.098620881068      2.113174243649     -0.253600010535
H      3.689588183493      2.336199298257     -1.900169874492
H      2.008706374650      1.858863231835     -1.634953140852
C      3.330507993506     -0.122235214102     -2.860476016998
H      2.289210909662     -0.082186490780     -3.181372856287
H      3.897307263375      0.591496716522     -3.464850579044
H      3.715576935056     -1.115503877816     -3.076116210927
C      4.936669148280      0.180917841275     -0.956252556273
H      5.072655854052      0.427761194069      0.098868600930
H      5.367092861309     -0.801534729640     -1.142169331937
H      5.513260879715      0.903285010873     -1.541182854356
Re    -0.124210274178     -0.508108867442     -0.802333737281
C     -0.038384211031     -2.219379150556     -1.631977540138
O      0.106975474604     -3.199842335240     -2.229875294921
N      0.032742294933      1.556248118039     -0.084077706533
C      0.173012157165      2.650472514622      0.225943044567
C      0.378061785357      4.052242718115      0.629674582426
C     -0.973345077441      4.648460081706      1.042250461031
C      1.355376552464      4.066067608701      1.812771711452
C      0.961835405654      4.815343468883     -0.566792497845
H     -1.686898918684      4.609120253973      0.219339534458
H     -1.394981516676      4.112481552499      1.891820799581
H     -0.824238329868      5.691158283684      1.325602066794
H      2.324393418640      3.654103232270      1.528637559590
H      1.502793372977      5.097175301011      2.136162336018
H      0.963803361679      3.491332173017      2.652573070488
H      1.112996940286      5.856340656878     -0.278699900640
H      1.920583581654      4.396546057143     -0.872110322535
H      0.282849242824      4.786439488979     -1.419082777611
`}
  caption="初期経路を求めるための初期構造"
  backgroundColor="#333333"
/>


### 2. 遷移状態構造最適化のための初期構造の算出


#### a. 初期構造をカレントディレクトリに`mobh35_25_Re.xyz`として保存し、以下を実行する。
```
python optmain.py .\mobh35_25_Re.xyz -os uma-s-1p1 -modelhess -opt rsirfo_block_fsb -spin 1 -elec 0 -ma 100 17 75
```
- `-opt rsirfo_block_fsb`は準ニュートン法であるRS-I-RFO法を構造最適化に使用することを示す。初期のへシアンに関しては、特にオプションで指定しない限り、単位行列が使われる。(以前のHessian更新法とは細かな点で異なる方法を使用している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `-spin`はスピン多重度の指定である。PySCFを使用するときは目的とするスピン多重度に1を引いた値を指定する。（デフォルトでは1が指定される。）
- `-elec M`は形式電荷をMとすることを示す。（デフォルトでは0が指定される。）
- `-ma yyy a b `はyyykJ/molの活性化障壁を超えうるペア同士を近づける力を原子のラベル番号aとbのペアに構造最適化時に加えることを示す。
- `-os uma-s-1p1`は今回使用するNNPを指定している。これを使用する際にASEライブラリが必要である。
- `-modelhess`は、計算コストが非常に低い数式を使用して、近似したHessianを生成するオプションである。



これを実行すると、`omol`のデータセットを使用した`uma-s-1p1`モデルのNNPで得たエネルギーに対して、指定した人工力ポテンシャルを加えた上で初期構造を構造最適化することができる。

結果は`yyyy_mm_dd`（今日の年月日）ディレクトリの中に存在するディレクトリを開いて確認できる。

正常終了していれば、このディレクトリ中に、`mobh35_25_Re_traj.xyz`が存在するので、これをコピーして、`MultiOptPy-v1.18c`ディレクトリに置く。

`mobh35_25_Re_traj.xyz`は構造最適化の過程をAvogadro（公式ページ:https://avogadro.cc/ ）等で可視化して確認できるようにしている。この`mobh35_25_Re_traj.xyz`は次のNEB計算に使用する。

※`mobh35_25_Re_traj.xyz`をアニメーションとして表示したい場合は、[https://github.com/ss0832/molecule_movie] を使うと良い。

（この人工力ポテンシャルを加えて行った構造最適化の結果は`mobh35_25_Re_optimized.xyz`で確認できる。構造を可視化して、生成系になっているか確認する。反応系のままであれば、`-ma`の設定を見直してb.をやり直す。今回の場合以下の構造が得られた。生成系の安定構造に近いものが得られていると判断できるため、次のNEB計算を行うことが可能である。）



#### b. `mobh35_25_Re_traj.xyz`を初期経路として、NEB法で経路の緩和を行う。

NEB法を用いることで、先ほど得られた`mobh35_25_Re_traj.xyz`全体のエネルギーを下げることができる。これにより、パスのエネルギー極大値を持つ構造を遷移状態構造に近づける。（この時点ではまだ正確な遷移状態構造は求められていない。）


```
python nebmain.py mobh35_25_Re_traj.xyz -os uma-s-1p1 -ns 15 -aneb 3 5 -modelhess -spng -ndb 0.75 -ad 9999 -spin 1 -elec 0
```
- `-ad X`は線形補間で、各ノード間の距離を全て等しくするための処理である。X回の反復計算ごとに本処理を行う。Xを`-ns`よりも大きな数値を指定することで、初期経路に対してのみ処理を行うことが出来る。
- `-ndb N`はノード間の距離をN Åとして初期経路を作成することを示す。経路作成時に元のノードをベルンシュタイン多項式を用いてがたついた経路を滑らかにする。

→プログラムの仕様上`-ad`の処理を行った後に、`-ndb`の処理を行うようになっている。

- `-ns n`はn回分NEB法による経路の緩和を行うことを示す。
- `-fc M`はM回あたりの経路緩和回数に対して1回だけ正確なHessianを計算し、経路緩和に使用する。これを使用すると、Hessianを使用しない場合の経路緩和アルゴリズムとは別のものを使用して、経路緩和を行う。
- `-spng`は緩和中のパスのエネルギープロファイルや各ノードの勾配のRMS値をmatplotlibで可視化するオプションである。
- `-os uma-s-1p1`は今回使用するNNPを指定している。これを使用する際にASEライブラリが必要である。
- `-aneb A B`これを指定すると、(B+1)回の緩和ごとに、エネルギー極大値を示すノードと前後のノードの間に線形補間でA個の新規ノードを内挿するようにできる。デフォルトではこのような操作は行われない。このオプションを使用するとノードの数が徐々に増えるため、計算コストが使用しない場合と比べて増加する。一方で、エネルギー極大値を示すノード周辺にノードを増加させるため、緩和している経路中のノードが遷移状態構造付近に存在する可能性が高くすることが出来る。


#### c. 初期構造の決定及び遷移状態構造の計算

`MultiOptPy-v1.18c`と同じディレクトリ内に、NEBという名前を含むディレクトリが生成されている。
そのディレクトリ内の`energy_plot.csv`を確認し、緩和後のパスのエネルギー極大値を示す構造を確認する。

経路の緩和後の各ノードのエネルギー一覧(単位:hartree) (energy_plot.csvに保存されている。)

export const dataset1 = [-2194.820710089673,-2194.820710089673,-2194.8162643939627,-2194.8117121557616,-2194.8084255302015,-2194.8057416407455,-2194.803466818379,-2194.8015777919795,-2194.8000163136453,-2194.798767523503,-2194.7979540856045,-2194.7976840144092,-2194.797865837581,-2194.7982465167042,-2194.7986288079837,-2194.798936169051,-2194.7991367773466,-2194.7991674083123,-2194.798877991244,-2194.798034202754,-2194.7963680043663,-2194.7935800257005,-2194.7893231625367,-2194.783801948419,-2194.7791827706924,-2194.7800281713385,-2194.7860907194404,-2194.7921478703242,-2194.7950603354793,-2194.796671720559,-2194.798458620374,-2194.8006292133427,-2194.8031042234416,-2194.8057518043383,-2194.808312889555,-2194.8105394173317,-2194.8123508499566,-2194.813780061396,-2194.8148759069886,-2194.81567497567,-2194.816227104091,-2194.8166053299333,-2194.816875541316,-2194.817204140788,-2194.817852297638,-2194.818828563304,-2194.819957563238,-2194.8211542036347,-2194.8223817553726,-2194.82363419039,-2194.8249293825907,-2194.8260326581203,-2194.826609739914,-2194.8267427077467,-2194.8267389226844];

export const dataset1_itr5 = [-2194.820710089673,-2194.820710089673,-2194.8182366917304,-2194.814430951902,-2194.8113593038547,-2194.8088167233864,-2194.8066701725716,-2194.8048982027244,-2194.803458056661,-2194.8023497343816,-2194.801688049439,-2194.8013601509047,-2194.8014661326456,-2194.801620689351,-2194.801847302425,-2194.8022112992376,-2194.802516837867,-2194.802555529614,-2194.802334103477,-2194.801600993009,-2194.800093977514,-2194.797559177451,-2194.7936161940725,-2194.788056428396,-2194.7824204007256,-2194.7824450737235,-2194.7889954742836,-2194.793928952358,-2194.7961322791057,-2194.7978490150826,-2194.7999884864294,-2194.802166859804,-2194.8047576647677,-2194.8074730263147,-2194.809982802911,-2194.812106573259,-2194.813945692913,-2194.815425582129,-2194.8165660774366,-2194.8173756601796,-2194.8178780220424,-2194.8182128598573,-2194.818522534018,-2194.8189330029827,-2194.8195315334624,-2194.820338382549,-2194.8213325221195,-2194.8224587183036,-2194.823653816638,-2194.8248823496883,-2194.8261423548297,-2194.827227405986,-2194.827810585936,-2194.8279877829204,-2194.828051778509];

export const dataset1_itr10 = [-2194.820709739204,-2194.820710159767,-2194.81947307528,-2194.8164706097577,-2194.813714313464,-2194.8113541169178,-2194.8093560246525,-2194.8077004104202,-2194.8063711526597,-2194.8053725971836,-2194.8047604685175,-2194.804657781183,-2194.8045728976585,-2194.8044981777275,-2194.8044684579804,-2194.804438457858,-2194.8044639719806,-2194.8044897664786,-2194.804525724569,-2194.804628972654,-2194.804706916897,-2194.8050065676525,-2194.805335727874,-2194.805367059778,-2194.805138203704,-2194.80445310745,-2194.803085858881,-2194.800795826172,-2194.797187820796,-2194.791721770455,-2194.7849384483834,-2194.7830818753873,-2194.7820226187287,-2194.782344208826,-2194.783665896462,-2194.785156510021,-2194.7871631537228,-2194.7892801950716,-2194.791144898942,-2194.7947550071303,-2194.796645926061,-2194.7985397188354,-2194.800690965931,-2194.802994036076,-2194.8055952149143,-2194.808284852057,-2194.8107472452825,-2194.8128759922865,-2194.8146778921623,-2194.815976518956,-2194.8169854483067,-2194.8176698436228,-2194.818102322023,-2194.818425664464,-2194.818780198621,-2194.819238471519,-2194.8198718385893,-2194.820703010205,-2194.8217162853675,-2194.822874934955,-2194.8241209213475,-2194.8253813470515,-2194.8265891323535,-2194.827509112743,-2194.8279694183593,-2194.8280824795684,-2194.8280817085374];

export const dataset2 = [-2194.8207009073926,-2194.820710089673,-2194.820133568629,-2194.817799026393,-2194.8153606052283,-2194.8131943580715,-2194.8113552384175,-2194.809808619957,-2194.8085731476262,-2194.8076431438312,-2194.8070460152267,-2194.8069384914234,-2194.8068489116185,-2194.8067657103447,-2194.8065881628913,-2194.8065808731417,-2194.8063737461284,-2194.806360778786,-2194.8063518768804,-2194.8062942598226,-2194.8063101711027,-2194.806317460852,-2194.8063281851946,-2194.806789121655,-2194.806816528309,-2194.806910173551,-2194.806952299891,-2194.8071230482515,-2194.8074261336,-2194.8073917876654,-2194.8071306884694,-2194.8064823914315,-2194.8052428536635,-2194.80316653678,-2194.7998818738447,-2194.7947577407867,-2194.7873767994543,-2194.7845715777275,-2194.7838847992243,-2194.78330939968,-2194.7828699819993,-2194.782583018212,-2194.782432106381,-2194.7824783682518,-2194.7826404950815,-2194.782927879432,-2194.7849480512264,-2194.786949788366,-2194.789303536288,-2194.79127141815,-2194.7927049053073,-2194.795251481119,-2194.7970444089956,-2194.7990422909797,-2194.801234122353,-2194.8036049731486,-2194.8062294932033,-2194.808882751693,-2194.8112887194543,-2194.813358377432,-2194.815021281414,-2194.816243506027,-2194.817163906979,-2194.817767764583,-2194.818154611956,-2194.81847388896,-2194.818852745646,-2194.8193609252894,-2194.8200330542004,-2194.8208959081885,-2194.821931683443,-2194.8231113611537,-2194.824376553232,-2194.825633263967,-2194.826767240557,-2194.8275612624884,-2194.8279927595763,-2194.82809243288,-2194.8280841618184];

<MultiDataGraph datasets={[ { data: dataset1, label: "緩和前の経路のエネルギー", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_itr5, label: "ITR. 5の経路のエネルギー", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_itr10, label: "ITR. 10の経路のエネルギー", color: "rgba(81, 143, 18, 1)"}, { data: dataset2, label: "緩和後の経路のエネルギー", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="Electronic Energy [hartree]" height="500px" />

export const dataset1_grad = [4.04161092120804e-06,4.041775659036538e-06,0.0017933626820085583,0.0020195622521005357,0.0020669866754433465,0.0021256483760257027,0.0021875778140824083,0.0022235024400309744,0.0022508391337664945,0.0022944563058727016,0.0023489396812469876,0.002383080175204197,0.0023736574811687406,0.0023532617600466594,0.002369698191455688,0.0024557468022843067,0.0026444679539336094,0.0029544506062842784,0.003321011908449448,0.00358606013921915,0.003652449488839371,0.003589692977608689,0.0034608516210725823,0.003138669790188135,0.0027052805653356117,0.0029178601246987223,0.003124449657596314,0.0022863479815839432,0.0015923291882202948,0.0018932702300360476,0.0021989292335167655,0.002315375251834689,0.002349318633792974,0.002346184333457386,0.0023329899564877047,0.002347678744039177,0.002394934926263064,0.0024351726573086465,0.002428791779409344,0.0023773995983451795,0.002315860579013463,0.002289349818552783,0.002341195313380276,0.002425561311286676,0.0024129564178782224,0.0023138156484178132,0.0022307494872247043,0.002186613048211316,0.0021586471799854715,0.0021385144133964687,0.0021228746888190724,0.002092299078845116,0.002079167326062117,0.0020842086562796415,0.002083764165409007];

export const dataset1_grad_itr5 = [2.76877778240912e-06,2.5693431982283566e-06,0.0009207113216903523,0.001159608421133853,0.0013174977789689772,0.0014197986311984903,0.0014621917225857478,0.0014973545373950308,0.00153207479806277,0.0015481322623122156,0.0015183313612769191,0.0015067375116187816,0.0014995014564376677,0.001549091781137496,0.0015492274887159289,0.0015137986625368464,0.0015602354137649363,0.0018890169562424562,0.002103981375431895,0.0022399621832918117,0.002281077612938609,0.0022770776255499094,0.0022524075637244774,0.002031147206914797,0.0013656878649728808,0.0011960081992816527,0.0022652097620372916,0.0009720198425775431,0.000681741693300244,0.0011532548234455115,0.0011402314288222217,0.0014048866539494646,0.0013404560066277394,0.001217189241062255,0.0012023348319438558,0.0012765806662887627,0.0012541457297405513,0.0012032383715145656,0.0010528229830886998,0.0008237876913670191,0.0006624331981592761,0.000623768829453236,0.0006791231874299109,0.00076673492433,0.0008333034730397211,0.000888417743478277,0.0009346512330194726,0.0009863450815855335,0.0010348773770796158,0.0010736440585708384,0.0010401830963005915,0.0008571309093137039,0.0006982487101405245,0.0005455164468214555,0.00028462459729013416];

export const dataset1_grad_itr10 = [7.990840606372468e-06,2.2946065491124097e-06,0.0005816283747235845,0.0008551694907561691,0.0009415346449415574,0.0010272754005103736,0.001081086756339486,0.0011355939685308968,0.0011802954222844635,0.001193775398403791,0.0011707872697397474,0.0011708941362941609,0.001170853063343879,0.0011738907005596055,0.0011495461653615255,0.0011561280459114866,0.0011627176876556284,0.0011533271449392284,0.0011495210336848723,0.0012048599628055935,0.0013161287496377843,0.0012153892048292884,0.001140759504209792,0.0011924014286794286,0.0012728753950462302,0.0013825414609654166,0.001513255065588781,0.0016661899944957152,0.0018500552855181642,0.001967551191531375,0.0015606646560866802,0.0011536027689436716,0.0006607485870937091,0.0007795871674136507,0.001169439217581474,0.0017916280008584901,0.002161405928780837,0.0022720509114184557,0.0021167536288931137,0.0006075537472326848,0.000494806405930536,0.0007759561296266524,0.0008527838500305264,0.0009903189597116886,0.0010078060719607691,0.0009098388144635992,0.0008479737264541564,0.0007692236949253378,0.0005860724943054131,0.0006475574161258384,0.00052005623029862,0.00032873524455092706,0.0002051194359307,0.00018189989851254363,0.00020776643703001723,0.0003076366796733922,0.0004118811222817992,0.0004943229092063539,0.000550040756225116,0.0005785957989133301,0.000584232289252074,0.0005707742461434039,0.0004661945482451372,0.0002689178185221026,0.000212657255135398,0.0001490100529497824,4.173997966376283e-05];


export const dataset2_grad = [5.4051246898097976e-05,2.0473413438069675e-06,0.0003604213273358624,0.0006575483850701812,0.0007726936644826723,0.0008429955780678764,0.0008610988370029277,0.0009099409375303718,0.0009520661579052094,0.0009682734076534418,0.000956053932793708,0.0009483508759150607,0.0009429848007566081,0.0009517037405382298,0.0009392949830589829,0.0009369844685687432,0.0009505201386380519,0.0009542128168652089,0.0009561769496131316,0.0009688268716820528,0.0009704837765777597,0.0009728682201323308,0.0009670762313179013,0.0009251708766102796,0.0009188187830930848,0.0009683423076476106,0.001078259401739432,0.0010480905266076665,0.0009457843975814499,0.0009727194881281956,0.0010152509564864227,0.0011059299710919931,0.0012476144040627264,0.0014355360635069042,0.001672641948745451,0.0019223727639787658,0.0018082606730148731,0.0014426071436769794,0.0012696528304076598,0.0010699063549254185,0.0008475059914223866,0.0006244355732869776,0.0004750004628274361,0.0004684802020741699,0.0005953830864525138,0.0007686906349490319,0.0014371316117036052,0.0021132041171962653,0.0023250871430882144,0.0021680921714294266,0.0016903979836348998,0.0004787095145513416,0.000404661557119233,0.0005222134158295467,0.0006739818610359717,0.000804318800138473,0.00079701524373947,0.0007200200490091486,0.0006276011761158857,0.00045977764031118274,0.0003108726020059155,0.00040841576801666207,0.0002670697966705566,0.00012543790416664536,7.189826354853824e-05,6.536877816514082e-05,7.626352712070273e-05,0.000124013515414589,0.00020941445810485713,0.00028764075484737127,0.000340465135508363,0.00036044071098243965,0.00034744288320981317,0.00030516094555302185,0.00019111330336472825,0.00010636980470054246,8.135611798794973e-05,5.15134956016275e-05,1.5211660829224626e-05];

<MultiDataGraph datasets={[ { data: dataset1_grad, label: "緩和前の経路の勾配のRMS値", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_grad_itr5, label: "ITR. 5の経路の勾配のRMS値", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_grad_itr10, label: "ITR. 10の経路の勾配のRMS値", color: "rgba(81, 143, 18, 1)"},  { data: dataset2_grad, label: "緩和後の経路の勾配のRMS値", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="RMS of gradient [hartree/Bohr]" height="500px" />

※`bias_force_rms.csv`にて、各Iterationごとのすべてのノードの勾配のRMS値を確認できる。

経路緩和の結果、経路のエネルギー極大値を示す構造の中から目視で、緩和後に得られた経路の42番(グラフ上では43番)の構造を遷移状態構造を求める初期構造として採用した。


※こちら[https://ss0832.github.io/molecule_viewer/] を使うことでも可視化は可能である。


`mobh35_25_Re_traj_42.xyz`
```
88
0 1
C       1.458201817477     -0.761150825253      1.816249813797
C      -0.818070685157     -0.321985376473      1.999492733602
C       1.567472290805     -1.066071095621      3.154388336253
C      -0.782416984344     -0.688061161242      3.367130058216
C       0.396838860604     -1.106627259799      3.922895233684
H       2.540565152704     -1.229184144010      3.595485215878
H      -1.686080038898     -0.601590175976      3.956450831253
H       0.437870109083     -1.392755067510      4.966411346628
N       0.259726213834     -0.585346187888      1.214653932624
P       2.387317377196     -0.800050775217     -0.788016855661
P      -2.292591441220      0.005471060341     -0.274574783974
C       2.660102891632     -0.404579288498      0.985862690201
H       2.722536341283      0.687365854619      1.032026917895
H       3.580954511528     -0.802825453904      1.405863990286
C      -0.015467335143      0.398337608600     -2.810297854394
O      -0.018711673181      0.827485422271     -3.884865875759
C      -1.868872545485      0.474153520736      1.422407123476
H      -2.703847944537      0.639001448439      2.104703046508
C      -3.418541507196      1.377220651044     -0.976646493886
C      -3.263599924256     -1.613859251650     -0.157289103532
C       3.601734600748      0.286696196999     -1.718449928637
C       2.938291153326     -2.608270427312     -0.803354905094
C      -2.891314109804      1.713838338962     -2.372864444363
H      -2.887416506974      0.844570271327     -3.032243547212
H      -3.529497150530      2.480601450704     -2.820995319298
H      -1.873734397058      2.098811630768     -2.322464470070
C      -4.907689370878      1.038046803188     -1.085601277466
H      -5.111196341750      0.150285018425     -1.676962331677
H      -5.373351754145      0.926435667258     -0.107400367121
H      -5.400832636662      1.876768362325     -1.584056751941
C      -3.345041483117      2.643644751720     -0.121808394257
H      -4.042915870660      3.377676844459     -0.533665792137
H      -3.635684364297      2.463168773203      0.911337026169
H      -2.352375532356      3.085230319140     -0.136192226653
C      -3.565808032760     -2.130027753834     -1.569984998336
H      -2.675248334385     -2.179062518790     -2.191589817137
H      -3.971728594222     -3.142770577618     -1.497397811591
H      -4.305313718904     -1.522255827976     -2.087746692743
C      -2.358963516273     -2.633500228341      0.556757399189
H      -1.343562022600     -2.652376004679      0.168348979124
H      -2.310003465904     -2.437325781785      1.627340848687
H      -2.792117841320     -3.627906453184      0.428031988550
C      -4.558619484071     -1.557903689137      0.663281702651
H      -5.391544875935     -1.118178081199      0.124745479021
H      -4.847127321425     -2.579953020672      0.921936318079
H      -4.422434100520     -1.016353641906      1.601504614786
C       3.087798184380     -3.116287638503     -2.239913629414
H       3.144367675435     -4.207972454567     -2.223312487635
H       2.241351176377     -2.837770697629     -2.869037095465
H       4.005260591612     -2.749439854971     -2.700716544879
C       1.873394969373     -3.458929025809     -0.088017251499
H       1.633007736990     -3.079926907835      0.905920578134
H       0.954811454052     -3.553973304668     -0.656548138093
H       2.283993181635     -4.465010574961      0.039174629348
C       4.250158496155     -2.859429742905     -0.043277633052
H       4.555827236660     -3.892444390645     -0.228815550691
H       5.069126226103     -2.214452972139     -0.346842130907
H       4.114173343262     -2.763052111403      1.034519182371
C       3.203931913217      1.737950748682     -1.406826117486
H       3.441463790799      2.023777470460     -0.380453606696
H       3.771983612052      2.397433169563     -2.067854845352
H       2.140766138657      1.914030679838     -1.570911181849
C       3.412155202235      0.075440145856     -3.226414674273
H       2.375458201360      0.210621947446     -3.528184324721
H       4.012142018995      0.818316911862     -3.758739596782
H       3.739675386403     -0.907864284704     -3.556003240479
C       5.076970622289      0.098302683632     -1.366016909948
H       5.258064819736      0.144935723506     -0.290022530265
H       5.471844553261     -0.842300453046     -1.748865708255
H       5.652612229427      0.902972588131     -1.831861203573
Re      0.032393837825     -0.280218996378     -1.033031224002
C      -0.235096573398     -1.952835474585     -1.862571286819
O      -0.436260763117     -2.932465160503     -2.457388443379
N       0.074223351268      1.725639429326     -0.066387954296
C      -0.521677352851      2.048077799857      0.908545026567
C      -0.382994912278      3.087217088526      2.001432995963
C      -1.681396347356      3.452904016956      2.708696881599
C       0.613595790155      2.523882730411      3.025270287473
C       0.230144142835      4.337811183965      1.358915252937
H      -2.360542206968      3.998261577548      2.055344173567
H      -2.192412229207      2.567328612351      3.079482903715
H      -1.445167881486      4.093331693564      3.560537121178
H       1.540607123421      2.214341467732      2.539770276223
H       0.850440246355      3.303342390116      3.752333460189
H       0.201215370200      1.671320087395      3.561883534456
H       0.379653568560      5.095798853712      2.131100794308
H       1.193372745667      4.105498149322      0.904541026410
H      -0.420327084342      4.750996970440      0.587709601757

```


<MoleculeViewer 
  xyzData={`88
0 1
C       1.458201817477     -0.761150825253      1.816249813797
C      -0.818070685157     -0.321985376473      1.999492733602
C       1.567472290805     -1.066071095621      3.154388336253
C      -0.782416984344     -0.688061161242      3.367130058216
C       0.396838860604     -1.106627259799      3.922895233684
H       2.540565152704     -1.229184144010      3.595485215878
H      -1.686080038898     -0.601590175976      3.956450831253
H       0.437870109083     -1.392755067510      4.966411346628
N       0.259726213834     -0.585346187888      1.214653932624
P       2.387317377196     -0.800050775217     -0.788016855661
P      -2.292591441220      0.005471060341     -0.274574783974
C       2.660102891632     -0.404579288498      0.985862690201
H       2.722536341283      0.687365854619      1.032026917895
H       3.580954511528     -0.802825453904      1.405863990286
C      -0.015467335143      0.398337608600     -2.810297854394
O      -0.018711673181      0.827485422271     -3.884865875759
C      -1.868872545485      0.474153520736      1.422407123476
H      -2.703847944537      0.639001448439      2.104703046508
C      -3.418541507196      1.377220651044     -0.976646493886
C      -3.263599924256     -1.613859251650     -0.157289103532
C       3.601734600748      0.286696196999     -1.718449928637
C       2.938291153326     -2.608270427312     -0.803354905094
C      -2.891314109804      1.713838338962     -2.372864444363
H      -2.887416506974      0.844570271327     -3.032243547212
H      -3.529497150530      2.480601450704     -2.820995319298
H      -1.873734397058      2.098811630768     -2.322464470070
C      -4.907689370878      1.038046803188     -1.085601277466
H      -5.111196341750      0.150285018425     -1.676962331677
H      -5.373351754145      0.926435667258     -0.107400367121
H      -5.400832636662      1.876768362325     -1.584056751941
C      -3.345041483117      2.643644751720     -0.121808394257
H      -4.042915870660      3.377676844459     -0.533665792137
H      -3.635684364297      2.463168773203      0.911337026169
H      -2.352375532356      3.085230319140     -0.136192226653
C      -3.565808032760     -2.130027753834     -1.569984998336
H      -2.675248334385     -2.179062518790     -2.191589817137
H      -3.971728594222     -3.142770577618     -1.497397811591
H      -4.305313718904     -1.522255827976     -2.087746692743
C      -2.358963516273     -2.633500228341      0.556757399189
H      -1.343562022600     -2.652376004679      0.168348979124
H      -2.310003465904     -2.437325781785      1.627340848687
H      -2.792117841320     -3.627906453184      0.428031988550
C      -4.558619484071     -1.557903689137      0.663281702651
H      -5.391544875935     -1.118178081199      0.124745479021
H      -4.847127321425     -2.579953020672      0.921936318079
H      -4.422434100520     -1.016353641906      1.601504614786
C       3.087798184380     -3.116287638503     -2.239913629414
H       3.144367675435     -4.207972454567     -2.223312487635
H       2.241351176377     -2.837770697629     -2.869037095465
H       4.005260591612     -2.749439854971     -2.700716544879
C       1.873394969373     -3.458929025809     -0.088017251499
H       1.633007736990     -3.079926907835      0.905920578134
H       0.954811454052     -3.553973304668     -0.656548138093
H       2.283993181635     -4.465010574961      0.039174629348
C       4.250158496155     -2.859429742905     -0.043277633052
H       4.555827236660     -3.892444390645     -0.228815550691
H       5.069126226103     -2.214452972139     -0.346842130907
H       4.114173343262     -2.763052111403      1.034519182371
C       3.203931913217      1.737950748682     -1.406826117486
H       3.441463790799      2.023777470460     -0.380453606696
H       3.771983612052      2.397433169563     -2.067854845352
H       2.140766138657      1.914030679838     -1.570911181849
C       3.412155202235      0.075440145856     -3.226414674273
H       2.375458201360      0.210621947446     -3.528184324721
H       4.012142018995      0.818316911862     -3.758739596782
H       3.739675386403     -0.907864284704     -3.556003240479
C       5.076970622289      0.098302683632     -1.366016909948
H       5.258064819736      0.144935723506     -0.290022530265
H       5.471844553261     -0.842300453046     -1.748865708255
H       5.652612229427      0.902972588131     -1.831861203573
Re      0.032393837825     -0.280218996378     -1.033031224002
C      -0.235096573398     -1.952835474585     -1.862571286819
O      -0.436260763117     -2.932465160503     -2.457388443379
N       0.074223351268      1.725639429326     -0.066387954296
C      -0.521677352851      2.048077799857      0.908545026567
C      -0.382994912278      3.087217088526      2.001432995963
C      -1.681396347356      3.452904016956      2.708696881599
C       0.613595790155      2.523882730411      3.025270287473
C       0.230144142835      4.337811183965      1.358915252937
H      -2.360542206968      3.998261577548      2.055344173567
H      -2.192412229207      2.567328612351      3.079482903715
H      -1.445167881486      4.093331693564      3.560537121178
H       1.540607123421      2.214341467732      2.539770276223
H       0.850440246355      3.303342390116      3.752333460189
H       0.201215370200      1.671320087395      3.561883534456
H       0.379653568560      5.095798853712      2.131100794308
H       1.193372745667      4.105498149322      0.904541026410
H      -0.420327084342      4.750996970440      0.587709601757
`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造"
  backgroundColor="#333333"
/>


構造が壊れていないので、これを遷移状態を求めるための初期構造とする。

遷移状態構造を求めるための初期構造を含むxyzファイルを`MultiOptPy-v1.18c`と同じディレクトリ内にコピーする。

そして、以下を実行する。

```
python optmain.py .\mobh35_25_Re_traj_42.xyz -spin 1 -elec 0 -os uma-s-1p1  -tcc -freq -opt rsirfo_block_bofill -order 1 -fc 5 -tr 0.2
```
- `-opt rsirfo_block_bofill`は遷移状態構造の最適化向けのoptimizerを指定することを意味する。準ニュートン法であるRS-I-RFO法を使用する。今回は`-fc`で正確なHessianを計算するようにしているので、初期Hessianは正確なHessianを使用するようになっている。(Bofill法によるHessianの更新法を細かい点で変更している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `-order 1`は一次の鞍点を求めることを指定する。（デフォルトだと極小値を求めるようになっている。）
- `-fc 5`は5回の反復回数当たり1回正確なHessianを計算することを指定する。
- `-freq`は収束条件を満たした後に基準振動解析を行うことを示す。（自前で実装しているため、あくまで目安として使用することを推奨する。各振動モードを`vibration_animation`内のxyzファイルで可視化できる。）UMAモデルから算出されるHessianは数値微分により求めているため、原子数Zが多いとZの二乗オーダーで計算コストが急増する。
- `-tcc`は収束条件を厳しくすることを示す。（Gaussianのtightと同等）
- `-tr D`は一回の反復計算ごとの計算されるステップ幅の最大値をDÅ以下にすることを示す。

実行して得られた正確な遷移状態構造と思われる構造を以下に示す。

(実行して得られた正確な遷移状態構造は計算開始時に、`yyyy_mm_dd`ディレクトリ内に生成された新規ディレクトリ内の`YYY_optimized.xyz`として保存されている。)

```
88
OptimizedStructure
C      1.330758278256     -1.029791989721      1.882182215729
C     -0.867733581962     -0.233389275817      2.010733295304
C      1.365415224920     -1.314226932093      3.229441103691
C     -0.875970183111     -0.503979904105      3.402195382101
C      0.214503389469     -1.081042495539      3.991742644146
H      2.283960971993     -1.656197926541      3.685486433849
H     -1.760023468387     -0.252534458097      3.973853584908
H      0.205975968892     -1.310869741560      5.050041421167
N      0.199360540071     -0.637253182966      1.256111512730
P      2.426668746686     -0.856700815738     -0.721487231934
P     -2.239206762903     -0.033057288308     -0.287491456257
C      2.622402754993     -0.936943858156      1.110112543194
H      3.050335655431      0.026432036549      1.403645829393
H      3.336655195505     -1.697166600556      1.427816072745
C      0.165441972922      0.475082130826     -2.729399770561
O      0.254097964799      0.964770209524     -3.774603264527
C     -1.894988458305      0.538528985040      1.379969329525
H     -2.739906001124      0.767532157351      2.023422133357
C     -3.322998386311      1.212361877406     -1.193386529187
C     -3.257863368228     -1.607673099201      0.019170640283
C      3.760489772120      0.371292002679     -1.216522412601
C      2.925449435675     -2.593125479428     -1.244442176821
C     -3.385341309453      0.824229059572     -2.677481071107
H     -3.926636161103     -0.100892409865     -2.856374895661
H     -3.901542618214      1.620009881162     -3.222003505006
H     -2.386584633695      0.722731678717     -3.101312338348
C     -4.739368759151      1.371213454889     -0.638662923293
H     -5.352275363188      0.485773142001     -0.798718283932
H     -4.735387001224      1.606206719911      0.428112412827
H     -5.226808714466      2.201655759809     -1.157492375831
C     -2.641811586175      2.582981400895     -1.127708392242
H     -3.231284872405      3.284550623248     -1.724306765825
H     -2.601145323022      2.964465853991     -0.107060214563
H     -1.629631279815      2.556661962439     -1.528938219552
C     -3.930376741176     -2.114423206382     -1.259782952913
H     -3.224637027414     -2.199836519444     -2.086876172465
H     -4.336315776847     -3.111776358476     -1.068801014164
H     -4.761525363710     -1.480941094944     -1.567815547953
C     -2.333443596470     -2.722064152578      0.536058662001
H     -1.609425935757     -3.047997824112     -0.204069986923
H     -1.804739993455     -2.436357566184      1.444056705664
H     -2.961027237309     -3.583783888688      0.782628409618
C     -4.316820148228     -1.407135996779      1.113015769695
H     -5.007503031091     -0.592554500729      0.915388069946
H     -4.904344491734     -2.326338898085      1.193842741238
H     -3.849208812651     -1.232651619693      2.082576335058
C      2.638838717850     -2.811277020499     -2.735878293267
H      2.732118209816     -3.877523557930     -2.959444181855
H      1.639391282960     -2.499339607642     -3.025129836731
H      3.352381235095     -2.281520655350     -3.364269067241
C      2.070249166640     -3.558299390246     -0.405458506797
H      2.381860256597     -3.564247250750      0.640755028241
H      1.008357476032     -3.322997899147     -0.439237638284
H      2.203934718561     -4.571015549897     -0.793521023012
C      4.393672560870     -2.943277721597     -0.986637281868
H      4.531196486882     -4.011883592206     -1.173906396031
H      5.066219055850     -2.409055584783     -1.656380423990
H      4.700721446572     -2.751710307912      0.043134683528
C      3.189021056279      1.766167904404     -0.934486891422
H      2.910139244192      1.898737061992      0.113050631547
H      3.952311099880      2.510168301066     -1.179507797603
H      2.299485179084      1.964895296221     -1.529805194283
C      4.011581772334      0.263164577231     -2.723671585284
H      3.077490729470      0.251054037221     -3.289640422925
H      4.587196900302      1.133172512186     -3.050401458254
H      4.587369353201     -0.625651315293     -2.980691145315
C      5.087308063380      0.248439226598     -0.460030314207
H      4.965937392586      0.406716923721      0.612516740748
H      5.583807520465     -0.706101222026     -0.609171555311
H      5.761734312505      1.029585641848     -0.822242988413
Re     0.093104511781     -0.274006603100     -0.978740759804
C     -0.349537381954     -1.895639626227     -1.836691153611
O     -0.696388139312     -2.832341542761     -2.432918151481
N      0.214249983196      1.706587817080      0.020645017597
C     -0.438372954002      2.110701909717      0.915256398449
C     -0.489914826084      3.215409982227      1.938516802309
C     -1.792114716061      3.277202143758      2.726982223660
C      0.680501254548      2.955786502183      2.899623277651
C     -0.265902748303      4.533489939267      1.183792363407
H     -2.660630013084      3.354389475931      2.072133100215
H     -1.913476756123      2.398264349698      3.358715868204
H     -1.770484500345      4.158718769121      3.370822622359
H      1.628322157162      2.951609690915      2.359429632675
H      0.712761229498      3.743314106415      3.655464770078
H      0.563237556519      1.995204980040      3.404856837881
H     -0.199945788145      5.354001267973      1.900980444982
H      0.656526895482      4.494242726785      0.604925074137
H     -1.089898885827      4.739091451543      0.499394802814

```

<MoleculeViewer 
  xyzData={`88
OptimizedStructure
C      1.330758278256     -1.029791989721      1.882182215729
C     -0.867733581962     -0.233389275817      2.010733295304
C      1.365415224920     -1.314226932093      3.229441103691
C     -0.875970183111     -0.503979904105      3.402195382101
C      0.214503389469     -1.081042495539      3.991742644146
H      2.283960971993     -1.656197926541      3.685486433849
H     -1.760023468387     -0.252534458097      3.973853584908
H      0.205975968892     -1.310869741560      5.050041421167
N      0.199360540071     -0.637253182966      1.256111512730
P      2.426668746686     -0.856700815738     -0.721487231934
P     -2.239206762903     -0.033057288308     -0.287491456257
C      2.622402754993     -0.936943858156      1.110112543194
H      3.050335655431      0.026432036549      1.403645829393
H      3.336655195505     -1.697166600556      1.427816072745
C      0.165441972922      0.475082130826     -2.729399770561
O      0.254097964799      0.964770209524     -3.774603264527
C     -1.894988458305      0.538528985040      1.379969329525
H     -2.739906001124      0.767532157351      2.023422133357
C     -3.322998386311      1.212361877406     -1.193386529187
C     -3.257863368228     -1.607673099201      0.019170640283
C      3.760489772120      0.371292002679     -1.216522412601
C      2.925449435675     -2.593125479428     -1.244442176821
C     -3.385341309453      0.824229059572     -2.677481071107
H     -3.926636161103     -0.100892409865     -2.856374895661
H     -3.901542618214      1.620009881162     -3.222003505006
H     -2.386584633695      0.722731678717     -3.101312338348
C     -4.739368759151      1.371213454889     -0.638662923293
H     -5.352275363188      0.485773142001     -0.798718283932
H     -4.735387001224      1.606206719911      0.428112412827
H     -5.226808714466      2.201655759809     -1.157492375831
C     -2.641811586175      2.582981400895     -1.127708392242
H     -3.231284872405      3.284550623248     -1.724306765825
H     -2.601145323022      2.964465853991     -0.107060214563
H     -1.629631279815      2.556661962439     -1.528938219552
C     -3.930376741176     -2.114423206382     -1.259782952913
H     -3.224637027414     -2.199836519444     -2.086876172465
H     -4.336315776847     -3.111776358476     -1.068801014164
H     -4.761525363710     -1.480941094944     -1.567815547953
C     -2.333443596470     -2.722064152578      0.536058662001
H     -1.609425935757     -3.047997824112     -0.204069986923
H     -1.804739993455     -2.436357566184      1.444056705664
H     -2.961027237309     -3.583783888688      0.782628409618
C     -4.316820148228     -1.407135996779      1.113015769695
H     -5.007503031091     -0.592554500729      0.915388069946
H     -4.904344491734     -2.326338898085      1.193842741238
H     -3.849208812651     -1.232651619693      2.082576335058
C      2.638838717850     -2.811277020499     -2.735878293267
H      2.732118209816     -3.877523557930     -2.959444181855
H      1.639391282960     -2.499339607642     -3.025129836731
H      3.352381235095     -2.281520655350     -3.364269067241
C      2.070249166640     -3.558299390246     -0.405458506797
H      2.381860256597     -3.564247250750      0.640755028241
H      1.008357476032     -3.322997899147     -0.439237638284
H      2.203934718561     -4.571015549897     -0.793521023012
C      4.393672560870     -2.943277721597     -0.986637281868
H      4.531196486882     -4.011883592206     -1.173906396031
H      5.066219055850     -2.409055584783     -1.656380423990
H      4.700721446572     -2.751710307912      0.043134683528
C      3.189021056279      1.766167904404     -0.934486891422
H      2.910139244192      1.898737061992      0.113050631547
H      3.952311099880      2.510168301066     -1.179507797603
H      2.299485179084      1.964895296221     -1.529805194283
C      4.011581772334      0.263164577231     -2.723671585284
H      3.077490729470      0.251054037221     -3.289640422925
H      4.587196900302      1.133172512186     -3.050401458254
H      4.587369353201     -0.625651315293     -2.980691145315
C      5.087308063380      0.248439226598     -0.460030314207
H      4.965937392586      0.406716923721      0.612516740748
H      5.583807520465     -0.706101222026     -0.609171555311
H      5.761734312505      1.029585641848     -0.822242988413
Re     0.093104511781     -0.274006603100     -0.978740759804
C     -0.349537381954     -1.895639626227     -1.836691153611
O     -0.696388139312     -2.832341542761     -2.432918151481
N      0.214249983196      1.706587817080      0.020645017597
C     -0.438372954002      2.110701909717      0.915256398449
C     -0.489914826084      3.215409982227      1.938516802309
C     -1.792114716061      3.277202143758      2.726982223660
C      0.680501254548      2.955786502183      2.899623277651
C     -0.265902748303      4.533489939267      1.183792363407
H     -2.660630013084      3.354389475931      2.072133100215
H     -1.913476756123      2.398264349698      3.358715868204
H     -1.770484500345      4.158718769121      3.370822622359
H      1.628322157162      2.951609690915      2.359429632675
H      0.712761229498      3.743314106415      3.655464770078
H      0.563237556519      1.995204980040      3.404856837881
H     -0.199945788145      5.354001267973      1.900980444982
H      0.656526895482      4.494242726785      0.604925074137
H     -1.089898885827      4.739091451543      0.499394802814
`}
  caption="遷移状態構造"
  backgroundColor="#333333"
/>


停留点に収束した分子構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                     -334.5628             30.9269             35.8853
Reduced mass [au]                   6.8805              3.3916              4.8472
Force const [Dyne/A]               -0.4538              0.0019              0.0037
Char temp [K]                       0.0000             44.4969             51.6310
Normal mode                   x         y         z            x         y         z            x         y         z     
       C                -0.00534    0.00844    0.00160   -0.00901   -0.02359    0.00260   -0.00447   -0.00395   -0.00031
       C                -0.02832    0.00516   -0.00492    0.00285    0.01443    0.00395   -0.00425   -0.00283   -0.00087
       C                 0.00659    0.00317   -0.00617   -0.01283   -0.02093    0.00332   -0.00568   -0.00607   -0.00075
       C                 0.00239    0.00042    0.01482    0.00343    0.02343    0.00566   -0.00583   -0.00574   -0.00134
       C                -0.00049    0.00790    0.00211   -0.00521    0.00758    0.00574   -0.00686   -0.00808   -0.00169
       H                 0.00996    0.01056   -0.00816   -0.01951   -0.04074    0.00197   -0.00588   -0.00569   -0.00006
       H                -0.00431   -0.02667    0.01746    0.00875    0.04023    0.00653   -0.00608   -0.00614   -0.00154
       H                 0.00214    0.00199    0.00135   -0.00642    0.01350    0.00702   -0.00811   -0.01054   -0.00223
       N                -0.00825    0.00901   -0.00545   -0.00084    0.00198    0.00406   -0.00477   -0.00450   -0.00036
       P                 0.00052   -0.00307    0.00182   -0.00020   -0.01171    0.00278    0.00096    0.01457    0.00134
       P                -0.00921   -0.00963    0.01403    0.00226   -0.00299    0.00667   -0.00756    0.00728   -0.00118
       C                -0.00308    0.00572   -0.00006   -0.00570   -0.06320    0.00214   -0.00313    0.00292    0.00173
       H                 0.00341    0.00365   -0.00381    0.04121   -0.09246    0.02794   -0.00574    0.00170    0.00951
       H                -0.00553    0.00393    0.00106   -0.04075   -0.10472   -0.01830   -0.00161    0.00264   -0.00231
       C                -0.00078   -0.00544   -0.00252    0.00553   -0.00161    0.00361   -0.00907   -0.04780   -0.01348
       O                 0.00117    0.00006   -0.00053    0.00701   -0.00307    0.00310   -0.00852   -0.07357   -0.02559
       C                -0.09368   -0.12214    0.03659    0.00214    0.01077    0.00152   -0.00122    0.00243   -0.00021
       H                -0.10000   -0.16349    0.03766    0.00255    0.01260    0.00129    0.00116    0.00814    0.00099
       C                 0.00055   -0.00469    0.00233   -0.00236   -0.01612   -0.00468    0.01021    0.02160   -0.00578
       C                -0.01034   -0.01187   -0.01571    0.00847   -0.00482    0.02074   -0.02940    0.02201   -0.00158
       C                -0.00086   -0.00041   -0.00067    0.00922   -0.00374    0.04447   -0.01413    0.03765    0.01331
       C                -0.00010   -0.00087   -0.00067   -0.00628    0.00253   -0.05101    0.02861    0.02779   -0.01495
       C                 0.00018   -0.00153    0.00176   -0.00499   -0.03307   -0.00020    0.01096    0.02169   -0.00588
       H                -0.00171   -0.00033    0.00155   -0.00923   -0.03264    0.01079    0.00822    0.02346   -0.00678
       H                 0.00216   -0.00044    0.00103   -0.00166   -0.03709   -0.00919    0.01397    0.02345   -0.00623
       H                 0.00007   -0.00457    0.00188   -0.00548   -0.04249    0.00059    0.01079    0.01869   -0.00501
       C                 0.00020   -0.00003    0.00004   -0.00087   -0.01208   -0.00220    0.00901    0.03670   -0.01299
       H                 0.00016    0.00006    0.00010    0.00057   -0.01554    0.01142   -0.00110    0.04543   -0.02268
       H                 0.00097   -0.00197    0.00052    0.00246    0.00132   -0.00513    0.00496    0.03048   -0.01165
       H                 0.00040    0.00055    0.00028   -0.00466   -0.01972   -0.01091    0.02293    0.04572   -0.01159
       C                 0.00331   -0.00625    0.00410   -0.00323   -0.01489   -0.02187    0.02210    0.01575   -0.00568
       H                 0.00163    0.00120    0.01454   -0.00476   -0.02192   -0.02863    0.02829    0.01979   -0.00707
       H                 0.01230   -0.01502    0.00768   -0.00120   -0.00338   -0.02639    0.02415    0.01692   -0.00608
       H                -0.00252   -0.00710   -0.01196   -0.00401   -0.01904   -0.02373    0.02210    0.00709   -0.00470
       C                -0.00829   -0.01202   -0.01173    0.00184   -0.01539    0.02838   -0.01504    0.02031   -0.00835
       H                -0.00834   -0.00850   -0.01234   -0.00317   -0.02066    0.02477   -0.00397    0.01187    0.00177
       H                -0.00943   -0.01273   -0.01667    0.00462   -0.01457    0.03859   -0.02500    0.02411   -0.00987
       H                -0.00826   -0.01094   -0.01111   -0.00119   -0.01926    0.02871   -0.00605    0.02524   -0.02270
       C                -0.00551   -0.00345   -0.00591    0.01336    0.00020    0.02292   -0.04607    0.01843    0.02034
       H                -0.00718   -0.01188   -0.00402    0.01276   -0.00032    0.02237   -0.03047    0.01358    0.03795
       H                -0.00389    0.01018   -0.01126    0.01463    0.00533    0.02050   -0.06562    0.01839    0.03181
       H                -0.00249   -0.00261    0.00543    0.01664   -0.00080    0.02780   -0.05544    0.02188    0.00832
       C                -0.01080   -0.01540   -0.01296    0.01377    0.00085    0.02490   -0.04321    0.03737   -0.01787
       H                 0.00085   -0.00153    0.00134    0.01381    0.00089    0.02414   -0.04170    0.03343   -0.03783
       H                -0.02413   -0.00894   -0.03459    0.01314    0.00185    0.03175   -0.04338    0.03796   -0.01245
       H                -0.01131   -0.04299   -0.00979    0.01840    0.00500    0.02188   -0.05577    0.05087   -0.01423
       C                -0.00021   -0.00023   -0.00055   -0.01550    0.05280   -0.05676    0.01749    0.03640   -0.01399
       H                -0.00084   -0.00021   -0.00063   -0.01089    0.06119   -0.09478    0.05295    0.04250   -0.02837
       H                -0.00020   -0.00005   -0.00053   -0.01916    0.05781   -0.03886    0.00209    0.00422    0.00410
       H                -0.00013   -0.00063   -0.00091   -0.02296    0.07922   -0.04305   -0.01042    0.07023   -0.01718
       C                -0.00048    0.00036    0.00049   -0.00126   -0.02379   -0.07611    0.05486    0.00434   -0.01527
       H                -0.00181    0.00277    0.00061    0.01768   -0.06927   -0.08206    0.07491   -0.00927   -0.02141
       H                -0.00064   -0.00026    0.00110    0.00031   -0.01367   -0.04686    0.05139   -0.00797    0.00865
       H                -0.00018    0.00015    0.00118   -0.01749   -0.00927   -0.11949    0.05900    0.01220   -0.03429
       C                -0.00013   -0.00010    0.00000   -0.00554   -0.00896   -0.07129    0.03729    0.05250   -0.03122
       H                -0.00016   -0.00018    0.00068   -0.01009   -0.00420   -0.10183    0.05490    0.05646   -0.04088
       H                 0.00018   -0.00075   -0.00036   -0.00858    0.00756   -0.06111    0.02218    0.07004   -0.03231
       H                -0.00123    0.00046    0.00010    0.00154   -0.03811   -0.06787    0.04181    0.04985   -0.03200
       C                -0.00022    0.00005   -0.00056    0.01999   -0.01044    0.09910   -0.02924    0.02911    0.02375
       H                 0.00361   -0.00336    0.00149    0.02072   -0.04942    0.10448   -0.03088    0.01807    0.02467
       H                -0.00083    0.00139    0.00244    0.02590   -0.00656    0.12927   -0.03644    0.03859    0.02995
       H                 0.00423   -0.00061   -0.00827    0.02176    0.01947    0.10664   -0.03090    0.02445    0.02497
       C                -0.00026    0.00095   -0.00049    0.00250    0.05199    0.03935   -0.01137    0.05510    0.01240
       H                -0.00002    0.00045   -0.00094    0.00027    0.08041    0.04251   -0.01065    0.05231    0.01135
       H                 0.00083    0.00011   -0.00106    0.00790    0.06007    0.07030   -0.01938    0.06412    0.02226
       H                -0.00086    0.00045    0.00061   -0.00512    0.05748    0.00316   -0.00256    0.06351    0.00323
       C                -0.00066    0.00057   -0.00042    0.01255   -0.04011    0.03306   -0.01309    0.04852    0.01354
       H                -0.00073   -0.00094   -0.00036    0.01987   -0.08503    0.04047   -0.01642    0.03561    0.01508
       H                -0.00185    0.00018   -0.00085    0.00938   -0.03478   -0.01022    0.00147    0.05771    0.00405
       H                 0.00001   -0.00009   -0.00079    0.01265   -0.02662    0.06231   -0.02440    0.06244    0.02249
      Re                 0.00035   -0.00201   -0.00184    0.00239    0.00024    0.00448   -0.00712   -0.01607    0.00061
       C                -0.00486    0.00215    0.00093   -0.00619    0.00266    0.00468    0.00336   -0.03667    0.03285
       O                 0.00236    0.00121    0.00114   -0.01275    0.00568    0.00369    0.01236   -0.05462    0.05618
       N                -0.00312   -0.01382   -0.01687    0.00088    0.00381   -0.00672   -0.00531   -0.01158   -0.01334
       C                 0.14073    0.14141   -0.03177    0.00187    0.01610   -0.01256    0.00694   -0.00870   -0.00588
       C                 0.02742    0.03784    0.01264   -0.00950    0.02960   -0.02851    0.03099   -0.01518    0.00181
       C                 0.00685   -0.01451   -0.01654   -0.01579    0.03627   -0.03931    0.03233    0.00584    0.00228
       C                 0.01387    0.01766    0.02137   -0.01626    0.04767   -0.01565    0.02666   -0.04605   -0.00118
       C                 0.00684    0.04930    0.02267   -0.00858    0.01951   -0.04623    0.05811   -0.01497    0.01027
       H                 0.01816   -0.01817   -0.02908   -0.01137    0.02341   -0.04655    0.03400    0.02593    0.00232
       H                 0.01684   -0.02961   -0.03886   -0.01718    0.04498   -0.02753    0.01532    0.00466   -0.00268
       H                -0.00795   -0.02218   -0.00533   -0.02358    0.04580   -0.05211    0.04895    0.00190    0.00710
       H                 0.02358    0.03482    0.03887   -0.01184    0.04319   -0.00776    0.02601   -0.06156   -0.00237
       H                -0.00602    0.00083    0.03806   -0.02533    0.05859   -0.02668    0.04391   -0.05166    0.00395
       H                 0.00192    0.00421   -0.00864   -0.01716    0.05439   -0.00307    0.00786   -0.04685   -0.00724
       H                -0.02759    0.04438    0.02958   -0.01795    0.03025   -0.05770    0.07474   -0.02080    0.01541
       H                 0.01871    0.07997    0.03958   -0.00354    0.01483   -0.03787    0.05743   -0.03017    0.01016
       H                 0.01088    0.02541    0.01155   -0.00371    0.00593   -0.05614    0.06240    0.00597    0.01132
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。

次に、`vibration_animation`内の虚振動を示す分子振動が示されたxyzファイル(`mode_1_XXXi_wave_number.xyz`)をAvogadroで確認すると、想定される反応系と生成系をつなぐ方向に振動していることを確認できた。


## 終わりに
　
　自作ライブラリで、UMAモデルのニューラルネットワークポテンシャル(NNP, `uma-s-1p1`)を用いて、MOBH35データセットのNo. 25の反応のある1つの遷移状態構造を算出する手順を説明した。



## 参考
- https://github.com/ss0832/MultiOptPy (自作ライブラリMultiOptPyのレポジトリ)
- https://avogadro.cc/ (Avogadro、分子構造可視化ツール)
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)
- _The Journal of Chemical Physics_ 2010, 132, 241102.
- _The Journal of Chemical Physics_ 1991, 94, 751–760.
- In _Classical and Quantum Dynamics in Condensed Phase Simulations_; WORLD SCIENTIFIC: LERICI, Villa Marigola, 1998; pp 385–404.
- _The Journal of Chemical Physics_, 2020, 153, 024109.
- _The Journal of Chemical Physics_, 2022, 144, 214108.
- _J. Phys. Chem. A_ 2019, 123, 3761−3781 http://dx.doi.org/10.1021/acs.jpca.9b01546 (MOBH35のデータセットについて)


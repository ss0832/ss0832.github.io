---
title:  【Unix】asyncコマンドの基本解説と詳細オプション
published: 2025-02-22
description: ""
tags: [async]
category: Unix
draft: false
---
最終更新：2025-02-22

# `async`コマンドの解説

`async`コマンドは、Unix系システム上で複数のコマンドやタスクを非同期に実行するためのツールである。

バックグラウンドで複数のジョブを並列に実行し、作業の効率化や処理の高速化を図るために用いられる。

標準入出力やエラー出力の制御、並列実行数の調整、各種ログの取得など、柔軟なオプションが提供され、多様な環境下で実用されるであろう。

---

# 使用方法

最もシンプルな使い方は、実行したいコマンドを`async`に引き渡す方法である。例えば、`ls -l`コマンドを非同期実行するには、以下のようにする。

```bash
async ls -l
```

このコマンドは、`ls -l`をバックグラウンドで実行しながら、他の処理を並行して実施することが可能である。

---

# 主なオプションの詳細

以下に、`async`コマンドで利用可能な主要なオプションを、具体例を交えて解説する。

- **`-j, --jobs <NUM>`**  
  並列に実行するジョブ数を指定するオプションである。  
  例:
  ```bash
  async -j 4 script.sh
  ```
  この例では、`script.sh`に記述された複数のタスクを最大4ジョブまで同時に実行することができる。

- **`-v, --verbose`**  
  詳細な実行ログやデバッグ情報を表示する。  
  例:
  ```bash
  async -v ls -l
  ```
  実行中のプロセスの状態、進捗状況、エラー情報等が標準出力に表示されるため、動作確認やトラブルシューティングに便利である。

- **`-q, --quiet`**  
  出力を抑制して最小限の情報のみを表示するモードである。  
  例:
  ```bash
  async -q my_command
  ```
  制作環境やスクリプト実行時に、余計な出力を避けたい場合に有用である。

- **`-D, --delay <SECONDS>`**  
  各ジョブの開始間隔に遅延を設定する。負荷分散やリソース管理の観点から連続実行を避けたい場合に使用する。  
  例:
  ```bash
  async -D 2 -j 3 batch_process.sh
  ```
  この例では、ジョブ間に2秒の遅延を設け、同時に3ジョブを実行する。

- **`-x, --exit-on-error`**  
  いずれかのジョブがエラーを返した場合、全体の実行を即時中断する。  
  例:
  ```bash
  async -x -j 5 run_tasks.sh
  ```
  エラー発生時に迅速に処理を停止するため、後続のタスク実行をキャンセルする。

- **`-o, --output <FILE>`**  
  各ジョブの標準出力及び標準エラー出力を指定したファイルに記録する。  
  例:
  ```bash
  async -o output.log my_command
  ```
  このオプションにより、実行結果を後で確認可能なログファイルとして残すことができる。

- **`--retry <NUM>`**  
  タスクが失敗した場合に、再試行回数を指定する。  
  例:
  ```bash
  async --retry 3 my_command
  ```
  この例では、エラー時に最大3回まで再実行する。

---

# ハンズオン

以下に、`async`コマンドの操作を体験する手順を示す。

## 1. 単純な非同期実行の体験

1. ターミナルを開く。
2. 以下のコマンドを実行する。

   ```bash
   async ls -l
   ```

   このコマンドを実行すると、`ls -l`がバックグラウンドで非同期に実行される。あなたは同時に他のターミナル操作を進めることができる。

## 2. 並列ジョブ数の指定

1. 複数のシェルスクリプト（例：`task1.sh`, `task2.sh`, `task3.sh`, `task4.sh`）が存在するとする。
2. 以下のコマンドを実行し、最大2ジョブまで同時に実行する。

   ```bash
   async -j 2 ./task1.sh ./task2.sh ./task3.sh ./task4.sh
   ```

   実際に並列実行されるジョブ数が2に制限され、残りは順次実行される様子を確認する。

## 3. 遅延付きの実行

1. 複数のコマンドを実行し、各ジョブ開始間に2秒の遅延を入れて実行する例である。

   ```bash
   async -D 2 -j 3 echo "Task execution"
   ```

   このコマンドを実行すると、「Task execution」というメッセージが、ジョブ毎に2秒の間隔をあけて表示されることが確認できる。

## 4. ログファイルへの出力

1. 非同期に実行されるコマンドの出力をログファイルに保存するため、以下のコマンドを実行する。

   ```bash
   async -o async_output.log -v sleep 5
   ```

   この操作により、`sleep 5`の実行状況が`async_output.log`に記録され、詳細なログが得られる。ログファイルを後で確認し、実行の流れを追うことが可能である。

## 5. エラー時の即時中断

1. 複数のタスクを実行する際に、エラーが発生した場合、全体の実行を中断する動作を確認するため、以下のコマンドを実行する。

   ```bash
   async -x -j 3 ./risky_task.sh
   ```

   ここで、`risky_task.sh`内のいずれかのタスクがエラーを返した場合には、その時点で全てのジョブの実行が停止される様子が確認できる。

---

`async`コマンドは、非同期実行によってシステムリソースの有効活用と効率的なタスク管理を可能にする強力なツールである。各オプションを状況に応じて適切に組み合わせることで、複雑な処理の並列実行やログ管理、エラー制御が一層容易に実現される。ここで示したハンズオン手順を参考に、実際の運用やスクリプトに取り入れることが望まれるであろう。
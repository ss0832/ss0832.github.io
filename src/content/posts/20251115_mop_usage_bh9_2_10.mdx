---
title:  【計算化学】自作pythonライブラリで遷移状態構造を求めてみる(BH9データセットの2. Pericyclic, No. 10の化学反応, NNP(UMA)使用, 失敗例)
published: 2025-11-15
description: ""
tags: [MultiOptPy, python]
category: Computational Chemistry
draft: false
---
最終更新：2025-11-15

import MoleculeViewer from '../../components/MoleculeViewer.astro';
import MultiDataGraph from '../../components/MultiDataGraph.astro';

## 概要

本記事では、自作ライブラリ(MultiOptPy)で、BH9データセットの2. Pericyclic, No. 10の素過程の遷移状態構造を算出してみる。計算レベルは、Meta社のFAIR Chemistryが開発したニューラルネットワークポテンシャル(NNP)であるUMA(Meta’s Universal Model for Atoms)とした。本記事では失敗例に関して解説する。

MultiOptPyは電子状態計算ソフトウェアを用いた分子構造最適化手法の勉強を目的として作成したpythonライブラリである。

MultiOptPyのレポジトリ:https://github.com/ss0832/MultiOptPy

BH9のデータセットについて:

- _J. Chem. Theory Comput._ 2022, 18, 1, 151–166 

https://doi.org/10.1021/acs.jctc.1c00694


この文献のSupporting Informationから、データセットの詳細を確認できる。

有機金属錯体が関わる反応を除いたさまざまなカテゴリの反応がまとめられたデータセットである。DFTの汎関数の電子エネルギーの精度の比較などのベンチマークに主に使われる。

今回使用したニューラルネットワークポテンシャルについて：
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)



## 使用した自作ライブラリMultiOptPyのバージョン
```
v1.19.6
```
## 環境
```
Windows 11
```
※Windows 11環境下でAnaconda PowerShell Promptを使用した。

## Source codeのダウンロード(Unixコマンド)
```
wget https://github.com/ss0832/MultiOptPy/archive/refs/tags/v1.19.6.zip
unzip v1.19.6.zip
cd MultiOptPy-v1.19.6
```
https://github.com/ss0832/MultiOptPy/releases/tag/v1.19.6 にアクセスしてzipファイルをダウンロードする。Unixコマンドの場合とはディレクトリ名が異なるので都度読み替えていただけると良い。

移動先のディレクトリで`requirements.txt`を参照することで、本ソースコードで必要なモジュールを把握することが出来る。導入方法は各自の状況に合わせて適宜LLMとの対話などで調べると良い。

次に述べる環境構築手順を使用する場合は、環境構築が終わった後、`pip install -r requirements.txt`で本自作モジュールが動作させるために最低限必要なモジュールを導入することが可能である。

### 環境構築手順

今回は、Windows 11のPower Shellを使用した。初めに、NNPを使用できる環境が整ったAnaconda PowerShell Promptを用意する手順を説明する。

1, https://repo.anaconda.com/archive/ より、`Anaconda3-2025.06-1-Windows-x86_64.exe`でAnacondaをインストールする。

2, 検索機能を使い、スタートから`Anaconda PowerShell Prompt`を開く。

3, 以下のコマンドを実行し、仮想環境を作成する。
```
conda create -n (任意の仮想環境名) python=3.12.7
```

4, 先ほど作成した仮想環境を`conda activate (仮想環境名)`で起動させる。

5, 以下のコマンドを実行し、必要なライブラリを導入する。
```
pip install ase==3.26.0 fairchem-core==2.7.1 torch==2.6.0
```
- fairchem-coreは、FAIR Chemistryが管理しているNNPを動作させるために必要なライブラリである。
- aseはNNPに電子エネルギーを算出したい分子構造を渡すために必要なインターフェイスの役割を果たすために必要なライブラリである。
- torchはPyTorchライブラリを指す。これはニューラルネットワークなどの機械学習を行ったり、学習結果を扱ったりするために必須なライブラリである。

これで、`Anaconda PowerShell Prompt`から仮想環境を立ち上げることで、NNPを使用する準備が整えることが出来る。

次に、NNPを使用するために必要なModelの情報が保存されている`.pt`ファイルのダウンロードおよびNNPの自作ライブラリへの導入方法について説明する。


1, 以下のサイトにアクセスして、`uma-s-1p1.pt`をダウンロードする。（使用許諾が下りていれば可能である。）
```
https://huggingface.co/facebook/UMA
```

2, ダウンロード後、`MultiOptPy-v1.19.6`ディレクトリ内に存在する`software_path.conf`に対して、`uma-s-1p1.pt`の絶対パスを用いて以下を追記する。
```
uma-s-1p1::(uma-s-1p1.ptの絶対パス)
```

これで、`MultiOptPy-v1.19.6`がNNP`uma-s-1p1`を使用できるようになる。


### 使用するNNPに関する具体的な説明

今回使用するNNPについて具体的に説明する。

- UMAのModel Checkpointは`uma-s-1p1`を使用した。
- 小分子系のトレーニングセットである`Omol25`(`omol`)を使用して学習したニューラルネットワークポテンシャルを使用する。

※自作ライブラリでの具体的な使用の仕方に関しては、`ase_calculation_tools.py` を参照すると良い。`omol`以外のモデルを使用したい場合は、現バージョンでは、`multioptpy/Calculator/ase_tools/firechem.py`内の、`self.task_name`を編集することで対応可能である。


## 手順

### 1. 初期構造の準備

モデル反応系として、以下の構造を用意した。今回はファイルの名前を`bh9_2_10.xyz`とした。
初期構造は以下のものを使用した。

```
47
OptimizedStructure
C      2.860334405198     -0.149316734226     -0.735986148992
C      4.030382461350     -0.286453850084     -0.104924410201
C     -4.426646050407      0.874575913199      0.236075833529
C     -3.214337573980      0.651010992973      0.732329560773
C      0.645829771100     -1.043293974371     -1.343762782675
C      1.816896278561     -1.164811655875     -0.721363236264
C     -2.778422663551     -0.585529726953      1.451887923834
H     -3.606196002172     -1.300628162483      1.451021751043
C     -0.446437996825     -2.065440773203     -1.332058254826
H     -0.649908464125     -2.386943967843     -2.359289815768
H     -0.116989372940     -2.953594743361     -0.782128407151
C     -1.758899330528     -1.548874000862     -0.723244029352
C     -1.563295346110     -1.208415137134      0.753463902283
H     -0.717928558089     -0.519931357488      0.853839796052
H     -1.282320859941     -2.120840273745      1.293413218216
C     -4.754684799078      2.147037768135     -0.464312639691
O     -3.932482095758      3.020187598600     -0.636490949138
H     -2.032029826883     -0.629420502186     -1.255044565024
C     -2.874372922637     -2.567822354141     -0.930840853609
H     -2.966612910795     -2.834443518273     -1.985055560318
H     -3.841020309770     -2.184007256010     -0.602666241459
H     -2.667627476487     -3.484323548054     -0.370703793558
C      5.116255883554      0.697777549067     -0.080153320687
C      6.228865351224      0.397443619701      0.599770027250
H      6.251623698428     -0.570914504073      1.093652365450
C      7.463206090669      1.222354172171      0.775997900545
H      8.336182729275      0.690232842058      0.390130887501
H      7.652618676852      1.404144362191      1.836724434821
H      7.411503839071      2.186400659890      0.275796057574
C      4.897913438757      1.983139031025     -0.826922256339
H      5.747731369260      2.655664961133     -0.754549004425
H      4.020252371166      2.506237764736     -0.440927023648
H      4.714128452155      1.785097222027     -1.885202694585
C     -6.174972885042      2.286074233377     -0.952614830423
H     -6.307895305939      3.243437382436     -1.448539814413
H     -6.865489564987      2.202509086728     -0.110475702753
H     -6.411410181395      1.472266495435     -1.641872586221
C     -2.432293000887     -0.247591265017      2.904419392899
H     -3.294457050324      0.160623948634      3.432281997819
H     -1.628688255455      0.491065329020      2.945301505029
H     -2.094876578241     -1.140506172945      3.433251751310
H      0.443228692923     -0.128701097020     -1.899152481066
H      2.026070246984     -2.072728803017     -0.159241881068
H      4.214632102920     -1.205608257215      0.446199784658
H      2.644594108517      0.755870289406     -1.295353455027
H     -2.469185060865      1.436002052909      0.608901707617
H     -5.212769524754      0.130988360730      0.328416940476
```

<MoleculeViewer 
  xyzData={`47
OptimizedStructure
C      2.860334405198     -0.149316734226     -0.735986148992
C      4.030382461350     -0.286453850084     -0.104924410201
C     -4.426646050407      0.874575913199      0.236075833529
C     -3.214337573980      0.651010992973      0.732329560773
C      0.645829771100     -1.043293974371     -1.343762782675
C      1.816896278561     -1.164811655875     -0.721363236264
C     -2.778422663551     -0.585529726953      1.451887923834
H     -3.606196002172     -1.300628162483      1.451021751043
C     -0.446437996825     -2.065440773203     -1.332058254826
H     -0.649908464125     -2.386943967843     -2.359289815768
H     -0.116989372940     -2.953594743361     -0.782128407151
C     -1.758899330528     -1.548874000862     -0.723244029352
C     -1.563295346110     -1.208415137134      0.753463902283
H     -0.717928558089     -0.519931357488      0.853839796052
H     -1.282320859941     -2.120840273745      1.293413218216
C     -4.754684799078      2.147037768135     -0.464312639691
O     -3.932482095758      3.020187598600     -0.636490949138
H     -2.032029826883     -0.629420502186     -1.255044565024
C     -2.874372922637     -2.567822354141     -0.930840853609
H     -2.966612910795     -2.834443518273     -1.985055560318
H     -3.841020309770     -2.184007256010     -0.602666241459
H     -2.667627476487     -3.484323548054     -0.370703793558
C      5.116255883554      0.697777549067     -0.080153320687
C      6.228865351224      0.397443619701      0.599770027250
H      6.251623698428     -0.570914504073      1.093652365450
C      7.463206090669      1.222354172171      0.775997900545
H      8.336182729275      0.690232842058      0.390130887501
H      7.652618676852      1.404144362191      1.836724434821
H      7.411503839071      2.186400659890      0.275796057574
C      4.897913438757      1.983139031025     -0.826922256339
H      5.747731369260      2.655664961133     -0.754549004425
H      4.020252371166      2.506237764736     -0.440927023648
H      4.714128452155      1.785097222027     -1.885202694585
C     -6.174972885042      2.286074233377     -0.952614830423
H     -6.307895305939      3.243437382436     -1.448539814413
H     -6.865489564987      2.202509086728     -0.110475702753
H     -6.411410181395      1.472266495435     -1.641872586221
C     -2.432293000887     -0.247591265017      2.904419392899
H     -3.294457050324      0.160623948634      3.432281997819
H     -1.628688255455      0.491065329020      2.945301505029
H     -2.094876578241     -1.140506172945      3.433251751310
H      0.443228692923     -0.128701097020     -1.899152481066
H      2.026070246984     -2.072728803017     -0.159241881068
H      4.214632102920     -1.205608257215      0.446199784658
H      2.644594108517      0.755870289406     -1.295353455027
H     -2.469185060865      1.436002052909      0.608901707617
H     -5.212769524754      0.130988360730      0.328416940476`}
  caption="初期経路を求めるための初期構造"
  backgroundColor="#333333"
/>


### 2. 遷移状態構造最適化

　`run_autots.py`を適切に使用することで、自動的に遷移状態構造が得られる。以下にその手順を説明していく。

初期構造をカレントディレクトリに`bh9_2_10.xyz`として保存する。その後、同じディレクトリ内で、`config_bh9_2_10.json`を作成し、以下のように記述する。

`config_bh9_2_10.json`
```json
{
  "work_dir": "bh9_2_10",
  "top_n_candidates": 3,
  "multioptpy_version": "v1.19.6b",
  
  "step1_settings": {
    "othersoft": "uma-s-1p1",
    "opt_method": ["rsirfo_block_fsb"],
    "use_model_hessian": "fischerd3",
    "spin_multiplicity": 1,
    "electronic_charge": 0,
	"manual_AFIR": ["200", "2", "3", "200", "4", "5"]
  },
  
  "step2_settings": {
    "othersoft": "uma-s-1p1",
    "NSTEP": 15,
    "ANEB": [3, 5],
    "QSM": true,
    "use_model_hessian": "fischerd3",
    "save_pict": true,
    "node_distance_bernstein": 0.80,
    "align_distances": 9999,
    "spin_multiplicity": 1,
    "electronic_charge": 0
  },
  
  "step3_settings": {
    "othersoft": "uma-s-1p1",
    "opt_method": ["rsirfo_block_bofill"],
    "calc_exact_hess": 5,
    "tight_convergence_criteria": true,
    "max_trust_radius": 0.2,
    "frequency_analysis": true,
	"NSTEP": 500,
	"detect_negative_eigenvalues": true,
    "spin_multiplicity": 1,
    "electronic_charge": 0
  },

  "step4_settings": {
    "othersoft": "uma-s-1p1",
	"opt_method": ["rsirfo_block_bofill"],
    "spin_multiplicity": 1,
    "electronic_charge": 0,
	"calc_exact_hess": 10,
    "tight_convergence_criteria": true,
    "frequency_analysis": true,
    
    "intrinsic_reaction_coordinates": ["0.5", "200", "lqa"],

    "step4b_opt_method": ["rsirfo_block_fsb"]
  }
}
```
その後、以下のコマンドを実行する。
```
python run_autots.py bh9_2_10.xyz -cfg config_bh9_2_10.json
```

これにより、これまでの似た内容の記事で行ってきたコマンドの操作をまとめ、遷移状態構造を求める処理を自動的に行う。

具体的な処理の流れは、
```
Step1. バイアスポテンシャルによるNEB法のための初期経路の作成

Step2. NEB法による経路の緩和

Step3. NEB法により得られた経路のエネルギー極大値を示す構造のうち、エネルギー値が上位の最大で3個
(`run_autots.py`にて、`--top_n X`で最大値を変更可能)の構造を初期構造とした遷移状態構造の算出

(Step4.得られた遷移状態構造に対するIRC計算とIRC経路の末端に存在する構造に対する構造最適化。
こちらは`--run_step4`をコマンドで追記しなければ行わない。)
```
となっている。

`run_autots.py`のオプションの説明：

- `-cfg YYY.json`は、workflowを実行するためのオプションが記されたJSONファイルの読み込み先を指定する。


これらの一連の結果は、`(jsonファイルの"work_dir"にて指定した名前)`のディレクトリの中に存在するファイルを開いて確認できる。

以下にすべてのstepで共通のオプションに関する説明を載せる。

- `"opt_method": ["rsirfo_block_fsb"]`は準ニュートン法であるRS-I-RFO法を構造最適化に使用することを示す。初期のへシアンに関しては、特にオプションで指定しない限り、単位行列が使われる。(以前のHessian更新法とは細かな点で異なる方法を使用している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `"spin_multiplicity": Z`はスピン多重度の指定である。PySCFを使用するときは目的とするスピン多重度に1を引いた値を指定する。（デフォルトでは1が指定される。）
- ` "electronic_charge": 0`は形式電荷をMとすることを示す。（デフォルトでは0が指定される。）
- `"othersoft": "uma-s-1p1"`は今回使用するNNPを指定している。これを使用する際にASEライブラリが必要である。
- `"use_model_hessian": "fischerd3"`は、計算コストが非常に低い数式を使用して、近似したHessianを生成する機能を呼び出すオプションである。デフォルトではこの機能は使用されない。


※オプションの説明は`MultiOptPy-v1.19.6/OPTION_README.md`にて示されている。


#### Step 1


Step1では、`omol`のデータセットを使用した`uma-s-1p1`モデルのNNPで得たエネルギーに対して、指定した人工力ポテンシャルを加えた上で初期構造を構造最適化を行っている。


以下のJSON内で記述したバイアスポテンシャルで、次の経路緩和アルゴリズムの初期経路として用いるトラジェクトリーを生成する。
- `"manual_AFIR": ["yyy", "a", "b]`：yyykJ/molの活性化障壁を超えうるペア同士を近づける力を原子のラベル番号aとbのペアに構造最適化時に加えることを示す。


Step1が正常終了していれば作成された`work_dir`ディレクトリ中に、`bh9_2_10_step1_traj.xyz`が存在する。必要に応じて確認し、目的に沿った初期経路が得られているか確認する。もし想定とは異なる場合は、プロセスをkillして再度設定を見直してやり直す。


`bh9_2_10_step1_traj.xyz`は構造最適化の過程をAvogadro（公式ページ:https://avogadro.cc/ ）等で可視化して確認できるようにしている。この`bh9_2_10_step1_traj.xyz`はStep2のNEB計算に使用している。

※`bh9_2_10_step1_traj.xyz`をアニメーションとして表示したい場合は、[https://github.com/ss0832/molecule_movie] を使うと良い。


#### Step 2

Step2では、NEB法を用いることで、先ほど得られた`bh9_2_10_step1_traj.xyz`全体のエネルギーを下げることができる。これにより、パスのエネルギー極大値を持つ構造を遷移状態構造に近づける。（この時点ではまだ正確な遷移状態構造は求められていない。）

Step2固有のオプションについて以下に示す。


- `"NSTEP": n`はn回分NEB法による経路の緩和を行うことを示す。
- `"align_distances": X`は線形補間で、各ノード間の距離を全て等しくするための処理である。X回の反復計算ごとに本処理を行う。Xを`"NSTEP": n`よりも大きな数値を指定することで、初期経路に対してのみ処理を行うことが出来る。
- `"node_distance_bernstein": N`はノード間の距離をN Åとして初期経路を作成することを示す。経路作成時に元のノードをベルンシュタイン多項式を用いてがたついた経路を滑らかにする。

→プログラムの仕様上`"align_distances": X`の処理を行った後に、`"node_distance_bernstein": N`の処理を行うようになっている。

- `"save_pict": true`は緩和中のパスのエネルギープロファイルや各ノードの勾配のRMS値をmatplotlibで可視化するオプションである。
- `"ANEB": [A, B]`これを指定すると、(B+1)回の緩和ごとに、エネルギー極大値を示すノードと前後のノードの間に線形補間でA個の新規ノードを内挿するようにできる。デフォルトではこのような操作は行われない。このオプションを使用するとノードの数が徐々に増えるため、計算コストが使用しない場合と比べて増加する。一方で、エネルギー極大値を示すノード周辺にノードを増加させるため、緩和している経路中のノードが遷移状態構造付近に存在する可能性が高くすることが出来る。


`MultiOptPy-v1.19.6/"work_dir"`と同じディレクトリ内に、NEBという名前を含むディレクトリが生成されている。
そのディレクトリ内の`energy_plot.csv`を確認し、緩和後のパスのエネルギー極大値を示す構造を確認する。

経路の緩和後の各ノードのエネルギー一覧(単位:hartree) (energy_plot.csvに保存されている。)

export const dataset1 = [-777.8590531931713,-777.8590531931713,-777.8459449621145,-777.8320614854878,-777.8215049208006,-777.8122869275801,-777.8036747896354,-777.7952006706535,-777.7870295888308,-777.7806789861071,-777.7773760659418,-777.776812341387,-777.7778440227286,-777.7794340160739,-777.7809558958235,-777.7822039587431,-777.7831193436115,-777.7836833091136,-777.7838322889855,-777.7834606957637,-777.7823828686437,-777.7805078653738,-777.7779414486519,-777.7749642650668,-777.7718587880261,-777.7691989472955,-777.7678220476936,-777.767828281656,-777.7687756270811,-777.770211232384,-777.7715192933581,-777.7721011612406,-777.7720257929424,-777.7717546725312,-777.7710328624889,-777.7685056522645,-777.76205625898,-777.7506720854107,-777.7423410681804,-777.7554853833802,-777.7817894944352,-777.7975497222945,-777.8028741613685,-777.8068020132602,-777.8111342140564,-777.8150288108475,-777.8180136653166,-777.8202179120444,-777.8218013297204,-777.8226681615284,-777.822882148967,-777.8228897541383,-777.823241992725,-777.8233296799987];

export const dataset1_itr5 = [-777.8590531931713,-777.8590531931713,-777.8504114756668,-777.8395742118203,-777.830510591309,-777.8218904977244,-777.8134818901078,-777.8051562121522,-777.7974287580159,-777.7915654689044,-777.7888151174366,-777.788762069615,-777.790305314814,-777.7921816016756,-777.7939527391595,-777.7954489032668,-777.7965406834226,-777.7971960949754,-777.797458893945,-777.7973195519628,-777.7966106807877,-777.7952269470456,-777.7932358203464,-777.7909692865653,-777.7886943590584,-777.7865540203015,-777.7849948068716,-777.7848191256641,-777.7853555487058,-777.7865449300191,-777.7876956852988,-777.7881012827481,-777.7883985152694,-777.7877881915174,-777.7864856350926,-777.783483927459,-777.7761701687899,-777.762547850501,-777.7508744624777,-777.7617961082398,-777.7856205556282,-777.8004214673653,-777.8070264446666,-777.8124651584475,-777.8172652130804,-777.8213414972366,-777.8245416095934,-777.8270035384475,-777.8288578684437,-777.8295445155212,-777.829755453882,-777.8299009597326,-777.8296681083153,-777.8296471327624];

export const dataset1_itr10 = [-777.8590532019331,-777.8590532019331,-777.8540485874702,-777.8454671768706,-777.8373394480286,-777.8293026745812,-777.821144787906,-777.8125334998479,-777.8045028420796,-777.7983634274256,-777.7983701389015,-777.7979949884221,-777.7972142492551,-777.7959688586594,-777.7966052572842,-777.7969304659711,-777.7969776960118,-777.7965840057373,-777.7986264848657,-777.8007993646431,-777.802826361816,-777.8045257057827,-777.8057238926227,-777.8064298023372,-777.8067433710817,-777.8067084775397,-777.8061658380592,-777.804993318672,-777.803221094735,-777.8011621611001,-777.7990415055428,-777.7968502918706,-777.7952962215691,-777.7952212957376,-777.7951665218575,-777.7951419101917,-777.7951332842803,-777.7952394806832,-777.7953523841813,-777.79550991549,-777.7956876688438,-777.796894082937,-777.7978892739137,-777.7980546075322,-777.7983841839355,-777.7978596680686,-777.7967499351525,-777.7937034332357,-777.7854021216177,-777.7719467031045,-777.7684466442843,-777.7640651018731,-777.7601592320367,-777.7572587244363,-777.755852661456,-777.7572155215,-777.7608129142454,-777.7657347961862,-777.7877171383653,-777.8014763256414,-777.8084502501258,-777.8138625823739,-777.8186136852883,-777.8225216918887,-777.8255770168556,-777.8277920492584,-777.8292373121649,-777.8300648038592,-777.830338809066,-777.8304599661025,-777.8304645046724,-777.829986701905];

export const dataset2 = [-777.8590531931713,-777.8590532019331,-777.8559284140658,-777.84940118825,-777.8420156382542,-777.8344938172585,-777.826488699898,-777.8181560695192,-777.8100028966481,-777.8086931862807,-777.8071738080016,-777.8055810415725,-777.8032362568881,-777.8026581105454,-777.8028297569817,-777.8026305637039,-777.8032303952987,-777.8031762040729,-777.8022459899969,-777.8014100038171,-777.8010628952161,-777.8007405034217,-777.8003096678436,-777.8004960865366,-777.8006142339228,-777.8007370118771,-777.8013031809513,-777.802499295645,-777.8021306551221,-777.8014604055999,-777.8014508597081,-777.8012805143868,-777.8017835859489,-777.802899841964,-777.8034816244196,-777.8039858262433,-777.8043491878311,-777.8066185691705,-777.8087970739709,-777.8106371486521,-777.8118876998997,-777.8126214543539,-777.8129706526246,-777.813019543011,-777.8125572397228,-777.8114923273752,-777.8098534524052,-777.8079144973557,-777.8058901900303,-777.8037658808365,-777.8024304416841,-777.8023772799602,-777.8022924051979,-777.801248166124,-777.800605310113,-777.8010178424622,-777.8010116084998,-777.8010210317276,-777.8010959750825,-777.80111733177,-777.8010850404584,-777.8018069578317,-777.8024622204352,-777.8026106833659,-777.8027906227683,-777.8039361735874,-777.8047842071295,-777.8048131120372,-777.8051160309134,-777.8048253171104,-777.8039598959389,-777.8003216363504,-777.7922820722957,-777.7811675044557,-777.7778503048804,-777.7731884247307,-777.7675111819392,-777.7625995950172,-777.7611026094987,-777.7601036586499,-777.7594646665566,-777.7590316613581,-777.7590503479121,-777.7591810880776,-777.759656030144,-777.7603436366296,-777.7639104049803,-777.7680845312412,-777.788924901763,-777.8020587783685,-777.8090547517163,-777.8142972555844,-777.8190673758078,-777.822973060553,-777.8258807768568,-777.82799972826,-777.8292772568373,-777.8300938752395,-777.8303801293281,-777.8304818791592,-777.8305102057934,-777.8301185569991];

<MultiDataGraph datasets={[ { data: dataset1, label: "緩和前の経路のエネルギー", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_itr5, label: "ITR. 5の経路のエネルギー", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_itr10, label: "ITR. 10の経路のエネルギー", color: "rgba(81, 143, 18, 1)"}, { data: dataset2, label: "緩和後の経路のエネルギー", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="Electronic Energy [hartree]" height="500px" />

export const dataset1_grad = [2.1584520104551993e-06,2.158515619382165e-06,0.005298389086761629,0.006499178517791595,0.0066543001512162515,0.00664927589157153,0.006639311908888707,0.0066870001323986565,0.006799597383771666,0.006898193372538877,0.006952641568738966,0.006981334889448844,0.007021528469415156,0.00709858453502261,0.0072092753166797694,0.007329459728002386,0.007416105805540368,0.007440166568415517,0.007411149549137511,0.007360193235087377,0.0073294687953408,0.00736395422667915,0.007500425487969699,0.007793653317273309,0.008241433067701856,0.008617344654228677,0.008614682051902741,0.008273347855073316,0.007927706822864485,0.007743051544764643,0.007673819443439384,0.00767775436113649,0.007759558231393886,0.007880907442376258,0.007963341618142312,0.008006026823966403,0.00803884256935995,0.0075915238390614394,0.005573311557568201,0.005312166122875195,0.004199031215035574,0.003980961153210635,0.005812161696077327,0.006730883081060908,0.0069668418238014885,0.007032845197585991,0.007047191046206983,0.007041536059470016,0.007021579044191658,0.007011056546354823,0.007060561575616226,0.0071173628725130994,0.007000865295560402,0.0069757735828097425];

export const dataset1_grad_itr5 = [1.2695074628999541e-06,5.710075640288461e-07,0.0036439844176978115,0.004727470244520407,0.004962565910182388,0.005031983845664335,0.0050578281919547614,0.004918612948959913,0.004639224088016268,0.004445006677147268,0.004405566184123816,0.004521420193229804,0.004547111435035522,0.004596089897686603,0.004667299145276179,0.004755101372786119,0.0048600393909353735,0.0049761237216722045,0.00514206703648162,0.005161461539575141,0.005004701992813299,0.004800150259551958,0.004658803001739962,0.004600414344164155,0.004478600065470493,0.0044492305547808005,0.004690841730426755,0.004655394935709534,0.004825000888664188,0.0048948612172622155,0.00496191629430665,0.005112646082102009,0.004692176712164112,0.004650440025518208,0.005117716248662217,0.005514742264305778,0.005732642992735864,0.006094624938534195,0.0041290464531651356,0.0033439192220962445,0.0025669903931969003,0.0020208250456156033,0.0029423405360372973,0.0029743607634989395,0.0028731909133556284,0.0027094003508551824,0.0023520372814407075,0.0018157694834159245,0.0009887616663529944,0.0014770011338190653,0.0016362163691225455,0.0014607545753711924,0.0019405248205987774,0.001001729037680028];

export const dataset1_grad_itr10 = [6.7518380956806e-07,2.462782906332042e-07,0.002282786257315459,0.0034376025535102638,0.0037101528417666655,0.0037775708563378544,0.0038431173294684955,0.0038489918699787084,0.0035768010790214817,0.0034470091188840532,0.003414124340382833,0.0034034898322540456,0.003346367158151376,0.0033239096350087187,0.00335353521376897,0.003411047558053361,0.003433990503769107,0.003418322359296506,0.0033707226837412893,0.0033628162512288457,0.003413577978843869,0.0035057409033286634,0.0036256247713688963,0.0037568470046053697,0.0039476957090886335,0.0040027620094661275,0.0037850187962847497,0.0034961662482429203,0.003345998235208438,0.003271210543701936,0.003123351480042071,0.003248634502369113,0.003509705673728925,0.0035188291298534906,0.0035358874313830267,0.0035120397296015487,0.0034903362948956983,0.0034806078546356168,0.0035326494499751575,0.0035387241388634204,0.003539306852315167,0.0034781091371324595,0.003594290268257416,0.0038266191614422093,0.003389292713181769,0.0035176786628302896,0.004082341721282268,0.004465363644064719,0.004682425685901225,0.0054784203589912355,0.005193350151812103,0.004976102987593673,0.004287747470821935,0.0034734182599892678,0.002760060033760429,0.002576634203664894,0.0027346998606363714,0.002611188482025195,0.002143642133123036,0.0013738929277736346,0.0015774165467620593,0.0014899536675081918,0.0013783555005129197,0.00137033085405962,0.0010444304031139136,0.0006678532940270839,0.0003405133557551108,0.0003233399465647123,0.00041676205377884313,0.0002493541018451618,0.0004007635069947042,0.00048615822836869444];

export const dataset2_grad = [6.686079685622272e-07,1.548179791561466e-07,0.0015145736210865188,0.002459696149377515,0.0027480820505835853,0.0028955808796620446,0.0029183150790128487,0.003033075032736629,0.002900633128494453,0.002876189136086224,0.0028496616842559786,0.002806309038152752,0.002747517098637955,0.002929111278510712,0.0029173687931470685,0.0029115333803765653,0.002733483600682944,0.0027313961566380147,0.0028284912625644223,0.002838510733387233,0.0028239316810531843,0.0028099404469034235,0.002742145553389174,0.0027479783232669443,0.00277351426392928,0.0027870854326343523,0.002750684372612319,0.002699824642417752,0.002765132152404423,0.0028919050540599954,0.002872374369589048,0.0028173595415396132,0.0026341598088349396,0.002631244280321428,0.0026469190233895565,0.0026623425597596347,0.002679098748382495,0.0026628283059297706,0.002729507652908275,0.002835839925908374,0.002948613746993366,0.003061220375132996,0.003216385481981272,0.003251577563046245,0.00304195784830347,0.0027988404724440313,0.0027200679702922767,0.00272770246385441,0.0026478287247031435,0.0027867531472801107,0.002921915036328392,0.0029691313807727344,0.002950798925660762,0.0028918147821404665,0.0030409562193429366,0.003031082344216082,0.003019337745732172,0.0030032066236383,0.002905619851252235,0.0028998597779808285,0.0028662293580798263,0.002659800780980743,0.0028515745006913824,0.002877398241124978,0.002903570575672089,0.002767430703715145,0.0028691596793265803,0.003040717009694277,0.002706042972865654,0.002866356508351159,0.003264498879961899,0.0035933441797432173,0.00390316467507128,0.004413458393843163,0.004333814236689102,0.0042601884164731015,0.004045537975796531,0.003071551643650873,0.0028685882405305586,0.002593480058914899,0.002332998465574963,0.002136068808652116,0.0020822796461793807,0.002039124005841621,0.0021364153882492457,0.0021342013641863027,0.002234024268041519,0.002146604665388456,0.0019421260774748262,0.0012658212065762146,0.0007942303736054218,0.0008424776634837831,0.0007059279907639229,0.000623512318847738,0.0005607751552072732,0.00019750667749228074,0.000289298854826532,8.43945854219024e-05,0.00011127764186835844,6.734174027251555e-05,8.189837247586968e-05,0.00037258253488395694];

<MultiDataGraph datasets={[ { data: dataset1_grad, label: "緩和前の経路の勾配のRMS値", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_grad_itr5, label: "ITR. 5の経路の勾配のRMS値", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_grad_itr10, label: "ITR. 10の経路の勾配のRMS値", color: "rgba(81, 143, 18, 1)"},  { data: dataset2_grad, label: "緩和後の経路の勾配のRMS値", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="RMS of gradient [hartree/Bohr]" height="500px" />

※`bias_force_rms.csv`にて、各Iterationごとのすべてのノードの勾配のRMS値を確認できる。

経路緩和の結果、以下の構造がstep3の初期構造として用いられることとなった。"work_dir"内の`bh9_2_10_step3_TS_Opt_Inputs`内に保存された`bh9_2_10_ts_guess_X.xyz`にて確認が可能である。ts_guessの番号が小さい順にエネルギー値が高い構造を示すようになっている。

※こちら[https://ss0832.github.io/molecule_viewer/] を使うことでも可視化は可能である。


`bh9_2_10_ts_guess_1.xyz`
```
47
0 1
C       1.045454580229      0.164435806367     -1.817349712112
C       1.700230248267      0.641512422284     -0.703538224968
C      -0.464357077449      0.890914299818      0.293571223259
C      -0.692697566248     -0.500751625067      0.506148478038
C      -0.918076386412     -1.176305181718     -1.301786709869
C       0.440071446252     -1.092372509833     -1.634420003625
C      -1.962446910435     -1.000475989017      1.197272057677
H      -2.826597547063     -0.455639109874      0.803279424982
C      -1.578733362354     -2.533758241600     -1.394693792543
H      -1.959399187193     -2.629873682481     -2.417127410292
H      -0.808590479063     -3.305007453906     -1.283724730886
C      -2.694266541437     -2.816471109774     -0.401994313258
C      -2.191152651888     -2.496953327115      0.991882579859
H      -1.249954131249     -3.035379231540      1.173067771130
H      -2.902571401687     -2.854109086764      1.740423100483
C       0.200244351545      1.910762591590      1.075672270065
O       0.813724126865      1.739483625544      2.123090504513
H      -3.539100412493     -2.149026536453     -0.613233500252
C      -3.175611962915     -4.254386832177     -0.537026262259
H      -3.557649247418     -4.445416984495     -1.541583665346
H      -3.973330337898     -4.474175686746      0.174309166834
H      -2.357514904282     -4.955264338768     -0.352465510185
C       2.595444516835      1.803852212610     -0.660983384559
C       3.357181108540      1.939460014390      0.431409542959
H       3.166306784780      1.255183868994      1.252128990576
C       4.464646234263      2.908582564531      0.682947495377
H       5.382217679516      2.366327614733      0.924005360356
H       4.230103881961      3.523540836932      1.554042292297
H       4.675620010252      3.565344734839     -0.158208590088
C       2.723663630417      2.635375019377     -1.903561913037
H       3.401783240254      3.473552318635     -1.763040247832
H       1.761016153034      3.030372437330     -2.234397543266
H       3.116130488658      2.018356983978     -2.714877775364
C       0.044456027573      3.296325789361      0.463129422305
H       0.871427968893      3.939361143542      0.748112742974
H      -0.893182844646      3.749265766278      0.792766663503
H       0.009179979434      3.222883670903     -0.624475472757
C      -1.844215925579     -0.729124403747      2.699683874014
H      -1.699417649228      0.324877824715      2.928170639211
H      -0.994250883886     -1.277657245318      3.115220419630
H      -2.744163506505     -1.085998889883      3.205855169500
H      -1.554156555783     -0.348500229410     -1.618304797954
H       1.056159228280     -1.935075126170     -1.327165229665
H       1.833195180588     -0.034025914782      0.137525538794
H       0.725786649515      0.858325771852     -2.589359424017
H       0.157372232633     -1.026525255168      0.954509421612
H      -1.189978275472      1.354176673205     -0.374905935813
```

<MoleculeViewer 
  xyzData={`47
0 1
C       1.045454580229      0.164435806367     -1.817349712112
C       1.700230248267      0.641512422284     -0.703538224968
C      -0.464357077449      0.890914299818      0.293571223259
C      -0.692697566248     -0.500751625067      0.506148478038
C      -0.918076386412     -1.176305181718     -1.301786709869
C       0.440071446252     -1.092372509833     -1.634420003625
C      -1.962446910435     -1.000475989017      1.197272057677
H      -2.826597547063     -0.455639109874      0.803279424982
C      -1.578733362354     -2.533758241600     -1.394693792543
H      -1.959399187193     -2.629873682481     -2.417127410292
H      -0.808590479063     -3.305007453906     -1.283724730886
C      -2.694266541437     -2.816471109774     -0.401994313258
C      -2.191152651888     -2.496953327115      0.991882579859
H      -1.249954131249     -3.035379231540      1.173067771130
H      -2.902571401687     -2.854109086764      1.740423100483
C       0.200244351545      1.910762591590      1.075672270065
O       0.813724126865      1.739483625544      2.123090504513
H      -3.539100412493     -2.149026536453     -0.613233500252
C      -3.175611962915     -4.254386832177     -0.537026262259
H      -3.557649247418     -4.445416984495     -1.541583665346
H      -3.973330337898     -4.474175686746      0.174309166834
H      -2.357514904282     -4.955264338768     -0.352465510185
C       2.595444516835      1.803852212610     -0.660983384559
C       3.357181108540      1.939460014390      0.431409542959
H       3.166306784780      1.255183868994      1.252128990576
C       4.464646234263      2.908582564531      0.682947495377
H       5.382217679516      2.366327614733      0.924005360356
H       4.230103881961      3.523540836932      1.554042292297
H       4.675620010252      3.565344734839     -0.158208590088
C       2.723663630417      2.635375019377     -1.903561913037
H       3.401783240254      3.473552318635     -1.763040247832
H       1.761016153034      3.030372437330     -2.234397543266
H       3.116130488658      2.018356983978     -2.714877775364
C       0.044456027573      3.296325789361      0.463129422305
H       0.871427968893      3.939361143542      0.748112742974
H      -0.893182844646      3.749265766278      0.792766663503
H       0.009179979434      3.222883670903     -0.624475472757
C      -1.844215925579     -0.729124403747      2.699683874014
H      -1.699417649228      0.324877824715      2.928170639211
H      -0.994250883886     -1.277657245318      3.115220419630
H      -2.744163506505     -1.085998889883      3.205855169500
H      -1.554156555783     -0.348500229410     -1.618304797954
H       1.056159228280     -1.935075126170     -1.327165229665
H       1.833195180588     -0.034025914782      0.137525538794
H       0.725786649515      0.858325771852     -2.589359424017
H       0.157372232633     -1.026525255168      0.954509421612
H      -1.189978275472      1.354176673205     -0.374905935813`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.1)"
  backgroundColor="#333333"
/>

`bh9_2_10_ts_guess_2.xyz`
```
47
0 1
C       1.904580796291      0.636408581262     -0.556582956123
C       2.992964048194      0.450893894656      0.199894305854
C      -2.823295887210      1.032148300216     -0.196593388519
C      -1.811162162118      0.611873497884      0.565506546386
C      -0.137663824061     -0.632164877220     -1.356798512772
C       0.999075562123     -0.498484001021     -0.679233798494
C      -2.144532898287     -0.610530998617      1.406568516564
H      -3.218574634010     -0.755735687049      1.272737485326
C      -0.783351736336     -1.983398414689     -1.492128745669
H      -1.061114197892     -2.124768392212     -2.537705512113
H      -0.033824615973     -2.740087156972     -1.244475941437
C      -2.004930987297     -2.093142990344     -0.572773025683
C      -1.549888169264     -1.925334951976      0.893064518562
H      -0.460515643887     -1.910943943491      0.968597569108
H      -1.889018568256     -2.754118631191      1.517752598806
C      -3.346344865643      2.270691770594     -0.833676232905
O      -2.733472688921      3.247249980164     -1.189030624053
H      -2.578949729695     -1.207666501087     -0.827679248723
C      -3.001165969724     -3.219594820150     -0.814240623872
H      -3.218434540275     -3.314426531417     -1.880044735492
H      -3.941007313443     -2.941924782780     -0.326208068395
H      -2.705531179802     -4.191111868666     -0.424044031721
C       4.292895880197      1.126685987591      0.134193776423
C       5.335480871801      0.554457058156      0.754368748952
H       5.144849647247     -0.334762795339      1.351152141177
C       6.779575143096      0.947790967797      0.690173175566
H       7.379544753145      0.160843922658      0.221700849116
H       7.185240770422      1.080997288273      1.695283317746
H       6.960383213067      1.864554991831      0.134804907226
C       4.433988670902      2.283631532762     -0.809945971487
H       5.402052019875      2.767662350606     -0.720459964072
H       3.660765222874      3.032542999329     -0.642283932699
H       4.333591384164      1.928634482576     -1.839114580617
C      -4.869669096787      2.175723104674     -0.898698648408
H      -5.321557616849      3.070988631862     -1.310574050569
H      -5.254753633129      2.005086698284      0.111692599488
H      -5.178095312311      1.301422313160     -1.480328139448
C      -1.963077788764     -0.247184277147      2.875895461676
H      -2.783481304820      0.408947635724      3.174839701110
H      -1.034360369150      0.291194309051      3.063199757525
H      -1.993203763759     -1.133097188457      3.507540144834
H      -0.610177837581      0.236467952780     -1.802712482314
H       1.394714092102     -1.401692113493     -0.218572467091
H       3.001269145694     -0.451743783060      0.806822332247
H       1.782066216248      1.509672060598     -1.189467946035
H      -0.879425233915      1.144283262506      0.694258035319
H      -3.652455868282      0.331061131382     -0.196672860299
```

<MoleculeViewer 
  xyzData={`47
0 1
C       1.904580796291      0.636408581262     -0.556582956123
C       2.992964048194      0.450893894656      0.199894305854
C      -2.823295887210      1.032148300216     -0.196593388519
C      -1.811162162118      0.611873497884      0.565506546386
C      -0.137663824061     -0.632164877220     -1.356798512772
C       0.999075562123     -0.498484001021     -0.679233798494
C      -2.144532898287     -0.610530998617      1.406568516564
H      -3.218574634010     -0.755735687049      1.272737485326
C      -0.783351736336     -1.983398414689     -1.492128745669
H      -1.061114197892     -2.124768392212     -2.537705512113
H      -0.033824615973     -2.740087156972     -1.244475941437
C      -2.004930987297     -2.093142990344     -0.572773025683
C      -1.549888169264     -1.925334951976      0.893064518562
H      -0.460515643887     -1.910943943491      0.968597569108
H      -1.889018568256     -2.754118631191      1.517752598806
C      -3.346344865643      2.270691770594     -0.833676232905
O      -2.733472688921      3.247249980164     -1.189030624053
H      -2.578949729695     -1.207666501087     -0.827679248723
C      -3.001165969724     -3.219594820150     -0.814240623872
H      -3.218434540275     -3.314426531417     -1.880044735492
H      -3.941007313443     -2.941924782780     -0.326208068395
H      -2.705531179802     -4.191111868666     -0.424044031721
C       4.292895880197      1.126685987591      0.134193776423
C       5.335480871801      0.554457058156      0.754368748952
H       5.144849647247     -0.334762795339      1.351152141177
C       6.779575143096      0.947790967797      0.690173175566
H       7.379544753145      0.160843922658      0.221700849116
H       7.185240770422      1.080997288273      1.695283317746
H       6.960383213067      1.864554991831      0.134804907226
C       4.433988670902      2.283631532762     -0.809945971487
H       5.402052019875      2.767662350606     -0.720459964072
H       3.660765222874      3.032542999329     -0.642283932699
H       4.333591384164      1.928634482576     -1.839114580617
C      -4.869669096787      2.175723104674     -0.898698648408
H      -5.321557616849      3.070988631862     -1.310574050569
H      -5.254753633129      2.005086698284      0.111692599488
H      -5.178095312311      1.301422313160     -1.480328139448
C      -1.963077788764     -0.247184277147      2.875895461676
H      -2.783481304820      0.408947635724      3.174839701110
H      -1.034360369150      0.291194309051      3.063199757525
H      -1.993203763759     -1.133097188457      3.507540144834
H      -0.610177837581      0.236467952780     -1.802712482314
H       1.394714092102     -1.401692113493     -0.218572467091
H       3.001269145694     -0.451743783060      0.806822332247
H       1.782066216248      1.509672060598     -1.189467946035
H      -0.879425233915      1.144283262506      0.694258035319
H      -3.652455868282      0.331061131382     -0.196672860299`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.2)"
  backgroundColor="#333333"
/>

`bh9_2_10_ts_guess_3.xyz`
```
47
0 1
C       1.179164951633      0.393886040929     -1.526823830198
C       1.898850544979      0.646861665597     -0.424529929001
C      -1.139529187358      1.206859439369      0.490733179276
C      -0.784409524876     -0.027492273233      0.821204638526
C      -0.898692364015     -1.035306302994     -1.643624889261
C       0.424158839522     -0.883673186026     -1.609381885339
C      -1.742259409824     -0.958038122696      1.498548868518
H      -2.743785018100     -0.520340331821      1.447903232730
C      -1.576934175621     -2.356349205904     -1.574735954813
H      -2.146791278859     -2.473292001479     -2.498569033973
H      -0.817293505391     -3.144892454624     -1.552052732388
C      -2.523860755595     -2.575660639996     -0.381616918244
C      -1.822721683716     -2.395549707430      0.970085348766
H      -0.816751861161     -2.833800310357      0.923852825634
H      -2.364397409759     -2.972741069670      1.726072678280
C      -0.632750001134      2.480038982539     -0.098714155695
O       0.385892169082      3.070101948099      0.168474030130
H      -3.336090728448     -1.840469879715     -0.438521097390
C      -3.133623692258     -3.971073532217     -0.490630779067
H      -3.631390316784     -4.109803120485     -1.451922454489
H      -3.864909082009     -4.150638730869      0.298967072765
H      -2.356113557703     -4.735236966051     -0.405649593730
C       2.918802446577      1.663284513032     -0.198355734545
C       3.748374217637      1.396795467560      0.814691480099
H       3.485164610902      0.555267548761      1.452308810002
C       5.073898159716      2.009036463580      1.113402857391
H       5.860769772753      1.295384805066      0.852635550855
H       5.181844744075      2.219780715256      2.176998402906
H       5.260474292753      2.922092398332      0.554331288073
C       3.098821732618      2.772096640411     -1.184287056127
H       3.928680103293      3.418859188867     -0.912701743427
H       2.197663414456      3.382298995244     -1.244791715101
H       3.297995344124      2.361527064061     -2.175899517088
C      -1.680638727039      3.126676108308     -0.981771842017
H      -1.275935312177      3.982184761812     -1.513123338458
H      -2.481588737104      3.474983453391     -0.325389583866
H      -2.122436120856      2.411036867401     -1.676427637256
C      -1.242409813805     -0.943905169310      2.945160495876
H      -1.233563658619      0.074439106422      3.331716462098
H      -0.220678039003     -1.327154572809      2.988473106221
H      -1.869320801438     -1.567981904915      3.580867972948
H      -1.530383941134     -0.156889884931     -1.706139641257
H       1.029093419368     -1.784152777203     -1.496412384216
H       1.838767621912     -0.051304629282      0.401872471199
H       1.189545523277      1.085435808915     -2.363505563196
H       0.204450802866     -0.452536687465      0.773489948294
H      -2.213154007756      1.319355478534      0.543788289558
```

<MoleculeViewer 
  xyzData={`47
0 1
C       1.179164951633      0.393886040929     -1.526823830198
C       1.898850544979      0.646861665597     -0.424529929001
C      -1.139529187358      1.206859439369      0.490733179276
C      -0.784409524876     -0.027492273233      0.821204638526
C      -0.898692364015     -1.035306302994     -1.643624889261
C       0.424158839522     -0.883673186026     -1.609381885339
C      -1.742259409824     -0.958038122696      1.498548868518
H      -2.743785018100     -0.520340331821      1.447903232730
C      -1.576934175621     -2.356349205904     -1.574735954813
H      -2.146791278859     -2.473292001479     -2.498569033973
H      -0.817293505391     -3.144892454624     -1.552052732388
C      -2.523860755595     -2.575660639996     -0.381616918244
C      -1.822721683716     -2.395549707430      0.970085348766
H      -0.816751861161     -2.833800310357      0.923852825634
H      -2.364397409759     -2.972741069670      1.726072678280
C      -0.632750001134      2.480038982539     -0.098714155695
O       0.385892169082      3.070101948099      0.168474030130
H      -3.336090728448     -1.840469879715     -0.438521097390
C      -3.133623692258     -3.971073532217     -0.490630779067
H      -3.631390316784     -4.109803120485     -1.451922454489
H      -3.864909082009     -4.150638730869      0.298967072765
H      -2.356113557703     -4.735236966051     -0.405649593730
C       2.918802446577      1.663284513032     -0.198355734545
C       3.748374217637      1.396795467560      0.814691480099
H       3.485164610902      0.555267548761      1.452308810002
C       5.073898159716      2.009036463580      1.113402857391
H       5.860769772753      1.295384805066      0.852635550855
H       5.181844744075      2.219780715256      2.176998402906
H       5.260474292753      2.922092398332      0.554331288073
C       3.098821732618      2.772096640411     -1.184287056127
H       3.928680103293      3.418859188867     -0.912701743427
H       2.197663414456      3.382298995244     -1.244791715101
H       3.297995344124      2.361527064061     -2.175899517088
C      -1.680638727039      3.126676108308     -0.981771842017
H      -1.275935312177      3.982184761812     -1.513123338458
H      -2.481588737104      3.474983453391     -0.325389583866
H      -2.122436120856      2.411036867401     -1.676427637256
C      -1.242409813805     -0.943905169310      2.945160495876
H      -1.233563658619      0.074439106422      3.331716462098
H      -0.220678039003     -1.327154572809      2.988473106221
H      -1.869320801438     -1.567981904915      3.580867972948
H      -1.530383941134     -0.156889884931     -1.706139641257
H       1.029093419368     -1.784152777203     -1.496412384216
H       1.838767621912     -0.051304629282      0.401872471199
H       1.189545523277      1.085435808915     -2.363505563196
H       0.204450802866     -0.452536687465      0.773489948294
H      -2.213154007756      1.319355478534      0.543788289558`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.3)"
  backgroundColor="#333333"
/>


#### Step 3

step3のオプションで、追加での説明を要するものを以下に示す。

- `"opt_method": ["rsirfo_block_bofill"]`は遷移状態構造の最適化向けのoptimizerを指定することを意味する。準ニュートン法であるRS-I-RFO法を使用する。今回は`-fc`で正確なHessianを計算するようにしているので、初期Hessianは正確なHessianを使用するようになっている。(Bofill法によるHessianの更新法を細かい点で変更している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `"saddle_order": 1`は一次の鞍点を求めることを指定する。（step3のデフォルトでは一次の鞍点を指定する。それ以外の値の指定は、プログラムの使用目的上想定していないので、行わないことを勧める。）
- `"calc_exact_hess": 5`は5回の反復回数当たり1回正確なHessianを計算することを指定する。
- `"frequency_analysis": true`は収束条件を満たした後に基準振動解析を行うことを示す。（自前で実装しているため、あくまで目安として使用することを推奨する。各振動モードを`vibration_animation`内のxyzファイルで可視化できる。）UMAモデルから算出されるHessianは数値微分により求めているため、原子数Zが多いとZの二乗オーダーで計算コストが急増する。
- `"tight_convergence_criteria": true`は収束条件を厳しくすることを示す。（Gaussianのtightと同等）
- `"max_trust_radius": D`は一回の反復計算ごとの計算されるステップ幅の最大値をDÅ以下にすることを示す。デフォルトでは、`"saddle_order": 1`を指定すると0.1Åが指定される。
- `"detect_negative_eigenvalues": true`は、初めの計算時(ITR. 0)に、任意の次数の鞍点(遷移状態構造等)を求める際に、正確なへシアンから算出した固有値に１つも負の固有値がない場合、計算を打ち切るオプションである。

実行して得られた正確な遷移状態構造と思われる構造を以下に示す。

(実行して得られた正確な遷移状態構造は計算開始時に、`MultiOptPy-v1.19.6/"work_dir"`ディレクトリ内に生成された新規ディレクトリ内の`bh9_2_10_ts_final_X.xyz`として保存されている。)

`bh9_2_10_ts_final_1.xyz`
```
47
OptimizedStructure
C      1.316870938422      0.435887707436     -0.792085783119
C      2.606767418282      0.797737942335     -0.729462645520
C     -1.137859185401      0.743750547481      1.456903518667
C     -1.527322158305     -0.557978429043      1.096094485759
C     -0.514794640375     -1.172555786382     -0.442307293018
C      0.816335501892     -0.803101961231     -0.256578674581
C     -2.968320205628     -0.845704041066      0.714613681576
H     -3.215476127350     -0.263323056033     -0.181461839633
C     -0.862818404877     -2.647355189663     -0.492612589778
H     -0.298285377046     -3.128333881919     -1.297889637975
H     -0.547204769600     -3.132198444510      0.438917390780
C     -2.351096101239     -2.892632015763     -0.722644390667
C     -3.187649823250     -2.328545910657      0.419113555470
H     -2.965765081023     -2.897197167645      1.331858161660
H     -4.247748610019     -2.495994132911      0.204536702307
C      0.182966235244      0.898137277675      1.884291646016
O      0.951927526811     -0.103166406652      1.890487095643
H     -2.633439473300     -2.364091995016     -1.643137785075
C     -2.634049510202     -4.377164775469     -0.917137607834
H     -2.067925283581     -4.781941476650     -1.757882309940
H     -3.693922145196     -4.557370442557     -1.104994199896
H     -2.353725924466     -4.940187409358     -0.023031339623
C      3.164935764996      2.050410526283     -1.227628584524
C      4.476516104201      2.262040073239     -1.050272982745
H      5.034099972727      1.471303071118     -0.555169730018
C      5.287274295545      3.453552910977     -1.442855187123
H      6.092100144553      3.157877369461     -2.120213981529
H      5.766350062266      3.890544103470     -0.563491198115
H      4.704019694826      4.230647761125     -1.930449278420
C      2.223893833604      3.021473875695     -1.882330697669
H      2.725451654158      3.926719011627     -2.212074518013
H      1.429073839651      3.309318644304     -1.190124576864
H      1.743975811075      2.566533491299     -2.751356066728
C      0.749623517547      2.253791498412      2.226916667997
H      1.565607730841      2.482373855051      1.536277917647
H      1.173735753656      2.226163446327      3.231462698891
H     -0.001405221448      3.042105045466      2.175667919068
C     -3.904854677325     -0.410305780922      1.842842625071
H     -3.835665561766      0.658679755872      2.037363904302
H     -3.652023081534     -0.934478751863      2.767489427508
H     -4.940516664201     -0.649164224414      1.592622017241
H     -1.048176355586     -0.566697457992     -1.172922681880
H      1.531588896721     -1.525570495107      0.115596923044
H      3.304359194667      0.122332871365     -0.241560796227
H      0.584118347259      1.091703341743     -1.250764310210
H     -1.073860185274     -1.322246382159      1.725091245171
H     -1.767687670952      1.604221487221      1.264293102905
```

<MoleculeViewer 
  xyzData={`47
OptimizedStructure
C      1.316870938422      0.435887707436     -0.792085783119
C      2.606767418282      0.797737942335     -0.729462645520
C     -1.137859185401      0.743750547481      1.456903518667
C     -1.527322158305     -0.557978429043      1.096094485759
C     -0.514794640375     -1.172555786382     -0.442307293018
C      0.816335501892     -0.803101961231     -0.256578674581
C     -2.968320205628     -0.845704041066      0.714613681576
H     -3.215476127350     -0.263323056033     -0.181461839633
C     -0.862818404877     -2.647355189663     -0.492612589778
H     -0.298285377046     -3.128333881919     -1.297889637975
H     -0.547204769600     -3.132198444510      0.438917390780
C     -2.351096101239     -2.892632015763     -0.722644390667
C     -3.187649823250     -2.328545910657      0.419113555470
H     -2.965765081023     -2.897197167645      1.331858161660
H     -4.247748610019     -2.495994132911      0.204536702307
C      0.182966235244      0.898137277675      1.884291646016
O      0.951927526811     -0.103166406652      1.890487095643
H     -2.633439473300     -2.364091995016     -1.643137785075
C     -2.634049510202     -4.377164775469     -0.917137607834
H     -2.067925283581     -4.781941476650     -1.757882309940
H     -3.693922145196     -4.557370442557     -1.104994199896
H     -2.353725924466     -4.940187409358     -0.023031339623
C      3.164935764996      2.050410526283     -1.227628584524
C      4.476516104201      2.262040073239     -1.050272982745
H      5.034099972727      1.471303071118     -0.555169730018
C      5.287274295545      3.453552910977     -1.442855187123
H      6.092100144553      3.157877369461     -2.120213981529
H      5.766350062266      3.890544103470     -0.563491198115
H      4.704019694826      4.230647761125     -1.930449278420
C      2.223893833604      3.021473875695     -1.882330697669
H      2.725451654158      3.926719011627     -2.212074518013
H      1.429073839651      3.309318644304     -1.190124576864
H      1.743975811075      2.566533491299     -2.751356066728
C      0.749623517547      2.253791498412      2.226916667997
H      1.565607730841      2.482373855051      1.536277917647
H      1.173735753656      2.226163446327      3.231462698891
H     -0.001405221448      3.042105045466      2.175667919068
C     -3.904854677325     -0.410305780922      1.842842625071
H     -3.835665561766      0.658679755872      2.037363904302
H     -3.652023081534     -0.934478751863      2.767489427508
H     -4.940516664201     -0.649164224414      1.592622017241
H     -1.048176355586     -0.566697457992     -1.172922681880
H      1.531588896721     -1.525570495107      0.115596923044
H      3.304359194667      0.122332871365     -0.241560796227
H      0.584118347259      1.091703341743     -1.250764310210
H     -1.073860185274     -1.322246382159      1.725091245171
H     -1.767687670952      1.604221487221      1.264293102905`}
  caption="遷移状態構造 (No.1)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                     -577.4950             20.6858             34.0842
Reduced mass [au]                   9.2142              3.7983              3.3389
Force const [Dyne/A]               -1.8105              0.0010              0.0023
Char temp [K]                       0.0000             29.7622             49.0396
Normal mode                   x         y         z            x         y         z            x         y         z     
       C                 0.00131    0.00794   -0.00283    0.00260    0.03372    0.03770    0.00767   -0.00969    0.03765
       C                -0.00315    0.00264    0.00179    0.01170    0.00655    0.00316    0.00643   -0.00122    0.00947
       C                -0.02396   -0.00864    0.00005   -0.04310   -0.00353    0.03052    0.01984   -0.00070   -0.00201
       C                -0.06861    0.06137    0.12024   -0.02123   -0.00643    0.02207    0.00223    0.00740   -0.01347
       C                 0.09610   -0.05509   -0.14769    0.00031    0.02680    0.01299    0.02376   -0.02175    0.01619
       C                -0.00490   -0.03904   -0.10032   -0.00424    0.03278    0.02995    0.02149   -0.01948    0.02722
       C                -0.00778    0.00344    0.00884   -0.01483   -0.02584    0.01403    0.00799    0.03206   -0.05473
       H                 0.01078    0.00776    0.00933   -0.02296   -0.01485    0.02345    0.04992    0.02082   -0.07359
       C                -0.00095   -0.01747   -0.00548    0.01506    0.02403   -0.01155    0.01430   -0.01934    0.03217
       H                -0.02141   -0.07787    0.01690    0.02364    0.04288   -0.01684    0.02868   -0.03834    0.05363
       H                -0.00564    0.01358    0.01240    0.01682    0.01251   -0.01808   -0.01263   -0.00660    0.04787
       C                -0.00159    0.00057    0.00210    0.01902    0.01002   -0.02108    0.01683   -0.00686    0.00015
       C                 0.00353    0.00176    0.00312    0.00933   -0.02414   -0.01160   -0.00870    0.03037   -0.03609
       H                 0.00356    0.00053    0.00236    0.01800   -0.03686   -0.02162   -0.04767    0.04339   -0.01853
       H                 0.00229    0.00668    0.00724    0.01208   -0.03709   -0.01502   -0.00475    0.04466   -0.06675
       C                 0.03366   -0.01265    0.02557   -0.04519    0.01762    0.03086    0.01384   -0.02872    0.02708
       O                -0.00663    0.02643    0.07528   -0.02804    0.03130    0.02691   -0.00463   -0.04308    0.03518
       H                 0.00006    0.00103    0.00205    0.01467    0.02526   -0.01099    0.04785   -0.02545   -0.02004
       C                -0.00377    0.00076    0.00147    0.03887    0.01031   -0.05236    0.00337   -0.00796    0.02815
       H                -0.00346    0.00438    0.00033    0.04629    0.03512   -0.05930    0.02109   -0.03535    0.05327
       H                -0.00351   -0.00156    0.00254    0.04171    0.00030   -0.05875    0.00620    0.00083    0.00373
       H                -0.00067   -0.00067   -0.00029    0.04402   -0.00452   -0.06330   -0.02797    0.01010    0.04933
       C                 0.00250    0.00209    0.00227    0.02559   -0.00482   -0.01089   -0.02051    0.01091    0.00838
       C                 0.00067    0.00223   -0.00038    0.04004   -0.04470   -0.07120   -0.01108    0.00849   -0.05948
       H                 0.00067    0.00118   -0.00197    0.03962   -0.06340   -0.10056    0.01698   -0.00027   -0.10502
       C                 0.00160    0.00200   -0.00088    0.05833   -0.06878   -0.10698   -0.03298    0.01479   -0.08600
       H                 0.00123    0.00526   -0.00307    0.01303   -0.09149   -0.15096   -0.07691    0.02639   -0.14332
       H                 0.00198    0.00598   -0.00269    0.11889   -0.08885   -0.13005    0.02416   -0.00432   -0.10771
       H                 0.00081    0.00193   -0.00106    0.05821   -0.04731   -0.07264   -0.06176    0.02601   -0.03361
       C                 0.00201    0.00121    0.00022    0.02468    0.02545    0.03513   -0.05639    0.02353    0.07826
       H                 0.00079    0.00129   -0.00236    0.03394    0.01785    0.02837   -0.07843    0.03952    0.08879
       H                 0.00105    0.00262   -0.00098    0.05625    0.03543    0.06712   -0.03126   -0.00784    0.12009
       H                 0.00137   -0.00188    0.00195   -0.01727    0.04759    0.04662   -0.08686    0.04872    0.08181
       C                 0.00043    0.00836   -0.00273   -0.06822    0.02645    0.03426    0.03223   -0.04228    0.05028
       H                -0.00218    0.00271   -0.00553   -0.06971    0.03985    0.03698    0.05279   -0.05296    0.07103
       H                -0.00051    0.01463   -0.00291   -0.07050    0.03221    0.03537    0.00825   -0.05829    0.05997
       H                -0.00602    0.00079   -0.01133   -0.08076    0.01437    0.03301    0.04880   -0.02716    0.03906
       C                -0.01782   -0.00053    0.00203   -0.02344   -0.06005    0.02028   -0.02356    0.07079   -0.09628
       H                -0.01147   -0.00051   -0.00090   -0.03983   -0.06240    0.03917   -0.00905    0.07284   -0.11264
       H                -0.01720    0.00035    0.00207   -0.01684   -0.07253    0.01142   -0.06829    0.08196   -0.07777
       H                -0.01679   -0.00145    0.00068   -0.01937   -0.07155    0.01450   -0.01939    0.08800   -0.12999
       H                -0.03928    0.01250    0.01545   -0.00082    0.03388    0.01983    0.03509   -0.02843    0.00245
       H                -0.01269    0.01898    0.03031   -0.00557    0.03031    0.02825    0.02568   -0.01587    0.02571
       H                -0.00243   -0.00410   -0.00790    0.01287   -0.01357   -0.02624    0.02756   -0.00393   -0.02438
       H                 0.00723    0.01083   -0.01254    0.00249    0.05121    0.06241   -0.00673   -0.00691    0.06451
       H                 0.07667    0.00557   -0.06563   -0.00810   -0.00577    0.01322   -0.02874   -0.00066   -0.00097
       H                 0.02952    0.01482   -0.07645   -0.05674   -0.01294    0.03266    0.04130    0.01274   -0.01173
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。

`bh9_2_10_ts_final_2.xyz`
```
47
OptimizedStructure
C      2.219932859344     -0.150333936937     -0.850676827792
C      3.418981905404     -0.078931333966     -0.265238015752
C     -3.158310710672      1.239022849151      0.244541165465
C     -2.357100904529      0.456180950311      0.959457399421
C      0.174920254095     -1.411318010548     -1.383356600273
C      1.374196778278     -1.335011440805     -0.809276232811
C     -2.710561503800     -0.880298806159      1.532664005871
H     -3.750638872246     -1.111689262221      1.278200652754
C     -0.755050243197     -2.580192114653     -1.299963802299
H     -1.009891552581     -2.922748484127     -2.308586887238
H     -0.264980646634     -3.417609767576     -0.792082189810
C     -2.053238115480     -2.217206630248     -0.562577654824
C     -1.790631960586     -1.947143829380      0.922476788337
H     -0.756712250372     -1.617658696565      1.066049585352
H     -1.902888494770     -2.880423535920      1.484839207977
C     -2.683349639559      2.542685201843     -0.296492599052
O     -1.541702383773      2.923874398148     -0.155920580442
H     -2.427533044198     -1.291457050792     -1.014970024074
C     -3.112739870324     -3.298972843148     -0.744925799172
H     -3.377311696840     -3.424169675831     -1.796283815758
H     -4.025726353025     -3.058514502193     -0.196090085011
H     -2.745540869206     -4.259552801062     -0.373886754805
C      4.301147457137      1.091806925207     -0.256336558438
C      5.477921924684      0.993660133284      0.372944571443
H      5.703162765046      0.037708048857      0.839503139622
C      6.540863918151      2.034022398932      0.525122166797
H      7.482107217187      1.684398580931      0.093770135932
H      6.735800930275      2.229298019170      1.582484135558
H      6.287270570987      2.979571873294      0.051988863493
C      3.811575923888      2.327044289610     -0.957884031902
H      4.517832540792      3.149696535132     -0.892320979616
H      2.863336411975      2.660666529738     -0.530997995964
H      3.631649306431      2.120953710285     -2.015381290001
C     -3.708234963990      3.363677609356     -1.038564173516
H     -3.262250068335      4.289761285109     -1.390287613900
H     -4.553834439272      3.581417908382     -0.382478229503
H     -4.098745750410      2.792666573448     -1.884016752614
C     -2.566184707576     -0.850050905921      3.055147412064
H     -3.207909862041     -0.089599410120      3.500859677112
H     -1.534059640527     -0.627873195104      3.336025189850
H     -2.830220749912     -1.818313607060      3.483026734147
H     -0.198125628470     -0.540898278968     -1.920951502014
H      1.756777292467     -2.193582762802     -0.260664238496
H      3.791602685927     -0.955415282482      0.259757943765
H      1.817737205671      0.708621616000     -1.378818751603
H     -1.340848502692      0.806105458896      1.136719602670
H     -4.182494522723      0.946125269503      0.033451609050
```

<MoleculeViewer 
  xyzData={`47
OptimizedStructure
C      2.219932859344     -0.150333936937     -0.850676827792
C      3.418981905404     -0.078931333966     -0.265238015752
C     -3.158310710672      1.239022849151      0.244541165465
C     -2.357100904529      0.456180950311      0.959457399421
C      0.174920254095     -1.411318010548     -1.383356600273
C      1.374196778278     -1.335011440805     -0.809276232811
C     -2.710561503800     -0.880298806159      1.532664005871
H     -3.750638872246     -1.111689262221      1.278200652754
C     -0.755050243197     -2.580192114653     -1.299963802299
H     -1.009891552581     -2.922748484127     -2.308586887238
H     -0.264980646634     -3.417609767576     -0.792082189810
C     -2.053238115480     -2.217206630248     -0.562577654824
C     -1.790631960586     -1.947143829380      0.922476788337
H     -0.756712250372     -1.617658696565      1.066049585352
H     -1.902888494770     -2.880423535920      1.484839207977
C     -2.683349639559      2.542685201843     -0.296492599052
O     -1.541702383773      2.923874398148     -0.155920580442
H     -2.427533044198     -1.291457050792     -1.014970024074
C     -3.112739870324     -3.298972843148     -0.744925799172
H     -3.377311696840     -3.424169675831     -1.796283815758
H     -4.025726353025     -3.058514502193     -0.196090085011
H     -2.745540869206     -4.259552801062     -0.373886754805
C      4.301147457137      1.091806925207     -0.256336558438
C      5.477921924684      0.993660133284      0.372944571443
H      5.703162765046      0.037708048857      0.839503139622
C      6.540863918151      2.034022398932      0.525122166797
H      7.482107217187      1.684398580931      0.093770135932
H      6.735800930275      2.229298019170      1.582484135558
H      6.287270570987      2.979571873294      0.051988863493
C      3.811575923888      2.327044289610     -0.957884031902
H      4.517832540792      3.149696535132     -0.892320979616
H      2.863336411975      2.660666529738     -0.530997995964
H      3.631649306431      2.120953710285     -2.015381290001
C     -3.708234963990      3.363677609356     -1.038564173516
H     -3.262250068335      4.289761285109     -1.390287613900
H     -4.553834439272      3.581417908382     -0.382478229503
H     -4.098745750410      2.792666573448     -1.884016752614
C     -2.566184707576     -0.850050905921      3.055147412064
H     -3.207909862041     -0.089599410120      3.500859677112
H     -1.534059640527     -0.627873195104      3.336025189850
H     -2.830220749912     -1.818313607060      3.483026734147
H     -0.198125628470     -0.540898278968     -1.920951502014
H      1.756777292467     -2.193582762802     -0.260664238496
H      3.791602685927     -0.955415282482      0.259757943765
H      1.817737205671      0.708621616000     -1.378818751603
H     -1.340848502692      0.806105458896      1.136719602670
H     -4.182494522723      0.946125269503      0.033451609050`}
  caption="遷移状態構造 (No.2)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                      -14.5063             19.3528             24.2752
Reduced mass [au]                   5.4943              3.4621              3.5867
Force const [Dyne/A]               -0.0007              0.0008              0.0012
Char temp [K]                       0.0000             27.8444             34.9265
Normal mode                   x         y         z            x         y         z            x         y         z     
       C                -0.04539    0.01764    0.00532    0.00046    0.03005    0.03736    0.01265   -0.02826   -0.02086
       C                -0.04087    0.01873   -0.00404    0.02272    0.01288   -0.00609   -0.00408    0.00180    0.00949
       C                 0.06134    0.00099   -0.00398   -0.00806   -0.01460   -0.02078    0.01474    0.00646   -0.00295
       C                 0.04225   -0.01610   -0.00129   -0.03676   -0.00901    0.01753   -0.00967    0.00266    0.02024
       C                -0.03723    0.00550    0.00175   -0.00427    0.03428    0.04633    0.02124   -0.04274   -0.01060
       C                -0.03400    0.00913   -0.00545    0.00548    0.02598    0.02704    0.00864   -0.02415    0.01325
       C                 0.00918   -0.00504    0.00414   -0.05265   -0.01346   -0.00292   -0.02286   -0.00759   -0.01195
       H                 0.00355    0.01908    0.00469   -0.04495   -0.01265   -0.03523   -0.01582   -0.00476   -0.04283
       C                -0.02581   -0.00425   -0.00648    0.00758    0.02295    0.02131    0.01129   -0.03268    0.01502
       H                -0.02913    0.00484   -0.00874    0.02605    0.03196    0.01336    0.01805   -0.05872    0.02225
       H                -0.01520   -0.00548   -0.01878    0.01103    0.02255    0.01734   -0.00095   -0.02270    0.04323
       C                -0.02404   -0.02290    0.00567   -0.00763   -0.00219    0.00558    0.00778   -0.00088   -0.00629
       C                -0.01720   -0.02910    0.00630   -0.03468   -0.00676    0.01139   -0.00573    0.00326   -0.00539
       H                -0.00928   -0.05445    0.00709   -0.03880   -0.00230    0.03145   -0.01004    0.01416    0.00134
       H                -0.04111   -0.02522    0.00767   -0.04046   -0.00909    0.00627    0.00075    0.00118   -0.00728
       C                 0.09432   -0.01453   -0.01215    0.01026   -0.01301   -0.00091    0.02747    0.01939    0.03886
       O                 0.10690   -0.04759   -0.02423   -0.00107   -0.00190    0.06109    0.01047    0.04007    0.12011
       H                -0.03585   -0.02371    0.01391   -0.01511   -0.00508    0.00589    0.03137    0.00350   -0.01718
       C                -0.01604   -0.03069    0.00608    0.01116   -0.01684   -0.01663   -0.00978    0.01712   -0.01188
       H                -0.02256   -0.02647    0.00720    0.02812   -0.01413   -0.02123   -0.00013    0.01613   -0.01416
       H                -0.01385   -0.04070    0.01433   -0.00025   -0.03374   -0.02815   -0.01187    0.03552   -0.02357
       H                -0.00596   -0.02996   -0.00208    0.01997   -0.01375   -0.01739   -0.03053    0.01266   -0.00284
       C                -0.05020    0.02566    0.00602    0.02447    0.01163   -0.00798   -0.00655    0.00403   -0.02555
       C                -0.04393    0.02539   -0.00567    0.05522   -0.01179   -0.06913   -0.02900    0.04294    0.02242
       H                -0.03248    0.02024   -0.02173    0.07602   -0.02770   -0.11176   -0.04309    0.07001    0.08469
       C                -0.05044    0.03121    0.00015    0.06602   -0.01989   -0.08894   -0.03830    0.05526    0.00331
       H                -0.05165    0.04467   -0.01343    0.04248   -0.00799   -0.14999   -0.01979    0.03258    0.06217
       H                -0.04240    0.01724    0.00126    0.12184   -0.05635   -0.09251   -0.08172    0.11873   -0.00039
       H                -0.06185    0.03618    0.01619    0.04417   -0.00316   -0.04380   -0.02221    0.02643   -0.06290
       C                -0.06585    0.03200    0.02813   -0.00693    0.03579    0.05640    0.01552   -0.03659   -0.11256
       H                -0.07312    0.03758    0.03694   -0.00594    0.03490    0.05697    0.01506   -0.03395   -0.14107
       H                -0.06674    0.01640    0.03833    0.00988    0.01839    0.10725    0.00414   -0.00952   -0.15888
       H                -0.06975    0.04661    0.02593   -0.05003    0.07359    0.05634    0.04548   -0.09897   -0.10550
       C                 0.11124    0.01321   -0.00488    0.04475   -0.02676   -0.06368    0.06286    0.00572   -0.02519
       H                 0.13461   -0.00037   -0.01101    0.05618   -0.02472   -0.04381    0.07006    0.01603    0.01109
       H                 0.12325    0.03882    0.00208    0.00548   -0.03073   -0.11298    0.01463   -0.01354   -0.08094
       H                 0.08747    0.02246   -0.00015    0.09802   -0.03535   -0.08250    0.13018    0.00418   -0.05525
       C                 0.01057   -0.00373    0.00388   -0.09618   -0.02746    0.00122   -0.06350   -0.03193   -0.00761
       H                 0.02882    0.01287    0.00184   -0.10777   -0.03055   -0.01012   -0.07267   -0.03659   -0.01282
       H                 0.01597   -0.02730    0.00266   -0.10389   -0.03162    0.03284   -0.07025   -0.04007    0.02366
       H                -0.01216    0.00386    0.00704   -0.10995   -0.03087   -0.01504   -0.07856   -0.03768   -0.02994
       H                -0.04940    0.00946    0.01658   -0.01846    0.04643    0.07566    0.03874   -0.06312   -0.05565
       H                -0.02197    0.00508   -0.02011    0.02103    0.01328   -0.00376   -0.00680   -0.00191    0.05872
       H                -0.02892    0.01363   -0.02098    0.04365   -0.00316   -0.04774   -0.01841    0.02944    0.06575
       H                -0.05806    0.02237    0.02267   -0.01957    0.04555    0.07775    0.02863   -0.05429   -0.07527
       H                 0.05173   -0.04179   -0.00477   -0.04747   -0.00213    0.06496   -0.02046    0.00912    0.06891
       H                 0.05315    0.02677   -0.00005    0.00407   -0.02161   -0.06989    0.02701    0.00023   -0.05379
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。

`bh9_2_10_ts_final_3.xyz`
```
47
OptimizedStructure
C      1.543702905546      0.004923913907     -1.409582908552
C      2.526976616465      0.437848025034     -0.615658591350
C     -1.586491050866      0.978683255820      1.011711300061
C     -1.454312123685     -0.125732897264      1.736407792252
C     -0.326981170747     -1.526511921094     -1.826984018192
C      0.792851372598     -1.221803178166     -1.174528056322
C     -2.406805594197     -1.277476318593      1.818436710784
H     -3.391133527659     -0.964226075277      1.454724677145
C     -1.232084189791     -2.686285205550     -1.542677147610
H     -1.683144854085     -3.033706682144     -2.475804984961
H     -0.671526440467     -3.528655762915     -1.126622105389
C     -2.343732786062     -2.271899254067     -0.556448981217
C     -1.872332619108     -2.393505291911      0.899139645111
H     -0.779459339994     -2.378446253519      0.946360729820
H     -2.182250614990     -3.368584954096      1.289665271727
C     -0.480510811094      1.976282056550      0.956684604697
O      0.441216571345      1.960755543796      1.742209107399
H     -2.564974479168     -1.216213633053     -0.751672095548
C     -3.623950494153     -3.073336507585     -0.771024741976
H     -4.038367519518     -2.904866950359     -1.766363769963
H     -4.386899260885     -2.801384761684     -0.037774038900
H     -3.427038860964     -4.143303445318     -0.664278109196
C      3.278015197463      1.684431611208     -0.783371929580
C      4.173785792704      2.013218147356      0.153687830140
H      4.283743027581      1.322365091684      0.985409932915
C      5.039798870498      3.229047234866      0.227209231235
H      6.092779821671      2.945346989213      0.295160904544
H      4.811157110150      3.801435398574      1.129647507541
H      4.925675598396      3.892130506371     -0.627165203958
C      2.974086205490      2.516106855223     -1.997432385974
H      3.595522813877      3.405082305001     -2.058001885173
H      1.929745716474      2.837662089527     -1.992547127951
H      3.126271795635      1.934660557927     -2.909483306677
C     -0.568240678928      3.001649273632     -0.145183669709
H      0.296642538786      3.659184093650     -0.110407510282
H     -1.485878704876      3.584889468500     -0.039035673693
H     -0.617289333727      2.494974379284     -1.112309856967
C     -2.536734994546     -1.756212122628      3.263073701789
H     -2.873447594089     -0.953852887144      3.920588714883
H     -1.573049987849     -2.113028663624      3.634518267659
H     -3.249032618399     -2.579636175093      3.332358011419
H     -0.684597084142     -0.823511901799     -2.577756323514
H      1.168187430932     -1.889683252289     -0.402074923178
H      2.794278407937     -0.161391238881      0.251102530227
H      1.238032630281      0.595133082502     -2.268935900829
H     -0.523040752557     -0.240164031158      2.289560270244
H     -2.469162937282      1.157609485585      0.405468505072
```

<MoleculeViewer 
  xyzData={`47
OptimizedStructure
C      1.543702905546      0.004923913907     -1.409582908552
C      2.526976616465      0.437848025034     -0.615658591350
C     -1.586491050866      0.978683255820      1.011711300061
C     -1.454312123685     -0.125732897264      1.736407792252
C     -0.326981170747     -1.526511921094     -1.826984018192
C      0.792851372598     -1.221803178166     -1.174528056322
C     -2.406805594197     -1.277476318593      1.818436710784
H     -3.391133527659     -0.964226075277      1.454724677145
C     -1.232084189791     -2.686285205550     -1.542677147610
H     -1.683144854085     -3.033706682144     -2.475804984961
H     -0.671526440467     -3.528655762915     -1.126622105389
C     -2.343732786062     -2.271899254067     -0.556448981217
C     -1.872332619108     -2.393505291911      0.899139645111
H     -0.779459339994     -2.378446253519      0.946360729820
H     -2.182250614990     -3.368584954096      1.289665271727
C     -0.480510811094      1.976282056550      0.956684604697
O      0.441216571345      1.960755543796      1.742209107399
H     -2.564974479168     -1.216213633053     -0.751672095548
C     -3.623950494153     -3.073336507585     -0.771024741976
H     -4.038367519518     -2.904866950359     -1.766363769963
H     -4.386899260885     -2.801384761684     -0.037774038900
H     -3.427038860964     -4.143303445318     -0.664278109196
C      3.278015197463      1.684431611208     -0.783371929580
C      4.173785792704      2.013218147356      0.153687830140
H      4.283743027581      1.322365091684      0.985409932915
C      5.039798870498      3.229047234866      0.227209231235
H      6.092779821671      2.945346989213      0.295160904544
H      4.811157110150      3.801435398574      1.129647507541
H      4.925675598396      3.892130506371     -0.627165203958
C      2.974086205490      2.516106855223     -1.997432385974
H      3.595522813877      3.405082305001     -2.058001885173
H      1.929745716474      2.837662089527     -1.992547127951
H      3.126271795635      1.934660557927     -2.909483306677
C     -0.568240678928      3.001649273632     -0.145183669709
H      0.296642538786      3.659184093650     -0.110407510282
H     -1.485878704876      3.584889468500     -0.039035673693
H     -0.617289333727      2.494974379284     -1.112309856967
C     -2.536734994546     -1.756212122628      3.263073701789
H     -2.873447594089     -0.953852887144      3.920588714883
H     -1.573049987849     -2.113028663624      3.634518267659
H     -3.249032618399     -2.579636175093      3.332358011419
H     -0.684597084142     -0.823511901799     -2.577756323514
H      1.168187430932     -1.889683252289     -0.402074923178
H      2.794278407937     -0.161391238881      0.251102530227
H      1.238032630281      0.595133082502     -2.268935900829
H     -0.523040752557     -0.240164031158      2.289560270244
H     -2.469162937282      1.157609485585      0.405468505072`}
  caption="遷移状態構造 (No.3)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                      -24.5151             22.5553             36.3904
Reduced mass [au]                   3.6390              4.1336              3.4978
Force const [Dyne/A]               -0.0013              0.0012              0.0027
Char temp [K]                       0.0000             32.4520             52.3577
Normal mode                   x         y         z            x         y         z            x         y         z     
       C                -0.00385   -0.00706   -0.01364    0.00977    0.02391    0.01997    0.01299    0.02104   -0.00016
       C                -0.03660    0.02826    0.00790    0.02822    0.02445   -0.00319    0.00259    0.02471    0.01090
       C                 0.04269   -0.00889    0.00569   -0.02785   -0.01040    0.01084   -0.03015   -0.03668    0.00932
       C                 0.00325   -0.00736    0.01517   -0.05343   -0.00712    0.02053   -0.02152   -0.01662    0.03835
       C                 0.00916   -0.02450   -0.01217    0.02132    0.00949    0.02917   -0.00114    0.03670   -0.00101
       C                -0.01048    0.00121    0.00957    0.01713    0.02156    0.03084   -0.00617    0.03425    0.00900
       C                -0.01709    0.00784   -0.00627   -0.05609   -0.00669   -0.00711   -0.00208   -0.03276    0.04138
       H                -0.00513    0.02451   -0.02416   -0.04508   -0.00761   -0.03760   -0.01456   -0.04282    0.06643
       C                 0.00242   -0.01557    0.00601    0.03319   -0.00120    0.02221   -0.01181    0.04395   -0.00119
       H                 0.00554   -0.03070    0.01033    0.05707   -0.01522    0.01577   -0.02131    0.05591   -0.00090
       H                -0.00291   -0.01058    0.02317    0.03820    0.01063    0.03929   -0.01617    0.03492   -0.01363
       C                -0.00054    0.00551   -0.00539    0.00695   -0.01087   -0.00346   -0.00156    0.04206    0.01173
       C                -0.01676    0.00262   -0.00027   -0.02539   -0.00464    0.00752   -0.00047   -0.00357    0.00706
       H                -0.01723   -0.00736    0.01147   -0.02643    0.00468    0.03184   -0.00043   -0.00261    0.00775
       H                -0.02916    0.00521   -0.00354   -0.02592   -0.00660    0.00216    0.00129   -0.01644   -0.02331
       C                 0.06427   -0.03131    0.02906   -0.02118   -0.01625    0.03746   -0.03610   -0.03234   -0.02141
       O                 0.04113   -0.04399    0.05620   -0.03584   -0.02625    0.05447   -0.05769    0.02229    0.00501
       H                 0.01777    0.00826   -0.01073    0.00121   -0.01321   -0.00956    0.01868    0.05097    0.03859
       C                -0.01110    0.02458   -0.01396    0.01930   -0.02306   -0.03172   -0.01777    0.07230   -0.00464
       H                 0.00009    0.02786   -0.01806    0.04058   -0.02833   -0.04148   -0.01847    0.10756    0.00162
       H                -0.01328    0.03856   -0.02140   -0.00003   -0.02912   -0.04958   -0.00985    0.06678    0.00561
       H                -0.02842    0.02190   -0.00893    0.02685   -0.02107   -0.02569   -0.03800    0.06557   -0.03492
       C                -0.02891    0.02052   -0.01576    0.03025    0.02011   -0.02848    0.02641    0.00874   -0.00268
       C                -0.06863    0.06079    0.00822    0.07059    0.01101   -0.06368    0.00925    0.01821    0.01053
       H                -0.10692    0.09832    0.04436    0.09739    0.00911   -0.06875   -0.02290    0.03830    0.03148
       C                -0.06769    0.06111   -0.00968    0.08936    0.00003   -0.10012    0.02968    0.00443   -0.00139
       H                -0.07124    0.06029    0.04250    0.08908   -0.01399   -0.15370    0.02282   -0.01332    0.03085
       H                -0.10006    0.09927   -0.04210    0.14185   -0.00116   -0.08614    0.01925    0.03269   -0.02198
       H                -0.03262    0.02576   -0.04183    0.05591    0.00550   -0.09136    0.06194   -0.01625   -0.02174
       C                 0.02514   -0.03378   -0.06663   -0.00754    0.02317   -0.01703    0.07100   -0.01882   -0.03276
       H                 0.02801   -0.03656   -0.07862   -0.00969    0.02347   -0.03408    0.08742   -0.03088   -0.04096
       H                 0.02494   -0.03318   -0.12858   -0.00746    0.02265    0.01625    0.07619   -0.00110   -0.06821
       H                 0.06592   -0.07458   -0.03381   -0.03544    0.02561   -0.02328    0.08448   -0.04617   -0.01307
       C                 0.11672   -0.03846    0.01872    0.00552   -0.00939    0.04182   -0.00928   -0.10746   -0.09327
       H                 0.14077   -0.07027    0.02443    0.01173   -0.01842    0.05836   -0.01529   -0.09859   -0.11008
       H                 0.13693   -0.00359    0.00332    0.00989   -0.00068    0.03207   -0.01758   -0.10774   -0.16382
       H                 0.11010   -0.04521    0.02275    0.01446   -0.00322    0.03818    0.02801   -0.17554   -0.05952
       C                -0.05216    0.00517   -0.01039   -0.10073   -0.00764   -0.01159    0.03611   -0.06591    0.03324
       H                -0.05185    0.00836   -0.01411   -0.12308   -0.00857   -0.02188    0.03761   -0.08558    0.05804
       H                -0.06483   -0.01131    0.00667   -0.11192   -0.00612    0.01884    0.04983   -0.05864    0.00473
       H                -0.06649    0.01621   -0.02644   -0.10149   -0.00893   -0.03455    0.05075   -0.07868    0.03139
       H                 0.03053   -0.05284   -0.04878    0.01765    0.00420    0.02586    0.01525    0.03032   -0.01478
       H                -0.03256    0.03107    0.04606    0.02217    0.02756    0.03358   -0.02260    0.04071    0.02254
       H                -0.07266    0.06669    0.04552    0.04846    0.02600   -0.00841   -0.02437    0.04012    0.02989
       H                 0.02998   -0.04472   -0.05156   -0.00677    0.02218    0.02464    0.03945    0.00639   -0.01962
       H                -0.01354   -0.02056    0.04077   -0.07042   -0.00693    0.04916   -0.02410    0.00771    0.04759
       H                 0.06293    0.00405   -0.01990   -0.00913   -0.00978   -0.01619   -0.02674   -0.06493   -0.00398
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。


次に、`vibration_animation`内の虚振動を示す分子振動が示されたxyzファイル(`mode_1_XXXi_wave_number.xyz`)をAvogadroで確認すると、求められた遷移状態構造の中に、想定される反応系と生成系をつなぐ方向に振動している構造が存在しないことが確認された。

初期構造として採用した安定構造が反応に関わる箇所をs-trans体にしたために、SIに記載された2つのC-C結合を作るTS構造を求めるはずが、C-C結合, C-O結合を作る付加環化反応のTS構造を求めてしまった。



## 終わりに
　
　自作ライブラリで、UMAモデルのニューラルネットワークポテンシャル(NNP, `uma-s-1p1`)を用いて、BH9データセットの2. Pericyclic, No. 10の反応のある1つの遷移状態構造を算出する手順を説明した。



## 参考
- https://github.com/ss0832/MultiOptPy (自作ライブラリMultiOptPyのレポジトリ)
- https://avogadro.cc/ (Avogadro、分子構造可視化ツール)
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)
- _The Journal of Chemical Physics_ 2010, 132, 241102.
- _The Journal of Chemical Physics_ 1991, 94, 751–760.
- In _Classical and Quantum Dynamics in Condensed Phase Simulations_; WORLD SCIENTIFIC: LERICI, Villa Marigola, 1998; pp 385–404.
- _The Journal of Chemical Physics_, 2020, 153, 024109.
- _The Journal of Chemical Physics_, 2022, 144, 214108.
- _J. Phys. Chem. A_ 2019, 123, 3761−3781 http://dx.doi.org/10.1021/acs.jpca.9b01546 (MOBH35のデータセットについて)


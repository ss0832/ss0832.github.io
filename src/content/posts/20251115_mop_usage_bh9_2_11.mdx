---
title:  【計算化学】自作pythonライブラリで遷移状態構造を求めてみる(BH9データセットの2. Pericyclic, No. 11の化学反応, NNP(UMA)使用, 失敗例)
published: 2025-11-15
description: ""
tags: [MultiOptPy, python]
category: Computational Chemistry
draft: false
---
最終更新：2025-11-15

import MoleculeViewer from '../../components/MoleculeViewer.astro';
import MultiDataGraph from '../../components/MultiDataGraph.astro';

## 概要

本記事では、自作ライブラリ(MultiOptPy)で、BH9データセットの2. Pericyclic, No. 11の素過程の遷移状態構造を算出してみる。計算レベルは、Meta社のFAIR Chemistryが開発したニューラルネットワークポテンシャル(NNP)であるUMA(Meta’s Universal Model for Atoms)とした。

MultiOptPyは電子状態計算ソフトウェアを用いた分子構造最適化手法の勉強を目的として作成したpythonライブラリである。

MultiOptPyのレポジトリ:https://github.com/ss0832/MultiOptPy

BH9のデータセットについて:

- _J. Chem. Theory Comput._ 2022, 18, 1, 151–166 

https://doi.org/10.1021/acs.jctc.1c00694


この文献のSupporting Informationから、データセットの詳細を確認できる。

有機金属錯体が関わる反応を除いたさまざまなカテゴリの反応がまとめられたデータセットである。DFTの汎関数の電子エネルギーの精度の比較などのベンチマークに主に使われる。

今回使用したニューラルネットワークポテンシャルについて：
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)



## 使用した自作ライブラリMultiOptPyのバージョン
```
v1.19.6
```
## 環境
```
Windows 11
```
※Windows 11環境下でAnaconda PowerShell Promptを使用した。

## Source codeのダウンロード(Unixコマンド)
```
wget https://github.com/ss0832/MultiOptPy/archive/refs/tags/v1.19.6.zip
unzip v1.19.6.zip
cd MultiOptPy-v1.19.6
```
https://github.com/ss0832/MultiOptPy/releases/tag/v1.19.6 にアクセスしてzipファイルをダウンロードする。Unixコマンドの場合とはディレクトリ名が異なるので都度読み替えていただけると良い。

移動先のディレクトリで`requirements.txt`を参照することで、本ソースコードで必要なモジュールを把握することが出来る。導入方法は各自の状況に合わせて適宜LLMとの対話などで調べると良い。

次に述べる環境構築手順を使用する場合は、環境構築が終わった後、`pip install -r requirements.txt`で本自作モジュールが動作させるために最低限必要なモジュールを導入することが可能である。

### 環境構築手順

今回は、Windows 11のPower Shellを使用した。初めに、NNPを使用できる環境が整ったAnaconda PowerShell Promptを用意する手順を説明する。

1, https://repo.anaconda.com/archive/ より、`Anaconda3-2025.06-1-Windows-x86_64.exe`でAnacondaをインストールする。

2, 検索機能を使い、スタートから`Anaconda PowerShell Prompt`を開く。

3, 以下のコマンドを実行し、仮想環境を作成する。
```
conda create -n (任意の仮想環境名) python=3.12.7
```

4, 先ほど作成した仮想環境を`conda activate (仮想環境名)`で起動させる。

5, 以下のコマンドを実行し、必要なライブラリを導入する。
```
pip install ase==3.26.0 fairchem-core==2.7.1 torch==2.6.0
```
- fairchem-coreは、FAIR Chemistryが管理しているNNPを動作させるために必要なライブラリである。
- aseはNNPに電子エネルギーを算出したい分子構造を渡すために必要なインターフェイスの役割を果たすために必要なライブラリである。
- torchはPyTorchライブラリを指す。これはニューラルネットワークなどの機械学習を行ったり、学習結果を扱ったりするために必須なライブラリである。

これで、`Anaconda PowerShell Prompt`から仮想環境を立ち上げることで、NNPを使用する準備が整えることが出来る。

次に、NNPを使用するために必要なModelの情報が保存されている`.pt`ファイルのダウンロードおよびNNPの自作ライブラリへの導入方法について説明する。


1, 以下のサイトにアクセスして、`uma-s-1p1.pt`をダウンロードする。（使用許諾が下りていれば可能である。）
```
https://huggingface.co/facebook/UMA
```

2, ダウンロード後、`MultiOptPy-v1.19.6`ディレクトリ内に存在する`software_path.conf`に対して、`uma-s-1p1.pt`の絶対パスを用いて以下を追記する。
```
uma-s-1p1::(uma-s-1p1.ptの絶対パス)
```

これで、`MultiOptPy-v1.19.6`がNNP`uma-s-1p1`を使用できるようになる。


### 使用するNNPに関する具体的な説明

今回使用するNNPについて具体的に説明する。

- UMAのModel Checkpointは`uma-s-1p1`を使用した。
- 小分子系のトレーニングセットである`Omol25`(`omol`)を使用して学習したニューラルネットワークポテンシャルを使用する。

※自作ライブラリでの具体的な使用の仕方に関しては、`ase_calculation_tools.py` を参照すると良い。`omol`以外のモデルを使用したい場合は、現バージョンでは、`multioptpy/Calculator/ase_tools/firechem.py`内の、`self.task_name`を編集することで対応可能である。


## 手順

### 1. 初期構造の準備

モデル反応系として、以下の構造を用意した。今回はファイルの名前を`bh9_2_11.xyz`とした。
初期構造は以下のものを使用した。

```
47
OptimizedStructure
C     -1.563256650915     -1.208266097841      0.753424052631
C     -2.778414517895     -0.585458809598      1.451871081976
C     -3.214477933128      0.651020393230      0.732277633193
C      0.645909412629     -1.043199974278     -1.343759042446
C     -1.758850357331     -1.548690950833     -0.723293798264
H     -3.606127347135     -1.300637853546      1.451067904471
H     -1.282242857264     -2.120698601589      1.293348019594
H     -0.717915140491     -0.519748552365      0.853816987855
H     -2.031925274656     -0.629215143540     -1.255084332202
H     -0.116993803528     -2.953481874645     -0.782177938982
H     -0.649869470589     -2.386776910152     -2.359334400994
C     -0.446399787716     -2.065302749269     -1.332093081940
C     -2.874371356947     -2.567578133519     -0.930929443207
H     -2.966581544292     -2.834203573965     -1.985146298505
H     -3.841006344139     -2.183695015130     -0.602799452864
H     -2.667708554773     -3.484087364355     -0.370774311122
C     -4.426846155701      0.874465389647      0.236091692118
C      1.816968154673     -1.164775574205     -0.721354708159
C      4.030490183579     -0.286503217260     -0.104895460815
C      2.860444780298     -0.149317366325     -0.735951915679
C     -4.755039235984      2.146871430115     -0.464351372597
O     -3.932906079920      3.020079708584     -0.636661748753
C      5.116401451009      0.697688033498     -0.080107702016
C      6.229008061941      0.397296292536      0.599796662370
H      6.251733347992     -0.571076322116      1.093654850787
C      4.898095095860      1.983077284832     -0.826842092567
H      4.714312312272      1.785071940318     -1.885130360297
H      5.747927915526      2.655583635019     -0.754446923574
H      4.020442616651      2.506182614287     -0.440835189746
C      7.463382644197      1.222155914973      0.776031169487
H      8.336336280628      0.690014474637      0.390137337865
H      7.652817381083      1.403911955812      1.836760248021
H      7.411706016871      2.186217884794      0.275854251244
C     -6.175396262168      2.285776040075     -0.952528648010
H     -6.865822898392      2.202211640674     -0.110309466357
H     -6.411852190286      1.471901617696     -1.641708575110
H     -6.308436934580      3.243102294492     -1.448510820262
C     -2.432253482006     -0.247434368873      2.904378576882
H     -3.294448379662      0.160692167760      3.432263793728
H     -2.094702746130     -1.140298342337      3.433226170274
H     -1.628729923844      0.491324042257      2.945203004806
H     -5.212911228094      0.130815686501      0.328530189579
H     -2.469390520885      1.436070814363      0.608763100907
H      4.214712102303     -1.205675538160      0.446211856260
H      2.644730421012      0.755887572912     -1.295303425622
H      0.443350860343     -0.128584134416     -1.899128106597
H      2.026107939585     -2.072712360694     -0.159249967362
```

<MoleculeViewer 
  xyzData={`47
OptimizedStructure
C     -1.563256650915     -1.208266097841      0.753424052631
C     -2.778414517895     -0.585458809598      1.451871081976
C     -3.214477933128      0.651020393230      0.732277633193
C      0.645909412629     -1.043199974278     -1.343759042446
C     -1.758850357331     -1.548690950833     -0.723293798264
H     -3.606127347135     -1.300637853546      1.451067904471
H     -1.282242857264     -2.120698601589      1.293348019594
H     -0.717915140491     -0.519748552365      0.853816987855
H     -2.031925274656     -0.629215143540     -1.255084332202
H     -0.116993803528     -2.953481874645     -0.782177938982
H     -0.649869470589     -2.386776910152     -2.359334400994
C     -0.446399787716     -2.065302749269     -1.332093081940
C     -2.874371356947     -2.567578133519     -0.930929443207
H     -2.966581544292     -2.834203573965     -1.985146298505
H     -3.841006344139     -2.183695015130     -0.602799452864
H     -2.667708554773     -3.484087364355     -0.370774311122
C     -4.426846155701      0.874465389647      0.236091692118
C      1.816968154673     -1.164775574205     -0.721354708159
C      4.030490183579     -0.286503217260     -0.104895460815
C      2.860444780298     -0.149317366325     -0.735951915679
C     -4.755039235984      2.146871430115     -0.464351372597
O     -3.932906079920      3.020079708584     -0.636661748753
C      5.116401451009      0.697688033498     -0.080107702016
C      6.229008061941      0.397296292536      0.599796662370
H      6.251733347992     -0.571076322116      1.093654850787
C      4.898095095860      1.983077284832     -0.826842092567
H      4.714312312272      1.785071940318     -1.885130360297
H      5.747927915526      2.655583635019     -0.754446923574
H      4.020442616651      2.506182614287     -0.440835189746
C      7.463382644197      1.222155914973      0.776031169487
H      8.336336280628      0.690014474637      0.390137337865
H      7.652817381083      1.403911955812      1.836760248021
H      7.411706016871      2.186217884794      0.275854251244
C     -6.175396262168      2.285776040075     -0.952528648010
H     -6.865822898392      2.202211640674     -0.110309466357
H     -6.411852190286      1.471901617696     -1.641708575110
H     -6.308436934580      3.243102294492     -1.448510820262
C     -2.432253482006     -0.247434368873      2.904378576882
H     -3.294448379662      0.160692167760      3.432263793728
H     -2.094702746130     -1.140298342337      3.433226170274
H     -1.628729923844      0.491324042257      2.945203004806
H     -5.212911228094      0.130815686501      0.328530189579
H     -2.469390520885      1.436070814363      0.608763100907
H      4.214712102303     -1.205675538160      0.446211856260
H      2.644730421012      0.755887572912     -1.295303425622
H      0.443350860343     -0.128584134416     -1.899128106597
H      2.026107939585     -2.072712360694     -0.159249967362`}
  caption="初期経路を求めるための初期構造"
  backgroundColor="#333333"
/>


### 2. 遷移状態構造最適化

　`run_autots.py`を適切に使用することで、自動的に遷移状態構造が得られる。以下にその手順を説明していく。

初期構造をカレントディレクトリに`bh9_2_11.xyz`として保存する。その後、同じディレクトリ内で、`config_bh9_2_11.json`を作成し、以下のように記述する。

`config_bh9_2_11.json`
```json
{
  "work_dir": "bh9_2_11",
  "top_n_candidates": 3,
  "multioptpy_version": "v1.19.6b",
  
  "step1_settings": {
    "othersoft": "uma-s-1p1",
    "opt_method": ["rsirfo_block_fsb"],
    "use_model_hessian": "fischerd3",
    "spin_multiplicity": 1,
    "electronic_charge": 0,
	"manual_AFIR": ["200", "3", "4", "200", "17", "19"]
  },
  
  "step2_settings": {
    "othersoft": "uma-s-1p1",
    "NSTEP": 15,
    "ANEB": [3, 5],
    "QSM": true,
    "use_model_hessian": "fischerd3",
    "save_pict": true,
    "node_distance_bernstein": 0.80,
    "align_distances": 9999,
    "spin_multiplicity": 1,
    "electronic_charge": 0
  },
  
  "step3_settings": {
    "othersoft": "uma-s-1p1",
    "opt_method": ["rsirfo_block_bofill"],
    "calc_exact_hess": 5,
    "tight_convergence_criteria": true,
    "max_trust_radius": 0.2,
    "frequency_analysis": true,
	"NSTEP": 500,
	"detect_negative_eigenvalues": true,
    "spin_multiplicity": 1,
    "electronic_charge": 0
  },

  "step4_settings": {
    "othersoft": "uma-s-1p1",
	"opt_method": ["rsirfo_block_bofill"],
    "spin_multiplicity": 1,
    "electronic_charge": 0,
	"calc_exact_hess": 10,
    "tight_convergence_criteria": true,
    "frequency_analysis": true,
    
    "intrinsic_reaction_coordinates": ["0.5", "200", "lqa"],

    "step4b_opt_method": ["rsirfo_block_fsb"]
  }
}
```
その後、以下のコマンドを実行する。
```
python run_autots.py bh9_2_11.xyz -cfg config_bh9_2_11.json
```

これにより、これまでの似た内容の記事で行ってきたコマンドの操作をまとめ、遷移状態構造を求める処理を自動的に行う。

具体的な処理の流れは、
```
Step1. バイアスポテンシャルによるNEB法のための初期経路の作成

Step2. NEB法による経路の緩和

Step3. NEB法により得られた経路のエネルギー極大値を示す構造のうち、エネルギー値が上位の最大で3個
(`run_autots.py`にて、`--top_n X`で最大値を変更可能)の構造を初期構造とした遷移状態構造の算出

(Step4.得られた遷移状態構造に対するIRC計算とIRC経路の末端に存在する構造に対する構造最適化。
こちらは`--run_step4`をコマンドで追記しなければ行わない。)
```
となっている。

`run_autots.py`のオプションの説明：

- `-cfg YYY.json`は、workflowを実行するためのオプションが記されたJSONファイルの読み込み先を指定する。


これらの一連の結果は、`(jsonファイルの"work_dir"にて指定した名前)`のディレクトリの中に存在するファイルを開いて確認できる。

以下にすべてのstepで共通のオプションに関する説明を載せる。

- `"opt_method": ["rsirfo_block_fsb"]`は準ニュートン法であるRS-I-RFO法を構造最適化に使用することを示す。初期のへシアンに関しては、特にオプションで指定しない限り、単位行列が使われる。(以前のHessian更新法とは細かな点で異なる方法を使用している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `"spin_multiplicity": Z`はスピン多重度の指定である。PySCFを使用するときは目的とするスピン多重度に1を引いた値を指定する。（デフォルトでは1が指定される。）
- ` "electronic_charge": 0`は形式電荷をMとすることを示す。（デフォルトでは0が指定される。）
- `"othersoft": "uma-s-1p1"`は今回使用するNNPを指定している。これを使用する際にASEライブラリが必要である。
- `"use_model_hessian": "fischerd3"`は、計算コストが非常に低い数式を使用して、近似したHessianを生成する機能を呼び出すオプションである。デフォルトではこの機能は使用されない。


※オプションの説明は`MultiOptPy-v1.19.6/OPTION_README.md`にて示されている。


#### Step 1


Step1では、`omol`のデータセットを使用した`uma-s-1p1`モデルのNNPで得たエネルギーに対して、指定した人工力ポテンシャルを加えた上で初期構造を構造最適化を行っている。


以下のJSON内で記述したバイアスポテンシャルで、次の経路緩和アルゴリズムの初期経路として用いるトラジェクトリーを生成する。
- `"manual_AFIR": ["yyy", "a", "b]`：yyykJ/molの活性化障壁を超えうるペア同士を近づける力を原子のラベル番号aとbのペアに構造最適化時に加えることを示す。


Step1が正常終了していれば作成された`work_dir`ディレクトリ中に、`bh9_2_11_step1_traj.xyz`が存在する。必要に応じて確認し、目的に沿った初期経路が得られているか確認する。もし想定とは異なる場合は、プロセスをkillして再度設定を見直してやり直す。


`bh9_2_11_step1_traj.xyz`は構造最適化の過程をAvogadro（公式ページ:https://avogadro.cc/ ）等で可視化して確認できるようにしている。この`bh9_2_11_step1_traj.xyz`はStep2のNEB計算に使用している。

※`bh9_2_11_step1_traj.xyz`をアニメーションとして表示したい場合は、[https://github.com/ss0832/molecule_movie] を使うと良い。


#### Step 2

Step2では、NEB法を用いることで、先ほど得られた`bh9_2_11_step1_traj.xyz`全体のエネルギーを下げることができる。これにより、パスのエネルギー極大値を持つ構造を遷移状態構造に近づける。（この時点ではまだ正確な遷移状態構造は求められていない。）

Step2固有のオプションについて以下に示す。


- `"NSTEP": n`はn回分NEB法による経路の緩和を行うことを示す。
- `"align_distances": X`は線形補間で、各ノード間の距離を全て等しくするための処理である。X回の反復計算ごとに本処理を行う。Xを`"NSTEP": n`よりも大きな数値を指定することで、初期経路に対してのみ処理を行うことが出来る。
- `"node_distance_bernstein": N`はノード間の距離をN Åとして初期経路を作成することを示す。経路作成時に元のノードをベルンシュタイン多項式を用いてがたついた経路を滑らかにする。

→プログラムの仕様上`"align_distances": X`の処理を行った後に、`"node_distance_bernstein": N`の処理を行うようになっている。

- `"save_pict": true`は緩和中のパスのエネルギープロファイルや各ノードの勾配のRMS値をmatplotlibで可視化するオプションである。
- `"ANEB": [A, B]`これを指定すると、(B+1)回の緩和ごとに、エネルギー極大値を示すノードと前後のノードの間に線形補間でA個の新規ノードを内挿するようにできる。デフォルトではこのような操作は行われない。このオプションを使用するとノードの数が徐々に増えるため、計算コストが使用しない場合と比べて増加する。一方で、エネルギー極大値を示すノード周辺にノードを増加させるため、緩和している経路中のノードが遷移状態構造付近に存在する可能性が高くすることが出来る。


`MultiOptPy-v1.19.6/"work_dir"`と同じディレクトリ内に、NEBという名前を含むディレクトリが生成されている。
そのディレクトリ内の`energy_plot.csv`を確認し、緩和後のパスのエネルギー極大値を示す構造を確認する。

経路の緩和後の各ノードのエネルギー一覧(単位:hartree) (energy_plot.csvに保存されている。)

export const dataset1 = [-777.8590532282179,-777.8590532282179,-777.8459056132386,-777.8319779337447,-777.8213776042762,-777.8121213179671,-777.8034694193462,-777.7949236163685,-777.786652020117,-777.7802313017451,-777.7769359736084,-777.7764462833801,-777.7775785054358,-777.7792551543624,-777.7808372753042,-777.7821138094265,-777.7830348499838,-777.7835944171035,-777.7837360371323,-777.7833432186485,-777.782216444191,-777.7802709923276,-777.777637064378,-777.7745980405874,-777.7714381050885,-777.7687596084698,-777.7674123672833,-777.7675299276345,-777.7686959304939,-777.7703411336147,-777.7716919298683,-777.7721591134335,-777.7719750231672,-777.771685150489,-777.7710474748438,-777.7684302861566,-777.7609413391267,-777.7473922753715,-777.7394623130162,-777.7557170453941,-777.7819356793187,-777.7963971796241,-777.8019876857885,-777.8064946171459,-777.8112912897556,-777.8154367914839,-777.8182917184369,-777.8203079036497,-777.8218722558273,-777.8227461671034,-777.8229588578077,-777.8229435160396,-777.8233463185009,-777.8233311519671];

export const dataset1_itr5 = [-777.8590532019329,-777.8590532194562,-777.8503781811381,-777.8394967582329,-777.8303863589093,-777.8217360373976,-777.8132798930801,-777.8048972157679,-777.7970891844922,-777.7911635294721,-777.7884203363278,-777.7884387008887,-777.7900734928982,-777.7920280043779,-777.7938594224818,-777.795384294358,-777.7964790710214,-777.7971270964459,-777.7973788994594,-777.7972203868384,-777.7964751851995,-777.7950324544294,-777.7929845912251,-777.7906686720206,-777.7883406879304,-777.7861911318463,-777.784742224065,-777.7847436084164,-777.7854268822325,-777.7866807103626,-777.7877046616786,-777.7879622868536,-777.7883317071694,-777.7876191429301,-777.7862778334267,-777.7829779513871,-777.7742619432756,-777.7591834646934,-777.748257671353,-777.7628011189115,-777.7864764571927,-777.8002786338382,-777.8068569229466,-777.8123629398642,-777.8175049249227,-777.8217042060761,-777.8247396945135,-777.8269802936094,-777.8288993464165,-777.8295363320764,-777.8297088765888,-777.8299416316273,-777.8293384136286,-777.8296483769261];

export const dataset1_itr10 = [-777.8590531931711,-777.8590532194562,-777.8540177286992,-777.84538634126,-777.8372269738544,-777.8291549870623,-777.8209535020784,-777.8122966487059,-777.8041919456589,-777.7979860558504,-777.7979945853829,-777.7976206571632,-777.7968397077149,-777.7955909482387,-777.7962482085139,-777.7965932143026,-777.7966574245529,-777.796278624818,-777.7984201025981,-777.8006687975213,-777.8027542835426,-777.8044738232693,-777.8056690530295,-777.8063664901628,-777.8066708328181,-777.8066185560277,-777.8060438749444,-777.8048179660287,-777.8029920897116,-777.8008793372239,-777.7986931177309,-777.7964932036725,-777.7961263680636,-777.7957662176453,-777.7954385250115,-777.7950861374756,-777.7950484095179,-777.7950380838332,-777.7950551209939,-777.7950950525236,-777.7958086944542,-777.7970451086699,-777.7978815636015,-777.7979126195111,-777.7983072385277,-777.7977051245055,-777.7964076674006,-777.7928203747257,-777.7833563918915,-777.768064182151,-777.7649004046388,-777.7601604981047,-777.756682009539,-777.7546041286889,-777.7545841464957,-777.7570619384403,-777.7614166995652,-777.7667461393896,-777.788486758912,-777.8015167127802,-777.8083602541392,-777.8138745421187,-777.8189587305044,-777.8229956307382,-777.8257698359832,-777.8278310914734,-777.8292694764315,-777.8300803559083,-777.8303110344198,-777.8304196621993,-777.8304023578064,-777.8302757947899,-777.8304524485482,-777.830330380293,-777.8302275965792,-777.8302074446278,-777.8301919188635,-777.8299881651117];

export const dataset2 = [-777.8590532019329,-777.8590531756477,-777.8559045296223,-777.8493278701935,-777.8419170163562,-777.8343451484272,-777.8262967306566,-777.8179273448707,-777.8097109123958,-777.8083881952579,-777.8068539220582,-777.8052455291052,-777.8028812364555,-777.8023039662846,-777.8024789158886,-777.8022795868043,-777.8028767197899,-777.802811874315,-777.8018872458342,-777.8010486880902,-777.8006995117238,-777.8003751748279,-777.7999401905764,-777.8001330666555,-777.8002539214126,-777.8003808086125,-777.800948059759,-777.8021777712603,-777.8018302990481,-777.8011595676313,-777.8011516689426,-777.8009836717617,-777.801480150131,-777.8026264676006,-777.803234947011,-777.8037671907131,-777.8041587694137,-777.8065018411824,-777.8087454455474,-777.8105924419857,-777.8118358130055,-777.8125603238473,-777.8129042957531,-777.8129356583227,-777.8124424349317,-777.8113270901353,-777.8096378002399,-777.8076472123862,-777.8055510940202,-777.8035022451227,-777.8030878509084,-777.8028041245755,-777.8020715967617,-777.8016070592354,-777.8010768175858,-777.8010618131437,-777.801007153166,-777.8008634434675,-777.8009926043333,-777.8010330177575,-777.8010224555064,-777.8010191041493,-777.8010095407342,-777.8010016420454,-777.8009913251225,-777.8009778408384,-777.8009860943768,-777.8009917062572,-777.800920127402,-777.8016650924745,-777.802915056687,-777.8040920095034,-777.804792789232,-777.8047967144818,-777.8047787923875,-777.8047620794105,-777.804768558701,-777.8050608058046,-777.8051518531972,-777.8051705857503,-777.8050424587672,-777.8047442624569,-777.8035722162026,-777.7985221590893,-777.7900555357571,-777.7792022554901,-777.7743642867131,-777.7681043962461,-777.7629025577016,-777.7578675236491,-777.757463712495,-777.7572357194501,-777.7572991170512,-777.7575464417315,-777.7579663930654,-777.7584938517743,-777.7592494250969,-777.760092710883,-777.7646364885501,-777.7692197213287,-777.7896759430866,-777.8020880731724,-777.8090061767515,-777.8143407312289,-777.819199712796,-777.8233172208354,-777.8261207427889,-777.8280968957123,-777.8293057324205,-777.8301106889761,-777.8303533535176,-777.8304669579531,-777.8304956175327,-777.8304987104192,-777.8305063681606,-777.8304986490871,-777.8304905006894,-777.8305157256755,-777.8305318998069,-777.8305381031032,-777.8305446919152,-777.8304966777006,-777.830453105677,-777.8304334969521,-777.8303655673525,-777.8301200990612];

<MultiDataGraph datasets={[ { data: dataset1, label: "緩和前の経路のエネルギー", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_itr5, label: "ITR. 5の経路のエネルギー", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_itr10, label: "ITR. 10の経路のエネルギー", color: "rgba(81, 143, 18, 1)"}, { data: dataset2, label: "緩和後の経路のエネルギー", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="Electronic Energy [hartree]" height="500px" />

export const dataset1_grad = [2.4894542366954294e-06,2.489549414935998e-06,0.005299859429134513,0.006499402870688575,0.006654875992495172,0.006649648451046825,0.006638925410787633,0.006690108904521152,0.006810115271356804,0.006913279923947673,0.006966487251531379,0.006992750618993835,0.007032226971458357,0.007110054801558287,0.007222950947125953,0.0073452921396114585,0.007430945919497887,0.007450123478137484,0.007412835908227604,0.007355253028745788,0.007325679660561154,0.007367507978329512,0.007513069119507891,0.007813905626675516,0.008260522637605397,0.008645984172399139,0.00870129386831007,0.008419313761958083,0.008044749117547602,0.007752923266820141,0.007582131603508434,0.007550234318070802,0.007661956956074877,0.007830479886553207,0.007912945855468813,0.007956983790553927,0.00815379653317134,0.007912701100313066,0.006110028866464507,0.0059970552747730865,0.004749578170061103,0.0048334270642272905,0.006337703457211755,0.006967716492648316,0.007016153895947925,0.006967024762149236,0.006978711297960306,0.00699128007058395,0.006987677453795852,0.006990191060291823,0.0070238377566681385,0.00709213611178098,0.006977678317705345,0.00697565632131355];

export const dataset1_grad_itr5 = [1.622511171680396e-06,7.253317060833371e-07,0.00364663646355614,0.004728060163567893,0.004966601688626544,0.005030533987157953,0.005058515715537491,0.004915099853702142,0.004621745245541537,0.004423990981148871,0.004394277832235887,0.004515129096123286,0.00454635397442906,0.004601271236385319,0.004672979339343929,0.004760647082240392,0.004866052117227947,0.004982786098802002,0.0051494469069967895,0.0051537241132329,0.004985172099232879,0.004784213400576677,0.0046529325831423975,0.004598487556217017,0.004486450062220965,0.00448573164665941,0.004732420931982346,0.0046868481427619554,0.004858471122032332,0.004915951167533653,0.005001893281949301,0.005132778490687136,0.004622492781259183,0.0047070459816470605,0.005160826092874572,0.005473228980721445,0.005978308608497556,0.006174989903653767,0.0039216320440597285,0.0033552758751218686,0.0025062231457351337,0.0023187536971167634,0.003106856298733489,0.003170426827760547,0.0029194691477433146,0.0026985542757930565,0.002404892921134428,0.001998625701039801,0.0009895431030014531,0.001535431997631802,0.0016901821875982754,0.0013556061612392824,0.0024021457875950006,0.0010021261764439871];

export const dataset1_grad_itr10 = [8.066318691569623e-07,3.10786904545899e-07,0.0022873215331876916,0.003442132177527349,0.0037134643364183113,0.0037751489591984263,0.003843851018910772,0.0038485481360960782,0.0035564018674850975,0.0034340635656607177,0.0033990094836536732,0.003387118972862458,0.0033311685044937153,0.0033120398040954614,0.0033430717562994263,0.003399937883899844,0.0034220645441290346,0.0034086290148129515,0.003368589878951976,0.003366078073984483,0.0034165854469296775,0.0035086702504359014,0.003628558866812843,0.0037612925286730314,0.003958238244577151,0.003992523622747494,0.0037592088560054,0.0034756223806180256,0.003340858961441435,0.0032736192076603127,0.0031473099168027392,0.0033015584725774,0.0033529432802309263,0.0034098657598902317,0.0034304619944155634,0.003546112037393783,0.0035588053785357227,0.00357082007233416,0.003551144764170543,0.003531040882951773,0.0035354106227841295,0.003489007700445052,0.0036602130132402434,0.00384607565552735,0.003399029986273257,0.0035790085080337117,0.004147093508023163,0.004277636738180652,0.004976144001494556,0.005384584122830352,0.005176038678191382,0.004801612539271404,0.003992485892954281,0.0031358540552254136,0.002647329508885623,0.0028554892339070015,0.0028309212796958105,0.0026438576407541124,0.0020325687680490603,0.0015113139068629862,0.0017082239288977155,0.001579278022816521,0.0011622288266711872,0.0011365166504952713,0.0011652288169038936,0.0008732194697045744,0.0003404995984770969,0.00034569713658164243,0.00044435803582209963,0.00047706108605017006,0.0007863074158814947,0.001267491190990229,0.0006256107705381171,0.0007380887522807877,0.0008307889840317145,0.0006164247363092097,0.00044245757734823,0.000486336512462129];

export const dataset2_grad = [1.0637534841009324e-06,1.3732381511023833e-07,0.0015180057954934621,0.002466617153508611,0.002751851333056992,0.0028951854638461045,0.0029257041048114454,0.0030325117844679328,0.002875652646614315,0.002853420416654853,0.0028297633262688478,0.002789922647446583,0.002742887254251776,0.0029190213427247994,0.0029067321274638884,0.0029006319167977656,0.002727288361504517,0.0027179335733774233,0.0028097074365286473,0.0028243423110592704,0.0028128593669749158,0.0028015614690047306,0.002740842853850582,0.0027487702778063003,0.002775353204807129,0.0027905659956618876,0.002757070080512907,0.002696099351193291,0.0027496595858258056,0.002878822790012658,0.0028601740351181,0.002807433627140662,0.0026272915672245233,0.0026307217136831633,0.002647256382326817,0.002664028873454884,0.002681641687458798,0.002668197463394015,0.0027330894447975475,0.0028390705467116824,0.0029506820340069197,0.0030647752047344343,0.0032265353459466966,0.0032367784782858923,0.0030201041321744385,0.00278574276008418,0.002723594891822987,0.0027369238118526177,0.002680251442451317,0.0027917815039891244,0.002890043136125796,0.002896937678138095,0.003129301228817439,0.003005648720062732,0.0030333103180378703,0.003042184641813198,0.003042066153616063,0.003216902948807849,0.003059221074428492,0.003047654622564354,0.0030387262538774727,0.0030294319732767716,0.0030473469644072835,0.0030589805009996755,0.003060674374095449,0.0030695792187276647,0.0030664184012865895,0.0030416892976566122,0.003049157597593072,0.002783269083405796,0.002864485249030632,0.00277878288001306,0.0029206342120204763,0.0029326952154873722,0.002976755788085729,0.003009420411445163,0.002987257575320483,0.0027352400662203325,0.002746055173015299,0.002678907086539697,0.0026996086408879105,0.002868736906744833,0.0033108785727919807,0.0034793991190366085,0.004151103958845246,0.00440520523820144,0.004509186929810269,0.004406493076720569,0.003802565246195274,0.002857740403893205,0.002645248960173904,0.0024556988465562566,0.0023942566447503564,0.002340510113871182,0.002334452121723002,0.0023326350627519894,0.0023537053691481545,0.0023227632545123507,0.0022952511513821736,0.0021365605669951726,0.0018143185788122124,0.001242723221141837,0.0008391252020703651,0.0009032884066718954,0.000754288464270809,0.0005046985214119477,0.0005970969746503337,0.0002579372054632207,0.00035994841499973647,9.174943963318525e-05,0.00011744600959662937,0.00019000995980110444,0.0001811018361354885,0.00025779578382527753,0.00025934171017736674,0.00035348184054443413,0.00040694714794107265,0.0003239194316204877,0.00023903465986006487,0.0002056831734594806,0.0001528238188651865,0.00024399505964274712,0.00035145408199584356,0.0002737859179161939,0.00023195984232702972,0.00037225339979713237];

<MultiDataGraph datasets={[ { data: dataset1_grad, label: "緩和前の経路の勾配のRMS値", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_grad_itr5, label: "ITR. 5の経路の勾配のRMS値", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_grad_itr10, label: "ITR. 10の経路の勾配のRMS値", color: "rgba(81, 143, 18, 1)"},  { data: dataset2_grad, label: "緩和後の経路の勾配のRMS値", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="RMS of gradient [hartree/Bohr]" height="500px" />

※`bias_force_rms.csv`にて、各Iterationごとのすべてのノードの勾配のRMS値を確認できる。

経路緩和の結果、以下の構造がstep3の初期構造として用いられることとなった。"work_dir"内の`bh9_2_11_step3_TS_Opt_Inputs`内に保存された`bh9_2_11_ts_guess_X.xyz`にて確認が可能である。ts_guessの番号が小さい順にエネルギー値が高い構造を示すようになっている。

※こちら[https://ss0832.github.io/molecule_viewer/] を使うことでも可視化は可能である。


`bh9_2_11_ts_guess_1.xyz`
```
47
0 1
C      -2.191283297223     -2.500175668666      0.993742512631
C      -1.960996542017     -1.003679111421      1.202539612974
C      -0.691403026153     -0.508039908030      0.503811731845
C      -0.912262838977     -1.177017469300     -1.283735318371
C      -2.693332231260     -2.817425945510     -0.401216574586
H      -2.823006447629     -0.457243251493      0.805694604810
H      -2.902235220700     -2.862045368332      1.740172952741
H      -1.250269247937     -3.038182772764      1.174868442177
H      -3.536109125807     -2.147653121031     -0.613234749430
H      -0.809557759475     -3.310225545205     -1.285036968509
H      -1.955085577231     -2.621724278805     -2.413713055753
C      -1.575487296265     -2.534186515276     -1.390401921856
C      -3.179023771048     -4.253756393386     -0.539023786579
H      -3.555976281782     -4.444706177905     -1.545641834591
H      -3.981626238520     -4.471218938127      0.167590360507
H      -2.364586844600     -4.957459413359     -0.350152421959
C      -0.463926793292      0.886974644215      0.283900814875
C       0.445712441733     -1.095538746908     -1.636288960120
C       1.688333557747      0.648808820498     -0.692025002029
C       1.050278431089      0.160552345241     -1.813459083746
C       0.190700308234      1.917004072041      1.059200547565
O       0.811314958816      1.753966967038      2.103784080469
C       2.594346154141      1.808170313320     -0.651702809220
C       3.370108877603      1.934872291533      0.432400430767
H       3.185417720459      1.250221590612      1.253964767254
C       2.720949016286      2.645747938008     -1.891142707337
H       3.110633675380      2.036637259696     -2.710069695938
H       3.397123600800      3.485099490932     -1.749246496117
H       1.757536981468      3.043876144552     -2.215720632202
C       4.479455405842      2.905286540128      0.677788379523
H       5.399328697233      2.367500340499      0.921884084302
H       4.240868014185      3.523771274303      1.545222114945
H       4.689027294581      3.561505576110     -0.163905061616
C       0.036194788706      3.299511363054      0.439446927296
H      -0.889520412498      3.761982053705      0.786963220181
H      -0.011377459081      3.231557862592     -0.646678643034
H       0.877718645614      3.925345647785      0.721373940736
C      -1.849533776806     -0.734544728549      2.705608291576
H      -1.707518400169      0.319387856496      2.936448311162
H      -2.752810328501     -1.092140496235      3.205522524304
H      -1.002728303624     -1.283723130526      3.126319247663
H      -1.210693439658      1.344172801652     -0.366841783847
H       0.158411045450     -1.025071907962      0.960861686362
H       1.831905752606     -0.030490942462      0.146417893591
H       0.728024782090      0.853319381527     -2.584437856755
H      -1.552048196397     -0.353547540494     -1.603850304011
H       1.059008706589     -1.945475203786     -1.348001812648
```

<MoleculeViewer 
  xyzData={`47
0 1
C      -2.191283297223     -2.500175668666      0.993742512631
C      -1.960996542017     -1.003679111421      1.202539612974
C      -0.691403026153     -0.508039908030      0.503811731845
C      -0.912262838977     -1.177017469300     -1.283735318371
C      -2.693332231260     -2.817425945510     -0.401216574586
H      -2.823006447629     -0.457243251493      0.805694604810
H      -2.902235220700     -2.862045368332      1.740172952741
H      -1.250269247937     -3.038182772764      1.174868442177
H      -3.536109125807     -2.147653121031     -0.613234749430
H      -0.809557759475     -3.310225545205     -1.285036968509
H      -1.955085577231     -2.621724278805     -2.413713055753
C      -1.575487296265     -2.534186515276     -1.390401921856
C      -3.179023771048     -4.253756393386     -0.539023786579
H      -3.555976281782     -4.444706177905     -1.545641834591
H      -3.981626238520     -4.471218938127      0.167590360507
H      -2.364586844600     -4.957459413359     -0.350152421959
C      -0.463926793292      0.886974644215      0.283900814875
C       0.445712441733     -1.095538746908     -1.636288960120
C       1.688333557747      0.648808820498     -0.692025002029
C       1.050278431089      0.160552345241     -1.813459083746
C       0.190700308234      1.917004072041      1.059200547565
O       0.811314958816      1.753966967038      2.103784080469
C       2.594346154141      1.808170313320     -0.651702809220
C       3.370108877603      1.934872291533      0.432400430767
H       3.185417720459      1.250221590612      1.253964767254
C       2.720949016286      2.645747938008     -1.891142707337
H       3.110633675380      2.036637259696     -2.710069695938
H       3.397123600800      3.485099490932     -1.749246496117
H       1.757536981468      3.043876144552     -2.215720632202
C       4.479455405842      2.905286540128      0.677788379523
H       5.399328697233      2.367500340499      0.921884084302
H       4.240868014185      3.523771274303      1.545222114945
H       4.689027294581      3.561505576110     -0.163905061616
C       0.036194788706      3.299511363054      0.439446927296
H      -0.889520412498      3.761982053705      0.786963220181
H      -0.011377459081      3.231557862592     -0.646678643034
H       0.877718645614      3.925345647785      0.721373940736
C      -1.849533776806     -0.734544728549      2.705608291576
H      -1.707518400169      0.319387856496      2.936448311162
H      -2.752810328501     -1.092140496235      3.205522524304
H      -1.002728303624     -1.283723130526      3.126319247663
H      -1.210693439658      1.344172801652     -0.366841783847
H       0.158411045450     -1.025071907962      0.960861686362
H       1.831905752606     -0.030490942462      0.146417893591
H       0.728024782090      0.853319381527     -2.584437856755
H      -1.552048196397     -0.353547540494     -1.603850304011
H       1.059008706589     -1.945475203786     -1.348001812648`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.1)"
  backgroundColor="#333333"
/>

`bh9_2_11_ts_guess_2.xyz`
```
47
0 1
C      -1.547418937017     -1.926786774926      0.892664785721
C      -2.141399292502     -0.611627369620      1.406260878460
C      -1.806020899733      0.610617386465      0.565772598622
C      -0.138416965242     -0.632990295742     -1.359224104332
C      -2.004059703435     -2.094314480921     -0.572777121694
H      -3.215494624002     -0.755669904456      1.271716038287
H      -1.885284215180     -2.755830995148      1.517680056966
H      -0.457960134394     -1.912100605674      0.966852095893
H      -2.577714522336     -1.208391364692     -0.826853997249
H      -0.033036579952     -2.740819241395     -1.246266812539
H      -1.062100907274     -2.126556683772     -2.538719732819
C      -0.783298541455     -1.984740497895     -1.493509713675
C      -3.001988712487     -3.219491325714     -0.813525655614
H      -3.219846987335     -3.314278158455     -1.879217994340
H      -3.941218768594     -2.940006502273     -0.325327308394
H      -2.708119648157     -4.191394297959     -0.423046002660
C      -2.817077796848      1.032304284725     -0.196928253501
C       0.996684082615     -0.497011158189     -0.679510188113
C       2.986809018519      0.455757093016      0.202569690586
C       1.899874454343      0.639531137693     -0.556331170317
C      -3.339852665793      2.270763438777     -0.834498824325
O      -2.727196354738      3.246687071992     -1.191877661801
C       4.287395882446      1.129908047461      0.136372387805
C       5.329264882658      0.555736342310      0.755942379846
H       5.137200932887     -0.332727052146      1.353387550601
C       4.430314715036      2.285309060539     -0.809346677980
H       4.330141537452      1.928728972369     -1.838003593761
H       5.398915042086      2.768281562683     -0.719999955328
H       3.657889052925      3.035403858156     -0.643399921282
C       6.774188341991      0.945297171224      0.689235273117
H       7.371182760393      0.156613175952      0.219885677706
H       7.181984527552      1.077700320688      1.693565964167
H       6.956352909918      1.861359509461      0.133168985933
C      -4.863255111344      2.175569116485     -0.897447769829
H      -5.246343385493      2.004464613367      0.113591785942
H      -5.171962125936      1.301033744970     -1.478592384339
H      -5.316449274146      3.070505090271     -1.308567373884
C      -1.960680653054     -0.247736889611      2.875550204402
H      -2.780777638632      0.409331721081      3.173252684611
H      -1.992075037868     -1.133092830210      3.507866904267
H      -1.031761114971      0.290184274217      3.063191287284
H      -3.646620703944      0.331833162055     -0.197433708104
H      -0.873515538257      1.141353325622      0.695295595098
H       2.993724194416     -0.445750702027      0.811181297428
H       1.777691463430      1.511717630342     -1.190760721278
H      -0.611425801024      0.234525105875     -1.806522379930
H       1.392758842475     -1.399199086971     -0.217315095653
```

<MoleculeViewer 
  xyzData={`47
0 1
C      -1.547418937017     -1.926786774926      0.892664785721
C      -2.141399292502     -0.611627369620      1.406260878460
C      -1.806020899733      0.610617386465      0.565772598622
C      -0.138416965242     -0.632990295742     -1.359224104332
C      -2.004059703435     -2.094314480921     -0.572777121694
H      -3.215494624002     -0.755669904456      1.271716038287
H      -1.885284215180     -2.755830995148      1.517680056966
H      -0.457960134394     -1.912100605674      0.966852095893
H      -2.577714522336     -1.208391364692     -0.826853997249
H      -0.033036579952     -2.740819241395     -1.246266812539
H      -1.062100907274     -2.126556683772     -2.538719732819
C      -0.783298541455     -1.984740497895     -1.493509713675
C      -3.001988712487     -3.219491325714     -0.813525655614
H      -3.219846987335     -3.314278158455     -1.879217994340
H      -3.941218768594     -2.940006502273     -0.325327308394
H      -2.708119648157     -4.191394297959     -0.423046002660
C      -2.817077796848      1.032304284725     -0.196928253501
C       0.996684082615     -0.497011158189     -0.679510188113
C       2.986809018519      0.455757093016      0.202569690586
C       1.899874454343      0.639531137693     -0.556331170317
C      -3.339852665793      2.270763438777     -0.834498824325
O      -2.727196354738      3.246687071992     -1.191877661801
C       4.287395882446      1.129908047461      0.136372387805
C       5.329264882658      0.555736342310      0.755942379846
H       5.137200932887     -0.332727052146      1.353387550601
C       4.430314715036      2.285309060539     -0.809346677980
H       4.330141537452      1.928728972369     -1.838003593761
H       5.398915042086      2.768281562683     -0.719999955328
H       3.657889052925      3.035403858156     -0.643399921282
C       6.774188341991      0.945297171224      0.689235273117
H       7.371182760393      0.156613175952      0.219885677706
H       7.181984527552      1.077700320688      1.693565964167
H       6.956352909918      1.861359509461      0.133168985933
C      -4.863255111344      2.175569116485     -0.897447769829
H      -5.246343385493      2.004464613367      0.113591785942
H      -5.171962125936      1.301033744970     -1.478592384339
H      -5.316449274146      3.070505090271     -1.308567373884
C      -1.960680653054     -0.247736889611      2.875550204402
H      -2.780777638632      0.409331721081      3.173252684611
H      -1.992075037868     -1.133092830210      3.507866904267
H      -1.031761114971      0.290184274217      3.063191287284
H      -3.646620703944      0.331833162055     -0.197433708104
H      -0.873515538257      1.141353325622      0.695295595098
H       2.993724194416     -0.445750702027      0.811181297428
H       1.777691463430      1.511717630342     -1.190760721278
H      -0.611425801024      0.234525105875     -1.806522379930
H       1.392758842475     -1.399199086971     -0.217315095653`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.2)"
  backgroundColor="#333333"
/>

`bh9_2_11_ts_guess_3.xyz`
```
47
0 1
C      -1.805589803584     -2.383007017513      0.965948201702
C      -1.736485117645     -0.945244655813      1.498053740012
C      -0.803898248015     -0.000984826346      0.804736408786
C      -0.880807515068     -1.038309277419     -1.652785891472
C      -2.513210918828     -2.565710739031     -0.382200931057
H      -2.744965190301     -0.522914063371      1.466835591373
H      -2.335607900351     -2.967881397073      1.723846853880
H      -0.795332685237     -2.809731142756      0.911506588200
H      -3.323426861741     -1.828249104306     -0.438656008737
H      -0.815077394282     -3.148898246418     -1.557080688124
H      -2.140989246068     -2.472182066999     -2.502887917110
C      -1.568748787056     -2.356053230288     -1.579970544333
C      -3.127265944811     -3.959671161911     -0.483518931398
H      -3.632300516729     -4.099911086787     -1.440718861145
H      -3.853012250741     -4.135574003646      0.311923938698
H      -2.350626759241     -4.725086500278     -0.402007261493
C      -1.185425624839      1.220518950116      0.461197413792
C       0.442681145759     -0.893041611722     -1.592317120856
C       1.911434007791      0.639079439683     -0.403092465045
C       1.197238331617      0.384819936314     -1.508817172232
C      -0.699868551716      2.492010175941     -0.154237707231
O       0.333896016900      3.069492476085      0.051469889435
C       2.932853202943      1.653991777814     -0.173470939356
C       3.769647740266      1.370631152698      0.829304456618
H       3.507559422998      0.522531844304      1.459265133472
C       3.114552198264      2.772738854979     -1.148124697564
H       3.311129700153      2.372237181255     -2.144537469705
H       3.947176166819      3.413325566687     -0.870010520899
H       2.215678382681      3.386256516307     -1.201643761782
C       5.104086703131      1.966208664669      1.118604187402
H       5.879224646075      1.246129674339      0.841504571706
H       5.228109039727      2.166460555523      2.181802234448
H       5.294250879054      2.881200182273      0.563901590844
C      -1.782551593366      3.138211007437     -0.992390469237
H      -2.565910595545      3.472884118612     -0.310105215674
H      -2.239836126447      2.424196426072     -1.678464238851
H      -1.401536091712      3.999213330860     -1.530675965903
C      -1.209312911241     -0.931710687889      2.934303600734
H      -1.200225444546      0.085131679418      3.325278847596
H      -1.819690236052     -1.561638377247      3.579938493613
H      -0.185159666709     -1.308210947945      2.957628604092
H      -2.259441886831      1.314519175688      0.520417398113
H       0.192040722896     -0.403454743886      0.758970994792
H       1.849064598559     -0.060403503597      0.421572904994
H       1.208051860822      1.077096363795     -2.344015452352
H      -1.503887186519     -0.158041426962     -1.742341894234
H       1.041516288768     -1.792975231668     -1.453939518511
```

<MoleculeViewer 
  xyzData={`47
0 1
C      -1.805589803584     -2.383007017513      0.965948201702
C      -1.736485117645     -0.945244655813      1.498053740012
C      -0.803898248015     -0.000984826346      0.804736408786
C      -0.880807515068     -1.038309277419     -1.652785891472
C      -2.513210918828     -2.565710739031     -0.382200931057
H      -2.744965190301     -0.522914063371      1.466835591373
H      -2.335607900351     -2.967881397073      1.723846853880
H      -0.795332685237     -2.809731142756      0.911506588200
H      -3.323426861741     -1.828249104306     -0.438656008737
H      -0.815077394282     -3.148898246418     -1.557080688124
H      -2.140989246068     -2.472182066999     -2.502887917110
C      -1.568748787056     -2.356053230288     -1.579970544333
C      -3.127265944811     -3.959671161911     -0.483518931398
H      -3.632300516729     -4.099911086787     -1.440718861145
H      -3.853012250741     -4.135574003646      0.311923938698
H      -2.350626759241     -4.725086500278     -0.402007261493
C      -1.185425624839      1.220518950116      0.461197413792
C       0.442681145759     -0.893041611722     -1.592317120856
C       1.911434007791      0.639079439683     -0.403092465045
C       1.197238331617      0.384819936314     -1.508817172232
C      -0.699868551716      2.492010175941     -0.154237707231
O       0.333896016900      3.069492476085      0.051469889435
C       2.932853202943      1.653991777814     -0.173470939356
C       3.769647740266      1.370631152698      0.829304456618
H       3.507559422998      0.522531844304      1.459265133472
C       3.114552198264      2.772738854979     -1.148124697564
H       3.311129700153      2.372237181255     -2.144537469705
H       3.947176166819      3.413325566687     -0.870010520899
H       2.215678382681      3.386256516307     -1.201643761782
C       5.104086703131      1.966208664669      1.118604187402
H       5.879224646075      1.246129674339      0.841504571706
H       5.228109039727      2.166460555523      2.181802234448
H       5.294250879054      2.881200182273      0.563901590844
C      -1.782551593366      3.138211007437     -0.992390469237
H      -2.565910595545      3.472884118612     -0.310105215674
H      -2.239836126447      2.424196426072     -1.678464238851
H      -1.401536091712      3.999213330860     -1.530675965903
C      -1.209312911241     -0.931710687889      2.934303600734
H      -1.200225444546      0.085131679418      3.325278847596
H      -1.819690236052     -1.561638377247      3.579938493613
H      -0.185159666709     -1.308210947945      2.957628604092
H      -2.259441886831      1.314519175688      0.520417398113
H       0.192040722896     -0.403454743886      0.758970994792
H       1.849064598559     -0.060403503597      0.421572904994
H       1.208051860822      1.077096363795     -2.344015452352
H      -1.503887186519     -0.158041426962     -1.742341894234
H       1.041516288768     -1.792975231668     -1.453939518511`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.3)"
  backgroundColor="#333333"
/>


#### Step 3

step3のオプションで、追加での説明を要するものを以下に示す。

- `"opt_method": ["rsirfo_block_bofill"]`は遷移状態構造の最適化向けのoptimizerを指定することを意味する。準ニュートン法であるRS-I-RFO法を使用する。今回は`-fc`で正確なHessianを計算するようにしているので、初期Hessianは正確なHessianを使用するようになっている。(Bofill法によるHessianの更新法を細かい点で変更している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `"saddle_order": 1`は一次の鞍点を求めることを指定する。（step3のデフォルトでは一次の鞍点を指定する。それ以外の値の指定は、プログラムの使用目的上想定していないので、行わないことを勧める。）
- `"calc_exact_hess": 5`は5回の反復回数当たり1回正確なHessianを計算することを指定する。
- `"frequency_analysis": true`は収束条件を満たした後に基準振動解析を行うことを示す。（自前で実装しているため、あくまで目安として使用することを推奨する。各振動モードを`vibration_animation`内のxyzファイルで可視化できる。）UMAモデルから算出されるHessianは数値微分により求めているため、原子数Zが多いとZの二乗オーダーで計算コストが急増する。
- `"tight_convergence_criteria": true`は収束条件を厳しくすることを示す。（Gaussianのtightと同等）
- `"max_trust_radius": D`は一回の反復計算ごとの計算されるステップ幅の最大値をDÅ以下にすることを示す。デフォルトでは、`"saddle_order": 1`を指定すると0.1Åが指定される。
- `"detect_negative_eigenvalues": true`は、初めの計算時(ITR. 0)に、任意の次数の鞍点(遷移状態構造等)を求める際に、正確なへシアンから算出した固有値に１つも負の固有値がない場合、計算を打ち切るオプションである。

実行して得られた正確な遷移状態構造と思われる構造を以下に示す。

(実行して得られた正確な遷移状態構造は計算開始時に、`MultiOptPy-v1.19.6/"work_dir"`ディレクトリ内に生成された新規ディレクトリ内の`bh9_2_11_ts_final_X.xyz`として保存されている。)

`bh9_2_11_ts_final_1.xyz`
```
47
OptimizedStructure
C     -3.186977004901     -2.329452252676      0.419220426973
C     -2.968265636152     -0.846390217976      0.714072425982
C     -1.527493768290     -0.557971131189      1.095881860427
C     -0.514246714052     -1.172939804244     -0.441893707103
C     -2.349853940528     -2.893796807725     -0.721992424405
H     -3.215335474240     -0.264531330611     -0.182366098347
H     -4.246946433655     -2.497378261861      0.204380770867
H     -2.965188211792     -2.897582789758      1.332312734056
H     -2.632083961830     -2.365801665079     -1.642833430847
H     -0.546256700590     -3.132165812475      0.440271902895
H     -0.296773735261     -3.129056850602     -1.296455505113
C     -0.861737367976     -2.647885486864     -0.491595951593
C     -2.632222077619     -4.378523323939     -0.915858853622
H     -2.065682515348     -4.783507436381     -1.756223655455
H     -3.691970220295     -4.559192564934     -1.103972258922
H     -2.351991151974     -4.941013588641     -0.021389063030
C     -1.138606400031      0.744070601960      1.456181463800
C      0.816693585540     -0.802930930037     -0.255909717623
C      2.606729664656      0.798288451649     -0.729005914042
C      1.316976235284      0.435969070188     -0.791860884328
C      0.182026362550      0.899132444980      1.883921063417
O      0.951338838539     -0.101896486464      1.890854702470
C      3.164632073776      2.050905312940     -1.227610214985
C      4.476085065378      2.263064400344     -1.049946737120
H      5.033779757052      1.472758625392     -0.554280181262
C      2.223469069949      3.021328917597     -1.883086276255
H      1.743982915486      2.565801222929     -2.752042436932
H      2.724824697874      3.926583264098     -2.213112352651
H      1.428330619150      3.309241448124     -1.191274423707
C      5.286565182695      3.454656976921     -1.442860540031
H      6.091697139636      3.158921039353     -2.119829258424
H      5.765225790623      3.892235799842     -0.563562932388
H      4.703200187000      4.231319189795     -1.931011454284
C      0.748094445864      2.255153887764      2.226065901121
H      1.171890193645      2.228167342752      3.230762902564
H     -0.003195416012      3.043177304966      2.174187314680
H      1.564222187347      2.483685743433      1.535579979885
C     -3.905320106759     -0.410774306638      1.841785430580
H     -3.836570309541      0.658329596005      2.035810400005
H     -4.940816584488     -0.650118571278      1.591344132327
H     -3.652605024325     -0.934409914976      2.766768651904
H     -1.768675282616      1.604225227915      1.262946381212
H     -1.073965962926     -1.321773010929      1.725397141561
H      3.304396107288      0.123358978152     -0.240552680730
H      0.584146237597      1.091310224870     -1.251093667025
H     -1.047602284997     -0.567622955329     -1.172976645700
H      1.532075929273     -1.524969571364      0.116851679197
```

<MoleculeViewer 
  xyzData={`47
OptimizedStructure
C     -3.186977004901     -2.329452252676      0.419220426973
C     -2.968265636152     -0.846390217976      0.714072425982
C     -1.527493768290     -0.557971131189      1.095881860427
C     -0.514246714052     -1.172939804244     -0.441893707103
C     -2.349853940528     -2.893796807725     -0.721992424405
H     -3.215335474240     -0.264531330611     -0.182366098347
H     -4.246946433655     -2.497378261861      0.204380770867
H     -2.965188211792     -2.897582789758      1.332312734056
H     -2.632083961830     -2.365801665079     -1.642833430847
H     -0.546256700590     -3.132165812475      0.440271902895
H     -0.296773735261     -3.129056850602     -1.296455505113
C     -0.861737367976     -2.647885486864     -0.491595951593
C     -2.632222077619     -4.378523323939     -0.915858853622
H     -2.065682515348     -4.783507436381     -1.756223655455
H     -3.691970220295     -4.559192564934     -1.103972258922
H     -2.351991151974     -4.941013588641     -0.021389063030
C     -1.138606400031      0.744070601960      1.456181463800
C      0.816693585540     -0.802930930037     -0.255909717623
C      2.606729664656      0.798288451649     -0.729005914042
C      1.316976235284      0.435969070188     -0.791860884328
C      0.182026362550      0.899132444980      1.883921063417
O      0.951338838539     -0.101896486464      1.890854702470
C      3.164632073776      2.050905312940     -1.227610214985
C      4.476085065378      2.263064400344     -1.049946737120
H      5.033779757052      1.472758625392     -0.554280181262
C      2.223469069949      3.021328917597     -1.883086276255
H      1.743982915486      2.565801222929     -2.752042436932
H      2.724824697874      3.926583264098     -2.213112352651
H      1.428330619150      3.309241448124     -1.191274423707
C      5.286565182695      3.454656976921     -1.442860540031
H      6.091697139636      3.158921039353     -2.119829258424
H      5.765225790623      3.892235799842     -0.563562932388
H      4.703200187000      4.231319189795     -1.931011454284
C      0.748094445864      2.255153887764      2.226065901121
H      1.171890193645      2.228167342752      3.230762902564
H     -0.003195416012      3.043177304966      2.174187314680
H      1.564222187347      2.483685743433      1.535579979885
C     -3.905320106759     -0.410774306638      1.841785430580
H     -3.836570309541      0.658329596005      2.035810400005
H     -4.940816584488     -0.650118571278      1.591344132327
H     -3.652605024325     -0.934409914976      2.766768651904
H     -1.768675282616      1.604225227915      1.262946381212
H     -1.073965962926     -1.321773010929      1.725397141561
H      3.304396107288      0.123358978152     -0.240552680730
H      0.584146237597      1.091310224870     -1.251093667025
H     -1.047602284997     -0.567622955329     -1.172976645700
H      1.532075929273     -1.524969571364      0.116851679197`}
  caption="遷移状態構造 (No.1)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                     -577.5100             20.7745             34.1001
Reduced mass [au]                   9.2144              3.7994              3.3385
Force const [Dyne/A]               -1.8106              0.0010              0.0023
Char temp [K]                       0.0000             29.8899             49.0624
Normal mode                   x         y         z            x         y         z            x         y         z     
       C                -0.00353   -0.00177   -0.00311    0.00933   -0.02406   -0.01169    0.00873   -0.03039    0.03607
       C                 0.00778   -0.00344   -0.00883   -0.01481   -0.02576    0.01392   -0.00803   -0.03208    0.05476
       C                 0.06868   -0.06142   -0.12019   -0.02123   -0.00641    0.02205   -0.00228   -0.00741    0.01351
       C                -0.09617    0.05513    0.14763    0.00037    0.02676    0.01304   -0.02376    0.02181   -0.01618
       C                 0.00158   -0.00057   -0.00210    0.01906    0.01004   -0.02111   -0.01679    0.00689   -0.00022
       H                -0.01075   -0.00777   -0.00934   -0.02285   -0.01477    0.02329   -0.04999   -0.02083    0.07363
       H                -0.00229   -0.00670   -0.00723    0.01208   -0.03696   -0.01518    0.00478   -0.04470    0.06673
       H                -0.00355   -0.00053   -0.00236    0.01791   -0.03678   -0.02167    0.04773   -0.04344    0.01851
       H                -0.00008   -0.00104   -0.00205    0.01479    0.02528   -0.01106   -0.04783    0.02551    0.01997
       H                 0.00564   -0.01359   -0.01240    0.01677    0.01247   -0.01800    0.01269    0.00662   -0.04794
       H                 0.02139    0.07789   -0.01694    0.02369    0.04281   -0.01675   -0.02862    0.03842   -0.05371
       C                 0.00093    0.01748    0.00546    0.01509    0.02400   -0.01149   -0.01426    0.01940   -0.03222
       C                 0.00377   -0.00076   -0.00145    0.03886    0.01033   -0.05238   -0.00327    0.00798   -0.02829
       H                 0.00348   -0.00438   -0.00030    0.04630    0.03511   -0.05929   -0.02097    0.03543   -0.05345
       H                 0.00351    0.00156   -0.00254    0.04171    0.00036   -0.05880   -0.00610   -0.00083   -0.00387
       H                 0.00066    0.00068    0.00031    0.04396   -0.00450   -0.06328    0.02811   -0.01012   -0.04949
       C                 0.02396    0.00863   -0.00005   -0.04306   -0.00354    0.03051   -0.01993    0.00069    0.00208
       C                 0.00486    0.03909    0.10030   -0.00419    0.03273    0.03004   -0.02149    0.01954   -0.02715
       C                 0.00315   -0.00264   -0.00178    0.01174    0.00655    0.00324   -0.00639    0.00123   -0.00944
       C                -0.00131   -0.00794    0.00283    0.00263    0.03370    0.03782   -0.00765    0.00975   -0.03755
       C                -0.03366    0.01262   -0.02559   -0.04518    0.01755    0.03094   -0.01395    0.02873   -0.02701
       O                 0.00666   -0.02646   -0.07526   -0.02807    0.03120    0.02701    0.00455    0.04311   -0.03511
       C                -0.00250   -0.00209   -0.00226    0.02556   -0.00482   -0.01088    0.02057   -0.01093   -0.00841
       C                -0.00067   -0.00223    0.00038    0.04004   -0.04466   -0.07129    0.01115   -0.00855    0.05934
       H                -0.00066   -0.00119    0.00195    0.03971   -0.06332   -0.10063   -0.01693    0.00021    0.10485
       C                -0.00200   -0.00120   -0.00020    0.02452    0.02541    0.03518    0.05647   -0.02355   -0.07822
       H                -0.00133    0.00191   -0.00198   -0.01755    0.04748    0.04673    0.08671   -0.04880   -0.08158
       H                -0.00079   -0.00126    0.00241    0.03372    0.01781    0.02830    0.07856   -0.03965   -0.08896
       H                -0.00107   -0.00264    0.00097    0.05616    0.03545    0.06724    0.03151    0.00798   -0.11995
       C                -0.00160   -0.00200    0.00088    0.05827   -0.06873   -0.10719    0.03307   -0.01488    0.08576
       H                -0.00122   -0.00527    0.00308    0.01312   -0.09153   -0.15100    0.07698   -0.02651    0.14312
       H                -0.00198   -0.00594    0.00267    0.11868   -0.08855   -0.13026   -0.02408    0.00428    0.10741
       H                -0.00082   -0.00195    0.00103    0.05810   -0.04741   -0.07311    0.06188   -0.02614    0.03332
       C                -0.00043   -0.00837    0.00272   -0.06820    0.02634    0.03442   -0.03238    0.04228   -0.05020
       H                 0.00053   -0.01463    0.00289   -0.07060    0.03206    0.03557   -0.00841    0.05829   -0.05988
       H                 0.00601   -0.00079    0.01132   -0.08069    0.01429    0.03310   -0.04896    0.02714   -0.03898
       H                 0.00215   -0.00271    0.00551   -0.06959    0.03972    0.03724   -0.05293    0.05296   -0.07096
       C                 0.01782    0.00054   -0.00203   -0.02346   -0.05989    0.02010    0.02352   -0.07086    0.09637
       H                 0.01147    0.00052    0.00091   -0.03983   -0.06223    0.03894    0.00895   -0.07290    0.11273
       H                 0.01679    0.00145   -0.00067   -0.01938   -0.07136    0.01427    0.01934   -0.08810    0.13011
       H                 0.01721   -0.00034   -0.00208   -0.01693   -0.07235    0.01128    0.06831   -0.08202    0.07787
       H                -0.02952   -0.01480    0.07643   -0.05665   -0.01292    0.03263   -0.04142   -0.01278    0.01181
       H                -0.07669   -0.00557    0.06562   -0.00817   -0.00577    0.01322    0.02871    0.00065    0.00100
       H                 0.00242    0.00411    0.00793    0.01298   -0.01355   -0.02617   -0.02753    0.00394    0.02438
       H                -0.00723   -0.01084    0.01253    0.00248    0.05117    0.06253    0.00677    0.00699   -0.06437
       H                 0.03928   -0.01249   -0.01544   -0.00071    0.03385    0.01984   -0.03508    0.02852   -0.00244
       H                 0.01271   -0.01899   -0.03028   -0.00552    0.03027    0.02836   -0.02570    0.01592   -0.02564
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。

`bh9_2_11_ts_final_2.xyz`
```
47
OptimizedStructure
C     -1.790588189853     -1.947263297633      0.922298039507
C     -2.710388606734     -0.880519434175      1.532856524342
C     -2.356955700335      0.456075466058      0.959901658936
C      0.174662576520     -1.411011381976     -1.383693932862
C     -2.053416765393     -2.216981490911     -0.562779604908
H     -3.750511354980     -1.111810836693      1.278488407465
H     -1.902801479605     -2.880665471255      1.484466408683
H     -0.756634943054     -1.617851399740      1.065797533322
H     -2.427733351493     -1.291113723716     -1.014911584697
H     -0.265246507559     -3.417414904317     -0.792805469113
H     -1.010349389435     -2.922180666231     -2.309094118375
C     -0.755349732942     -2.579861278541     -1.300430439097
C     -3.112993291341     -3.298659053579     -0.745220146707
H     -3.377719464534     -3.423608475293     -1.796568772458
H     -4.025891137982     -3.058282184101     -0.196201730868
H     -2.745785490355     -4.259338692776     -0.374448178503
C     -3.158234177733      1.239109936274      0.245273288874
C      1.374025505400     -1.334889576592     -0.809769181792
C      3.418948955335     -0.079028277831     -0.265746388688
C      2.219811171724     -0.150242478442     -0.851026477668
C     -2.683296541725      2.542874884902     -0.295533999999
O     -1.541614838758      2.923987476789     -0.155034327642
C      4.301171836711      1.091665936760     -0.256710684364
C      5.478033376553      0.993321702579      0.372376353652
H      5.703296434850      0.037254038807      0.838687175724
C      3.811556199476      2.327084211284     -0.957909023665
H      3.631465453545      2.121240174821     -2.015426290996
H      4.517861698496      3.149688160142     -0.892264242435
H      2.863394856931      2.660655623991     -0.530809397119
C      6.541046825315      2.033598944382      0.524632418271
H      7.482210753482      1.684027177705      0.093064605922
H      6.736147771686      2.228627763281      1.582009816152
H      6.287429424746      2.979266951102      0.051748557837
C     -3.708252042536      3.364073773185     -1.037280284183
H     -4.553752073780      3.581700569472     -0.381028814312
H     -4.098901998804      2.793267270206     -1.882806787724
H     -3.262279059929      4.290218523311     -1.388858187179
C     -2.565794902129     -0.850621110487      3.055326216640
H     -3.207426055356     -0.090244163219      3.501301183522
H     -2.829809620548     -1.818969608748      3.483024264820
H     -1.533621085554     -0.628548656236      3.336107936171
H     -4.182459223173      0.946300500488      0.034260780326
H     -1.340664604904      0.805919857861      1.137100411766
H      3.791604683873     -0.955647819537      0.258998496315
H      1.817579368119      0.708850636260     -1.378917015123
H     -0.198420284997     -0.540453738466     -1.921039830255
H      1.756645022757     -2.193601859167     -0.261405167515
```

<MoleculeViewer 
  xyzData={`47
OptimizedStructure
C     -1.790588189853     -1.947263297633      0.922298039507
C     -2.710388606734     -0.880519434175      1.532856524342
C     -2.356955700335      0.456075466058      0.959901658936
C      0.174662576520     -1.411011381976     -1.383693932862
C     -2.053416765393     -2.216981490911     -0.562779604908
H     -3.750511354980     -1.111810836693      1.278488407465
H     -1.902801479605     -2.880665471255      1.484466408683
H     -0.756634943054     -1.617851399740      1.065797533322
H     -2.427733351493     -1.291113723716     -1.014911584697
H     -0.265246507559     -3.417414904317     -0.792805469113
H     -1.010349389435     -2.922180666231     -2.309094118375
C     -0.755349732942     -2.579861278541     -1.300430439097
C     -3.112993291341     -3.298659053579     -0.745220146707
H     -3.377719464534     -3.423608475293     -1.796568772458
H     -4.025891137982     -3.058282184101     -0.196201730868
H     -2.745785490355     -4.259338692776     -0.374448178503
C     -3.158234177733      1.239109936274      0.245273288874
C      1.374025505400     -1.334889576592     -0.809769181792
C      3.418948955335     -0.079028277831     -0.265746388688
C      2.219811171724     -0.150242478442     -0.851026477668
C     -2.683296541725      2.542874884902     -0.295533999999
O     -1.541614838758      2.923987476789     -0.155034327642
C      4.301171836711      1.091665936760     -0.256710684364
C      5.478033376553      0.993321702579      0.372376353652
H      5.703296434850      0.037254038807      0.838687175724
C      3.811556199476      2.327084211284     -0.957909023665
H      3.631465453545      2.121240174821     -2.015426290996
H      4.517861698496      3.149688160142     -0.892264242435
H      2.863394856931      2.660655623991     -0.530809397119
C      6.541046825315      2.033598944382      0.524632418271
H      7.482210753482      1.684027177705      0.093064605922
H      6.736147771686      2.228627763281      1.582009816152
H      6.287429424746      2.979266951102      0.051748557837
C     -3.708252042536      3.364073773185     -1.037280284183
H     -4.553752073780      3.581700569472     -0.381028814312
H     -4.098901998804      2.793267270206     -1.882806787724
H     -3.262279059929      4.290218523311     -1.388858187179
C     -2.565794902129     -0.850621110487      3.055326216640
H     -3.207426055356     -0.090244163219      3.501301183522
H     -2.829809620548     -1.818969608748      3.483024264820
H     -1.533621085554     -0.628548656236      3.336107936171
H     -4.182459223173      0.946300500488      0.034260780326
H     -1.340664604904      0.805919857861      1.137100411766
H      3.791604683873     -0.955647819537      0.258998496315
H      1.817579368119      0.708850636260     -1.378917015123
H     -0.198420284997     -0.540453738466     -1.921039830255
H      1.756645022757     -2.193601859167     -0.261405167515`}
  caption="遷移状態構造 (No.2)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                      -14.5204             19.3926             24.3396
Reduced mass [au]                   5.5029              3.4612              3.5957
Force const [Dyne/A]               -0.0007              0.0008              0.0013
Char temp [K]                       0.0000             27.9016             35.0193
Normal mode                   x         y         z            x         y         z            x         y         z     
       C                 0.01731    0.02917   -0.00632   -0.03471   -0.00679    0.01138   -0.00562    0.00335   -0.00541
       C                -0.00903    0.00512   -0.00412   -0.05264   -0.01344   -0.00297   -0.02276   -0.00753   -0.01194
       C                -0.04216    0.01618    0.00128   -0.03678   -0.00902    0.01739   -0.00963    0.00274    0.02028
       C                 0.03721   -0.00555   -0.00184   -0.00421    0.03423    0.04641    0.02125   -0.04279   -0.01067
       C                 0.02405    0.02290   -0.00566   -0.00761   -0.00223    0.00557    0.00780   -0.00084   -0.00629
       H                -0.00341   -0.01902   -0.00460   -0.04497   -0.01262   -0.03522   -0.01572   -0.00472   -0.04280
       H                 0.04127    0.02531   -0.00765   -0.04054   -0.00910    0.00628    0.00092    0.00127   -0.00727
       H                 0.00941    0.05453   -0.00718   -0.03882   -0.00237    0.03147   -0.00993    0.01428    0.00126
       H                 0.03582    0.02369   -0.01391   -0.01509   -0.00513    0.00584    0.03139    0.00355   -0.01718
       H                 0.01514    0.00542    0.01862    0.01106    0.02250    0.01738   -0.00099   -0.02276    0.04310
       H                 0.02899   -0.00480    0.00865    0.02615    0.03193    0.01338    0.01795   -0.05868    0.02217
       C                 0.02576    0.00423    0.00638    0.00763    0.02291    0.02134    0.01126   -0.03270    0.01495
       C                 0.01605    0.03068   -0.00594    0.01119   -0.01689   -0.01669   -0.00979    0.01719   -0.01177
       H                 0.02248    0.02641   -0.00703    0.02818   -0.01419   -0.02130   -0.00020    0.01616   -0.01404
       H                 0.01389    0.04070   -0.01412   -0.00024   -0.03379   -0.02823   -0.01185    0.03564   -0.02343
       H                 0.00601    0.02997    0.00223    0.01999   -0.01379   -0.01743   -0.03056    0.01273   -0.00271
       C                -0.06129   -0.00094    0.00399   -0.00817   -0.01453   -0.02075    0.01477    0.00646   -0.00299
       C                 0.03405   -0.00929    0.00525    0.00555    0.02591    0.02710    0.00870   -0.02429    0.01311
       C                 0.04093   -0.01892    0.00387    0.02280    0.01283   -0.00607   -0.00401    0.00165    0.00939
       C                 0.04541   -0.01778   -0.00542    0.00051    0.03000    0.03746    0.01267   -0.02836   -0.02090
       C                -0.09435    0.01460    0.01215    0.01014   -0.01296   -0.00093    0.02741    0.01944    0.03888
       O                -0.10701    0.04783    0.02438   -0.00114   -0.00194    0.06089    0.01026    0.04042    0.12059
       C                 0.05014   -0.02574   -0.00601    0.02451    0.01160   -0.00793   -0.00659    0.00397   -0.02550
       C                 0.04390   -0.02545    0.00563    0.05532   -0.01182   -0.06922   -0.02892    0.04282    0.02225
       H                 0.03259   -0.02037    0.02150    0.07619   -0.02776   -0.11198   -0.04282    0.06979    0.08425
       C                 0.06560   -0.03199   -0.02783   -0.00698    0.03581    0.05663    0.01521   -0.03649   -0.11211
       H                 0.06942   -0.04641   -0.02565   -0.05020    0.07372    0.05659    0.04506   -0.09860   -0.10510
       H                 0.07280   -0.03751   -0.03655   -0.00601    0.03493    0.05721    0.01465   -0.03377   -0.14048
       H                 0.06650   -0.01657   -0.03787    0.00987    0.01833    0.10761    0.00384   -0.00966   -0.15820
       C                 0.05027   -0.03116   -0.00000    0.06610   -0.01990   -0.08907   -0.03831    0.05523    0.00326
       H                 0.05154   -0.04443    0.01355    0.04253   -0.00792   -0.15024   -0.01982    0.03275    0.06187
       H                 0.04218   -0.01732   -0.00107    0.12203   -0.05643   -0.09266   -0.08159    0.11844   -0.00040
       H                 0.06157   -0.03609   -0.01591    0.04418   -0.00315   -0.04382   -0.02240    0.02650   -0.06268
       C                -0.11129   -0.01331    0.00469    0.04454   -0.02661   -0.06350    0.06291    0.00543   -0.02573
       H                -0.12342   -0.03899   -0.00240    0.00540   -0.03054   -0.11264    0.01437   -0.01387   -0.08185
       H                -0.08732   -0.02266   -0.00007    0.09761   -0.03514   -0.08228    0.13066    0.00365   -0.05585
       H                -0.13474    0.00030    0.01083    0.05597   -0.02458   -0.04367    0.07006    0.01576    0.01056
       C                -0.01031    0.00383   -0.00387   -0.09612   -0.02733    0.00117   -0.06338   -0.03189   -0.00759
       H                -0.02855   -0.01277   -0.00180   -0.10771   -0.03041   -0.01019   -0.07256   -0.03657   -0.01278
       H                 0.01247   -0.00376   -0.00700   -0.10983   -0.03072   -0.01502   -0.07839   -0.03763   -0.02993
       H                -0.01570    0.02743   -0.00272   -0.10381   -0.03143    0.03272   -0.07012   -0.04000    0.02366
       H                -0.05309   -0.02678    0.00007    0.00390   -0.02146   -0.06969    0.02709    0.00012   -0.05395
       H                -0.05164    0.04191    0.00474   -0.04742   -0.00221    0.06464   -0.02046    0.00929    0.06905
       H                 0.02909   -0.01388    0.02063    0.04379   -0.00324   -0.04782   -0.01823    0.02921    0.06546
       H                 0.05800   -0.02243   -0.02258   -0.01956    0.04552    0.07795    0.02856   -0.05431   -0.07514
       H                 0.04934   -0.00943   -0.01652   -0.01840    0.04640    0.07579    0.03872   -0.06309   -0.05560
       H                 0.02206   -0.00532    0.01976    0.02111    0.01319   -0.00376   -0.00670   -0.00212    0.05846
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。

`bh9_2_11_ts_final_3.xyz`
```
47
OptimizedStructure
C     -1.868417131172     -2.397812827082      0.895816253382
C     -2.401689601924     -1.285111771038      1.819832487463
C     -1.450287963594     -0.132361550121      1.739289690521
C     -0.329910823761     -1.521003419599     -1.831041895465
C     -2.343199264858     -2.271992456262     -0.558314315952
H     -3.387081837908     -0.971495990272      1.459330600145
H     -2.176685639597     -3.374364046438      1.283962387200
H     -0.775452314987     -2.382035853034      0.940618834894
H     -2.565710680145     -1.215872324269     -0.749706828881
H     -0.671296089243     -3.525616988719     -1.136218925435
H     -1.686349729492     -3.027223351767     -2.481548343193
C     -1.233455777158     -2.682385265602     -1.548350281598
C     -3.623268189143     -3.073763914526     -0.772528099473
H     -4.040063987225     -2.902486034080     -1.766393311290
H     -4.384772370648     -2.804730193415     -0.036703856904
H     -3.425275115386     -4.143905494754     -0.669601410502
C     -1.584968345500      0.974228477237      1.018379812651
C      0.791153438224     -1.217462262340     -1.180159051914
C      2.525233953655      0.441795151094     -0.619982378728
C      1.540506595739      0.010594417615     -1.413042200460
C     -0.479896984342      1.972869887636      0.964005735533
O      0.443613802187      1.955595156557      1.747396352946
C      3.274912517783      1.689495221741     -0.785464600014
C      4.172544771548      2.016037899847      0.150597928760
H      4.284926446856      1.322656017715      0.979887976118
C      2.967582939770      2.524749136235     -1.996207661089
H      3.118160107870      1.946299335305     -2.910428119271
H      3.588182254865      3.414403506143     -2.055380332622
H      1.923003970943      2.845459567164     -1.987947491837
C      5.037768109455      3.232314452012      0.225991031077
H      6.091122553842      2.949234727296      0.290671092000
H      4.810718658898      3.801678894794      1.130741265595
H      4.921193523752      3.897992157327     -0.626031703087
C     -0.570918013861      3.001636494168     -0.134421727666
H     -1.488769446707      3.583815179426     -0.024363054863
H     -0.621756014613      2.497974856669     -1.103028333561
H      0.293527432281      3.659740493774     -0.099523781611
C     -2.527982253594     -1.768502736412      3.263241240448
H     -2.863839908561     -0.968487682274      3.924041567942
H     -3.239475326204     -2.592705197104      3.331533273880
H     -1.563181708181     -2.125725290751      3.631384908177
H     -2.469146569881      1.154366513558      0.414696190507
H     -0.517680827147     -0.247798652651      2.289977148986
H      2.794967500303     -0.159958963497      0.244279549828
H      1.232429119583      0.603264801077     -2.269838003669
H     -0.689775901834     -0.815926093547     -2.578785501993
H      1.168760119110     -1.887473984841     -0.410664116968
```

<MoleculeViewer 
  xyzData={`47
OptimizedStructure
C     -1.868417131172     -2.397812827082      0.895816253382
C     -2.401689601924     -1.285111771038      1.819832487463
C     -1.450287963594     -0.132361550121      1.739289690521
C     -0.329910823761     -1.521003419599     -1.831041895465
C     -2.343199264858     -2.271992456262     -0.558314315952
H     -3.387081837908     -0.971495990272      1.459330600145
H     -2.176685639597     -3.374364046438      1.283962387200
H     -0.775452314987     -2.382035853034      0.940618834894
H     -2.565710680145     -1.215872324269     -0.749706828881
H     -0.671296089243     -3.525616988719     -1.136218925435
H     -1.686349729492     -3.027223351767     -2.481548343193
C     -1.233455777158     -2.682385265602     -1.548350281598
C     -3.623268189143     -3.073763914526     -0.772528099473
H     -4.040063987225     -2.902486034080     -1.766393311290
H     -4.384772370648     -2.804730193415     -0.036703856904
H     -3.425275115386     -4.143905494754     -0.669601410502
C     -1.584968345500      0.974228477237      1.018379812651
C      0.791153438224     -1.217462262340     -1.180159051914
C      2.525233953655      0.441795151094     -0.619982378728
C      1.540506595739      0.010594417615     -1.413042200460
C     -0.479896984342      1.972869887636      0.964005735533
O      0.443613802187      1.955595156557      1.747396352946
C      3.274912517783      1.689495221741     -0.785464600014
C      4.172544771548      2.016037899847      0.150597928760
H      4.284926446856      1.322656017715      0.979887976118
C      2.967582939770      2.524749136235     -1.996207661089
H      3.118160107870      1.946299335305     -2.910428119271
H      3.588182254865      3.414403506143     -2.055380332622
H      1.923003970943      2.845459567164     -1.987947491837
C      5.037768109455      3.232314452012      0.225991031077
H      6.091122553842      2.949234727296      0.290671092000
H      4.810718658898      3.801678894794      1.130741265595
H      4.921193523752      3.897992157327     -0.626031703087
C     -0.570918013861      3.001636494168     -0.134421727666
H     -1.488769446707      3.583815179426     -0.024363054863
H     -0.621756014613      2.497974856669     -1.103028333561
H      0.293527432281      3.659740493774     -0.099523781611
C     -2.527982253594     -1.768502736412      3.263241240448
H     -2.863839908561     -0.968487682274      3.924041567942
H     -3.239475326204     -2.592705197104      3.331533273880
H     -1.563181708181     -2.125725290751      3.631384908177
H     -2.469146569881      1.154366513558      0.414696190507
H     -0.517680827147     -0.247798652651      2.289977148986
H      2.794967500303     -0.159958963497      0.244279549828
H      1.232429119583      0.603264801077     -2.269838003669
H     -0.689775901834     -0.815926093547     -2.578785501993
H      1.168760119110     -1.887473984841     -0.410664116968`}
  caption="遷移状態構造 (No.3)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                      -24.4799             22.4286             36.3403
Reduced mass [au]                   3.6392              4.1355              3.4974
Force const [Dyne/A]               -0.0013              0.0012              0.0027
Char temp [K]                       0.0000             32.2698             52.2856
Normal mode                   x         y         z            x         y         z            x         y         z     
       C                -0.01668    0.00265   -0.00024    0.02547    0.00473   -0.00759    0.00044    0.00358   -0.00705
       C                -0.01701    0.00788   -0.00620    0.05613    0.00675    0.00696    0.00192    0.03288   -0.04130
       C                 0.00337   -0.00736    0.01513    0.05337    0.00730   -0.02067    0.02136    0.01674   -0.03833
       C                 0.00907   -0.02444   -0.01233   -0.02144   -0.00937   -0.02914    0.00121   -0.03670    0.00090
       C                -0.00057    0.00553   -0.00535   -0.00695    0.01077    0.00352    0.00159   -0.04206   -0.01189
       H                -0.00512    0.02460   -0.02403    0.04519    0.00752    0.03745    0.01434    0.04302   -0.06638
       H                -0.02903    0.00524   -0.00343    0.02613    0.00666   -0.00214   -0.00126    0.01635    0.02336
       H                -0.01712   -0.00733    0.01140    0.02646   -0.00440   -0.03200    0.00039    0.00262   -0.00772
       H                 0.01768    0.00830   -0.01073   -0.00133    0.01305    0.00956   -0.01873   -0.05090   -0.03875
       H                -0.00292   -0.01066    0.02304   -0.03825   -0.01053   -0.03933    0.01627   -0.03495    0.01351
       H                 0.00546   -0.03067    0.01018   -0.05713    0.01524   -0.01564    0.02143   -0.05593    0.00067
       C                 0.00237   -0.01558    0.00590   -0.03326    0.00124   -0.02217    0.01189   -0.04397    0.00103
       C                -0.01116    0.02458   -0.01374   -0.01916    0.02270    0.03195    0.01788   -0.07237    0.00433
       H                -0.00006    0.02785   -0.01783   -0.04049    0.02780    0.04178    0.01860   -0.10763   -0.00205
       H                -0.01332    0.03855   -0.02107    0.00021    0.02867    0.04980    0.00991   -0.06683   -0.00591
       H                -0.02842    0.02187   -0.00869   -0.02659    0.02075    0.02598    0.03819   -0.06571    0.03460
       C                 0.04278   -0.00883    0.00553    0.02780    0.01051   -0.01094    0.03004    0.03675   -0.00922
       C                -0.01048    0.00111    0.00947   -0.01718   -0.02151   -0.03095    0.00617   -0.03418   -0.00906
       C                -0.03660    0.02810    0.00799   -0.02812   -0.02459    0.00310   -0.00260   -0.02462   -0.01095
       C                -0.00389   -0.00707   -0.01373   -0.00983   -0.02385   -0.02001   -0.01297   -0.02101    0.00015
       C                 0.06443   -0.03131    0.02875    0.02102    0.01651   -0.03748    0.03604    0.03234    0.02151
       O                 0.04137   -0.04407    0.05590    0.03563    0.02658   -0.05450    0.05762   -0.02221   -0.00514
       C                -0.02900    0.02048   -0.01560   -0.03014   -0.02029    0.02851   -0.02635   -0.00875    0.00268
       C                -0.06879    0.06064    0.00868   -0.07030   -0.01145    0.06377   -0.00917   -0.01819   -0.01064
       H                -0.10703    0.09800    0.04499   -0.09696   -0.00972    0.06878    0.02291   -0.03816   -0.03169
       C                 0.02499   -0.03356   -0.06672    0.00743   -0.02310    0.01715   -0.07086    0.01864    0.03290
       H                 0.06588   -0.07439   -0.03415    0.03525   -0.02539    0.02321   -0.08441    0.04601    0.01335
       H                 0.02784   -0.03630   -0.07869    0.00959   -0.02342    0.03425   -0.08725    0.03064    0.04116
       H                 0.02466   -0.03275   -0.12866    0.00727   -0.02251   -0.01594   -0.07594    0.00083    0.06829
       C                -0.06801    0.06110   -0.00906   -0.08903   -0.00057    0.10037   -0.02949   -0.00452    0.00130
       H                -0.07145    0.06022    0.04339   -0.08866    0.01332    0.15393   -0.02273    0.01326   -0.03091
       H                -0.10076    0.09936   -0.04137   -0.14156    0.00052    0.08658   -0.01892   -0.03277    0.02175
       H                -0.03285    0.02585   -0.04145   -0.05568   -0.00592    0.09158   -0.06169    0.01604    0.02175
       C                 0.11684   -0.03841    0.01825   -0.00577    0.00970   -0.04174    0.00930    0.10725    0.09371
       H                 0.13704   -0.00343    0.00297   -0.01014    0.00089   -0.03196    0.01768    0.10719    0.16416
       H                 0.11014   -0.04520    0.02228   -0.01467    0.00357   -0.03813   -0.02798    0.17541    0.06023
       H                 0.14097   -0.07028    0.02373   -0.01206    0.01883   -0.05820    0.01527    0.09843    0.11055
       C                -0.05205    0.00520   -0.01024    0.10077    0.00775    0.01135   -0.03632    0.06596   -0.03298
       H                -0.05173    0.00840   -0.01394    0.12309    0.00866    0.02157   -0.03790    0.08570   -0.05770
       H                -0.06641    0.01628   -0.02620    0.10163    0.00892    0.03431   -0.05098    0.07872   -0.03107
       H                -0.06465   -0.01135    0.00676    0.11189    0.00638   -0.01908   -0.04999    0.05858   -0.00444
       H                 0.06294    0.00419   -0.02005    0.00916    0.00974    0.01609    0.02662    0.06496    0.00419
       H                -0.01335   -0.02063    0.04071    0.07028    0.00727   -0.04929    0.02394   -0.00757   -0.04766
       H                -0.07256    0.06631    0.04575   -0.04820   -0.02632    0.00822    0.02429   -0.03991   -0.03001
       H                 0.02984   -0.04451   -0.05179    0.00657   -0.02195   -0.02457   -0.03937   -0.00649    0.01967
       H                 0.03032   -0.05258   -0.04898   -0.01786   -0.00399   -0.02570   -0.01513   -0.03043    0.01468
       H                -0.03245    0.03077    0.04601   -0.02213   -0.02761   -0.03384    0.02255   -0.04053   -0.02261
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。


次に、`vibration_animation`内の虚振動を示す分子振動が示されたxyzファイル(`mode_1_XXXi_wave_number.xyz`)をAvogadroで確認すると、求められた遷移状態構造の中に、想定される反応系と生成系をつなぐ方向に振動している構造が存在しないことが判明した。

初期構造として採用した安定構造が反応に関わる箇所をs-trans体にしたために、SIに記載された3つのC-C結合を作るTS構造を求めるはずが、C-C結合, C-O結合を作る付加環化反応のTS構造を求めてしまった。


## 終わりに
　
　自作ライブラリで、UMAモデルのニューラルネットワークポテンシャル(NNP, `uma-s-1p1`)を用いて、BH9データセットの2. Pericyclic, No. 11の反応のある1つの遷移状態構造を算出する手順を説明した。



## 参考
- https://github.com/ss0832/MultiOptPy (自作ライブラリMultiOptPyのレポジトリ)
- https://avogadro.cc/ (Avogadro、分子構造可視化ツール)
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)
- _The Journal of Chemical Physics_ 2010, 132, 241102.
- _The Journal of Chemical Physics_ 1991, 94, 751–760.
- In _Classical and Quantum Dynamics in Condensed Phase Simulations_; WORLD SCIENTIFIC: LERICI, Villa Marigola, 1998; pp 385–404.
- _The Journal of Chemical Physics_, 2020, 153, 024109.
- _The Journal of Chemical Physics_, 2022, 144, 214108.
- _J. Phys. Chem. A_ 2019, 123, 3761−3781 http://dx.doi.org/10.1021/acs.jpca.9b01546 (MOBH35のデータセットについて)


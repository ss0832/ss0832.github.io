---
title:  【計算化学】自作pythonライブラリで遷移状態構造を求めてみる(BH9データセットの3. Halogen atom transfer, No. 39の化学反応, NNP(UMA)使用)
published: 2025-11-19
description: ""
tags: [MultiOptPy, python]
category: Computational Chemistry
draft: false
---
最終更新：2025-11-19

import MoleculeViewer from '../../components/MoleculeViewer.astro';
import MultiDataGraph from '../../components/MultiDataGraph.astro';

## 概要

本記事では、自作ライブラリ(MultiOptPy)で、BH9データセットの3. Halogen atom transfer, No. 39の素過程の遷移状態構造を算出してみる。計算レベルは、Meta社のFAIR Chemistryが開発したニューラルネットワークポテンシャル(NNP)であるUMA(Meta’s Universal Model for Atoms)とした。

MultiOptPyは電子状態計算ソフトウェアを用いた分子構造最適化手法の勉強を目的として作成したpythonライブラリである。

MultiOptPyのレポジトリ:https://github.com/ss0832/MultiOptPy

BH9のデータセットについて:

- _J. Chem. Theory Comput._ 2022, 18, 1, 151–166 

https://doi.org/10.1021/acs.jctc.1c00694


この文献のSupporting Informationから、データセットの詳細を確認できる。

有機金属錯体が関わる反応を除いたさまざまなカテゴリの反応がまとめられたデータセットである。DFTの汎関数の電子エネルギーの精度の比較などのベンチマークに主に使われる。

今回使用したニューラルネットワークポテンシャルについて：
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)



## 使用した自作ライブラリMultiOptPyのバージョン
```
v1.20.0-rc.1
```
## 環境
```
Windows 11
```
※Windows 11環境下でAnaconda PowerShell Promptを使用した。

## Source codeのダウンロード(Unixコマンド)
```
wget https://github.com/ss0832/MultiOptPy/archive/refs/tags/v1.20.0-rc.1.zip
unzip v1.20.0-rc.1.zip
cd MultiOptPy-v1.20.0-rc.1
```
https://github.com/ss0832/MultiOptPy/releases/tag/v1.20.0-rc.1 にアクセスしてzipファイルをダウンロードする。Unixコマンドの場合とはディレクトリ名が異なるので都度読み替えていただけると良い。

移動先のディレクトリで`requirements.txt`を参照することで、本ソースコードで必要なモジュールを把握することが出来る。導入方法は各自の状況に合わせて適宜LLMとの対話などで調べると良い。

次に述べる環境構築手順を使用する場合は、環境構築が終わった後、`pip install -r requirements.txt`で本自作モジュールが動作させるために最低限必要なモジュールを導入することが可能である。

### 環境構築手順

今回は、Windows 11のPower Shellを使用した。初めに、NNPを使用できる環境が整ったAnaconda PowerShell Promptを用意する手順を説明する。

1, https://repo.anaconda.com/archive/ より、`Anaconda3-2025.06-1-Windows-x86_64.exe`でAnacondaをインストールする。

2, 検索機能を使い、スタートから`Anaconda PowerShell Prompt`を開く。

3, 以下のコマンドを実行し、仮想環境を作成する。
```
conda create -n (任意の仮想環境名) python=3.12.7
```

4, 先ほど作成した仮想環境を`conda activate (仮想環境名)`で起動させる。

5, 以下のコマンドを実行し、必要なライブラリを導入する。
```
pip install ase==3.26.0 fairchem-core==2.7.1 torch==2.6.0
```
- fairchem-coreは、FAIR Chemistryが管理しているNNPを動作させるために必要なライブラリである。
- aseはNNPに電子エネルギーを算出したい分子構造を渡すために必要なインターフェイスの役割を果たすために必要なライブラリである。
- torchはPyTorchライブラリを指す。これはニューラルネットワークなどの機械学習を行ったり、学習結果を扱ったりするために必須なライブラリである。

これで、`Anaconda PowerShell Prompt`から仮想環境を立ち上げることで、NNPを使用する準備が整えることが出来る。

次に、NNPを使用するために必要なModelの情報が保存されている`.pt`ファイルのダウンロードおよびNNPの自作ライブラリへの導入方法について説明する。


1, 以下のサイトにアクセスして、`uma-s-1p1.pt`をダウンロードする。（使用許諾が下りていれば可能である。）
```
https://huggingface.co/facebook/UMA
```

2, ダウンロード後、`MultiOptPy-v1.20.0-rc.1`ディレクトリ内に存在する`software_path.conf`に対して、`uma-s-1p1.pt`の絶対パスを用いて以下を追記する。
```
uma-s-1p1::(uma-s-1p1.ptの絶対パス)
```

これで、`MultiOptPy-v1.20.0-rc.1`がNNP`uma-s-1p1`を使用できるようになる。


### 使用するNNPに関する具体的な説明

今回使用するNNPについて具体的に説明する。

- UMAのModel Checkpointは`uma-s-1p1`を使用した。
- 小分子系のトレーニングセットである`Omol25`(`omol`)を使用して学習したニューラルネットワークポテンシャルを使用する。

※自作ライブラリでの具体的な使用の仕方に関しては、`ase_calculation_tools.py` を参照すると良い。`omol`以外のモデルを使用したい場合は、現バージョンでは、`multioptpy/Calculator/ase_tools/firechem.py`内の、`self.task_name`を編集することで対応可能である。


## 手順

### 1. 初期構造の準備

モデル反応系として、以下の構造を用意した。今回はファイルの名前を`bh9_3_39.xyz`とした。
初期構造は以下のものを使用した。

```
42
OptimizedStructure
O      4.994424904903     -1.660088919473      0.937208289704
C      4.199241908291     -0.946396655490      0.435599653218
C      3.423692978456     -1.171070520901     -0.831382792727
C      1.911174273520     -1.214845614698     -0.604444019855
Cl     3.799768378633      0.630949964782      1.215699650740
C      0.790182712560      2.510068532516     -0.188474731384
H      3.788660798707     -2.111770019140     -1.246136377999
H      1.555274069127     -0.229320965415     -0.297020709724
C      1.490626233095     -2.259365549350      0.422552268396
H      1.437456045073     -1.430930948578     -1.566579684641
C     -0.309815026276      1.724155600337     -0.456949511890
C     -1.233322601367      1.287465967853      0.487835823204
C     -0.024198985465     -2.340445818183      0.561750843994
H      1.931089745758     -2.010332352278      1.393264724184
H      1.895546536271     -3.237211820192      0.143737947058
N     -2.317536620704      0.506847374537      0.204849441059
H     -1.134354574925      1.566583102557      1.528691560239
H     -0.459115429788      1.410005192753     -1.486717901160
C      1.744838654772      2.898872792670     -1.271964211583
C     -2.574389371677     -0.045216702687     -1.111508280284
H     -1.736822943659     -0.677510655024     -1.438650282273
C     -3.846547253407     -0.864761929596     -0.910072776851
H     -2.696769897794      0.748368845776     -1.852780947853
H     -4.722738644334     -0.223258598578     -1.024477850318
C     -3.727099413209     -1.336659535705      0.540434877086
H     -3.931790918670     -1.683359513287     -1.622938070434
C     -3.116530394906     -0.126758484317      1.244459558168
H     -3.039056930136     -2.182592162369      0.599803148469
H     -4.678023611410     -1.639885978089      0.975697128437
H     -2.490628826887     -0.409166544148      2.094448898914
H     -3.894274151299      0.552696525449      1.612215404342
H      1.447108235362      2.486357874275     -2.237066828590
H      2.759549878563      2.549017157918     -1.048735321925
H      1.812597331384      3.987336759894     -1.379155739185
C      1.073060667484      2.997289823603      1.199368492886
H      1.160359775836      2.167928617554      1.910010564129
H      0.275989436509      3.650789945628      1.571001796950
H      2.006009033274      3.559954471257      1.237479160767
H     -0.317759962733     -3.057954375030      1.329391407372
H     -0.484713424529     -2.651410689395     -0.379596125956
H     -0.437484875938     -1.364443509577      0.826974391509
H      3.676322261534     -0.359930687860     -1.517822866195
```

<MoleculeViewer 
  xyzData={`42
OptimizedStructure
O      4.994424904903     -1.660088919473      0.937208289704
C      4.199241908291     -0.946396655490      0.435599653218
C      3.423692978456     -1.171070520901     -0.831382792727
C      1.911174273520     -1.214845614698     -0.604444019855
Cl     3.799768378633      0.630949964782      1.215699650740
C      0.790182712560      2.510068532516     -0.188474731384
H      3.788660798707     -2.111770019140     -1.246136377999
H      1.555274069127     -0.229320965415     -0.297020709724
C      1.490626233095     -2.259365549350      0.422552268396
H      1.437456045073     -1.430930948578     -1.566579684641
C     -0.309815026276      1.724155600337     -0.456949511890
C     -1.233322601367      1.287465967853      0.487835823204
C     -0.024198985465     -2.340445818183      0.561750843994
H      1.931089745758     -2.010332352278      1.393264724184
H      1.895546536271     -3.237211820192      0.143737947058
N     -2.317536620704      0.506847374537      0.204849441059
H     -1.134354574925      1.566583102557      1.528691560239
H     -0.459115429788      1.410005192753     -1.486717901160
C      1.744838654772      2.898872792670     -1.271964211583
C     -2.574389371677     -0.045216702687     -1.111508280284
H     -1.736822943659     -0.677510655024     -1.438650282273
C     -3.846547253407     -0.864761929596     -0.910072776851
H     -2.696769897794      0.748368845776     -1.852780947853
H     -4.722738644334     -0.223258598578     -1.024477850318
C     -3.727099413209     -1.336659535705      0.540434877086
H     -3.931790918670     -1.683359513287     -1.622938070434
C     -3.116530394906     -0.126758484317      1.244459558168
H     -3.039056930136     -2.182592162369      0.599803148469
H     -4.678023611410     -1.639885978089      0.975697128437
H     -2.490628826887     -0.409166544148      2.094448898914
H     -3.894274151299      0.552696525449      1.612215404342
H      1.447108235362      2.486357874275     -2.237066828590
H      2.759549878563      2.549017157918     -1.048735321925
H      1.812597331384      3.987336759894     -1.379155739185
C      1.073060667484      2.997289823603      1.199368492886
H      1.160359775836      2.167928617554      1.910010564129
H      0.275989436509      3.650789945628      1.571001796950
H      2.006009033274      3.559954471257      1.237479160767
H     -0.317759962733     -3.057954375030      1.329391407372
H     -0.484713424529     -2.651410689395     -0.379596125956
H     -0.437484875938     -1.364443509577      0.826974391509
H      3.676322261534     -0.359930687860     -1.517822866195`}
  caption="初期経路を求めるための初期構造"
  backgroundColor="#333333"
/>


### 2. 遷移状態構造最適化

　`run_autots.py`を適切に使用することで、自動的に遷移状態構造が得られる。以下にその手順を説明していく。

初期構造をカレントディレクトリに`bh9_3_39.xyz`として保存する。その後、同じディレクトリ内で、`config_bh9_3_39.json`を作成し、以下のように記述する。

`config_bh9_3_39.json`
```json
{
  "work_dir": "bh9_3_39",
  "top_n_candidates": 3,
  "multioptpy_version": "1.20.0-rc.1",
  
  "step1_settings": {
    "othersoft": "uma-s-1p1",
    "opt_method": ["rsirfo_block_fsb"],
    "use_model_hessian": "fischerd3",
    "spin_multiplicity": 2,
    "electronic_charge": 0,
	"manual_AFIR": ["600", "6", "5"]
  },
  
  "step2_settings": {
    "othersoft": "uma-s-1p1",
    "NSTEP": 15,
    "ANEB": [3, 5],
    "QSM": true,
    "use_model_hessian": "fischerd3",
    "save_pict": true,
    "node_distance_bernstein": 0.50,
    "align_distances": 9999,
    "spin_multiplicity": 2,
    "electronic_charge": 0
  },
  
  "step3_settings": {
    "othersoft": "uma-s-1p1",
    "opt_method": ["rsirfo_block_bofill"],
    "calc_exact_hess": 5,
    "tight_convergence_criteria": true,
    "max_trust_radius": 0.2,
    "frequency_analysis": true,
	"NSTEP": 500,
	"detect_negative_eigenvalues": true,
    "spin_multiplicity": 2,
    "electronic_charge": 0
  },

  "step4_settings": {
    "othersoft": "uma-s-1p1",
	"opt_method": ["rsirfo_block_bofill"],
    "spin_multiplicity": 2,
    "electronic_charge": 0,
	"calc_exact_hess": 10,
    "tight_convergence_criteria": true,
    "frequency_analysis": true,
    
    "intrinsic_reaction_coordinates": ["0.5", "200", "lqa"],

    "step4b_opt_method": ["rsirfo_block_fsb"]
  }
}
```
その後、以下のコマンドを実行する。
```
python run_autots.py bh9_3_39.xyz -cfg config_bh9_3_39.json
```

これにより、これまでの似た内容の記事で行ってきたコマンドの操作をまとめ、遷移状態構造を求める処理を自動的に行う。

具体的な処理の流れは、
```
Step1. バイアスポテンシャルによるNEB法のための初期経路の作成

Step2. NEB法による経路の緩和

Step3. NEB法により得られた経路のエネルギー極大値を示す構造のうち、エネルギー値が上位の最大で3個
(`run_autots.py`にて、`--top_n X`で最大値を変更可能)の構造を初期構造とした遷移状態構造の算出

(Step4.得られた遷移状態構造に対するIRC計算とIRC経路の末端に存在する構造に対する構造最適化。
こちらは`--run_step4`をコマンドで追記しなければ行わない。)
```
となっている。

`run_autots.py`のオプションの説明：

- `-cfg YYY.json`は、workflowを実行するためのオプションが記されたJSONファイルの読み込み先を指定する。


これらの一連の結果は、`(jsonファイルの"work_dir"にて指定した名前)`のディレクトリの中に存在するファイルを開いて確認できる。

以下にすべてのstepで共通のオプションに関する説明を載せる。

- `"opt_method": ["rsirfo_block_fsb"]`は準ニュートン法であるRS-I-RFO法を構造最適化に使用することを示す。初期のへシアンに関しては、特にオプションで指定しない限り、単位行列が使われる。(以前のHessian更新法とは細かな点で異なる方法を使用している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `"spin_multiplicity": Z`はスピン多重度の指定である。PySCFを使用するときは目的とするスピン多重度に1を引いた値を指定する。（デフォルトでは1が指定される。）
- ` "electronic_charge": 0`は形式電荷をMとすることを示す。（デフォルトでは0が指定される。）
- `"othersoft": "uma-s-1p1"`は今回使用するNNPを指定している。これを使用する際にASEライブラリが必要である。
- `"use_model_hessian": "fischerd3"`は、計算コストが非常に低い数式を使用して、近似したHessianを生成する機能を呼び出すオプションである。デフォルトではこの機能は使用されない。


※オプションの説明は`MultiOptPy-v1.20.0-rc.1/OPTION_README.md`にて示されている。


#### Step 1


Step1では、`omol`のデータセットを使用した`uma-s-1p1`モデルのNNPで得たエネルギーに対して、指定した人工力ポテンシャルを加えた上で初期構造を構造最適化を行っている。


以下のJSON内で記述したバイアスポテンシャルで、次の経路緩和アルゴリズムの初期経路として用いるトラジェクトリーを生成する。
- `"manual_AFIR": ["yyy", "a", "b]`：yyykJ/molの活性化障壁を超えうるペア同士を近づける力を原子のラベル番号aとbのペアに構造最適化時に加えることを示す。


Step1が正常終了していれば作成された`work_dir`ディレクトリ中に、`bh9_3_39_step1_traj.xyz`が存在する。必要に応じて確認し、目的に沿った初期経路が得られているか確認する。もし想定とは異なる場合は、プロセスをkillして再度設定を見直してやり直す。


`bh9_3_39_step1_traj.xyz`は構造最適化の過程をAvogadro（公式ページ:https://avogadro.cc/ ）等で可視化して確認できるようにしている。この`bh9_3_39_step1_traj.xyz`はStep2のNEB計算に使用している。

※`bh9_3_39_step1_traj.xyz`をアニメーションとして表示したい場合は、[https://github.com/ss0832/molecule_movie] を使うと良い。


#### Step 2

Step2では、NEB法を用いることで、先ほど得られた`bh9_3_39_step1_traj.xyz`全体のエネルギーを下げることができる。これにより、パスのエネルギー極大値を持つ構造を遷移状態構造に近づける。（この時点ではまだ正確な遷移状態構造は求められていない。）

Step2固有のオプションについて以下に示す。


- `"NSTEP": n`はn回分NEB法による経路の緩和を行うことを示す。
- `"align_distances": X`は線形補間で、各ノード間の距離を全て等しくするための処理である。X回の反復計算ごとに本処理を行う。Xを`"NSTEP": n`よりも大きな数値を指定することで、初期経路に対してのみ処理を行うことが出来る。
- `"node_distance_bernstein": N`はノード間の距離をN Åとして初期経路を作成することを示す。経路作成時に元のノードをベルンシュタイン多項式を用いてがたついた経路を滑らかにする。

→プログラムの仕様上`"align_distances": X`の処理を行った後に、`"node_distance_bernstein": N`の処理を行うようになっている。

- `"save_pict": true`は緩和中のパスのエネルギープロファイルや各ノードの勾配のRMS値をmatplotlibで可視化するオプションである。
- `"ANEB": [A, B]`これを指定すると、(B+1)回の緩和ごとに、エネルギー極大値を示すノードと前後のノードの間に線形補間でA個の新規ノードを内挿するようにできる。デフォルトではこのような操作は行われない。このオプションを使用するとノードの数が徐々に増えるため、計算コストが使用しない場合と比べて増加する。一方で、エネルギー極大値を示すノード周辺にノードを増加させるため、緩和している経路中のノードが遷移状態構造付近に存在する可能性が高くすることが出来る。


`MultiOptPy-v1.20.0-rc.1/"work_dir"`と同じディレクトリ内に、NEBという名前を含むディレクトリが生成されている。
そのディレクトリ内の`energy_plot.csv`を確認し、緩和後のパスのエネルギー極大値を示す構造を確認する。

経路の緩和後の各ノードのエネルギー一覧(単位:hartree) (energy_plot.csvに保存されている。)

export const dataset1 = [-1138.6000126531128,-1138.6000126531128,-1138.587947636009,-1138.5599257518086,-1138.5194401901454,-1138.5050631725153,-1138.5094591279526,-1138.522514057098,-1138.5353994820473,-1138.5433973753711,-1138.5471075073322,-1138.5491720134198,-1138.5507524214456,-1138.551679389305,-1138.5522267338283,-1138.5526477168544,-1138.552971221387,-1138.553206201902,-1138.5533933784834,-1138.553558769053,-1138.5536899013055,-1138.5537859604008,-1138.553866235261,-1138.553931076355,-1138.5539757041656,-1138.5540031458663,-1138.5540243667474,-1138.5540961076942,-1138.5541512977559,-1138.5541684356763,-1138.5542575905379,-1138.5543979664026,-1138.5545316045063,-1138.5546593284505,-1138.554791880101,-1138.5549005954979,-1138.5549772824347,-1138.5550367306914,-1138.5551211191782,-1138.5552367738558,-1138.5553273875432,-1138.5554618317249,-1138.5556404656315,-1138.5558640602937,-1138.5561312445031,-1138.5563800422474,-1138.5566283449543,-1138.556917026039,-1138.557124814562,-1138.5572410869406,-1138.557330342562,-1138.5573628792017,-1138.5573985744406,-1138.5574154100818];

export const dataset1_itr5 = [-1138.6000126881597,-1138.6000126618744,-1138.592742617607,-1138.5714640319502,-1138.5356232388012,-1138.511482287493,-1138.523123145448,-1138.537269171335,-1138.5497059393717,-1138.5568412196549,-1138.560590003935,-1138.563620594572,-1138.5661862271202,-1138.5681733847614,-1138.5696716648235,-1138.570078155968,-1138.5694481621592,-1138.569979323789,-1138.5706878751616,-1138.5710647779847,-1138.5711580201876,-1138.5709918629675,-1138.5709560100174,-1138.57133826625,-1138.5713861665624,-1138.5714321130115,-1138.5715732993353,-1138.5716916438603,-1138.5716318538966,-1138.571746430883,-1138.5718497665848,-1138.571922462559,-1138.5719454708305,-1138.5717906775587,-1138.571784115032,-1138.5718776463716,-1138.571684380396,-1138.571003060443,-1138.5709606624896,-1138.5708984017217,-1138.5721065813011,-1138.572506290876,-1138.5728284241998,-1138.573278794028,-1138.5734384675768,-1138.5733858184133,-1138.5735892655052,-1138.574263786365,-1138.5745551572968,-1138.5746203620022,-1138.5741711136736,-1138.5739371057095,-1138.5705232687658,-1138.5744794823386];

export const dataset1_itr10 = [-1138.6000126706363,-1138.6000126531128,-1138.596804865491,-1138.581503742893,-1138.5489896426407,-1138.5379344354399,-1138.5249543313662,-1138.5164261810596,-1138.5173364227994,-1138.5203230734207,-1138.5235314283639,-1138.5261551598642,-1138.5272676790064,-1138.542021036519,-1138.5533677197923,-1138.5605261310109,-1138.5640197872056,-1138.5666068246308,-1138.568608465392,-1138.5697896063095,-1138.5705731930348,-1138.5708953614055,-1138.5708803788677,-1138.5709738401135,-1138.570875866583,-1138.57087141563,-1138.5709387581946,-1138.5708501597023,-1138.5710548947668,-1138.5710700963475,-1138.5714985618808,-1138.571624108538,-1138.5717065563042,-1138.5717002741524,-1138.5716770117913,-1138.571677826631,-1138.5716711502018,-1138.571651042059,-1138.571711664386,-1138.5717069856285,-1138.571755560593,-1138.5717734783063,-1138.5718377104608,-1138.5719211483015,-1138.5720317737528,-1138.5721236578895,-1138.5721074925198,-1138.572102112825,-1138.5721001940085,-1138.572105871602,-1138.5721247443423,-1138.5721423641573,-1138.572156479285,-1138.5721677731394,-1138.5722555480304,-1138.5722996369952,-1138.5722984454017,-1138.5723492808895,-1138.5723682500088,-1138.5723779492307,-1138.5723552125726,-1138.572404102959,-1138.572425788211,-1138.5724611066962,-1138.572501322982,-1138.5726321441932,-1138.5726217352722,-1138.5726234350454,-1138.5725531222586,-1138.5726583154449,-1138.572578548764,-1138.5726410198135,-1138.5726573341324,-1138.5729262575428,-1138.5728728023014,-1138.5729195548286,-1138.5730261849365,-1138.573126121092,-1138.57336336213,-1138.5736403726062,-1138.5738554026893,-1138.5738895909128,-1138.5738267431097,-1138.573953095845,-1138.5740519805943,-1138.574113225003,-1138.5741548168783,-1138.5741946038397,-1138.5742785849066,-1138.5747347637541,-1138.574941470205,-1138.575052945543,-1138.574971233761,-1138.5749955037197,-1138.574841271198,-1138.5748092471188,-1138.5747276580007,-1138.5741704653067,-1138.574578770127,-1138.5747684525597,-1138.5749890375719,-1138.574948795001];

export const dataset2 = [-1138.6000126618744,-1138.6000117506558,-1138.598349600182,-1138.5871993852923,-1138.5623169297899,-1138.550290595671,-1138.5304417559182,-1138.527451530516,-1138.5246189240395,-1138.5224721454201,-1138.5203645404417,-1138.5196931825622,-1138.519851184813,-1138.5203795164082,-1138.5215325760196,-1138.5248911549984,-1138.527422822747,-1138.529526927419,-1138.5300115906116,-1138.5439351915259,-1138.5545753692877,-1138.5617972722957,-1138.5654226083502,-1138.5676069659783,-1138.5692836346188,-1138.5702368832513,-1138.570803845261,-1138.5711142378827,-1138.571115376906,-1138.5711683327297,-1138.5711579851406,-1138.5711496001766,-1138.5711271614168,-1138.571103855247,-1138.5711304908696,-1138.5711507479616,-1138.5711858824507,-1138.5711841476307,-1138.571234001806,-1138.571188081642,-1138.571161673824,-1138.571132059217,-1138.5711013932041,-1138.571201811254,-1138.571256063812,-1138.5713325448482,-1138.5713645952126,-1138.5713718148684,-1138.5713756700243,-1138.571388383277,-1138.5714238244263,-1138.5715271601284,-1138.5715994618251,-1138.571663536269,-1138.571710761929,-1138.5718092348775,-1138.571855014854,-1138.5718074387253,-1138.5718039778467,-1138.5717997546985,-1138.5717937879685,-1138.5717860513716,-1138.5717844655007,-1138.5717853942429,-1138.5717745647594,-1138.5717735396383,-1138.5718017173235,-1138.5717964252458,-1138.5717945064296,-1138.571790984219,-1138.571789117973,-1138.5717942260546,-1138.5718011565734,-1138.571800762296,-1138.5718120035804,-1138.5718013756164,-1138.5717950584178,-1138.5717884696057,-1138.5717842114109,-1138.5718025584483,-1138.5718163406307,-1138.5718273103016,-1138.5718371321875,-1138.571882938449,-1138.571892418628,-1138.571995973373,-1138.5721119171874,-1138.5722106179405,-1138.5721928053679,-1138.5721823526383,-1138.5721814677047,-1138.5721746948966,-1138.572169963569,-1138.5721806966735,-1138.5721870138723,-1138.5721896861962,-1138.5721977645003,-1138.5722334860245,-1138.572252761804,-1138.5722450602539,-1138.5722489241716,-1138.5722425281174,-1138.5722343008642,-1138.5722388043873,-1138.572234590001,-1138.5722672186387,-1138.5722875721096,-1138.5723100459163,-1138.5723307498558,-1138.5723421050425,-1138.5723500431588,-1138.572360381986,-1138.572367654212,-1138.5723798417619,-1138.572396515311,-1138.572401123975,-1138.572407458697,-1138.5724786564174,-1138.572500078818,-1138.572532917737,-1138.572531489577,-1138.57253431085,-1138.5725336975297,-1138.5725366327054,-1138.572547611138,-1138.5725582478635,-1138.5725775849753,-1138.572569235058,-1138.5725622344453,-1138.5725570913169,-1138.572550563837,-1138.5725453593764,-1138.5725715569133,-1138.5725884144588,-1138.5725972024618,-1138.5726093812498,-1138.572666262323,-1138.5727858597736,-1138.572836274699,-1138.5728707783444,-1138.5729627500982,-1138.5729902093224,-1138.5729534889624,-1138.5729419673032,-1138.5729390408894,-1138.5729385589948,-1138.5729656414653,-1138.5729880013696,-1138.5730080131334,-1138.5730634660465,-1138.5730504636572,-1138.5731098943902,-1138.5731022016018,-1138.5730890677867,-1138.5730719211044,-1138.5730486850284,-1138.5730752505574,-1138.573099678227,-1138.5731357064114,-1138.5731543513473,-1138.5731948655314,-1138.5733045622408,-1138.5735089117895,-1138.5737303992587,-1138.5739346787136,-1138.5740462416688,-1138.5740126229568,-1138.5740152777576,-1138.5739993752393,-1138.5739891765995,-1138.5740453304502,-1138.5740646500383,-1138.5740933534266,-1138.5741221882404,-1138.5742534562994,-1138.5743210179069,-1138.57435056242,-1138.574464929125,-1138.5745076249768,-1138.5748076962946,-1138.5749927525403,-1138.5751121835183,-1138.5751265527358,-1138.5751376450708,-1138.5751483956988,-1138.5751511118315,-1138.5751619851235,-1138.5751681708964,-1138.5751747859933,-1138.575175390552,-1138.5751453991913,-1138.5751342630476,-1138.575128383935,-1138.5751097565224,-1138.5751123762761,-1138.575109151964,-1138.575136891563,-1138.575130276466,-1138.5750029687035,-1138.5749661256793,-1138.5749158246563,-1138.574858137505,-1138.5747573865099,-1138.574788236519,-1138.5748315369292,-1138.5748647788873,-1138.574975518241,-1138.575060778519,-1138.5751184831936,-1138.5750137543785];

<MultiDataGraph datasets={[ { data: dataset1, label: "緩和前の経路のエネルギー", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_itr5, label: "ITR. 5の経路のエネルギー", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_itr10, label: "ITR. 10の経路のエネルギー", color: "rgba(81, 143, 18, 1)"}, { data: dataset2, label: "緩和後の経路のエネルギー", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="Electronic Energy [hartree]" height="500px" />

export const dataset1_grad = [4.952600611144066e-06,4.952423620958235e-06,0.005281192741017207,0.008912531092580311,0.009956656847066366,0.006480938309061406,0.011840945423979446,0.013601855856018502,0.013194487123751276,0.012819738055829945,0.012873814806734472,0.012983945930180358,0.01298066924375789,0.013016451855345624,0.013030540865561402,0.013004205302681936,0.012991088614035152,0.013003772282382121,0.013023089113710976,0.01302841679922964,0.013014583680804494,0.012997663289339368,0.012987286676905288,0.01298168812033202,0.01298751988662679,0.013029571257814223,0.01310801824378353,0.013114371316487058,0.01308162426667986,0.013080997259054736,0.0130617147889504,0.013030856479337091,0.013009269938459488,0.012995457727083585,0.012985218859331401,0.012979438986131334,0.012976756042073661,0.012969909931486435,0.012959312971856415,0.012958754950417576,0.012971838782665319,0.012978240140469647,0.01297348971195861,0.012964426397218941,0.012964481884212937,0.012981139472416662,0.012995585220962454,0.012990516322933968,0.012992994105380304,0.012992917987603417,0.012975274764120234,0.012973002097999016,0.01297111071690807,0.012964979456273];

export const dataset1_grad_itr5 = [2.3099579717159677e-06,1.8303248265584994e-06,0.0034832471338811636,0.007221894009606452,0.01015679437454564,0.0037837520394926254,0.004511622469487351,0.005905546606788147,0.0056369560104325,0.005614265580783127,0.005634094227698,0.005101364839675168,0.004331269632584747,0.0034184684965316305,0.0021707917363542133,0.001876720679247335,0.0030480331010623086,0.0026986183080992573,0.0019192560848015961,0.001533581774122273,0.0013881746061757266,0.0017902867856505202,0.0018482181224273345,0.0012115100252792436,0.0011791462142223695,0.0012543566005013998,0.001218742945827697,0.001143041327210929,0.0014358555837842525,0.0012627288560676153,0.0010825110405431816,0.0010538083491679654,0.0012558018478742044,0.0018081848178441821,0.001992312784092944,0.0019605998639484284,0.002365785452448451,0.003201323038187665,0.003330730747033163,0.003504265220004481,0.002087472913256283,0.001732023812720337,0.001490110459614364,0.0010479076262160886,0.0013216665703886443,0.001959076830880967,0.0020772995181247925,0.0012486290553256722,0.0010048679787693895,0.001112276132378419,0.002204270986531337,0.0025366562985449435,0.005252007915588219,0.001372877637602392];

export const dataset1_grad_itr10 = [1.2179547259038568e-06,1.280739787895476e-06,0.0019397609156003646,0.0052708538489394125,0.009010620353020887,0.009325192472759801,0.007316428823536506,0.0028785277737824445,0.0027878162242997266,0.0027623235486353348,0.002800565719906101,0.0027958840539431063,0.002973464481242904,0.0031123112968501226,0.0033649804579570963,0.003149747302541321,0.0033847331392606946,0.0028753467396936427,0.002140870351844259,0.001603498640255275,0.0008695153625668997,0.0007581689890581362,0.0009009748598723621,0.0007548596224487174,0.0011262855986682652,0.0011458589872721605,0.0011633801972722971,0.0013692821192970402,0.0011547568801822446,0.0012291535804550451,0.0007316663612989943,0.0006737718436511836,0.000455688214435308,0.0005273056034851711,0.0005216171839496852,0.0005182753419656134,0.0004812419961430794,0.0005124958961470681,0.0004408779153455311,0.0005594714848238411,0.0003852027976279061,0.0003717458778856861,0.0003892670893172968,0.00033053522159996745,0.0003110282654921272,0.000298192289670393,0.0004200863605814595,0.0005551904847475045,0.00050270106331583,0.0005212223919004076,0.0005000761277581673,0.0005244785566176114,0.00046755639113955867,0.0005111632180612173,0.0003051479735362255,0.0004006981946708639,0.0006645284342944688,0.0005954237675139963,0.0005938443768572796,0.0006935111675959391,0.0008073376444231672,0.000745492257065149,0.000759574368125998,0.0007435977101167468,0.0006556867771753692,0.0005909653599788215,0.000808106873079749,0.0008897374013988325,0.0013556392990785014,0.0011761788241475505,0.0013819235766773423,0.0012872720225975036,0.0011953000809316863,0.0007144651342315283,0.000854399417648834,0.0008841046927042922,0.0006735296542825721,0.0007333878851793125,0.00041512065569824884,0.0003096907192798845,0.0006363321140374762,0.0006781996398497122,0.0013933945519564574,0.0008968131635577954,0.0007567701012527991,0.0008304609163655524,0.0011091960388087154,0.0010319949648982362,0.0008981243561171798,0.00022541369305424864,0.00019694153378893619,0.00020540867570808573,0.0008511283066228923,0.0007726694667164477,0.0011229557648721673,0.001178980456338882,0.0012489779654060388,0.0019146379824473117,0.0013454186734060895,0.0010229832994132625,0.0004985493741976658,0.0003951822517051369];

export const dataset2_grad = [2.4809184612455673e-06,2.5347420558272604e-05,0.0011520815101735984,0.003934751238640784,0.007509169762075084,0.008458821254693185,0.007730816124138795,0.006867851895081563,0.00536390066846596,0.004597022553047951,0.003164038066004042,0.002112533302045474,0.0020876649688214882,0.0023370754703256253,0.002352599366777419,0.0022746497719598464,0.0024038382292778365,0.002331436725848105,0.0023762791323251684,0.0022173128809711965,0.002498856058121427,0.0021953766786246874,0.0022690413780118222,0.0020035934948271386,0.0012656758276782941,0.0007799582765553467,0.00041273811765707316,0.00037274454104735627,0.0002600554508100407,0.0002565854889561163,0.0003164782173099946,0.00044083551608231565,0.0004848863672106692,0.0005664280018825456,0.0005626954285955951,0.0005559960649593463,0.0005485176963241608,0.000557021686001488,0.0006594768719503895,0.0007319327774913656,0.0007800256380230752,0.0008263091484163131,0.0008626861912526483,0.0007141145784235812,0.0006151186685636681,0.0004879412446869325,0.00042647465491712176,0.0004773833002251541,0.0005241404542402933,0.0005809239168651739,0.0005258604048070154,0.00047179655383609186,0.0004222801388949784,0.000374433356186825,0.00034317372788039734,0.00023242078321531698,0.00018367901551587045,0.0003436382043811118,0.00030281024608197016,0.0002631869774427358,0.00023522839864287512,0.00021821303974419712,0.00022320130920673378,0.00023216813013541567,0.0002657885398868028,0.0002898043931808519,0.00022174845496398664,0.0002291292406476883,0.00022948539938028714,0.00023922640041290416,0.00024102196807576607,0.00022847275567242664,0.00021759753029535527,0.00022090869206408997,0.00021972627071469497,0.00023773428851070203,0.0002546358049326411,0.00027132387646441024,0.000281790930196385,0.0002463161457782535,0.00022526934321359716,0.00021286412209870574,0.00020150707538770435,0.00016947143676571675,0.00037006053053442956,0.00031988557165724276,0.00019981930778153879,0.00011075587250173722,0.0001766122985375369,0.00018893054695286182,0.00019187975333475552,0.00021877999901146196,0.0002439362417584117,0.00022510784648933,0.00021838568417634682,0.0002288938504790331,0.00023258446365549676,0.00015643150794182075,0.00015741088396516997,0.00018592606099739588,0.00015677606207595233,0.00018042497863170347,0.00020186283832600416,0.0001987001469926851,0.00020301124527198695,0.00018702738569231902,0.00017483651589470078,0.00016468609280428231,0.00022359104606795341,0.00014979274839637375,0.000159952669479125,0.00016471893270954475,0.00018783273598805758,0.0002055280640084197,0.0002494657759920787,0.00032234610815817344,0.00038678580410968916,0.00021439970962152516,0.00031271187079284264,0.000255008800105869,0.0002621165493341098,0.0002699401782148481,0.00029105879453784894,0.0002996220846173709,0.000283909016376278,0.0002657503741179759,0.00024983232123453747,0.00026000659369202026,0.00032411665519328916,0.0003653508782216146,0.0004101625373768999,0.00044412242723496683,0.0003521925353365662,0.00029746846538684864,0.00025935583750610994,0.0002245533597697301,0.0002726856068210179,0.00029183668008714764,0.00036348691041835626,0.00034308894257472077,0.00033004544769669433,0.0003341321066751675,0.00042954090862874447,0.00046302520042522177,0.0004875524209308914,0.00048250443997327003,0.0004269775514458418,0.00041200379113581916,0.00040112225665539075,0.000354622600449708,0.00031567281883851904,0.00026624670424287174,0.00024194894069649425,0.00024832142453015297,0.0002683555802524637,0.00029908449939035977,0.00030349874573976744,0.0002892661677223957,0.0002707326465522269,0.0002632702318834709,0.00026638651719518514,0.00034431556353068884,0.00016146712934341786,0.0001126402195232703,0.00024505118476907475,0.00022598668714418843,0.0003423877376491072,0.0003503090046430742,0.0005015531090762581,0.0005220665776962999,0.0003419522449533232,0.00045817879988940157,0.0003453867905619491,0.00031152637153507523,0.00022160052667051272,0.00032743662546828823,0.0003528162687677877,0.00023710727339983987,0.00024796577636298036,0.00011762198970846635,8.949052504758097e-05,8.719442060074922e-05,0.00011623585471975564,0.00015448944177332217,0.00019127406608040177,0.0002270524512641748,0.00022175127137663802,0.0002094664544719439,0.0001985467618859351,0.00016295432598758397,0.00023384878078095426,0.00028350797016852956,0.0003111469562976674,0.0004046626516032782,0.0003794450503237763,0.0003660022899469954,0.0003054096846147865,0.00032188390645616243,0.0005988815600351685,0.0006363927998977683,0.0006912991654604237,0.0007671866868458393,0.0009233125691283209,0.0008735524830438827,0.0007806353693340747,0.0006979278472517865,0.000452915896956567,0.0003649425667873211,0.00021668502438101242,0.0002345442199525583];

<MultiDataGraph datasets={[ { data: dataset1_grad, label: "緩和前の経路の勾配のRMS値", color: "rgba(75, 192, 192, 1)" }, { data: dataset1_grad_itr5, label: "ITR. 5の経路の勾配のRMS値", color: "rgba(81, 43, 186, 1)" }, { data: dataset1_grad_itr10, label: "ITR. 10の経路の勾配のRMS値", color: "rgba(81, 143, 18, 1)"},  { data: dataset2_grad, label: "緩和後の経路の勾配のRMS値", color: "rgba(255, 99, 132, 1)" }, ]} title="NEB計算の結果の可視化" xLabel="# NODE" yLabel="RMS of gradient [hartree/Bohr]" height="500px" />

※`bias_force_rms.csv`にて、各Iterationごとのすべてのノードの勾配のRMS値を確認できる。

経路緩和の結果、以下の構造がstep3の初期構造として用いられることとなった。"work_dir"内の`bh9_3_39_step3_TS_Opt_Inputs`内に保存された`bh9_3_39_ts_guess_X.xyz`にて確認が可能である。ts_guessの番号が小さい順にエネルギー値が高い構造を示すようになっている。

※こちら[https://ss0832.github.io/molecule_viewer/] を使うことでも可視化は可能である。


`bh9_3_39_ts_guess_1.xyz`
```
42
0 2
O       4.827906821721     -1.211432719862      1.074446624924
C       4.010619597499     -0.742560714769      0.375214773920
C       3.369146410633     -1.203868708817     -0.912235795407
C       1.855499183720     -1.329123165412     -0.724687912833
Cl      2.724976000747      1.035568666539      0.710251931912
C       1.194003567294      2.191918753644      0.041240583356
H       3.823817327091     -2.145185281767     -1.226385961581
H       1.444932274108     -0.361479328295     -0.465314899531
C       1.474430917291     -2.299362700217      0.382525530962
H       1.385182669038     -1.602067034243     -1.671494816146
C      -0.069403717986      1.498393748762     -0.320242732655
C      -1.088550669951      1.187146326176      0.519057952731
C      -0.035443398082     -2.359426513160      0.564243461077
H       1.936466645723     -1.980086354853      1.323047668565
H       1.876878436609     -3.290088553393      0.157994541406
N      -2.250255227716      0.538928109264      0.204359803698
H      -1.039221868356      1.473602455503      1.564593839851
H      -0.215399093722      1.256473519275     -1.370829091145
C       1.856984733559      2.827993963427     -1.183266795157
C      -2.527949218273     -0.025036237454     -1.113196389921
H      -1.700032422202     -0.669483239878     -1.434171817953
C      -3.809200586511     -0.837368108996     -0.908984496947
H      -2.649819981790      0.760057952613     -1.862388093211
H      -4.688724475232     -0.201146599332     -1.030178772756
C      -3.695140636106     -1.301923920547      0.542130900420
H      -3.896615535027     -1.661841504639     -1.615880930945
C      -3.084296675719     -0.087097303624      1.239908964032
H      -3.016097320335     -2.154191787782      0.609221726414
H      -4.649970707604     -1.598458732624      0.975818798484
H      -2.477413728896     -0.371698682736      2.100618830951
H      -3.867571944187      0.594495994638      1.586086617958
H       1.479844379242      2.394623355184     -2.113518390970
H       2.934103806251      2.675134759573     -1.168483618351
H       1.676485275352      3.904139689410     -1.233789857828
C       1.139087045400      3.011034621737      1.306444665932
H       1.114630116775      2.339015869430      2.165391060157
H       0.263403589889      3.661792639816      1.355672888224
H       2.043094704975      3.611898566886      1.391902292857
H      -0.323178489153     -3.067356988051      1.342415040579
H      -0.520481771360     -2.662960781722     -0.367279883559
H      -0.425320725152     -1.375375438177      0.833689232483
H       3.598594690444     -0.423598591524     -1.643947473997
```

<MoleculeViewer 
  xyzData={`42
0 2
O       4.827906821721     -1.211432719862      1.074446624924
C       4.010619597499     -0.742560714769      0.375214773920
C       3.369146410633     -1.203868708817     -0.912235795407
C       1.855499183720     -1.329123165412     -0.724687912833
Cl      2.724976000747      1.035568666539      0.710251931912
C       1.194003567294      2.191918753644      0.041240583356
H       3.823817327091     -2.145185281767     -1.226385961581
H       1.444932274108     -0.361479328295     -0.465314899531
C       1.474430917291     -2.299362700217      0.382525530962
H       1.385182669038     -1.602067034243     -1.671494816146
C      -0.069403717986      1.498393748762     -0.320242732655
C      -1.088550669951      1.187146326176      0.519057952731
C      -0.035443398082     -2.359426513160      0.564243461077
H       1.936466645723     -1.980086354853      1.323047668565
H       1.876878436609     -3.290088553393      0.157994541406
N      -2.250255227716      0.538928109264      0.204359803698
H      -1.039221868356      1.473602455503      1.564593839851
H      -0.215399093722      1.256473519275     -1.370829091145
C       1.856984733559      2.827993963427     -1.183266795157
C      -2.527949218273     -0.025036237454     -1.113196389921
H      -1.700032422202     -0.669483239878     -1.434171817953
C      -3.809200586511     -0.837368108996     -0.908984496947
H      -2.649819981790      0.760057952613     -1.862388093211
H      -4.688724475232     -0.201146599332     -1.030178772756
C      -3.695140636106     -1.301923920547      0.542130900420
H      -3.896615535027     -1.661841504639     -1.615880930945
C      -3.084296675719     -0.087097303624      1.239908964032
H      -3.016097320335     -2.154191787782      0.609221726414
H      -4.649970707604     -1.598458732624      0.975818798484
H      -2.477413728896     -0.371698682736      2.100618830951
H      -3.867571944187      0.594495994638      1.586086617958
H       1.479844379242      2.394623355184     -2.113518390970
H       2.934103806251      2.675134759573     -1.168483618351
H       1.676485275352      3.904139689410     -1.233789857828
C       1.139087045400      3.011034621737      1.306444665932
H       1.114630116775      2.339015869430      2.165391060157
H       0.263403589889      3.661792639816      1.355672888224
H       2.043094704975      3.611898566886      1.391902292857
H      -0.323178489153     -3.067356988051      1.342415040579
H      -0.520481771360     -2.662960781722     -0.367279883559
H      -0.425320725152     -1.375375438177      0.833689232483
H       3.598594690444     -0.423598591524     -1.643947473997`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.1)"
  backgroundColor="#333333"
/>

`bh9_3_39_ts_guess_2.xyz`
```
42
0 2
O       5.349226552218     -1.670855207382      0.225751777230
C       4.206937422045     -1.447237840687      0.063433745116
C       3.323319106552     -1.909511719215     -1.087217602528
C       1.832566581079     -1.836097387113     -0.782024622266
Cl      2.577275318905      1.535667895233      0.563089933070
C       1.117099601112      2.592485364919      0.189138437829
H       3.641999317035     -2.924909578324     -1.348999136794
H       1.554160042506     -0.795703018051     -0.598475501187
C       1.434219208034     -2.675539636247      0.426780742860
H       1.273926553371     -2.168154539920     -1.664046279453
C      -0.010030742215      1.702523106891     -0.226023216865
C      -1.056546703762      1.385539272336      0.550526635505
C      -0.052289807942     -2.554452308127      0.740711107194
H       2.019845165896     -2.345450590234      1.291040871721
H       1.698210794819     -3.724214864989      0.253785789945
N      -2.120948410396      0.611984172437      0.191585331840
H      -1.120791638329      1.766118159563      1.564659880606
H       0.054397837379      1.299189164192     -1.231609151487
C       1.522233010084      3.496260849832     -0.974037478049
C      -2.193068871604     -0.057249852678     -1.094987228977
H      -1.323063047705     -0.714342787481     -1.244288469086
C      -3.490191243240     -0.857511786156     -1.002236927654
H      -2.201203322106      0.670001523581     -1.912110526247
H      -4.336323328170     -0.225679572465     -1.284411451281
C      -3.571220966186     -1.211839533739      0.486226118676
H      -3.488772779110     -1.731930418890     -1.652149255897
C      -3.045709302407      0.048421697232      1.173821166203
H      -2.909684344458     -2.052984982636      0.703906894764
H      -4.576316988864     -1.476536480518      0.812362096348
H      -2.532056945408     -0.178015094011      2.111806213591
H      -3.860275271608      0.748034825808      1.395466721658
H       1.770474959659      2.907944403033     -1.857891647147
H       2.383594133756      4.111736436593     -0.714760310693
H       0.678049571472      4.145954101727     -1.216261715733
C       0.843186832955      3.425954157968      1.428649315588
H       0.641458462350      2.803411770358      2.299242986566
H      -0.020770720414      4.066866420861      1.237653369334
H       1.704632979633      4.051916203280      1.657908951884
H      -0.329941209245     -3.140280497288      1.619258927333
H      -0.658230065654     -2.904947521552     -0.100139482477
H      -0.317462955494     -1.510291597392      0.930120234239
H       3.588085213456     -1.256272710746     -1.925257245284
```

<MoleculeViewer 
  xyzData={`42
0 2
O       5.349226552218     -1.670855207382      0.225751777230
C       4.206937422045     -1.447237840687      0.063433745116
C       3.323319106552     -1.909511719215     -1.087217602528
C       1.832566581079     -1.836097387113     -0.782024622266
Cl      2.577275318905      1.535667895233      0.563089933070
C       1.117099601112      2.592485364919      0.189138437829
H       3.641999317035     -2.924909578324     -1.348999136794
H       1.554160042506     -0.795703018051     -0.598475501187
C       1.434219208034     -2.675539636247      0.426780742860
H       1.273926553371     -2.168154539920     -1.664046279453
C      -0.010030742215      1.702523106891     -0.226023216865
C      -1.056546703762      1.385539272336      0.550526635505
C      -0.052289807942     -2.554452308127      0.740711107194
H       2.019845165896     -2.345450590234      1.291040871721
H       1.698210794819     -3.724214864989      0.253785789945
N      -2.120948410396      0.611984172437      0.191585331840
H      -1.120791638329      1.766118159563      1.564659880606
H       0.054397837379      1.299189164192     -1.231609151487
C       1.522233010084      3.496260849832     -0.974037478049
C      -2.193068871604     -0.057249852678     -1.094987228977
H      -1.323063047705     -0.714342787481     -1.244288469086
C      -3.490191243240     -0.857511786156     -1.002236927654
H      -2.201203322106      0.670001523581     -1.912110526247
H      -4.336323328170     -0.225679572465     -1.284411451281
C      -3.571220966186     -1.211839533739      0.486226118676
H      -3.488772779110     -1.731930418890     -1.652149255897
C      -3.045709302407      0.048421697232      1.173821166203
H      -2.909684344458     -2.052984982636      0.703906894764
H      -4.576316988864     -1.476536480518      0.812362096348
H      -2.532056945408     -0.178015094011      2.111806213591
H      -3.860275271608      0.748034825808      1.395466721658
H       1.770474959659      2.907944403033     -1.857891647147
H       2.383594133756      4.111736436593     -0.714760310693
H       0.678049571472      4.145954101727     -1.216261715733
C       0.843186832955      3.425954157968      1.428649315588
H       0.641458462350      2.803411770358      2.299242986566
H      -0.020770720414      4.066866420861      1.237653369334
H       1.704632979633      4.051916203280      1.657908951884
H      -0.329941209245     -3.140280497288      1.619258927333
H      -0.658230065654     -2.904947521552     -0.100139482477
H      -0.317462955494     -1.510291597392      0.930120234239
H       3.588085213456     -1.256272710746     -1.925257245284`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.2)"
  backgroundColor="#333333"
/>

`bh9_3_39_ts_guess_3.xyz`
```
42
0 2
O       5.350842785424     -1.668558572547      0.324805936878
C       4.210020638707     -1.457204669205      0.130465085866
C       3.371398812445     -1.928131328203     -1.044508228565
C       1.875302720915     -1.850395693181     -0.793446048751
Cl      2.562407298686      1.536257051521      0.556448668964
C       1.101813861590      2.599010648248      0.169841589388
H       3.696884722578     -2.945914303372     -1.283686043676
H       1.593270009300     -0.808258683686     -0.629956463089
C       1.435787281636     -2.678704248592      0.405427356678
H       1.349265844537     -2.189887036773     -1.690261805112
C      -0.032135586857      1.712643205562     -0.231710923032
C      -1.058717775898      1.376913397099      0.562579297925
C      -0.056704482294     -2.547031736723      0.670160448991
H       1.993801287978     -2.344312229560      1.284677827587
H       1.699632440532     -3.729592825838      0.249054377779
N      -2.127415084188      0.607765392827      0.214469058158
H      -1.098788377413      1.737413808044      1.583957382248
H       0.009978575926      1.328098168640     -1.244393601941
C       1.517172090508      3.487358317050     -0.994814675966
C      -2.231578252436     -0.032411211903     -1.081881645459
H      -1.367258982514     -0.683770867521     -1.265316026176
C      -3.525909318829     -0.833289174762     -0.975877552897
H      -2.256827971166      0.713219236293     -1.879969296142
H      -4.376404044730     -0.196799076960     -1.225152233206
C      -3.574701858294     -1.218655144611      0.503175907254
H      -3.541515043244     -1.693249605731     -1.642502128147
C      -3.031792103075      0.025580306955      1.202546378165
H      -2.910611513107     -2.064045165955      0.687534135600
H      -4.571989929274     -1.490139278368      0.845153651135
H      -2.499597194695     -0.219239786874      2.123298208137
H      -3.839051259971      0.720802994857      1.454748355882
H       1.757598862464      2.888917915769     -1.872776568725
H       2.386657285440      4.091623112571     -0.737832277986
H       0.683207635522      4.147526211143     -1.242884644145
C       0.838516303100      3.440757905443      1.408901137083
H       0.634125396784      2.826206078117      2.283858004195
H      -0.018880433281      4.090173259920      1.219771415364
H       1.707495255009      4.059246516132      1.633022616783
H      -0.364576592073     -3.126742456182      1.541091582795
H      -0.636758554920     -2.899059558986     -0.186482791379
H      -0.320719634633     -1.500898041100      0.845445472692
H       3.666754883808     -1.283222829558     -1.876980941152
```

<MoleculeViewer 
  xyzData={`42
0 2
O       5.350842785424     -1.668558572547      0.324805936878
C       4.210020638707     -1.457204669205      0.130465085866
C       3.371398812445     -1.928131328203     -1.044508228565
C       1.875302720915     -1.850395693181     -0.793446048751
Cl      2.562407298686      1.536257051521      0.556448668964
C       1.101813861590      2.599010648248      0.169841589388
H       3.696884722578     -2.945914303372     -1.283686043676
H       1.593270009300     -0.808258683686     -0.629956463089
C       1.435787281636     -2.678704248592      0.405427356678
H       1.349265844537     -2.189887036773     -1.690261805112
C      -0.032135586857      1.712643205562     -0.231710923032
C      -1.058717775898      1.376913397099      0.562579297925
C      -0.056704482294     -2.547031736723      0.670160448991
H       1.993801287978     -2.344312229560      1.284677827587
H       1.699632440532     -3.729592825838      0.249054377779
N      -2.127415084188      0.607765392827      0.214469058158
H      -1.098788377413      1.737413808044      1.583957382248
H       0.009978575926      1.328098168640     -1.244393601941
C       1.517172090508      3.487358317050     -0.994814675966
C      -2.231578252436     -0.032411211903     -1.081881645459
H      -1.367258982514     -0.683770867521     -1.265316026176
C      -3.525909318829     -0.833289174762     -0.975877552897
H      -2.256827971166      0.713219236293     -1.879969296142
H      -4.376404044730     -0.196799076960     -1.225152233206
C      -3.574701858294     -1.218655144611      0.503175907254
H      -3.541515043244     -1.693249605731     -1.642502128147
C      -3.031792103075      0.025580306955      1.202546378165
H      -2.910611513107     -2.064045165955      0.687534135600
H      -4.571989929274     -1.490139278368      0.845153651135
H      -2.499597194695     -0.219239786874      2.123298208137
H      -3.839051259971      0.720802994857      1.454748355882
H       1.757598862464      2.888917915769     -1.872776568725
H       2.386657285440      4.091623112571     -0.737832277986
H       0.683207635522      4.147526211143     -1.242884644145
C       0.838516303100      3.440757905443      1.408901137083
H       0.634125396784      2.826206078117      2.283858004195
H      -0.018880433281      4.090173259920      1.219771415364
H       1.707495255009      4.059246516132      1.633022616783
H      -0.364576592073     -3.126742456182      1.541091582795
H      -0.636758554920     -2.899059558986     -0.186482791379
H      -0.320719634633     -1.500898041100      0.845445472692
H       3.666754883808     -1.283222829558     -1.876980941152`}
  caption="NEB法により緩和した経路から得られた遷移状態構造を求めるための初期構造 (No.3)"
  backgroundColor="#333333"
/>


#### Step 3

step3のオプションで、追加での説明を要するものを以下に示す。

- `"opt_method": ["rsirfo_block_bofill"]`は遷移状態構造の最適化向けのoptimizerを指定することを意味する。準ニュートン法であるRS-I-RFO法を使用する。今回は`-fc`で正確なHessianを計算するようにしているので、初期Hessianは正確なHessianを使用するようになっている。(Bofill法によるHessianの更新法を細かい点で変更している。具体的には、複数の座標変位や勾配変位を用いてHessianの更新を行う。)
- `"saddle_order": 1`は一次の鞍点を求めることを指定する。（step3のデフォルトでは一次の鞍点を指定する。それ以外の値の指定は、プログラムの使用目的上想定していないので、行わないことを勧める。）
- `"calc_exact_hess": 5`は5回の反復回数当たり1回正確なHessianを計算することを指定する。
- `"frequency_analysis": true`は収束条件を満たした後に基準振動解析を行うことを示す。（自前で実装しているため、あくまで目安として使用することを推奨する。各振動モードを`vibration_animation`内のxyzファイルで可視化できる。）UMAモデルから算出されるHessianは数値微分により求めているため、原子数Zが多いとZの二乗オーダーで計算コストが急増する。
- `"tight_convergence_criteria": true`は収束条件を厳しくすることを示す。（Gaussianのtightと同等）
- `"max_trust_radius": D`は一回の反復計算ごとの計算されるステップ幅の最大値をDÅ以下にすることを示す。デフォルトでは、`"saddle_order": 1`を指定すると0.1Åが指定される。
- `"detect_negative_eigenvalues": true`は、初めの計算時(ITR. 0)に、任意の次数の鞍点(遷移状態構造等)を求める際に、正確なへシアンから算出した固有値に１つも負の固有値がない場合、計算を打ち切るオプションである。

実行して得られた正確な遷移状態構造と思われる構造を以下に示す。

(実行して得られた正確な遷移状態構造は計算開始時に、`MultiOptPy-v1.20.0-rc.1/"work_dir"`ディレクトリ内に生成された新規ディレクトリ内の`bh9_3_39_ts_final_X.xyz`として保存されている。)

`bh9_3_39_ts_final_1.xyz`
```
42
OptimizedStructure
O      5.044599574177     -0.561158016502      0.412274846913
C      4.023669394792     -0.696671301245     -0.150286478681
C      3.511710355150     -1.888004259932     -0.929020606174
C      2.005522626411     -2.096089805634     -0.834525605901
Cl     2.541595965166      0.996384862712     -0.100632179296
C      1.015980756148      2.481429806173      0.049024623354
H      4.064318642155     -2.764443115992     -0.575019870080
H      1.495859928669     -1.217264005260     -1.232619964864
C      1.531253300716     -2.349058438382      0.591621439043
H      1.733161543935     -2.943026401980     -1.470374182892
C     -0.195908683147      1.781686250558     -0.329632558739
C     -1.091631965347      1.269193583076      0.543395689196
C      0.012638429484     -2.428798492104      0.678518243678
H      1.886731994941     -1.538143178862      1.233434784187
H      1.980862738978     -3.272747628285      0.969374864390
N     -2.193716132469      0.551169805335      0.216521939015
H     -0.962974564490      1.413693507286      1.610382321854
H     -0.339010401303      1.615643808319     -1.392058440162
C      1.500443246165      3.498004747927     -0.951995620548
C     -2.502250122733      0.153878256238     -1.145617102871
H     -1.685607899802     -0.454631856944     -1.556024993350
C     -3.794487233681     -0.649334775135     -1.001858962507
H     -2.617091381176      1.027391583631     -1.792527101049
H     -4.656254151688      0.018209399971     -1.065123901559
C     -3.689351773853     -1.233447963766      0.408933054939
H     -3.899346996082     -1.408499510422     -1.774827004738
C     -3.057396584071     -0.091411187260      1.198811012485
H     -3.017256268042     -2.094067340335      0.407626748472
H     -4.648105801079     -1.547668842914      0.818153539554
H     -2.475211544994     -0.439486613522      2.053805047487
H     -3.822474676568      0.601842622359      1.567131421214
H      1.477816271312      3.095883005250     -1.964911491870
H      2.518682275597      3.814597383006     -0.728866398230
H      0.848800004655      4.378390777323     -0.920479248216
C      1.163088540968      2.914455539998      1.482991292767
H      1.033656414210      2.082491057824      2.174567770799
H      0.421745549088      3.685064316860      1.720456575657
H      2.155482992393      3.330487763253      1.651859664448
H     -0.321716266237     -2.635473082678      1.696853694587
H     -0.378590553099     -3.218693643435      0.031729823747
H     -0.431966878037     -1.481721073824      0.362977184235
H      3.812729332789     -1.700057542683     -1.964043870295
```

<MoleculeViewer 
  xyzData={`42
OptimizedStructure
O      5.044599574177     -0.561158016502      0.412274846913
C      4.023669394792     -0.696671301245     -0.150286478681
C      3.511710355150     -1.888004259932     -0.929020606174
C      2.005522626411     -2.096089805634     -0.834525605901
Cl     2.541595965166      0.996384862712     -0.100632179296
C      1.015980756148      2.481429806173      0.049024623354
H      4.064318642155     -2.764443115992     -0.575019870080
H      1.495859928669     -1.217264005260     -1.232619964864
C      1.531253300716     -2.349058438382      0.591621439043
H      1.733161543935     -2.943026401980     -1.470374182892
C     -0.195908683147      1.781686250558     -0.329632558739
C     -1.091631965347      1.269193583076      0.543395689196
C      0.012638429484     -2.428798492104      0.678518243678
H      1.886731994941     -1.538143178862      1.233434784187
H      1.980862738978     -3.272747628285      0.969374864390
N     -2.193716132469      0.551169805335      0.216521939015
H     -0.962974564490      1.413693507286      1.610382321854
H     -0.339010401303      1.615643808319     -1.392058440162
C      1.500443246165      3.498004747927     -0.951995620548
C     -2.502250122733      0.153878256238     -1.145617102871
H     -1.685607899802     -0.454631856944     -1.556024993350
C     -3.794487233681     -0.649334775135     -1.001858962507
H     -2.617091381176      1.027391583631     -1.792527101049
H     -4.656254151688      0.018209399971     -1.065123901559
C     -3.689351773853     -1.233447963766      0.408933054939
H     -3.899346996082     -1.408499510422     -1.774827004738
C     -3.057396584071     -0.091411187260      1.198811012485
H     -3.017256268042     -2.094067340335      0.407626748472
H     -4.648105801079     -1.547668842914      0.818153539554
H     -2.475211544994     -0.439486613522      2.053805047487
H     -3.822474676568      0.601842622359      1.567131421214
H      1.477816271312      3.095883005250     -1.964911491870
H      2.518682275597      3.814597383006     -0.728866398230
H      0.848800004655      4.378390777323     -0.920479248216
C      1.163088540968      2.914455539998      1.482991292767
H      1.033656414210      2.082491057824      2.174567770799
H      0.421745549088      3.685064316860      1.720456575657
H      2.155482992393      3.330487763253      1.651859664448
H     -0.321716266237     -2.635473082678      1.696853694587
H     -0.378590553099     -3.218693643435      0.031729823747
H     -0.431966878037     -1.481721073824      0.362977184235
H      3.812729332789     -1.700057542683     -1.964043870295`}
  caption="遷移状態構造 (No.1)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                     -566.2674             18.8701             28.9701
Reduced mass [au]                  12.1704              4.3512              3.9770
Force const [Dyne/A]               -2.2993              0.0009              0.0020
Char temp [K]                       0.0000             27.1499             41.6816
Normal mode                   x         y         z            x         y         z            x         y         z     
       O                -0.03383    0.02477   -0.00695    0.02442    0.00075   -0.11683   -0.05940   -0.08559    0.06470
       C                -0.04559    0.06558    0.00879   -0.00910   -0.00352   -0.05501   -0.03803   -0.01410    0.00875
       C                -0.01670    0.03627    0.00382   -0.05239   -0.00933   -0.01807   -0.06009    0.04971   -0.07327
       C                -0.00510    0.00086   -0.00039   -0.04984    0.00222    0.04511   -0.05882    0.05015   -0.03322
      Cl                 0.08534   -0.09215   -0.00669    0.00049    0.00187   -0.00103    0.00995    0.02602    0.02177
       C                -0.11303    0.10101    0.00520    0.00266    0.00086    0.02937    0.00689    0.02294   -0.00755
       H                 0.01254    0.06867    0.03021   -0.04412   -0.00883   -0.02977   -0.05238    0.01879   -0.16210
       H                -0.01781   -0.00820   -0.00493   -0.06006    0.00161    0.05658   -0.06955    0.07210    0.02915
       C                -0.00186   -0.00099    0.00048    0.00518    0.01988    0.06647   -0.00909   -0.01875   -0.02901
       H                 0.00957   -0.00493    0.00130   -0.08136   -0.00246    0.06475   -0.08300    0.08307   -0.06659
       C                -0.00265    0.02075    0.00250    0.00545    0.00638    0.01024    0.01502    0.00710   -0.00607
       C                -0.00846   -0.00004    0.00706   -0.00860    0.00612   -0.00454    0.01032    0.01665   -0.00565
       C                -0.00111   -0.00083    0.00067    0.00840    0.02276    0.12534   -0.00566   -0.02617    0.02041
       H                -0.00441   -0.00177    0.00248    0.03139    0.02689    0.04298    0.01100   -0.04765   -0.00311
       H                -0.00097   -0.00127   -0.00134    0.01815    0.02349    0.05993    0.00681   -0.03465   -0.08705
       N                 0.00338   -0.00738    0.00075   -0.00232    0.00444   -0.02348    0.02424   -0.00637   -0.00299
       H                -0.01719    0.01220    0.00535   -0.02732    0.00752   -0.00244   -0.00568    0.04397   -0.00740
       H                -0.00665    0.01965    0.00219    0.02005    0.01135    0.00751    0.02929   -0.01774   -0.00417
       C                -0.00306    0.00919   -0.00598    0.00643    0.02196    0.05264    0.00691    0.01066   -0.02013
       C                -0.00062   -0.00112   -0.00037    0.03664   -0.01650   -0.02636    0.05207   -0.05104    0.00376
       H                -0.00254   -0.00094   -0.00297    0.05439   -0.01309    0.00369    0.06758   -0.05190    0.03596
       C                -0.00086   -0.00036   -0.00029    0.04145   -0.02826   -0.04951    0.05988   -0.06379    0.00533
       H                 0.00129    0.00246    0.00422    0.04379   -0.02681   -0.04148    0.05077   -0.07221   -0.02468
       H                -0.00053   -0.00006   -0.00027    0.03596   -0.03833   -0.08089    0.05211   -0.07787   -0.03676
       C                -0.00132   -0.00097   -0.00033    0.01065   -0.00885   -0.03918    0.03671   -0.01357    0.02798
       H                -0.00086    0.00003   -0.00057    0.06987   -0.03944   -0.04240    0.08667   -0.09233    0.02970
       C                -0.00083   -0.00194   -0.00075   -0.02079    0.00756   -0.03763    0.01028    0.01950    0.00133
       H                -0.00153   -0.00127   -0.00035    0.01894   -0.00238   -0.01053    0.04385   -0.00786    0.07190
       H                -0.00150   -0.00067   -0.00071    0.00308   -0.01278   -0.05992    0.03093   -0.00746    0.01915
       H                -0.00195    0.00049    0.00068   -0.03893    0.02421   -0.01844   -0.00381    0.05441    0.02522
       H                 0.00134    0.00265   -0.00500   -0.03712    0.00433   -0.06560   -0.00361    0.02502   -0.03777
       H                 0.00396   -0.01443    0.00242    0.00923    0.04363    0.04399    0.01635   -0.00539   -0.01398
       H                 0.00894   -0.03822    0.01084    0.00594    0.01671    0.06247    0.00333    0.02104   -0.01832
       H                 0.05674    0.06032   -0.06125    0.00670    0.02155    0.06946    0.00094    0.00687   -0.03839
       C                -0.01150    0.00822    0.00399   -0.00314   -0.03019    0.03916   -0.00733    0.04652   -0.01333
       H                 0.00923   -0.01901   -0.02269   -0.00701   -0.04549    0.02011   -0.00760    0.05644   -0.00148
       H                 0.01894    0.01496    0.09682   -0.00332   -0.03457    0.05313   -0.01411    0.04559   -0.03121
       H                 0.00378   -0.01567   -0.02365   -0.00365   -0.03431    0.05235   -0.01147    0.05583   -0.01181
       H                -0.00063   -0.00139    0.00055    0.04627    0.04046    0.14127    0.03024   -0.07741    0.02168
       H                -0.00084   -0.00059    0.00020   -0.01619    0.01185    0.15347   -0.02679    0.00538   -0.00544
       H                -0.00029    0.00010    0.00247   -0.00295    0.01744    0.12507   -0.01848   -0.01140    0.08298
       H                -0.00734    0.02785    0.00552   -0.09240   -0.02493   -0.03261   -0.09976    0.13276   -0.06940
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。

`bh9_3_39_ts_final_2.xyz`
```
42
OptimizedStructure
O      5.229442088510     -1.090959015416     -0.549908526446
C      4.131796879891     -1.398632882858     -0.260464370282
C      3.084312001852     -2.034060001088     -1.159522752646
C      1.655641189108     -1.900234703432     -0.654273437539
Cl     2.724672144268      1.578799233074      0.193600177311
C      1.160994580326      2.581988082560      0.153290156432
H      3.379302183105     -3.087955128896     -1.214825590130
H      1.384054491011     -0.842483032353     -0.619554969466
C      1.433102073967     -2.514729590034      0.721173619920
H      0.988941402062     -2.377428672126     -1.380272498358
C      0.061669344064      1.683917365002     -0.301408544533
C     -0.981571760005      1.313799783825      0.457387899372
C     -0.018567469609     -2.394918670380      1.165765077567
H      2.085958087568     -2.013488708414      1.440075285009
H      1.734051677982     -3.567673349249      0.708494929698
N     -2.010175464595      0.513140918110      0.069760510695
H     -1.065592976518      1.663022365206      1.480751658942
H      0.138111596287      1.334675729216     -1.325448045494
C      1.415544662098      3.696823090943     -0.852124927534
C     -2.051267313437     -0.142123981656     -1.223061307568
H     -1.193070591321     -0.817711448575     -1.339524926228
C     -3.375443937517     -0.903674241658     -1.193286071821
H     -2.006795186871      0.589312576563     -2.034910020989
H     -4.181795995772     -0.257917743206     -1.546971380426
C     -3.569609863649     -1.215919030945      0.292611585786
H     -3.358119212177     -1.794091541330     -1.819563069627
C     -3.046941384110      0.043344897072      0.979217072062
H     -2.954233722764     -2.070868065763      0.577494148533
H     -4.603179430097     -1.437611302400      0.553719743668
H     -2.634268192159     -0.162783837031      1.969183928392
H     -3.842762448796      0.788711629346      1.093331767732
H      1.581128329799      3.286821709985     -1.847798102819
H      2.287905714298      4.284712526791     -0.567781483292
H      0.540385974623      4.349086016419     -0.886671587619
C      0.990930717683      3.141727056438      1.554628869994
H      0.908396660657      2.346277880678      2.293950755339
H      0.095303381092      3.765316301312      1.595906064669
H      1.852077148988      3.755840113696      1.813151965204
H     -0.171841358489     -2.813367057299      2.161601873462
H     -0.680871917827     -2.924682275571      0.475667376614
H     -0.327233107431     -1.346786781065      1.185479584612
H      3.209619003906     -1.607216215490     -2.158872438196
```

<MoleculeViewer 
  xyzData={`42
OptimizedStructure
O      5.229442088510     -1.090959015416     -0.549908526446
C      4.131796879891     -1.398632882858     -0.260464370282
C      3.084312001852     -2.034060001088     -1.159522752646
C      1.655641189108     -1.900234703432     -0.654273437539
Cl     2.724672144268      1.578799233074      0.193600177311
C      1.160994580326      2.581988082560      0.153290156432
H      3.379302183105     -3.087955128896     -1.214825590130
H      1.384054491011     -0.842483032353     -0.619554969466
C      1.433102073967     -2.514729590034      0.721173619920
H      0.988941402062     -2.377428672126     -1.380272498358
C      0.061669344064      1.683917365002     -0.301408544533
C     -0.981571760005      1.313799783825      0.457387899372
C     -0.018567469609     -2.394918670380      1.165765077567
H      2.085958087568     -2.013488708414      1.440075285009
H      1.734051677982     -3.567673349249      0.708494929698
N     -2.010175464595      0.513140918110      0.069760510695
H     -1.065592976518      1.663022365206      1.480751658942
H      0.138111596287      1.334675729216     -1.325448045494
C      1.415544662098      3.696823090943     -0.852124927534
C     -2.051267313437     -0.142123981656     -1.223061307568
H     -1.193070591321     -0.817711448575     -1.339524926228
C     -3.375443937517     -0.903674241658     -1.193286071821
H     -2.006795186871      0.589312576563     -2.034910020989
H     -4.181795995772     -0.257917743206     -1.546971380426
C     -3.569609863649     -1.215919030945      0.292611585786
H     -3.358119212177     -1.794091541330     -1.819563069627
C     -3.046941384110      0.043344897072      0.979217072062
H     -2.954233722764     -2.070868065763      0.577494148533
H     -4.603179430097     -1.437611302400      0.553719743668
H     -2.634268192159     -0.162783837031      1.969183928392
H     -3.842762448796      0.788711629346      1.093331767732
H      1.581128329799      3.286821709985     -1.847798102819
H      2.287905714298      4.284712526791     -0.567781483292
H      0.540385974623      4.349086016419     -0.886671587619
C      0.990930717683      3.141727056438      1.554628869994
H      0.908396660657      2.346277880678      2.293950755339
H      0.095303381092      3.765316301312      1.595906064669
H      1.852077148988      3.755840113696      1.813151965204
H     -0.171841358489     -2.813367057299      2.161601873462
H     -0.680871917827     -2.924682275571      0.475667376614
H     -0.327233107431     -1.346786781065      1.185479584612
H      3.209619003906     -1.607216215490     -2.158872438196`}
  caption="遷移状態構造 (No.2)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                      -16.9278             17.2198             27.3550
Reduced mass [au]                   4.6698              4.2401              4.3751
Force const [Dyne/A]               -0.0008              0.0007              0.0019
Char temp [K]                       0.0000             24.7754             39.3578
Normal mode                   x         y         z            x         y         z            x         y         z     
       O                 0.00189    0.01663   -0.10675   -0.02578   -0.00218   -0.02340   -0.04143   -0.02189   -0.06416
       C                 0.01814   -0.00035   -0.06320   -0.01926   -0.00185    0.00175   -0.03911   -0.00628   -0.03897
       C                 0.00489   -0.05376   -0.00965   -0.03584   -0.01319    0.02918   -0.08016    0.04332   -0.02638
       C                 0.01154   -0.01954    0.00131   -0.02684   -0.00610    0.05273   -0.05847    0.02820    0.03756
      Cl                -0.01974   -0.03954    0.05337    0.01802    0.02114   -0.07830    0.01373    0.03301    0.05734
       C                -0.00293   -0.01577    0.01978    0.00344    0.00025    0.01463    0.00605    0.02150   -0.00248
       H                 0.00117   -0.05835    0.05731   -0.03730   -0.01408    0.03842   -0.08856    0.04448   -0.09250
       H                 0.01103   -0.01749   -0.06669   -0.02855   -0.00594    0.03794   -0.04853    0.02863    0.10335
       C                 0.03123    0.07505    0.04677   -0.00176    0.01841    0.06772   -0.01113   -0.04182    0.01383
       H                 0.00204   -0.06980    0.04312   -0.03885   -0.02069    0.07332   -0.09080    0.07144    0.03865
       C                -0.00793   -0.00259    0.00517    0.00467    0.00543    0.00073    0.02260    0.00216   -0.00247
       C                -0.02707    0.01770   -0.01179    0.01386   -0.02109    0.00029    0.02735   -0.01557   -0.00401
       C                 0.03538    0.09477    0.05491    0.00317    0.01359    0.08501    0.00615   -0.05299    0.07385
       H                 0.03528    0.13064    0.00422    0.00393    0.03797    0.04890    0.02003   -0.08464    0.01540
       H                 0.03935    0.07651    0.11661    0.00749    0.02086    0.08404   -0.02050   -0.04369   -0.05184
       N                -0.03419    0.03272   -0.02710    0.01321   -0.01425   -0.01296    0.05083   -0.04554    0.00004
       H                -0.04028    0.02513   -0.01545    0.02225   -0.05094    0.01121    0.01443   -0.00885   -0.00730
       H                 0.00471   -0.00825    0.00803   -0.00422    0.03680   -0.01061    0.03670   -0.00838    0.00215
       C                 0.03111   -0.02509    0.01803   -0.04028    0.05375    0.06265    0.01989   -0.00351   -0.02643
       C                 0.00198    0.00115   -0.01262    0.00574    0.01873   -0.02936    0.04475   -0.02813   -0.00829
       H                 0.01409    0.01007    0.02119    0.00146    0.01643   -0.04930    0.03588   -0.03704   -0.01546
       C                 0.01388   -0.01824   -0.01987    0.00159    0.02595   -0.04403    0.03329   -0.01031   -0.02259
       H                 0.00805   -0.01770   -0.02887    0.00722    0.03895   -0.01094    0.05582   -0.01793    0.00106
       H                 0.00739   -0.03330   -0.03265    0.00344    0.04190   -0.01914    0.04691   -0.00062   -0.03587
       C                 0.00696   -0.00835   -0.01889    0.01014   -0.01718   -0.05210    0.00658   -0.00257   -0.02434
       H                 0.03366   -0.02335   -0.01208   -0.00814    0.04466   -0.07085    0.02913   -0.01261   -0.01942
       C                -0.02231    0.00742   -0.02458    0.02115   -0.04045   -0.01745    0.01659   -0.00844   -0.02232
       H                 0.02046    0.00531   -0.00694    0.00774   -0.02890   -0.08209   -0.01091   -0.01089   -0.01144
       H                 0.00907   -0.02567   -0.02519    0.01094   -0.01999   -0.05138   -0.00088    0.01489   -0.03912
       H                -0.01667    0.02018   -0.02427    0.03023   -0.07384   -0.02803   -0.01389   -0.00700   -0.00934
       H                -0.03949   -0.01124   -0.02625    0.02477   -0.04156    0.01458    0.02963    0.01057   -0.05123
       H                 0.04287   -0.03283    0.02318   -0.06157    0.10517    0.03796    0.04366   -0.02861   -0.01215
       H                 0.03456   -0.03612    0.03030   -0.04104    0.05244    0.06785    0.00992    0.00980   -0.02355
       H                 0.04117   -0.01260   -0.00106   -0.05078    0.04259    0.11883    0.01633   -0.01013   -0.06216
       C                -0.01997   -0.00516    0.01350    0.03272   -0.07183    0.04692   -0.02746    0.05758   -0.02097
       H                -0.04580    0.00038    0.01660    0.06015   -0.11050    0.00847   -0.03247    0.07739   -0.00030
       H                -0.01112    0.00886   -0.00635    0.02703   -0.08356    0.10133   -0.03573    0.04799   -0.05586
       H                -0.01520   -0.01697    0.02566    0.03224   -0.07494    0.05581   -0.03949    0.07442   -0.02084
       H                 0.04953    0.15864    0.08395    0.02129    0.03721    0.09767    0.04136   -0.09380    0.06197
       H                 0.03096    0.04552    0.09698   -0.00025   -0.01102    0.10737   -0.02225   -0.02087    0.07655
       H                 0.02995    0.09430   -0.00905   -0.00792    0.01066    0.06197    0.01114   -0.05240    0.12822
       H                -0.00823   -0.12102   -0.04008   -0.05370   -0.02678    0.02115   -0.11783    0.09349   -0.00967
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。

`bh9_3_39_ts_final_3.xyz`
```
42
OptimizedStructure
O      5.231098707993     -1.087631841180     -0.540316052916
C      4.133360286099     -1.395563783019     -0.251499437783
C      3.087617292313     -2.034253463279     -1.150273422576
C      1.658173867755     -1.900432258959     -0.647212734817
Cl     2.723019907130      1.581751467581      0.192976017578
C      1.158496824444      2.583424197722      0.148020567639
H      3.383635784719     -3.088017691020     -1.202488344133
H      1.385587091517     -0.842841836622     -0.615555155852
C      1.434412082663     -2.511604577911      0.729515667458
H      0.992844833828     -2.380088343744     -1.372846759591
C      0.060559531308      1.683172240843     -0.305716666142
C     -0.983313265020      1.314103708413      0.452722381855
C     -0.017935730822     -2.391957780333      1.171931053653
H      2.085892715326     -2.007939849443      1.447970999346
H      1.736318766839     -3.564306892684      0.719920355532
N     -2.010700278173      0.511500847273      0.065891924821
H     -1.068951088637      1.665932909917      1.475058859650
H      0.138620151628      1.331313408037     -1.328737771085
C      1.413338626658      3.695834253464     -0.860003138925
C     -2.049574206577     -0.147169967501     -1.225266410472
H     -1.190632453980     -0.822294944506     -1.338881616790
C     -3.373113020291     -0.909816954194     -1.195179763436
H     -2.004721587989      0.582186158433     -2.038963941851
H     -4.179585549999     -0.265706779012     -1.551582668755
C     -3.568898476131     -1.218340689617      0.291282498400
H     -3.354201128880     -1.801856107124     -1.819098484556
C     -3.048219512437      0.043180796915      0.975249615501
H     -2.953131191213     -2.071994092412      0.579188725769
H     -4.602604294467     -1.440264762698      0.551653819049
H     -2.636636055825     -0.159984430367      1.966282292937
H     -3.844842047772      0.788141647458      1.086387041651
H      1.580567020658      3.283359038753     -1.854378866132
H      2.284807476673      4.285254605203     -0.576093279719
H      0.537641398677      4.347217029025     -0.897390584832
C      0.986135495315      3.146700339059      1.547660303866
H      0.903368034071      2.353128420649      2.288970654275
H      0.089896692456      3.769589157363      1.586147827311
H      1.846398614244      3.762267577376      1.805664735406
H     -0.172119375375     -2.807993979350      2.168637435951
H     -0.678877177329     -2.924078624238      0.482340293337
H     -0.327562737701     -1.344056051551      1.188565379560
H      3.213827976303     -1.609862102718     -2.150553350181
```

<MoleculeViewer 
  xyzData={`42
OptimizedStructure
O      5.231098707993     -1.087631841180     -0.540316052916
C      4.133360286099     -1.395563783019     -0.251499437783
C      3.087617292313     -2.034253463279     -1.150273422576
C      1.658173867755     -1.900432258959     -0.647212734817
Cl     2.723019907130      1.581751467581      0.192976017578
C      1.158496824444      2.583424197722      0.148020567639
H      3.383635784719     -3.088017691020     -1.202488344133
H      1.385587091517     -0.842841836622     -0.615555155852
C      1.434412082663     -2.511604577911      0.729515667458
H      0.992844833828     -2.380088343744     -1.372846759591
C      0.060559531308      1.683172240843     -0.305716666142
C     -0.983313265020      1.314103708413      0.452722381855
C     -0.017935730822     -2.391957780333      1.171931053653
H      2.085892715326     -2.007939849443      1.447970999346
H      1.736318766839     -3.564306892684      0.719920355532
N     -2.010700278173      0.511500847273      0.065891924821
H     -1.068951088637      1.665932909917      1.475058859650
H      0.138620151628      1.331313408037     -1.328737771085
C      1.413338626658      3.695834253464     -0.860003138925
C     -2.049574206577     -0.147169967501     -1.225266410472
H     -1.190632453980     -0.822294944506     -1.338881616790
C     -3.373113020291     -0.909816954194     -1.195179763436
H     -2.004721587989      0.582186158433     -2.038963941851
H     -4.179585549999     -0.265706779012     -1.551582668755
C     -3.568898476131     -1.218340689617      0.291282498400
H     -3.354201128880     -1.801856107124     -1.819098484556
C     -3.048219512437      0.043180796915      0.975249615501
H     -2.953131191213     -2.071994092412      0.579188725769
H     -4.602604294467     -1.440264762698      0.551653819049
H     -2.636636055825     -0.159984430367      1.966282292937
H     -3.844842047772      0.788141647458      1.086387041651
H      1.580567020658      3.283359038753     -1.854378866132
H      2.284807476673      4.285254605203     -0.576093279719
H      0.537641398677      4.347217029025     -0.897390584832
C      0.986135495315      3.146700339059      1.547660303866
H      0.903368034071      2.353128420649      2.288970654275
H      0.089896692456      3.769589157363      1.586147827311
H      1.846398614244      3.762267577376      1.805664735406
H     -0.172119375375     -2.807993979350      2.168637435951
H     -0.678877177329     -2.924078624238      0.482340293337
H     -0.327562737701     -1.344056051551      1.188565379560
H      3.213827976303     -1.609862102718     -2.150553350181`}
  caption="遷移状態構造 (No.3)"
  backgroundColor="#333333"
/>


停留点に収束した構造が得られた。`-freq`オプションにより生成された`normal_modes.txt`や`vibration_animation`ディレクトリ内の振動モードのアニメーションを確認した。

以下に`-freq`オプションで生成された`normal_modes.txt`の一部を示す。
```
Mode                                 0                   1                   2
Freq [cm^-1]                      -17.4741             17.0145             27.4290
Reduced mass [au]                   4.7116              4.2176              4.3741
Force const [Dyne/A]               -0.0008              0.0007              0.0019
Char temp [K]                       0.0000             24.4801             39.4643
Normal mode                   x         y         z            x         y         z            x         y         z     
       O                -0.00153   -0.01818    0.10685   -0.02605   -0.00277   -0.02570    0.04117    0.02147    0.06363
       C                -0.01818    0.00017    0.06319   -0.01945   -0.00196    0.00031    0.03904    0.00559    0.03879
       C                -0.00516    0.05335    0.00989   -0.03669   -0.01353    0.02869    0.07977   -0.04368    0.02662
       C                -0.01165    0.01948   -0.00082   -0.02740   -0.00592    0.05302    0.05835   -0.02832   -0.03693
      Cl                 0.01973    0.03991   -0.05485    0.01786    0.02073   -0.07681   -0.01363   -0.03288   -0.05798
       C                 0.00269    0.01598   -0.01957    0.00340    0.00038    0.01490   -0.00615   -0.02135    0.00284
       H                -0.00152    0.05772   -0.05687   -0.03835   -0.01447    0.03828    0.08776   -0.04474    0.09266
       H                -0.01114    0.01764    0.06673   -0.02900   -0.00575    0.03772    0.04876   -0.02885   -0.10282
       C                -0.03092   -0.07457   -0.04572   -0.00153    0.01959    0.06853    0.01126    0.04202   -0.01326
       H                -0.00234    0.06935   -0.04238   -0.03992   -0.02090    0.07436    0.09035   -0.07149   -0.03755
       C                 0.00765    0.00305   -0.00525    0.00474    0.00554    0.00073   -0.02273   -0.00191    0.00251
       C                 0.02713   -0.01790    0.01188    0.01378   -0.02098    0.00012   -0.02755    0.01571    0.00385
       C                -0.03494   -0.09406   -0.05355    0.00360    0.01488    0.08654   -0.00571    0.05373   -0.07275
       H                -0.03480   -0.12971   -0.00343    0.00448    0.03971    0.04895   -0.01942    0.08464   -0.01532
       H                -0.03898   -0.07622   -0.11511    0.00786    0.02213    0.08542    0.02009    0.04393    0.05245
       N                 0.03418   -0.03271    0.02702    0.01326   -0.01424   -0.01334   -0.05106    0.04575   -0.00057
       H                 0.04066   -0.02607    0.01585    0.02190   -0.05070    0.01107   -0.01470    0.00880    0.00724
       H                -0.00529    0.00949   -0.00845   -0.00387    0.03677   -0.01065   -0.03680    0.00887   -0.00224
       C                -0.03205    0.02631   -0.01694   -0.03969    0.05355    0.06246   -0.02042    0.00435    0.02731
       C                -0.00218   -0.00060    0.01211    0.00623    0.01844   -0.02972   -0.04454    0.02825    0.00786
       H                -0.01418   -0.00946   -0.02217    0.00213    0.01621   -0.04930   -0.03547    0.03741    0.01525
       C                -0.01402    0.01865    0.01921    0.00223    0.02538   -0.04461   -0.03286    0.01010    0.02204
       H                -0.00854    0.01867    0.02864    0.00776    0.03856   -0.01147   -0.05563    0.01795   -0.00154
       H                -0.00772    0.03388    0.03256    0.00399    0.04122   -0.01998   -0.04664    0.00022    0.03529
       C                -0.00665    0.00789    0.01814    0.01061   -0.01765   -0.05256   -0.00619    0.00224    0.02380
       H                -0.03388    0.02408    0.01087   -0.00719    0.04395   -0.07140   -0.02838    0.01244    0.01881
       C                 0.02271   -0.00820    0.02452    0.02122   -0.04066   -0.01785   -0.01660    0.00819    0.02191
       H                -0.01998   -0.00594    0.00554    0.00837   -0.02931   -0.08233    0.01151    0.01069    0.01089
       H                -0.00869    0.02498    0.02455    0.01141   -0.02064   -0.05201    0.00130   -0.01548    0.03854
       H                 0.01750   -0.02156    0.02395    0.03027   -0.07393   -0.02827    0.01402    0.00673    0.00892
       H                 0.03980    0.01029    0.02697    0.02462   -0.04186    0.01406   -0.02992   -0.01106    0.05101
       H                -0.04412    0.03504   -0.02259   -0.06055    0.10452    0.03783   -0.04431    0.03001    0.01266
       H                -0.03553    0.03727   -0.02902   -0.04048    0.05220    0.06790   -0.01048   -0.00898    0.02467
       H                -0.04230    0.01368    0.00318   -0.05011    0.04269    0.11796   -0.01702    0.01094    0.06359
       C                 0.02029    0.00403   -0.01262    0.03204   -0.07103    0.04711    0.02765   -0.05823    0.02185
       H                 0.04660   -0.00223   -0.01640    0.05908   -0.10947    0.00907    0.03289   -0.07857    0.00075
       H                 0.01135   -0.01012    0.00828    0.02633   -0.08252    0.10083    0.03585   -0.04860    0.05731
       H                 0.01554    0.01569   -0.02462    0.03149   -0.07411    0.05621    0.03972   -0.07518    0.02197
       H                -0.04877   -0.15741   -0.08215    0.02232    0.03925    0.09955   -0.04075    0.09483   -0.06086
       H                -0.03065   -0.04531   -0.09528   -0.00010   -0.01032    0.10972    0.02222    0.02178   -0.07494
       H                -0.02955   -0.09340    0.00984   -0.00765    0.01184    0.06289   -0.01012    0.05315   -0.12723
       H                 0.00781    0.12041    0.04004   -0.05506   -0.02769    0.02037    0.11733   -0.09387    0.01006
       
(...snip...)
```
その結果、虚振動が１つであることが確認できた。つまりこの構造は遷移状態構造である。


次に、`vibration_animation`内の虚振動を示す分子振動が示されたxyzファイル(`mode_1_XXXi_wave_number.xyz`)をAvogadroで確認すると、求められた遷移状態構造の中に、想定される反応系と生成系をつなぐ方向に振動している構造が存在することを確認できた。


## 終わりに
　
　自作ライブラリで、UMAモデルのニューラルネットワークポテンシャル(NNP, `uma-s-1p1`)を用いて、BH9データセットの3. Halogen atom transfer, No. 39の反応のある1つの遷移状態構造を算出する手順を説明した。



## 参考
- https://github.com/ss0832/MultiOptPy (自作ライブラリMultiOptPyのレポジトリ)
- https://avogadro.cc/ (Avogadro、分子構造可視化ツール)
- https://ai.meta.com/blog/meta-fair-science-new-open-source-releases/ (UMAの公開に関する記事)
- https://github.com/facebookresearch/fairchem (FAIR Chemistryの提供するGitHubのレポジトリ)
- https://fair-chem.github.io/ (同上のレポジトリの内容に関して説明したサイト)
- https://huggingface.co/facebook/UMA (NNPの配布サイト, Hugging Faceへのアカウント登録と配布元の使用許諾が必要である。)
- arXiv preprint arXiv:2505.08762 (2025). (プレプリント)
- _The Journal of Chemical Physics_ 2010, 132, 241102.
- _The Journal of Chemical Physics_ 1991, 94, 751–760.
- In _Classical and Quantum Dynamics in Condensed Phase Simulations_; WORLD SCIENTIFIC: LERICI, Villa Marigola, 1998; pp 385–404.
- _The Journal of Chemical Physics_, 2020, 153, 024109.
- _The Journal of Chemical Physics_, 2022, 144, 214108.
- _J. Phys. Chem. A_ 2019, 123, 3761−3781 http://dx.doi.org/10.1021/acs.jpca.9b01546 (MOBH35のデータセットについて)

